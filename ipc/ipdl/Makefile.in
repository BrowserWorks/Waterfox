# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

GARBAGE_DIRS += _ipdlheaders
GARBAGE += ipdl_lextab.py ipdl_yacctab.py $(wildcard *.pyc $(srcdir)/ipdl/*.pyc $(srcdir)/ipdl/cxx/*.pyc)

ifdef COMPILE_ENVIRONMENT

# This file is generated by the moz.build backend.
include ipdlsrcs.mk

include $(topsrcdir)/config/rules.mk


# NB: the IPDL compiler manages .ipdl-->.h/.cpp dependencies itself,
# which is why we don't have explicit .h/.cpp targets here
ipdl: $(ALL_IPDLSRCS)
	$(PYTHON) $(topsrcdir)/config/pythonpath.py \
	  $(PLY_INCLUDE) \
	  $(srcdir)/ipdl.py \
	  --sync-msg-list=$(srcdir)/sync-messages.ini \
	  --msg-metadata=$(srcdir)/message-metadata.ini \
	  --outheaders-dir=_ipdlheaders \
	  --outcpp-dir=. \
	  $(IPDLDIRS:%=-I%) \
	  $^

.PHONY: ipdl

export:: ipdl
endif

