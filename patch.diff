diff --git a/addon-sdk/source/python-lib/cuddlefish/_version.py.orig b/addon-sdk/source/python-lib/cuddlefish/_version.py.orig
deleted file mode 100644
index f1a051a..0000000
--- a/addon-sdk/source/python-lib/cuddlefish/_version.py.orig
+++ /dev/null
@@ -1,174 +0,0 @@
-
-# This file helps to compute a version number in source trees obtained from
-# git-archive tarball (such as those provided by githubs download-from-tag
-# feature). Distribution tarballs (build by setup.py sdist) and build
-# directories (produced by setup.py build) will contain a much shorter file
-# that just contains the computed version number.
-
-# This file is released into the public domain. Generated by versioneer-0.6
-# (https://github.com/warner/python-versioneer)
-
-# these strings will be replaced by git during git-archive
-git_refnames = " (release)"
-git_full = "a9d9c1d156223c31ae83f395a0004fbe5500ef3e"
-
-
-import subprocess
-
-def run_command(args, cwd=None, verbose=False):
-    try:
-        # remember shell=False, so use git.cmd on windows, not just git
-        p = subprocess.Popen(args, stdout=subprocess.PIPE, cwd=cwd)
-    except EnvironmentError, e:
-        if verbose:
-            print "unable to run %s" % args[0]
-            print e
-        return None
-    stdout = p.communicate()[0].strip()
-    if p.returncode != 0:
-        if verbose:
-            print "unable to run %s (error)" % args[0]
-        return None
-    return stdout
-
-
-import sys
-import re
-import os.path
-
-def get_expanded_variables(versionfile_source):
-    """
-    the code embedded in _version.py can just fetch the value of these
-    variables. When used from setup.py, we don't want to import
-    _version.py, so we do it with a regexp instead. This function is not
-    used from _version.py.
-    """
-    variables = {}
-    try:
-        for line in open(versionfile_source,"r").readlines():
-            if line.strip().startswith("git_refnames ="):
-                mo = re.search(r'=\s*"(.*)"', line)
-                if mo:
-                    variables["refnames"] = mo.group(1)
-            if line.strip().startswith("git_full ="):
-                mo = re.search(r'=\s*"(.*)"', line)
-                if mo:
-                    variables["full"] = mo.group(1)
-    except EnvironmentError:
-        pass
-    return variables
-
-def versions_from_expanded_variables(variables, tag_prefix):
-    refnames = variables["refnames"].strip()
-    if refnames.startswith("$Format"):
-        return {} # unexpanded, so not in an unpacked git-archive tarball
-    refs = set([r.strip() for r in refnames.strip("()").split(",")])
-    for ref in list(refs):
-        if not re.search(r'\d', ref):
-            refs.discard(ref)
-            # Assume all version tags have a digit. git's %d expansion
-            # behaves like git log --decorate=short and strips out the
-            # refs/heads/ and refs/tags/ prefixes that would let us
-            # distinguish between branches and tags. By ignoring refnames
-            # without digits, we filter out many common branch names like
-            # "release" and "stabilization", as well as "HEAD" and "master".
-    for ref in sorted(refs):
-        # sorting will prefer e.g. "2.0" over "2.0rc1"
-        if ref.startswith(tag_prefix):
-            r = ref[len(tag_prefix):]
-            return { "version": r,
-                     "full": variables["full"].strip() }
-    # no suitable tags, so we use the full revision id
-    return { "version": variables["full"].strip(),
-             "full": variables["full"].strip() }
-
-def versions_from_vcs(tag_prefix, versionfile_source, verbose=False):
-    """
-    this runs 'git' from the root of the source tree. That either means
-    someone ran a setup.py command (and this code is in versioneer.py, thus
-    the containing directory is the root of the source tree), or someone
-    ran a project-specific entry point (and this code is in _version.py,
-    thus the containing directory is somewhere deeper in the source tree).
-    This only gets called if the git-archive 'subst' variables were *not*
-    expanded, and _version.py hasn't already been rewritten with a short
-    version string, meaning we're inside a checked out source tree.
-    """
-    try:
-        here = os.path.abspath(__file__)
-    except NameError:
-        # some py2exe/bbfreeze/non-CPython implementations don't do __file__
-        return {} # not always correct
-
-    # versionfile_source is the relative path from the top of the source tree
-    # (where the .git directory might live) to this file. Invert this to find
-    # the root from __file__.
-    root = here
-    for i in range(len(versionfile_source.split("/"))):
-        root = os.path.dirname(root)
-    if not os.path.exists(os.path.join(root, ".git")):
-        return {}
-
-    GIT = "git"
-    if sys.platform == "win32":
-        GIT = "git.cmd"
-    stdout = run_command([GIT, "describe", "--tags", "--dirty", "--always"],
-                         cwd=root)
-    if stdout is None:
-        return {}
-    if not stdout.startswith(tag_prefix):
-        if verbose:
-            print "tag '%s' doesn't start with prefix '%s'" % (stdout, tag_prefix)
-        return {}
-    tag = stdout[len(tag_prefix):]
-    stdout = run_command([GIT, "rev-parse", "HEAD"], cwd=root)
-    if stdout is None:
-        return {}
-    full = stdout.strip()
-    if tag.endswith("-dirty"):
-        full += "-dirty"
-    return {"version": tag, "full": full}
-
-
-def versions_from_parentdir(parentdir_prefix, versionfile_source, verbose=False):
-    try:
-        here = os.path.abspath(__file__)
-        # versionfile_source is the relative path from the top of the source
-        # tree (where the .git directory might live) to _version.py, when
-        # this is used by the runtime. Invert this to find the root from
-        # __file__.
-        root = here
-        for i in range(len(versionfile_source.split("/"))):
-            root = os.path.dirname(root)
-    except NameError:
-        # try a couple different things to handle py2exe, bbfreeze, and
-        # non-CPython implementations which don't do __file__. This code
-        # either lives in versioneer.py (used by setup.py) or _version.py
-        # (used by the runtime). In the versioneer.py case, sys.argv[0] will
-        # be setup.py, in the root of the source tree. In the _version.py
-        # case, we have no idea what sys.argv[0] is (some
-        # application-specific runner).
-        root = os.path.dirname(os.path.abspath(sys.argv[0]))
-    # Source tarballs conventionally unpack into a directory that includes
-    # both the project name and a version string.
-    dirname = os.path.basename(root)
-    if not dirname.startswith(parentdir_prefix):
-        if verbose:
-            print "dirname '%s' doesn't start with prefix '%s'" %                   (dirname, parentdir_prefix)
-        return None
-    return {"version": dirname[len(parentdir_prefix):], "full": ""}
-
-tag_prefix = ""
-parentdir_prefix = "addon-sdk-"
-versionfile_source = "python-lib/cuddlefish/_version.py"
-
-def get_versions():
-    variables = { "refnames": git_refnames, "full": git_full }
-    ver = versions_from_expanded_variables(variables, tag_prefix)
-    if not ver:
-        ver = versions_from_vcs(tag_prefix, versionfile_source)
-    if not ver:
-        ver = versions_from_parentdir(parentdir_prefix, versionfile_source)
-    if not ver:
-        ver = {"version": "unknown", "full": ""}
-    return ver
-
diff --git a/addon-sdk/source/python-lib/cuddlefish/_version.py.rej b/addon-sdk/source/python-lib/cuddlefish/_version.py.rej
deleted file mode 100644
index 5feef7f..0000000
--- a/addon-sdk/source/python-lib/cuddlefish/_version.py.rej
+++ /dev/null
@@ -1,13 +0,0 @@
---- addon-sdk/source/python-lib/cuddlefish/_version.py	2016-04-12 11:54:00 +0100
-+++ addon-sdk/source/python-lib/cuddlefish/_version.py	2016-04-12 16:57:53 +0100
-@@ -9,8 +9,8 @@
- # (https://github.com/warner/python-versioneer)
- 
- # these strings will be replaced by git during git-archive
--git_refnames = ""
--git_full = "b44f2a41a8ae2ebf5ad7b90fcc27d100361f602f"
-+git_refnames = " (beta)"
-+git_full = "6c838969dbc4e95d702eb97c156080e88c6aeb32"
- 
- 
- import subprocess
diff --git a/browser/app/profile/firefox.js b/browser/app/profile/firefox.js
index eaa591a..a71826d 100755
--- a/browser/app/profile/firefox.js
+++ b/browser/app/profile/firefox.js
@@ -1142,7 +1142,7 @@ pref("browser.privatebrowsing.autostart", false);
 // bookmarking dialog
 pref("browser.bookmarks.editDialog.firstEditField", "namePicker");
 
-pref("dom.ipc.plugins.flash.disable-protected-mode", false);
+pref("dom.ipc.plugins.flash.disable-protected-mode", true);
 
 // Feature-disable the protected-mode auto-flip
 pref("browser.flash-protected-mode-flip.enable", false);
diff --git a/browser/base/content/abouthome/mozilla.png.orig b/browser/base/content/abouthome/mozilla.png.orig
deleted file mode 100644
index f2c348d..0000000
Binary files a/browser/base/content/abouthome/mozilla.png.orig and /dev/null differ
diff --git a/browser/base/content/abouthome/mozilla@2x.png.orig b/browser/base/content/abouthome/mozilla@2x.png.orig
deleted file mode 100644
index f8fc622..0000000
Binary files a/browser/base/content/abouthome/mozilla@2x.png.orig and /dev/null differ
diff --git a/browser/config/version_display.txt.rej b/browser/config/version_display.txt.rej
deleted file mode 100644
index f8cf1a4..0000000
--- a/browser/config/version_display.txt.rej
+++ /dev/null
@@ -1,5 +0,0 @@
---- browser/config/version_display.txt	2016-04-12 11:54:00 +0100
-+++ browser/config/version_display.txt	2016-04-19 18:31:16 +0100
-@@ -1 +1 @@
--46.0b11
-+46.0
diff --git a/browser/installer/windows/nsis/defines.nsi.in b/browser/installer/windows/nsis/defines.nsi.in
index f03333c..987d242 100755
--- a/browser/installer/windows/nsis/defines.nsi.in
+++ b/browser/installer/windows/nsis/defines.nsi.in
@@ -68,7 +68,7 @@
 #ifdef HAVE_64BIT_BUILD
 !define HAVE_64BIT_BUILD
 !define ARCH "x64"
-!define MinSupportedVer "Microsoft Windows 7 x64"
+!define MinSupportedVer "Microsoft Windows XP SP2 x64"
 #else
 !define ARCH "x86"
 !define MinSupportedVer "Microsoft Windows XP SP2"
diff --git a/browser/installer/windows/nsis/installer.nsi b/browser/installer/windows/nsis/installer.nsi
index a216a1b..b76cbb9 100755
--- a/browser/installer/windows/nsis/installer.nsi
+++ b/browser/installer/windows/nsis/installer.nsi
@@ -249,7 +249,7 @@ Section "-InstallStartCleanup"
   ${EndIf}
 
   ; setup the application model id registration value
-  ${InitHashAppModelId} "$INSTDIR" "Software\Mozilla\${AppName}\TaskBarIDs"
+  ${InitHashAppModelId} "$INSTDIR" "Software\WaterfoxProject\${AppName}\TaskBarIDs"
 
   ; Remove the updates directory for Vista and above
   ${CleanUpdateDirectories} "Mozilla\Firefox" "Mozilla\updates"
@@ -319,7 +319,7 @@ Section "-Application" APP_IDX
   ; Default for creating Quick Launch shortcut (1 = create, 0 = don't create)
   ${If} $AddQuickLaunchSC == ""
     ; Don't install the quick launch shortcut on Windows 7
-    ${If} ${AtLeastWin7}
+    ${If} ${AtLeastWinXP}
       StrCpy $AddQuickLaunchSC "0"
     ${Else}
       StrCpy $AddQuickLaunchSC "1"
@@ -333,25 +333,25 @@ Section "-Application" APP_IDX
 
   ${LogHeader} "Adding Registry Entries"
   SetShellVarContext current  ; Set SHCTX to HKCU
-  ${RegCleanMain} "Software\Mozilla"
+  ${RegCleanMain} "Software\WaterfoxProject"
   ${RegCleanUninstall}
   ${UpdateProtocolHandlers}
 
   ClearErrors
-  WriteRegStr HKLM "Software\Mozilla" "${BrandShortName}InstallerTest" "Write Test"
+  WriteRegStr HKLM "Software\WaterfoxProject" "${BrandShortName}InstallerTest" "Write Test"
   ${If} ${Errors}
     StrCpy $TmpVal "HKCU" ; used primarily for logging
   ${Else}
     SetShellVarContext all  ; Set SHCTX to HKLM
-    DeleteRegValue HKLM "Software\Mozilla" "${BrandShortName}InstallerTest"
+    DeleteRegValue HKLM "Software\WaterfoxProject" "${BrandShortName}InstallerTest"
     StrCpy $TmpVal "HKLM" ; used primarily for logging
-    ${RegCleanMain} "Software\Mozilla"
+    ${RegCleanMain} "Software\WaterfoxProject"
     ${RegCleanUninstall}
     ${UpdateProtocolHandlers}
 
-    ReadRegStr $0 HKLM "Software\mozilla.org\Mozilla" "CurrentVersion"
+    ReadRegStr $0 HKLM "Software\mozilla.org\WaterfoxProject" "CurrentVersion"
     ${If} "$0" != "${GREVersion}"
-      WriteRegStr HKLM "Software\mozilla.org\Mozilla" "CurrentVersion" "${GREVersion}"
+      WriteRegStr HKLM "Software\mozilla.org\WaterfoxProject" "CurrentVersion" "${GREVersion}"
     ${EndIf}
   ${EndIf}
 
@@ -527,7 +527,7 @@ Section "-Application" APP_IDX
     ${If} ${FileExists} "$SMPROGRAMS\${BrandFullName}.lnk"
       ShellLink::SetShortCutWorkingDirectory "$SMPROGRAMS\${BrandFullName}.lnk" \
                                            "$INSTDIR"
-      ${If} ${AtLeastWin7}
+      ${If} ${AtLeastWinXP}
       ${AndIf} "$AppUserModelID" != ""
         ApplicationID::Set "$SMPROGRAMS\${BrandFullName}.lnk" "$AppUserModelID" "true"
       ${EndIf}
@@ -542,7 +542,7 @@ Section "-Application" APP_IDX
     ${If} ${FileExists} "$DESKTOP\${BrandFullName}.lnk"
       ShellLink::SetShortCutWorkingDirectory "$DESKTOP\${BrandFullName}.lnk" \
                                              "$INSTDIR"
-      ${If} ${AtLeastWin7}
+      ${If} ${AtLeastWinXP}
       ${AndIf} "$AppUserModelID" != ""
         ApplicationID::Set "$DESKTOP\${BrandFullName}.lnk" "$AppUserModelID"  "true"
       ${EndIf}
@@ -555,7 +555,7 @@ Section "-Application" APP_IDX
   ; If elevated the Quick Launch shortcut must be added from the unelevated
   ; original process.
   ${If} $AddQuickLaunchSC == 1
-    ${Unless} ${AtLeastWin7}
+    ${Unless} ${AtLeastWinXP}
       ClearErrors
       ${GetParameters} $0
       ${GetOptions} "$0" "/UAC:" $0
@@ -901,7 +901,7 @@ Function leaveShortcuts
   ${MUI_INSTALLOPTIONS_READ} $AddStartMenuSC "shortcuts.ini" "Field 3" "State"
 
   ; Don't install the quick launch shortcut on Windows 7
-  ${Unless} ${AtLeastWin7}
+  ${Unless} ${AtLeastWinXP}
     ${MUI_INSTALLOPTIONS_READ} $AddQuickLaunchSC "shortcuts.ini" "Field 4" "State"
   ${EndUnless}
 
@@ -936,13 +936,13 @@ Function preComponents
 
   ; Only show the maintenance service page if we have write access to HKLM
   ClearErrors
-  WriteRegStr HKLM "Software\Mozilla" \
+  WriteRegStr HKLM "Software\WaterfoxProject" \
               "${BrandShortName}InstallerTest" "Write Test"
   ${If} ${Errors}
     ClearErrors
     Abort
   ${Else}
-    DeleteRegValue HKLM "Software\Mozilla" "${BrandShortName}InstallerTest"
+    DeleteRegValue HKLM "Software\WaterfoxProject" "${BrandShortName}InstallerTest"
   ${EndIf}
 
   StrCpy $PageName "Components"
@@ -1008,9 +1008,9 @@ Function preSummary
 
   ; Check if it is possible to write to HKLM
   ClearErrors
-  WriteRegStr HKLM "Software\Mozilla" "${BrandShortName}InstallerTest" "Write Test"
+  WriteRegStr HKLM "Software\WaterfoxProject" "${BrandShortName}InstallerTest" "Write Test"
   ${Unless} ${Errors}
-    DeleteRegValue HKLM "Software\Mozilla" "${BrandShortName}InstallerTest"
+    DeleteRegValue HKLM "Software\WaterfoxProject" "${BrandShortName}InstallerTest"
     ; Check if Firefox is the http handler for this user.
     SetShellVarContext current ; Set SHCTX to the current user
     ${IsHandlerForInstallDir} "http" $R9
@@ -1104,7 +1104,7 @@ Function .onInit
 ; The commands inside this ifndef are needed prior to NSIS 3.0a2 and can be
 ; removed after we require NSIS 3.0a2 or greater.
 !ifndef NSIS_PACKEDVERSION
-  ${If} ${AtLeastWinVista}
+  ${If} ${AtLeastWinXP}
     System::Call 'user32::SetProcessDPIAware()'
   ${EndIf}
 !endif
@@ -1156,7 +1156,7 @@ Function .onInit
 
   ; Setup the shortcuts.ini file for the Custom Shortcuts Page
   ; Don't offer to install the quick launch shortcut on Windows 7
-  ${If} ${AtLeastWin7}
+  ${If} ${AtLeastWinXP}
     WriteINIStr "$PLUGINSDIR\shortcuts.ini" "Settings" NumFields "3"
   ${Else}
     WriteINIStr "$PLUGINSDIR\shortcuts.ini" "Settings" NumFields "4"
@@ -1187,7 +1187,7 @@ Function .onInit
   WriteINIStr "$PLUGINSDIR\shortcuts.ini" "Field 3" State  "1"
 
   ; Don't offer to install the quick launch shortcut on Windows 7
-  ${Unless} ${AtLeastWin7}
+  ${Unless} ${AtLeastWinXP}
     WriteINIStr "$PLUGINSDIR\shortcuts.ini" "Field 4" Type   "checkbox"
     WriteINIStr "$PLUGINSDIR\shortcuts.ini" "Field 4" Text   "$(ICONS_QUICKLAUNCH)"
     WriteINIStr "$PLUGINSDIR\shortcuts.ini" "Field 4" Left   "0"
diff --git a/browser/installer/windows/nsis/maintenanceservice_installer.nsi b/browser/installer/windows/nsis/maintenanceservice_installer.nsi
index ef30c13..97c8a0d 100755
--- a/browser/installer/windows/nsis/maintenanceservice_installer.nsi
+++ b/browser/installer/windows/nsis/maintenanceservice_installer.nsi
@@ -45,7 +45,7 @@ Var BrandFullName
 ; And anyone that wants to run tests themselves should already have 
 ; this installed.
 !define FallbackKey \
-  "SOFTWARE\Mozilla\MaintenanceService\3932ecacee736d366d6436db0f55bce4"
+  "SOFTWARE\WaterfoxProject\MaintenanceService\3932ecacee736d366d6436db0f55bce4"
 
 !define CompanyName "Mozilla Corporation"
 !define BrandFullNameInternal ""
@@ -68,7 +68,7 @@ Name "${MaintFullName}"
 OutFile "maintenanceservice_installer.exe"
 
 ; Get installation folder from registry if available
-InstallDirRegKey HKLM "Software\Mozilla\MaintenanceService" ""
+InstallDirRegKey HKLM "Software\WaterfoxProject\MaintenanceService" ""
 
 SetOverwrite on
 
@@ -136,7 +136,7 @@ Function un.onInit
 ; The commands inside this ifndef are needed prior to NSIS 3.0a2 and can be
 ; removed after we require NSIS 3.0a2 or greater.
 !ifndef NSIS_PACKEDVERSION
-  ${If} ${AtLeastWinVista}
+  ${If} ${AtLeastWinXP}
     System::Call 'user32::SetProcessDPIAware()'
   ${EndIf}
 !endif
@@ -212,9 +212,9 @@ Section "MaintenanceService"
   ${If} ${RunningX64}
     SetRegView 64
   ${EndIf}
-  WriteRegDWORD HKLM "Software\Mozilla\MaintenanceService" "Attempted" 1
-  WriteRegDWORD HKLM "Software\Mozilla\MaintenanceService" "Installed" 1
-  DeleteRegValue HKLM "Software\Mozilla\MaintenanceService" "FFPrefetchDisabled"
+  WriteRegDWORD HKLM "Software\WaterfoxProject\MaintenanceService" "Attempted" 1
+  WriteRegDWORD HKLM "Software\WaterfoxProject\MaintenanceService" "Installed" 1
+  DeleteRegValue HKLM "Software\WaterfoxProject\MaintenanceService" "FFPrefetchDisabled"
 
   ; Included here for debug purposes only.  
   ; These keys are used to bypass the installation dir is a valid installation
@@ -326,8 +326,8 @@ Section "Uninstall"
   ${If} ${RunningX64}
     SetRegView 64
   ${EndIf}
-  DeleteRegValue HKLM "Software\Mozilla\MaintenanceService" "Installed"
-  DeleteRegValue HKLM "Software\Mozilla\MaintenanceService" "FFPrefetchDisabled"
+  DeleteRegValue HKLM "Software\WaterfoxProject\MaintenanceService" "Installed"
+  DeleteRegValue HKLM "Software\WaterfoxProject\MaintenanceService" "FFPrefetchDisabled"
   DeleteRegKey HKLM "${FallbackKey}\"
   ${If} ${RunningX64}
     SetRegView lastused
diff --git a/browser/installer/windows/nsis/shared.nsh b/browser/installer/windows/nsis/shared.nsh
index 187eb57..3d7b451 100755
--- a/browser/installer/windows/nsis/shared.nsh
+++ b/browser/installer/windows/nsis/shared.nsh
@@ -51,25 +51,25 @@
   ; install location in the Software\Mozilla key and uninstall registry entries
   ; that point to our install location for both HKCU and HKLM.
   SetShellVarContext current  ; Set SHCTX to the current user (e.g. HKCU)
-  ${RegCleanMain} "Software\Mozilla"
+  ${RegCleanMain} "Software\WaterfoxProject"
   ${RegCleanUninstall}
   ${UpdateProtocolHandlers}
 
   ; setup the application model id registration value
-  ${InitHashAppModelId} "$INSTDIR" "Software\Mozilla\${AppName}\TaskBarIDs"
+  ${InitHashAppModelId} "$INSTDIR" "Software\WaterfoxProject\${AppName}\TaskBarIDs"
 
   ; Win7 taskbar and start menu link maintenance
   Call FixShortcutAppModelIDs
 
   ClearErrors
-  WriteRegStr HKLM "Software\Mozilla" "${BrandShortName}InstallerTest" "Write Test"
+  WriteRegStr HKLM "Software\WaterfoxProject" "${BrandShortName}InstallerTest" "Write Test"
   ${If} ${Errors}
     StrCpy $TmpVal "HKCU" ; used primarily for logging
   ${Else}
     SetShellVarContext all    ; Set SHCTX to all users (e.g. HKLM)
-    DeleteRegValue HKLM "Software\Mozilla" "${BrandShortName}InstallerTest"
+    DeleteRegValue HKLM "Software\WaterfoxProject" "${BrandShortName}InstallerTest"
     StrCpy $TmpVal "HKLM" ; used primarily for logging
-    ${RegCleanMain} "Software\Mozilla"
+    ${RegCleanMain} "Software\WaterfoxProject"
     ${RegCleanUninstall}
     ${UpdateProtocolHandlers}
     ${FixShellIconHandler} "HKLM"
@@ -110,9 +110,9 @@
       ${EndIf}
     ${EndIf}
 
-    ReadRegStr $0 HKLM "Software\mozilla.org\Mozilla" "CurrentVersion"
+    ReadRegStr $0 HKLM "Software\mozilla.org\WaterfoxProject" "CurrentVersion"
     ${If} "$0" != "${GREVersion}"
-      WriteRegStr HKLM "Software\mozilla.org\Mozilla" "CurrentVersion" "${GREVersion}"
+      WriteRegStr HKLM "Software\mozilla.org\WaterfoxProject" "CurrentVersion" "${GREVersion}"
     ${EndIf}
   ${EndIf}
 
@@ -154,7 +154,7 @@
     ${If} ${RunningX64}
       SetRegView 64
     ${EndIf}
-    ReadRegDWORD $5 HKLM "Software\Mozilla\MaintenanceService" "Attempted"
+    ReadRegDWORD $5 HKLM "Software\WaterfoxProject\MaintenanceService" "Attempted"
     ClearErrors
     ${If} ${RunningX64}
       SetRegView lastused
@@ -286,7 +286,7 @@ ${EndIf}
     CreateShortCut "$DESKTOP\${BrandFullName}.lnk" "$INSTDIR\${FileMainEXE}"
     ${If} ${FileExists} "$DESKTOP\${BrandFullName}.lnk"
       ShellLink::SetShortCutWorkingDirectory "$DESKTOP\${BrandFullName}.lnk" "$INSTDIR"
-      ${If} ${AtLeastWin7}
+      ${If} ${AtLeastWinXP}
       ${AndIf} "$AppUserModelID" != ""
         ApplicationID::Set "$DESKTOP\${BrandFullName}.lnk" "$AppUserModelID" "true"
       ${EndIf}
@@ -297,7 +297,7 @@ ${EndIf}
         ${If} ${FileExists} "$DESKTOP\${BrandFullName}.lnk"
           ShellLink::SetShortCutWorkingDirectory "$DESKTOP\${BrandFullName}.lnk" \
                                                  "$INSTDIR"
-          ${If} ${AtLeastWin7}
+          ${If} ${AtLeastWinXP}
           ${AndIf} "$AppUserModelID" != ""
             ApplicationID::Set "$DESKTOP\${BrandFullName}.lnk" "$AppUserModelID" "true"
           ${EndIf}
@@ -312,7 +312,7 @@ ${EndIf}
     ${If} ${FileExists} "$SMPROGRAMS\${BrandFullName}.lnk"
       ShellLink::SetShortCutWorkingDirectory "$SMPROGRAMS\${BrandFullName}.lnk" \
                                              "$INSTDIR"
-      ${If} ${AtLeastWin7}
+      ${If} ${AtLeastWinXP}
       ${AndIf} "$AppUserModelID" != ""
         ApplicationID::Set "$SMPROGRAMS\${BrandFullName}.lnk" "$AppUserModelID" "true"
       ${EndIf}
@@ -324,7 +324,7 @@ ${EndIf}
         ${If} ${FileExists} "$SMPROGRAMS\${BrandFullName}.lnk"
           ShellLink::SetShortCutWorkingDirectory "$SMPROGRAMS\${BrandFullName}.lnk" \
                                                  "$INSTDIR"
-          ${If} ${AtLeastWin7}
+          ${If} ${AtLeastWinXP}
           ${AndIf} "$AppUserModelID" != ""
             ApplicationID::Set "$SMPROGRAMS\${BrandFullName}.lnk" "$AppUserModelID" "true"
           ${EndIf}
@@ -334,7 +334,7 @@ ${EndIf}
   ${EndUnless}
 
   ; Windows 7 doesn't use the QuickLaunch directory
-  ${Unless} ${AtLeastWin7}
+  ${Unless} ${AtLeastWinXP}
   ${AndUnless} ${FileExists} "$QUICKLAUNCH\${BrandFullName}.lnk"
     CreateShortCut "$QUICKLAUNCH\${BrandFullName}.lnk" \
                    "$INSTDIR\${FileMainEXE}"
@@ -519,14 +519,14 @@ ${EndIf}
   ${EndIf}
 
   ${GetLongPath} "$INSTDIR" $8
-  StrCpy $0 "Software\Mozilla\${BrandFullNameInternal}\${AppVersion}$3 (${ARCH} ${AB_CD})\Main"
+  StrCpy $0 "Software\WaterfoxProject\${BrandFullNameInternal}\${AppVersion}$3 (${ARCH} ${AB_CD})\Main"
   ${WriteRegStr2} $TmpVal "$0" "Install Directory" "$8" 0
   ${WriteRegStr2} $TmpVal "$0" "PathToExe" "$8\${FileMainEXE}" 0
 
-  StrCpy $0 "Software\Mozilla\${BrandFullNameInternal}\${AppVersion}$3 (${ARCH} ${AB_CD})\Uninstall"
+  StrCpy $0 "Software\WaterfoxProject\${BrandFullNameInternal}\${AppVersion}$3 (${ARCH} ${AB_CD})\Uninstall"
   ${WriteRegStr2} $TmpVal "$0" "Description" "${BrandFullNameInternal} ${AppVersion}$3 (${ARCH} ${AB_CD})" 0
 
-  StrCpy $0 "Software\Mozilla\${BrandFullNameInternal}\${AppVersion}$3 (${ARCH} ${AB_CD})"
+  StrCpy $0 "Software\WaterfoxProject\${BrandFullNameInternal}\${AppVersion}$3 (${ARCH} ${AB_CD})"
   ${WriteRegStr2} $TmpVal  "$0" "" "${AppVersion}$3 (${ARCH} ${AB_CD})" 0
   ${If} "$3" == ""
     DeleteRegValue SHCTX "$0" "ESR"
@@ -534,14 +534,14 @@ ${EndIf}
     ${WriteRegDWORD2} $TmpVal "$0" "ESR" 1 0
   ${EndIf}
 
-  StrCpy $0 "Software\Mozilla\${BrandFullNameInternal} ${AppVersion}$3\bin"
+  StrCpy $0 "Software\WaterfoxProject\${BrandFullNameInternal} ${AppVersion}$3\bin"
   ${WriteRegStr2} $TmpVal "$0" "PathToExe" "$8\${FileMainEXE}" 0
 
-  StrCpy $0 "Software\Mozilla\${BrandFullNameInternal} ${AppVersion}$3\extensions"
+  StrCpy $0 "Software\WaterfoxProject\${BrandFullNameInternal} ${AppVersion}$3\extensions"
   ${WriteRegStr2} $TmpVal "$0" "Components" "$8\components" 0
   ${WriteRegStr2} $TmpVal "$0" "Plugins" "$8\plugins" 0
 
-  StrCpy $0 "Software\Mozilla\${BrandFullNameInternal} ${AppVersion}$3"
+  StrCpy $0 "Software\WaterfoxProject\${BrandFullNameInternal} ${AppVersion}$3"
   ${WriteRegStr2} $TmpVal "$0" "GeckoVer" "${GREVersion}" 0
   ${If} "$3" == ""
     DeleteRegValue SHCTX "$0" "ESR"
@@ -549,7 +549,7 @@ ${EndIf}
     ${WriteRegDWORD2} $TmpVal "$0" "ESR" 1 0
   ${EndIf}
 
-  StrCpy $0 "Software\Mozilla\${BrandFullNameInternal}$3"
+  StrCpy $0 "Software\WaterfoxProject\${BrandFullNameInternal}$3"
   ${WriteRegStr2} $TmpVal "$0" "" "${GREVersion}" 0
   ${WriteRegStr2} $TmpVal "$0" "CurrentVersion" "${AppVersion}$3 (${ARCH} ${AB_CD})" 0
 !macroend
@@ -769,7 +769,7 @@ ${EndIf}
     ; Setting the Attempted value will ensure that a new Maintenance Service
     ; install will never be attempted again after this from updates.  The value
     ; is used only to see if updates should attempt new service installs.
-    WriteRegDWORD HKLM "Software\Mozilla\MaintenanceService" "Attempted" 1
+    WriteRegDWORD HKLM "Software\WaterfoxProject\MaintenanceService" "Attempted" 1
 
     ; These values associate the allowed certificates for the current
     ; installation.
@@ -950,10 +950,10 @@ ${EndIf}
       DeleteRegKey HKU "$1\Local Settings\Software\Microsoft\Windows\CurrentVersion\AppModel\SystemAppData\DefaultBrowser_NOPUBLISHERID\SplashScreen\DefaultBrowser_NOPUBLISHERID!${APP_USER_MODEL_ID}"
     ${Else}
       ; misc. Metro keys
-      DeleteRegKey HKU "$1\Software\Mozilla\Firefox\Metro"
-      DeleteRegValue HKU "$1\Software\Mozilla\Firefox" "CEHDump"
-      DeleteRegValue HKU "$1\Software\Mozilla\Firefox" "MetroD3DAvailable"
-      DeleteRegValue HKU "$1\Software\Mozilla\Firefox" "MetroLastAHE"
+      DeleteRegKey HKU "$1\Software\WaterfoxProject\Firefox\Metro"
+      DeleteRegValue HKU "$1\Software\WaterfoxProject\Firefox" "CEHDump"
+      DeleteRegValue HKU "$1\Software\WaterfoxProject\Firefox" "MetroD3DAvailable"
+      DeleteRegValue HKU "$1\Software\WaterfoxProject\Firefox" "MetroLastAHE"
       ${ResetWin8PromptKeys} "HKU" "$1\"
     ${EndIf}
     IntOp $0 $0 + 1
@@ -1129,7 +1129,7 @@ ${EndIf}
     ${If} ${Errors}
       ClearErrors
       WriteIniStr "$0" "TASKBAR" "Migrated" "true"
-      ${If} ${AtLeastWin7}
+      ${If} ${AtLeastWinXP}
         ; No need to check the default on Win8 and later
         ${If} ${AtMostWin2008R2}
           ; Check if the Firefox is the http handler for this user
@@ -1157,7 +1157,7 @@ ${EndIf}
 ; model ID removes a pinned pinned Start Menu shortcut this will also add a
 ; pinned Start Menu shortcut.
 !macro PinToTaskBar
-  ${If} ${AtLeastWin7}
+  ${If} ${AtLeastWinXP}
     StrCpy $8 "false" ; Whether a shortcut had to be created
     ${IsPinnedToTaskBar} "$INSTDIR\${FileMainEXE}" $R9
     ${If} "$R9" == "false"
@@ -1259,7 +1259,7 @@ ${EndIf}
                 ${If} ${FileExists} "$SMPROGRAMS\${BrandFullName}.lnk"
                   ShellLink::SetShortCutWorkingDirectory "$SMPROGRAMS\${BrandFullName}.lnk" \
                                                          "$INSTDIR"
-                  ${If} ${AtLeastWin7}
+                  ${If} ${AtLeastWinXP}
                   ${AndIf} "$AppUserModelID" != ""
                     ApplicationID::Set "$SMPROGRAMS\${BrandFullName}.lnk" \
                                        "$AppUserModelID" "true"
@@ -1472,7 +1472,7 @@ Function SetAsDefaultAppUserHKCU
 
   ${SetHandlers}
 
-  ${If} ${AtLeastWinVista}
+  ${If} ${AtLeastWinXP}
     ; Only register as the handler on Vista and above if the app registry name
     ; exists under the RegisteredApplications registry key. The protocol and
     ; file handlers set previously at the user level will associate this install
@@ -1491,7 +1491,7 @@ FunctionEnd
 
 ; Helper for updating the shortcut application model IDs.
 Function FixShortcutAppModelIDs
-  ${If} ${AtLeastWin7}
+  ${If} ${AtLeastWinXP}
   ${AndIf} "$AppUserModelID" != ""
     ${UpdateShortcutAppModelIDs} "$INSTDIR\${FileMainEXE}" "$AppUserModelID" $0
   ${EndIf}
diff --git a/browser/installer/windows/nsis/stub.nsi b/browser/installer/windows/nsis/stub.nsi
index d7cd02b..f8d12da 100755
--- a/browser/installer/windows/nsis/stub.nsi
+++ b/browser/installer/windows/nsis/stub.nsi
@@ -316,7 +316,7 @@ Function .onInit
 !ifdef HAVE_64BIT_BUILD
   ; Restrict x64 builds from being installed on x86 and pre Win7
   ${Unless} ${RunningX64}
-  ${OrUnless} ${AtLeastWin7}
+  ${OrUnless} ${AtLeastWinXP}
     MessageBox MB_OK|MB_ICONSTOP "$(WARN_MIN_SUPPORTED_OS_MSG)"
     Quit
   ${EndUnless}
@@ -360,17 +360,17 @@ Function .onInit
 ; The commands inside this ifndef are needed prior to NSIS 3.0a2 and can be
 ; removed after we require NSIS 3.0a2 or greater.
 !ifndef NSIS_PACKEDVERSION
-  ${If} ${AtLeastWinVista}
+  ${If} ${AtLeastWinXP}
     System::Call 'user32::SetProcessDPIAware()'
   ${EndIf}
 !endif
 
   SetShellVarContext all ; Set SHCTX to HKLM
-  ${GetSingleInstallPath} "Software\Mozilla\${BrandFullNameInternal}" $R9
+  ${GetSingleInstallPath} "Software\WaterfoxProject\${BrandFullNameInternal}" $R9
 
   ${If} "$R9" == "false"
     SetShellVarContext current ; Set SHCTX to HKCU
-    ${GetSingleInstallPath} "Software\Mozilla\${BrandFullNameInternal}" $R9
+    ${GetSingleInstallPath} "Software\WaterfoxProject\${BrandFullNameInternal}" $R9
 
     ${If} ${RunningX64}
       ; In HKCU there is no WOW64 redirection, which means we may have gotten
@@ -402,7 +402,7 @@ Function .onInit
   StrCpy $InitialInstallDir "$INSTDIR"
 
   ClearErrors
-  WriteRegStr HKLM "Software\Mozilla" "${BrandShortName}InstallerTest" \
+  WriteRegStr HKLM "Software\WaterfoxProject" "${BrandShortName}InstallerTest" \
                    "Write Test"
 
   ; Only display set as default when there is write access to HKLM and on Win7
@@ -412,12 +412,12 @@ Function .onInit
     StrCpy $CanSetAsDefault "false"
     StrCpy $CheckboxSetAsDefault "0"
   ${Else}
-    DeleteRegValue HKLM "Software\Mozilla" "${BrandShortName}InstallerTest"
+    DeleteRegValue HKLM "Software\WaterfoxProject" "${BrandShortName}InstallerTest"
     StrCpy $CanSetAsDefault "true"
   ${EndIf}
 
   ; The interval in MS used for the progress bars set as marquee.
-  ${If} ${AtLeastWinVista}
+  ${If} ${AtLeastWinXP}
     StrCpy $ProgressbarMarqueeIntervalMS "10"
   ${Else}
     StrCpy $ProgressbarMarqueeIntervalMS "50"
@@ -627,12 +627,12 @@ Function SendPing
     ${EndIf}
 
     ClearErrors
-    WriteRegStr HKLM "Software\Mozilla" "${BrandShortName}InstallerTest" \
+    WriteRegStr HKLM "Software\WaterfoxProject" "${BrandShortName}InstallerTest" \
                      "Write Test"
     ${If} ${Errors}
       StrCpy $R8 "0"
     ${Else}
-      DeleteRegValue HKLM "Software\Mozilla" "${BrandShortName}InstallerTest"
+      DeleteRegValue HKLM "Software\WaterfoxProject" "${BrandShortName}InstallerTest"
       StrCpy $R8 "1"
     ${EndIf}
 
@@ -662,7 +662,7 @@ Function SendPing
     ${EndIf}
 
     ${If} "$R2" == "0"
-    ${AndIf} ${AtLeastWinVista}
+    ${AndIf} ${AtLeastWinXP}
       ; Check to see if this install location is currently set as the default
       ; browser by Default Programs which is only available on Vista and above.
       ClearErrors
@@ -918,7 +918,7 @@ Function createOptions
   SetCtlColors $0 ${COMMON_TEXT_COLOR_NORMAL} ${COMMON_BKGRD_COLOR}
   SendMessage $0 ${WM_SETFONT} $FontNormal 0
 
-  ${If} ${AtLeastWin7}
+  ${If} ${AtLeastWinXP}
     StrCpy $0 "$(ADD_SC_TASKBAR)"
   ${Else}
     StrCpy $0 "$(ADD_SC_QUICKLAUNCHBAR)"
@@ -1056,13 +1056,13 @@ Function createOptions
   
   ; Only show the maintenance service checkbox if we have write access to HKLM
   ClearErrors
-  WriteRegStr HKLM "Software\Mozilla" "${BrandShortName}InstallerTest" \
+  WriteRegStr HKLM "Software\WaterfoxProject" "${BrandShortName}InstallerTest" \
                    "Write Test"
   ${If} ${Errors}
   ${OrIf} $0 != "true"
     StrCpy $CheckboxInstallMaintSvc "0"
   ${Else}
-    DeleteRegValue HKLM "Software\Mozilla" "${BrandShortName}InstallerTest"
+    DeleteRegValue HKLM "Software\WaterfoxProject" "${BrandShortName}InstallerTest"
     ; Read the registry instead of using ServicesHelper::IsInstalled so the
     ; plugin isn't included in the stub installer to lessen its size.
     ClearErrors
@@ -1310,7 +1310,7 @@ Function createInstall
     StrCpy $ExistingBuildID "0"
   ${EndIf}
 
-  ${If} ${FileExists} "$LOCALAPPDATA\Mozilla\Firefox"
+  ${If} ${FileExists} "$LOCALAPPDATA\WaterfoxProject\Firefox"
     StrCpy $ExistingProfile "1"
   ${Else}
     StrCpy $ExistingProfile "0"
diff --git a/browser/installer/windows/nsis/uninstaller.nsi b/browser/installer/windows/nsis/uninstaller.nsi
index 88938a4..7067a68 100755
--- a/browser/installer/windows/nsis/uninstaller.nsi
+++ b/browser/installer/windows/nsis/uninstaller.nsi
@@ -188,7 +188,7 @@ Function un.UninstallServiceIfNotUsed
   ; Figure out the number of subkeys
   StrCpy $0 0
   ${Do}
-    EnumRegKey $1 HKLM "Software\Mozilla\MaintenanceService" $0
+    EnumRegKey $1 HKLM "Software\WaterfoxProject\MaintenanceService" $0
     ${If} "$1" == ""
       ${ExitDo}
     ${EndIf}
@@ -244,15 +244,15 @@ Section "Uninstall"
   ${EndIf}
 
   ; setup the application model id registration value
-  ${un.InitHashAppModelId} "$INSTDIR" "Software\Mozilla\${AppName}\TaskBarIDs"
+  ${un.InitHashAppModelId} "$INSTDIR" "Software\WaterfoxProject\${AppName}\TaskBarIDs"
 
   SetShellVarContext current  ; Set SHCTX to HKCU
-  ${un.RegCleanMain} "Software\Mozilla"
+  ${un.RegCleanMain} "Software\WaterfoxProject"
   ${un.RegCleanUninstall}
   ${un.DeleteShortcuts}
 
   ; Unregister resources associated with Win7 taskbar jump lists.
-  ${If} ${AtLeastWin7}
+  ${If} ${AtLeastWinXP}
   ${AndIf} "$AppUserModelID" != ""
     ApplicationID::UninstallJumpLists "$AppUserModelID"
   ${EndIf}
@@ -261,18 +261,18 @@ Section "Uninstall"
   ${un.CleanUpdateDirectories} "Mozilla\Firefox" "Mozilla\updates"
 
   ; Remove any app model id's stored in the registry for this install path
-  DeleteRegValue HKCU "Software\Mozilla\${AppName}\TaskBarIDs" "$INSTDIR"
-  DeleteRegValue HKLM "Software\Mozilla\${AppName}\TaskBarIDs" "$INSTDIR"
+  DeleteRegValue HKCU "Software\WaterfoxProject\${AppName}\TaskBarIDs" "$INSTDIR"
+  DeleteRegValue HKLM "Software\WaterfoxProject\${AppName}\TaskBarIDs" "$INSTDIR"
 
   ClearErrors
-  WriteRegStr HKLM "Software\Mozilla" "${BrandShortName}InstallerTest" "Write Test"
+  WriteRegStr HKLM "Software\WaterfoxProject" "${BrandShortName}InstallerTest" "Write Test"
   ${If} ${Errors}
     StrCpy $TmpVal "HKCU" ; used primarily for logging
   ${Else}
     SetShellVarContext all  ; Set SHCTX to HKLM
-    DeleteRegValue HKLM "Software\Mozilla" "${BrandShortName}InstallerTest"
+    DeleteRegValue HKLM "Software\WaterfoxProject" "${BrandShortName}InstallerTest"
     StrCpy $TmpVal "HKLM" ; used primarily for logging
-    ${un.RegCleanMain} "Software\Mozilla"
+    ${un.RegCleanMain} "Software\WaterfoxProject"
     ${un.RegCleanUninstall}
     ${un.DeleteShortcuts}
     ${un.SetAppLSPCategories}
@@ -309,10 +309,10 @@ Section "Uninstall"
   ${EndIf}
 
   SetShellVarContext all  ; Set SHCTX to HKLM
-  ${un.GetSecondInstallPath} "Software\Mozilla" $R9
+  ${un.GetSecondInstallPath} "Software\WaterfoxProject" $R9
   ${If} $R9 == "false"
     SetShellVarContext current  ; Set SHCTX to HKCU
-    ${un.GetSecondInstallPath} "Software\Mozilla" $R9
+    ${un.GetSecondInstallPath} "Software\WaterfoxProject" $R9
   ${EndIf}
 
   StrCpy $0 "Software\Clients\StartMenuInternet\${FileMainEXE}\shell\open\command"
@@ -610,7 +610,7 @@ Function un.onInit
 ; The commands inside this ifndef are needed prior to NSIS 3.0a2 and can be
 ; removed after we require NSIS 3.0a2 or greater.
 !ifndef NSIS_PACKEDVERSION
-  ${If} ${AtLeastWinVista}
+  ${If} ${AtLeastWinXP}
     System::Call 'user32::SetProcessDPIAware()'
   ${EndIf}
 !endif
diff --git a/browser/locales/Makefile.in.orig b/browser/locales/Makefile.in.orig
deleted file mode 100644
index 91cac3b..0000000
--- a/browser/locales/Makefile.in.orig
+++ /dev/null
@@ -1,213 +0,0 @@
-# vim:set ts=8 sw=8 sts=8 noet:
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-include $(topsrcdir)/config/config.mk
-
-ifdef LOCALE_MERGEDIR
-vpath crashreporter%.ini $(LOCALE_MERGEDIR)/browser/crashreporter
-endif
-vpath crashreporter%.ini $(LOCALE_SRCDIR)/crashreporter
-ifdef LOCALE_MERGEDIR
-vpath crashreporter%.ini @srcdir@/en-US/crashreporter
-endif
-
-
-SUBMAKEFILES += \
-	$(DEPTH)/$(MOZ_BRANDING_DIRECTORY)/Makefile \
-	$(DEPTH)/$(MOZ_BRANDING_DIRECTORY)/locales/Makefile \
-	$(NULL)
-
-# This makefile uses variable overrides from the libs-% target to
-# build non-default locales to non-default dist/ locations. Be aware!
-
-PWD := $(CURDIR)
-
-# These are defaulted to be compatible with the files the wget-en-US target
-# pulls. You may override them if you provide your own files. You _must_
-# override them when MOZ_PKG_PRETTYNAMES is defined - the defaults will not
-# work in that case.
-ZIP_IN ?= $(ABS_DIST)/$(PACKAGE)
-WIN32_INSTALLER_IN ?= $(ABS_DIST)/$(PKG_INST_PATH)$(PKG_INST_BASENAME).exe
-RETRIEVE_WINDOWS_INSTALLER = 1
-
-MOZ_LANGPACK_EID=langpack-$(AB_CD)@firefox.mozilla.org
-
-L10N_PREF_JS_EXPORTS = $(call MERGE_FILE,firefox-l10n.js)
-L10N_PREF_JS_EXPORTS_PATH = $(FINAL_TARGET)/$(PREF_DIR)
-L10N_PREF_JS_EXPORTS_FLAGS = $(PREF_PPFLAGS) --silence-missing-directive-warnings
-PP_TARGETS += L10N_PREF_JS_EXPORTS
-
-ifneq (,$(filter cocoa,$(MOZ_WIDGET_TOOLKIT)))
-MOZ_PKG_MAC_DSSTORE=$(ABS_DIST)/branding/dsstore
-MOZ_PKG_MAC_BACKGROUND=$(ABS_DIST)/branding/background.png
-MOZ_PKG_MAC_ICON=$(ABS_DIST)/branding/disk.icns
-MOZ_PKG_MAC_EXTRA=--symlink '/Applications:/ '
-endif
-
-ifeq (WINNT,$(OS_ARCH))
-UNINSTALLER_PACKAGE_HOOK = $(RM) -r $(STAGEDIST)/uninstall; \
-    $(NSINSTALL) -D $(STAGEDIST)/uninstall; \
-    cp ../installer/windows/l10ngen/helper.exe $(STAGEDIST)/uninstall; \
-    $(RM) $(ABS_DIST)/l10n-stage/setup.exe; \
-    cp ../installer/windows/l10ngen/setup.exe $(ABS_DIST)/l10n-stage; \
-    $(NULL)
-
-STUB_HOOK = $(NSINSTALL) -D '$(ABS_DIST)/$(PKG_INST_PATH)'; \
-    $(RM) '$(ABS_DIST)/$(PKG_INST_PATH)$(PKG_STUB_BASENAME).exe'; \
-    cp ../installer/windows/l10ngen/stub.exe '$(ABS_DIST)/$(PKG_INST_PATH)$(PKG_STUB_BASENAME).exe'; \
-    chmod 0755 '$(ABS_DIST)/$(PKG_INST_PATH)$(PKG_STUB_BASENAME).exe'; \
-    $(NULL)
-endif
-
-SEARCHPLUGINS_NAMES = $(shell cat $(call MERGE_FILE,/searchplugins/list.txt)) ddg
-ifeq (,$(filter-out en-US ru be kk tr uk zh-CN zh-TW,$(AB_CD)))
-    SEARCHPLUGINS_NAMES := $(subst google,google:hidden,$(SEARCHPLUGINS_NAMES))
-    SEARCHPLUGINS_NAMES += google-nocodes
-endif
-SEARCHPLUGINS_FILENAMES = $(subst :hidden,,$(SEARCHPLUGINS_NAMES))
-SEARCHPLUGINS_PATH := .deps/generated_$(AB_CD)
-SEARCHPLUGINS_TARGET := libs searchplugins
-SEARCHPLUGINS := $(foreach plugin,$(addsuffix .xml,$(SEARCHPLUGINS_FILENAMES)),$(or $(wildcard $(call EN_US_OR_L10N_FILE,searchplugins/$(plugin))),$(warning Missing searchplugin: $(plugin))))
-# Some locale-specific search plugins may have preprocessor directives, but the
-# default en-US ones do not.
-SEARCHPLUGINS_FLAGS := --silence-missing-directive-warnings
-PP_TARGETS += SEARCHPLUGINS
-
-list-txt = $(SEARCHPLUGINS_PATH)/list.txt
-GARBAGE += $(list-txt)
-
-libs:: searchplugins
-
-# Required for l10n.mk - defines a list of app sub dirs that should
-# be included in langpack xpis.
-DIST_SUBDIRS = $(DIST_SUBDIR)
-
-include $(topsrcdir)/config/rules.mk
-
-include $(topsrcdir)/toolkit/locales/l10n.mk
-
-$(list-txt): $(call mkdir_deps,$(SEARCHPLUGINS_PATH)) $(if $(IS_LANGUAGE_REPACK),FORCE)
-	$(RM) $(list-txt)
-	$(foreach plugin,$(SEARCHPLUGINS_NAMES),printf '$(plugin)\n' >> $(list-txt);)
-searchplugins:: $(list-txt)
-
-$(STAGEDIST): $(DIST)/branding
-
-$(DIST)/branding:
-	$(NSINSTALL) -D $@
-
-DEFINES += -DBOOKMARKS_INCLUDE_DIR=$(dir $(call MERGE_FILE,profile/bookmarks.inc))
-
-libs-%:
-	$(NSINSTALL) -D $(DIST)/install
-	@$(MAKE) -C ../../toolkit/locales libs-$* XPI_ROOT_APPID='$(XPI_ROOT_APPID)'
-	@$(MAKE) -C ../../services/sync/locales AB_CD=$* XPI_NAME=locale-$*
-ifdef MOZ_WEBAPP_RUNTIME
-	@$(MAKE) -C ../../webapprt/locales AB_CD=$* XPI_NAME=locale-$*
-endif
-	@$(MAKE) -C ../../extensions/spellcheck/locales AB_CD=$* XPI_NAME=locale-$*
-	@$(MAKE) -C ../extensions/pocket/locales AB_CD=$* XPI_NAME=locale-$*
-	@$(MAKE) -C ../extensions/loop/chrome/locale AB_CD=$* XPI_NAME=locale-$*
-	@$(MAKE) -C ../../intl/locales AB_CD=$* XPI_NAME=locale-$*
-	@$(MAKE) -C ../../devtools/client/locales AB_CD=$* XPI_NAME=locale-$* XPI_ROOT_APPID='$(XPI_ROOT_APPID)'
-	@$(MAKE) -B searchplugins AB_CD=$* XPI_NAME=locale-$*
-	@$(MAKE) libs AB_CD=$* XPI_NAME=locale-$* PREF_DIR=$(PREF_DIR)
-	@$(MAKE) -C $(DEPTH)/$(MOZ_BRANDING_DIRECTORY)/locales AB_CD=$* XPI_NAME=locale-$*
-
-repackage-win32-installer: WIN32_INSTALLER_OUT=$(ABS_DIST)/$(PKG_INST_PATH)$(PKG_INST_BASENAME).exe
-repackage-win32-installer: $(call ESCAPE_WILDCARD,$(WIN32_INSTALLER_IN)) $(SUBMAKEFILES) libs-$(AB_CD)
-	@echo 'Repackaging $(WIN32_INSTALLER_IN) into $(WIN32_INSTALLER_OUT).'
-	$(MAKE) -C $(DEPTH)/$(MOZ_BRANDING_DIRECTORY) export
-	$(MAKE) -C ../installer/windows CONFIG_DIR=l10ngen l10ngen/setup.exe l10ngen/7zSD.sfx
-	$(MAKE) repackage-zip \
-	  AB_CD=$(AB_CD) \
-	  MOZ_PKG_FORMAT=SFX7Z \
-	  ZIP_IN='$(WIN32_INSTALLER_IN)' \
-	  ZIP_OUT='$(WIN32_INSTALLER_OUT)' \
-	  SFX_HEADER='$(PWD)/../installer/windows/l10ngen/7zSD.sfx \
-	              $(topsrcdir)/browser/installer/windows/app.tag'
-
-ifeq (WINNT,$(OS_ARCH))
-repackage-win32-installer-%: $(STAGEDIST)
-	@$(MAKE) repackage-win32-installer AB_CD=$* WIN32_INSTALLER_IN='$(WIN32_INSTALLER_IN)'
-
-repackage-zip-%: repackage-win32-installer-%
-else
-repackage-win32-installer-%: ;
-endif
-
-
-clobber-zip:
-	$(RM) $(STAGEDIST)/chrome/$(AB_CD).jar \
-	  $(STAGEDIST)/chrome/$(AB_CD).manifest \
-	  $(STAGEDIST)/webapprt/chrome/$(AB_CD).jar \
-	  $(STAGEDIST)/webapprt/chrome/$(AB_CD).manifest \
-	  $(STAGEDIST)/$(PREF_DIR)/firefox-l10n.js
-	$(RM) -rf  $(STAGEDIST)/dictionaries \
-	  $(STAGEDIST)/hyphenation \
-	  $(STAGEDIST)/defaults/profile \
-	  $(STAGEDIST)/chrome/$(AB_CD) \
-	  $(STAGEDIST)/webapprt/chrome/$(AB_CD)
-
-
-langpack: langpack-$(AB_CD)
-
-# This is a generic target that will make a langpack, repack ZIP (+tarball)
-# builds, and repack an installer if applicable. It is called from the
-# tinderbox scripts. Alter it with caution.
-
-installers-%: clobber-% langpack-% repackage-win32-installer-% repackage-zip-%
-	@echo 'repackaging done'
-
-ifdef MOZ_UPDATER
-# Note that we want updater.ini to be in the top directory, not the browser/
-# subdirectory, because that's where the updater is installed and runs.
-libs:: $(call MERGE_FILE,updater/updater.ini) $(call mkdir_deps,$(DIST)/bin)
-ifeq ($(OS_ARCH),WINNT)
-	cat $< $(srcdir)/../installer/windows/nsis/updater_append.ini | \
-	  sed -e 's/^InfoText=/Info=/' -e 's/^TitleText=/Title=/' | \
-	  sed -e 's/%MOZ_APP_DISPLAYNAME%/$(MOZ_APP_DISPLAYNAME)/' > \
-	  $(FINAL_TARGET)/../updater.ini
-else
-	cat $< | \
-	  sed -e 's/^InfoText=/Info=/' -e 's/^TitleText=/Title=/' | \
-	  sed -e 's/%MOZ_APP_DISPLAYNAME%/$(MOZ_APP_DISPLAYNAME)/' > \
-	  $(FINAL_TARGET)/../updater.ini
-endif
-endif
-
-ifdef MOZ_CRASHREPORTER
-libs:: crashreporter-override.ini
-	$(SYSINSTALL) $(IFLAGS1) $^ $(FINAL_TARGET)
-endif
-
-ident:
-	@printf 'fx_revision '
-	@$(PYTHON) $(topsrcdir)/config/printconfigsetting.py \
-	    $(STAGEDIST)/application.ini App SourceStamp
-	@printf 'buildid '
-	@$(PYTHON) $(topsrcdir)/config/printconfigsetting.py \
-	    $(STAGEDIST)/application.ini App BuildID
-
-merge-%:
-ifdef LOCALE_MERGEDIR
-	$(RM) -rf $(LOCALE_MERGEDIR)
-	MACOSX_DEPLOYMENT_TARGET= compare-locales -m $(LOCALE_MERGEDIR) $(srcdir)/l10n.ini $(L10NBASEDIR) $*
-endif
-	@echo
-
-# test target, depends on make package
-# try to repack x-test, with just toolkit/defines.inc being there
-l10n-check:: INNER_UNMAKE_PACKAGE=true
-l10n-check::
-	$(RM) -rf x-test
-	$(NSINSTALL) -D x-test/toolkit
-	echo '#define MOZ_LANG_TITLE Just testing' > x-test/toolkit/defines.inc
-	@# ZIP_IN='$(ZIP_IN)' will pass down the *current* value of ZIP_IN, based
-	@# on MOZ_SIMPLE_PACKAGE_NAME not being reset, overwriting the value it
-	@# would get with MOZ_SIMPLE_PACKAGE_NAME reset.
-	$(MAKE) installers-x-test L10NBASEDIR='$(PWD)' LOCALE_MERGEDIR='$(PWD)/mergedir' ZIP_IN='$(ZIP_IN)' MOZ_SIMPLE_PACKAGE_NAME=
-	$(PYTHON) $(topsrcdir)/toolkit/mozapps/installer/unpack.py $(DIST)/l10n-stage/$(STAGEPATH)$(MOZ_PKG_DIR)$(_BINPATH)
-	cd $(DIST)/l10n-stage && test $$(cat $(STAGEPATH)$(MOZ_PKG_DIR)$(_BINPATH)/update.locale) = x-test
diff --git a/browser/themes/linux/browser.css.orig b/browser/themes/linux/browser.css.orig
deleted file mode 100644
index 7852f03..0000000
--- a/browser/themes/linux/browser.css.orig
+++ /dev/null
@@ -1,1923 +0,0 @@
-%if 0
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-%endif
-
-@import url("chrome://global/skin/");
-
-@namespace url("http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul");
-@namespace html url("http://www.w3.org/1999/xhtml");
-@namespace svg url("http://www.w3.org/2000/svg");
-
-%include ../shared/browser.inc
-%include linuxShared.inc
-%filter substitution
-
-%define forwardTransitionLength 150ms
-%define conditionalForwardWithUrlbar window:not([chromehidden~="toolbar"]) #urlbar-wrapper
-
-:root {
-  --backbutton-urlbar-overlap: 6px;
-  /* icon width + border + horizontal padding (without the overlap from backbutton-urlbar-overlap) */
-  --forwardbutton-width: 25px;
-
-  --toolbarbutton-hover-background: rgba(255,255,255,.5) linear-gradient(rgba(255,255,255,.5), transparent);
-  --toolbarbutton-hover-bordercolor: rgba(0,0,0,.25);
-  --toolbarbutton-hover-boxshadow: none;
-
-  --toolbarbutton-active-background: rgba(154,154,154,.5) linear-gradient(rgba(255,255,255,.7), rgba(255,255,255,.4));
-  --toolbarbutton-active-bordercolor: rgba(0,0,0,.3);
-  --toolbarbutton-active-boxshadow: 0 1px 1px rgba(0,0,0,.1) inset, 0 0 1px rgba(0,0,0,.3) inset;
-
-  --toolbarbutton-checkedhover-backgroundcolor: rgba(200,200,200,.5);
-
-  --identity-box-verified-background-color: #fff;
-
-  --panel-separator-color: ThreeDShadow;
-
-  --urlbar-separator-color: hsla(0,0%,16%,.2);
-}
-
-#menubar-items {
-  -moz-box-orient: vertical; /* for flex hack */
-}
-
-#main-menubar {
-  -moz-box-flex: 1; /* make menu items expand to fill toolbar height */
-}
-
-#navigator-toolbox {
-  -moz-appearance: none;
-  background-color: transparent;
-  border-top: none;
-}
-
-#navigator-toolbox::after {
-  content: "";
-  display: -moz-box;
-  -moz-box-ordinal-group: 101; /* tabs toolbar is 100 */
-  height: 1px;
-  background-color: ThreeDShadow;
-}
-
-#navigator-toolbox:-moz-lwtheme::after {
-  background-color: rgba(0,0,0,.3);
-}
-
-#navigator-toolbox > toolbar:not(#toolbar-menubar):not(#TabsToolbar) {
-  background-image: linear-gradient(@toolbarHighlight@, @toolbarHighlight@);
-}
-
-#navigator-toolbox > toolbar:not(#toolbar-menubar):not(#TabsToolbar):-moz-lwtheme {
-  background-image: linear-gradient(@toolbarHighlightLWT@, @toolbarHighlightLWT@);
-}
-
-#navigator-toolbox > toolbar:not(:-moz-lwtheme):not(#toolbar-menubar):not(#TabsToolbar) {
-  -moz-appearance: none;
-  border-style: none;
-  background-color: -moz-Dialog;
-}
-
-#navigator-toolbox > toolbar:not(#toolbar-menubar):not(#TabsToolbar):not(#nav-bar) {
-  padding-top: 1px;
-  padding-bottom: 1px;
-}
-
-#navigator-toolbox > toolbar:not(#toolbar-menubar):not(#TabsToolbar):not(#nav-bar):not(#addon-bar) {
-  overflow: -moz-hidden-unscrollable;
-  max-height: 4em;
-  transition: min-height 170ms ease-out, max-height 170ms ease-out;
-}
-
-#navigator-toolbox > toolbar:not(#toolbar-menubar):not(#TabsToolbar):not(#nav-bar):not(#addon-bar)[collapsed=true] {
-  min-height: 0.1px;
-  max-height: 0;
-  transition: min-height 170ms ease-out, max-height 170ms ease-out, visibility 170ms linear;
-}
-
-#TabsToolbar:not([collapsed="true"]) + #nav-bar {
-  border-top: 1px solid hsla(0,0%,0%,.3) !important;
-  background-clip: padding-box;
-  /* Move up into the TabsToolbar for the inner highlight at the top of the nav-bar */
-  margin-top: calc(-1 * var(--navbar-tab-toolbar-highlight-overlap));
-  /* Position the toolbar above the bottom of background tabs */
-  position: relative;
-  z-index: 1;
-}
-
-#nav-bar {
-  box-shadow: 0 1px 0 @navbarInsetHighlight@ inset;
-  padding-top: 2px;
-  padding-bottom: 2px;
-}
-
-#nav-bar-overflow-button {
-  -moz-image-region: rect(-5px, 12px, 11px, -4px);
-}
-
-/* This only has an effect when this element is placed on the bookmarks toolbar.
- * It's 30px to make sure buttons with 18px icons fit along with the default 16px
- * icons, without changing the size of the toolbar.
- */
-#personal-bookmarks {
-  min-height: 30px;
-}
-
-#browser-bottombox {
-  /* opaque for layers optimization */
-  background-color: -moz-Dialog;
-}
-
-/* Places toolbar */
-toolbarbutton.bookmark-item:not(.subviewbutton),
-#personal-bookmarks[cui-areatype="toolbar"]:not([overflowedItem=true]) > #bookmarks-toolbar-placeholder {
-  margin: 0;
-  padding: 2px 3px;
-}
-
-toolbarbutton.bookmark-item:not(.subviewbutton):not(:hover):not(:active):not([open]) {
-  color: inherit;
-}
-
-toolbarbutton.bookmark-item:not(.subviewbutton):hover:active,
-toolbarbutton.bookmark-item[open="true"] {
-  padding-top: 3px;
-  padding-bottom: 1px;
-  -moz-padding-start: 4px;
-  -moz-padding-end: 2px;
-}
-
-.bookmark-item > .toolbarbutton-icon,
-#personal-bookmarks[cui-areatype="toolbar"] > #bookmarks-toolbar-placeholder > .toolbarbutton-icon {
-  width: 16px;
-  height: 16px;
-}
-
-/* Force the display of the label for bookmarks */
-.bookmark-item > .toolbarbutton-text,
-#personal-bookmarks[cui-areatype="toolbar"] > #bookmarks-toolbar-placeholder > .toolbarbutton-text {
-  display: -moz-box !important;
-}
-
-.bookmark-item > .toolbarbutton-menu-dropmarker {
-  display: none;
-}
-
-/* Dropmarker for folder bookmarks */
-.bookmark-item[container] > .toolbarbutton-menu-dropmarker {
-  display: -moz-box !important;
-}
-
-#bookmarks-toolbar-placeholder {
-  list-style-image: url("chrome://browser/skin/places/bookmarksToolbar.png") !important;
-}
-
-toolbarpaletteitem[place="palette"] > #personal-bookmarks > #bookmarks-toolbar-placeholder,
-#personal-bookmarks[cui-areatype="menu-panel"] > #bookmarks-toolbar-placeholder {
-  list-style-image: url("chrome://browser/skin/places/bookmarksToolbar-menuPanel.png") !important;
-}
-
-/* ----- BOOKMARK STAR ANIMATION ----- */
-
-@keyframes animation-bookmarkAdded {
-  from { transform: rotate(0deg) translateX(-16px) rotate(0deg) scale(1); opacity: 0; }
-  60%  { transform: rotate(180deg) translateX(-16px) rotate(-180deg) scale(2.2); opacity: 1; }
-  80%  { opacity: 1; }
-  to   { transform: rotate(180deg) translateX(-16px) rotate(-180deg) scale(1); opacity: 0; }
-}
-
-@keyframes animation-bookmarkPulse {
-  from { transform: scale(1); }
-  50%  { transform: scale(1.3); }
-  to   { transform: scale(1); }
-}
-
-#bookmarked-notification-container {
-  min-height: 1px;
-  min-width: 1px;
-  height: 1px;
-  margin-bottom: -1px;
-  z-index: 5;
-  position: relative;
-}
-
-#bookmarked-notification {
-  background-size: 16px;
-  background-position: center;
-  background-repeat: no-repeat;
-  width: 16px;
-  height: 16px;
-  opacity: 0;
-}
-
-#bookmarked-notification-dropmarker-anchor {
-  z-index: -1;
-  position: relative;
-}
-
-#bookmarked-notification-dropmarker-icon {
-  width: 18px;
-  height: 18px;
-  visibility: hidden;
-}
-
-#bookmarked-notification-anchor[notification="finish"] > #bookmarked-notification {
-  background-image: url("chrome://browser/skin/places/bookmarks-notification-finish.png");
-  animation: animation-bookmarkAdded 800ms;
-  animation-timing-function: ease, ease, ease;
-}
-
-#bookmarks-menu-button[notification="finish"] > .toolbarbutton-menubutton-dropmarker > .dropmarker-icon {
-  list-style-image: none !important;
-}
-
-#bookmarked-notification-dropmarker-anchor[notification="finish"] > #bookmarked-notification-dropmarker-icon {
-  visibility: visible;
-  animation: animation-bookmarkPulse 300ms;
-  animation-delay: 600ms;
-  animation-timing-function: ease-out;
-}
-
-/* Bookmark menus */
-menu.bookmark-item,
-menuitem.bookmark-item {
-  min-width: 0;
-  max-width: 32em;
-}
-
-.bookmark-item:not(.subviewbutton) > .menu-iconic-left {
-  margin-top: 0;
-  margin-bottom: 0;
-}
-
-.bookmark-item > .menu-iconic-left > .menu-iconic-icon {
-  -moz-padding-start: 0px;
-}
-
-/* Bookmark drag and drop styles */
-.bookmark-item[dragover-into="true"] {
-  background: Highlight !important;
-  color: HighlightText !important;
-}
-
-/* rules for menupopup drop indicators */
-.menupopup-drop-indicator-bar {
-  position: relative;
-  /* these two margins must together compensate the indicator's height */
-  margin-top: -1px;
-  margin-bottom: -1px;
-}
-
-.menupopup-drop-indicator {
-  list-style-image: none;
-  height: 2px;
-  -moz-margin-end: -4em;
-  background-color: Highlight;
-}
-
-/* Bookmarks toolbar */
-#PlacesToolbarDropIndicator {
-  list-style-image: url(chrome://browser/skin/places/toolbarDropMarker.png);
-}
-
-/* Bookmark items */
-.bookmark-item {
-  list-style-image: url("chrome://mozapps/skin/places/defaultFavicon.png");
-}
-
-.bookmark-item[container] {
-  list-style-image: url("moz-icon://stock/gtk-directory?size=menu");
-}
-
-.bookmark-item[container][livemark] {
-  list-style-image: url("chrome://browser/skin/feeds/feedIcon16.png");
-}
-
-.bookmark-item[container][livemark] .bookmark-item {
-  list-style-image: url("chrome://browser/skin/places/livemark-item.png");
-  -moz-image-region: rect(0px, 16px, 16px, 0px);
-}
-
-.bookmark-item[container][livemark] .bookmark-item[visited] {
-  -moz-image-region: rect(0px, 32px, 16px, 16px);
-}
-
-.bookmark-item[container][query] {
-  list-style-image: url("chrome://browser/skin/places/query.png");
-}
-
-.bookmark-item[query][tagContainer] {
-  list-style-image: url("chrome://browser/skin/places/tag.png");
-}
-
-.bookmark-item[query][dayContainer] {
-  list-style-image: url("chrome://browser/skin/places/calendar.png");
-}
-
-.bookmark-item[query][hostContainer] {
-  list-style-image: url("moz-icon://stock/gtk-directory?size=menu");
-}
-
-.bookmark-item[query][hostContainer][open] {
-  list-style-image: url("moz-icon://stock/gtk-directory?size=menu");
-}
-
-.bookmark-item[cutting] > .toolbarbutton-icon,
-.bookmark-item[cutting] > .menu-iconic-left > .menu-iconic-icon {
-  opacity: 0.5;
-}
-
-.bookmark-item[cutting] > .toolbarbutton-text,
-.bookmark-item[cutting] > .menu-iconic-left > .menu-iconic-text {
-  opacity: 0.7;
-}
-
-/* Stock icons for the menu bar items */
-menuitem:not([type]):not(.menuitem-tooltip):not(.menuitem-iconic-tooltip) {
-  -moz-binding: url("chrome://global/content/bindings/menu.xml#menuitem-iconic");
-}
-
-#placesContext_open\:newwindow,
-#menu_newNavigator,
-#context-openlink,
-#context-openframe {
-  list-style-image: url("chrome://browser/skin/Toolbar-small.png");
-  -moz-image-region: rect(0px 80px 16px 64px);
-}
-
-#placesContext_open\:newtab,
-#placesContext_openContainer\:tabs,
-#menu_newNavigatorTab,
-#context-openlinkintab,
-#context-openframeintab {
-  list-style-image: url("chrome://browser/skin/Toolbar-small.png");
-  -moz-image-region: rect(0px 64px 16px 48px);
-}
-
-#menu_openFile {
-  list-style-image: url("moz-icon://stock/gtk-open?size=menu");
-}
-
-#menu_close {
-  list-style-image: url("moz-icon://stock/gtk-close?size=menu");
-}
-
-#context-media-play {
-  list-style-image: url("moz-icon://stock/gtk-media-play?size=menu");
-}
-
-#context-media-pause {
-  list-style-image: url("moz-icon://stock/gtk-media-pause?size=menu");
-}
-
-#menu_savePage,
-#context-savelink,
-#context-saveimage,
-#context-savevideo,
-#context-saveaudio,
-#context-savepage,
-#context-saveframe {
-  list-style-image: url("moz-icon://stock/gtk-save-as?size=menu");
-}
-
-#menu_printPreview {
-  list-style-image: url("moz-icon://stock/gtk-print-preview?size=menu");
-}
-
-#menu_print,
-#context-printframe {
-  list-style-image: url("moz-icon://stock/gtk-print?size=menu");
-}
-
-#menu_FileQuitItem {
-  list-style-image: url("moz-icon://stock/gtk-quit?size=menu");
-}
-
-#menu_undo,
-#context-undo {
-  list-style-image: url("moz-icon://stock/gtk-undo?size=menu");
-}
-
-#menu_undo[disabled],
-#context-undo[disabled] {
-  list-style-image: url("moz-icon://stock/gtk-undo?size=menu&state=disabled");
-}
-
-#menu_redo {
-  list-style-image: url("moz-icon://stock/gtk-redo?size=menu");
-}
-
-#menu_redo[disabled] {
-  list-style-image: url("moz-icon://stock/gtk-redo?size=menu&state=disabled");
-}
-
-#menu_cut,
-#placesContext_cut,
-#context-cut {
-  list-style-image: url("moz-icon://stock/gtk-cut?size=menu");
-}
-
-#menu_cut[disabled],
-#placesContext_cut[disabled],
-#context-cut[disabled] {
-  list-style-image: url("moz-icon://stock/gtk-cut?size=menu&state=disabled");
-}
-
-#menu_copy,
-#placesContext_copy,
-#context-copy,
-#context-copyimage,
-#context-copyvideourl,
-#context-copyaudiourl,
-#context-copylink,
-#context-copyemail {
-  list-style-image: url("moz-icon://stock/gtk-copy?size=menu");
-}
-
-#menu_copy[disabled],
-#placesContext_copy[disabled],
-#context-copy[disabled] {
-  list-style-image: url("moz-icon://stock/gtk-copy?size=menu&state=disabled");
-}
-
-#menu_paste,
-#placesContext_paste,
-#context-paste {
-  list-style-image: url("moz-icon://stock/gtk-paste?size=menu");
-}
-
-#menu_paste[disabled],
-#placesContext_paste[disabled],
-#context-paste[disabled] {
-  list-style-image: url("moz-icon://stock/gtk-paste?size=menu&state=disabled");
-}
-
-#menu_delete,
-#placesContext_delete,
-#placesContext_delete_history,
-#context-delete {
-  list-style-image: url("moz-icon://stock/gtk-delete?size=menu");
-}
-
-#menu_delete[disabled],
-#placesContext_delete[disabled],
-#placesContext_delete_history[disabled],
-#context-delete[disabled] {
-  list-style-image: url("moz-icon://stock/gtk-delete?size=menu&state=disabled");
-}
-
-#menu_selectAll,
-#context-selectall {
-  list-style-image: url("moz-icon://stock/gtk-select-all?size=menu");
-}
-
-#menu_find {
-  list-style-image: url("moz-icon://stock/gtk-find?size=menu");
-}
-
-#menu_find[disabled] {
-  list-style-image: url("moz-icon://stock/gtk-find?size=menu&state=disabled");
-}
-
-#menu_preferences {
-  list-style-image: url("moz-icon://stock/gtk-preferences?size=menu");
-}
-
-#placesContext_reload,
-#context-reloadframe {
-  list-style-image: url("moz-icon://stock/gtk-refresh?size=menu");
-}
-
-#menu_zoomEnlarge {
-  list-style-image: url("moz-icon://stock/gtk-zoom-in?size=menu");
-}
-
-#menu_zoomReduce {
-  list-style-image: url("moz-icon://stock/gtk-zoom-out?size=menu");
-}
-
-#menu_zoomReset {
-  list-style-image: url("moz-icon://stock/gtk-zoom-100?size=menu");
-}
-
-#menu_showAllHistory {
-  list-style-image: url("chrome://browser/skin/Toolbar-small.png");
-  -moz-image-region: rect(0px 32px 16px 16px);
-}
-
-#bookmarksShowAll {
-  list-style-image: url("chrome://browser/skin/Toolbar-small.png");
-  -moz-image-region: rect(0px 48px 16px 32px);
-}
-
-#subscribeToPageMenuitem:not([disabled]),
-#subscribeToPageMenupopup,
-#BMB_subscribeToPageMenuitem:not([disabled]),
-#BMB_subscribeToPageMenupopup {
-  list-style-image: url("chrome://browser/skin/page-livemarks.png");
-}
-
-#bookmarksToolbarFolderMenu,
-#BMB_bookmarksToolbar,
-#panelMenu_bookmarksToolbar {
-  list-style-image: url("chrome://browser/skin/places/bookmarksToolbar.png");
-}
-
-#BMB_unsortedBookmarks,
-#panelMenu_unsortedBookmarks {
-  list-style-image: url("chrome://browser/skin/places/unsortedBookmarks.png");
-}
-
-#menu_openDownloads {
-  list-style-image: url("chrome://browser/skin/Toolbar-small.png");
-  -moz-image-region: rect(0px 16px 16px 0px);
-}
-
-#menu_openAddons {
-  list-style-image: url("chrome://mozapps/skin/extensions/extensionGeneric-16.png");
-}
-
-#menu_pageInfo,
-#context-viewinfo,
-#context-viewframeinfo {
-  list-style-image: url("moz-icon://stock/gtk-info?size=menu");
-}
-
-#placesContext_open\:newprivatewindow,
-#privateBrowsingItem {
-  list-style-image: url("chrome://browser/skin/Privacy-16.png");
-}
-
-#placesContext_show\:info {
-  list-style-image: url("moz-icon://stock/gtk-properties?size=menu");
-}
-
-#sanitizeItem {
-  list-style-image: url("moz-icon://stock/gtk-clear?size=menu");
-}
-
-#menu_openHelp {
-  list-style-image: url("moz-icon://stock/gtk-help?size=menu");
-}
-
-#aboutName {
-  list-style-image: url("moz-icon://stock/gtk-about?size=menu");
-}
-
-#javascriptConsole {
-  list-style-image: url("chrome://global/skin/console/console.png");
-}
-
-/* Primary toolbar buttons */
-
-:-moz-any(toolbar, .widget-overflow-list) .toolbarbutton-1 > .toolbarbutton-icon,
-:-moz-any(toolbar, .widget-overflow-list) .toolbarbutton-1 > :-moz-any(.toolbarbutton-menubutton-button, .toolbarbutton-badge-stack) > .toolbarbutton-icon {
-  max-width: 16px;
-}
-
-:-moz-any(toolbar, .widget-overflow-list) .toolbarbutton-1:-moz-any(@primaryToolbarButtons@) > .toolbarbutton-icon,
-:-moz-any(toolbar, .widget-overflow-list) .toolbarbutton-1:-moz-any(@primaryToolbarButtons@) > :-moz-any(.toolbarbutton-menubutton-button, .toolbarbutton-badge-stack) > .toolbarbutton-icon,
-#bookmarks-menu-button[cui-areatype="toolbar"] > .toolbarbutton-menubutton-dropmarker > .dropmarker-icon {
-  max-width: 18px;
-}
-
-.findbar-button,
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1 > .toolbarbutton-menubutton-button,
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1 {
-  -moz-appearance: none;
-}
-
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1[open="true"],
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1:hover:active {
-  padding: 3px;
-}
-
-.findbar-button > .toolbarbutton-text,
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1 > .toolbarbutton-menubutton-button > .toolbarbutton-icon,
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1 > .toolbarbutton-menubutton-dropmarker > .dropmarker-icon,
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1 > .toolbarbutton-badge-stack,
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1 > .toolbarbutton-icon {
-  -moz-margin-end: 0;
-  padding: 2px 6px;
-  border: 1px solid transparent;
-  border-radius: 2px;
-  transition-property: background-color, border-color;
-  transition-duration: 150ms;
-}
-
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1:not(:-moz-any(@primaryToolbarButtons@)) > .toolbarbutton-icon,
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1:not(:-moz-any(@primaryToolbarButtons@)) > .toolbarbutton-badge-stack,
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1:not(:-moz-any(@primaryToolbarButtons@)) > .toolbarbutton-menubutton-button > .toolbarbutton-icon {
-  padding: 3px 7px;
-}
-
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1 > .toolbarbutton-icon,
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1 > .toolbarbutton-menubutton-button > .toolbarbutton-icon,
-:-moz-any(#TabsToolbar, #nav-bar) #bookmarks-menu-button[cui-areatype="toolbar"] > .toolbarbutton-menubutton-dropmarker > .dropmarker-icon {
-  /* horizontal padding + border + actual icon width */
-  max-width: 32px !important /* bug 561154 */;
-}
-
-#nav-bar #PanelUI-menu-button {
-  -moz-padding-start: 5px;
-  -moz-padding-end: 5px;
-}
-
-.findbar-button:not(:-moz-any([checked="true"],[disabled="true"])):hover > .toolbarbutton-text,
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1[open]:not([disabled=true]) > .toolbarbutton-menubutton-button > .toolbarbutton-icon,
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1:not([disabled=true]):not([open]):hover > .toolbarbutton-menubutton-button > .toolbarbutton-icon,
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1:not([disabled=true]):not([open]):hover > .toolbarbutton-menubutton-dropmarker > .dropmarker-icon,
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1:not([disabled=true]):hover > .toolbarbutton-badge-stack,
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1:not([disabled=true]):hover > .toolbarbutton-icon {
-  background: var(--toolbarbutton-hover-background);
-  background-clip: padding-box;
-  border-color: var(--toolbarbutton-hover-bordercolor);
-  box-shadow: var(--toolbarbutton-hover-boxshadow);
-}
-
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1:hover > .toolbarbutton-menubutton-dropmarker > .dropmarker-icon,
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1[open] > .toolbarbutton-menubutton-dropmarker > .dropmarker-icon {
-  margin-top: 4px;
-  margin-bottom: 4px;
-}
-
-.findbar-button:not([disabled=true]):-moz-any([checked="true"],:hover:active) > .toolbarbutton-text,
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1 > .toolbarbutton-menubutton-button:not([disabled=true]):-moz-any(:hover:active, [open="true"]) > .toolbarbutton-icon,
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1[open="true"] > .toolbarbutton-menubutton-dropmarker:not([disabled=true]) > .dropmarker-icon,
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1:not([disabled=true]):-moz-any([open],[checked],:hover:active) > .toolbarbutton-badge-stack,
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1:not([disabled=true]):-moz-any([open],[checked],:hover:active) > .toolbarbutton-icon {
-  background: var(--toolbarbutton-active-background);
-  background-clip: padding-box;
-  box-shadow: var(--toolbarbutton-active-boxshadow);
-  border-color: var(--toolbarbutton-active-bordercolor);
-  transition-duration: 10ms;
-}
-
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1[checked]:not(:active):hover > .toolbarbutton-icon {
-  background-color: var(--toolbarbutton-checkedhover-backgroundcolor);
-  transition: background-color 150ms;
-}
-
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1 > .toolbarbutton-menubutton-button[open],
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1 > .toolbarbutton-menubutton-button:hover:active,
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1:hover:active {
-  padding: 3px;
-}
-
-:-moz-any(#TabsToolbar, #nav-bar) .toolbaritem-combined-buttons {
-  margin-left: 2px;
-  margin-right: 2px;
-}
-
-:-moz-any(#TabsToolbar, #nav-bar) .toolbaritem-combined-buttons > .toolbarbutton-1 {
-  padding-left: 0;
-  padding-right: 0;
-}
-
-:-moz-any(#TabsToolbar, #nav-bar) .toolbaritem-combined-buttons:not(:hover) > separator,
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1:not(:hover):not(:active):not([open]) > .toolbarbutton-menubutton-dropmarker::before {
-  content: "";
-  display: -moz-box;
-  width: 1px;
-  height: 18px;
-  -moz-margin-end: -1px;
-  background-image: linear-gradient(currentColor 0, currentColor 100%);
-  background-position: center;
-  background-repeat: no-repeat;
-  background-size: 1px 18px;
-  opacity: .2;
-}
-
-:-moz-any(#TabsToolbar, #nav-bar)[brighttext] .toolbaritem-combined-buttons > separator,
-:-moz-any(#TabsToolbar, #nav-bar)[brighttext] .toolbarbutton-1:not(:hover):not(:active):not([open]) > .toolbarbutton-menubutton-dropmarker::before {
-  opacity: .3;
-}
-
-:-moz-any(#TabsToolbar, #nav-bar) .toolbarbutton-1 > .toolbarbutton-menubutton-dropmarker {
-  -moz-margin-start: -4px;
-  margin-top: 3px;
-  margin-bottom: 3px;
-}
-
-:-moz-any(#back-button, #forward-button) > .toolbarbutton-icon {
-  border-color: var(--urlbar-border-color) !important /* bug 561154 */;
-}
-
-:-moz-any(#back-button, #forward-button):not(:hover):not(:active):not([open=true]) > .toolbarbutton-icon,
-:-moz-any(#back-button, #forward-button)[disabled=true] > .toolbarbutton-icon {
-  background-color: rgba(255,255,255,.25) !important /* bug 561154 */;
-  background-clip: padding-box;
-}
-
-#back-button {
-  padding-top: 2px;
-  padding-bottom: 2px;
-  -moz-padding-start: 4px;
-  -moz-padding-end: 0;
-  position: relative;
-  z-index: 1;
-  border-radius: 0 10000px 10000px 0;
-}
-
-#back-button:-moz-locale-dir(rtl) {
-  border-radius: 10000px 0 0 10000px;
-}
-
-#back-button > menupopup {
-  margin-top: -1px;
-}
-
-#back-button > .toolbarbutton-icon {
-  border-radius: 10000px;
-  padding: 6px;
-  max-width: 32px; /* horizontal padding + border + icon width */
-}
-
-#back-button:-moz-locale-dir(rtl) > .toolbarbutton-icon {
-  transform: scaleX(-1);
-}
-
-#forward-button {
-  -moz-box-align: stretch; /* let the button shape grow vertically with the location bar */
-  padding: 0;
-}
-
-#forward-button > .toolbarbutton-icon {
-  padding-left: calc(var(--backbutton-urlbar-overlap) + 3px);
-  padding-right: 3px;
-  border-left-style: none;
-  border-radius: 0;
-  max-width: calc(var(--forwardbutton-width) + var(--backbutton-urlbar-overlap));
-}
-
-@conditionalForwardWithUrlbar@:not([switchingtabs]) > #forward-button {
-  transition: margin-left @forwardTransitionLength@ ease-out;
-}
-
-@conditionalForwardWithUrlbar@ > #forward-button[disabled] {
-  margin-left: calc(0px - var(--forwardbutton-width) - var(--backbutton-urlbar-overlap));
-}
-
-@conditionalForwardWithUrlbar@:hover:not([switchingtabs]) > #forward-button[disabled] {
-  /* delay the hiding of the forward button when hovered to avoid accidental clicks on the url bar */
-  transition-delay: 100s;
-}
-
-@conditionalForwardWithUrlbar@:not(:hover) > #forward-button[disabled] {
-  /* when not hovered anymore, trigger a new transition to hide the forward button immediately */
-  margin-left: calc(-0.01px - var(--forwardbutton-width) - var(--backbutton-urlbar-overlap));
-}
-
-/* undo close tab menu item */
-#alltabs_undoCloseTab {
-  list-style-image: url(chrome://browser/skin/undoCloseTab.png);
-}
-
-.unified-nav-back[_moz-menuactive] {
-  list-style-image: url("moz-icon://stock/gtk-go-back-ltr?size=menu") !important;
-}
-.unified-nav-back[_moz-menuactive]:-moz-locale-dir(rtl) {
-  list-style-image: url("moz-icon://stock/gtk-go-back-rtl?size=menu") !important;
-}
-.unified-nav-forward[_moz-menuactive] {
-  list-style-image: url("moz-icon://stock/gtk-go-forward-ltr?size=menu") !important;
-}
-.unified-nav-forward[_moz-menuactive]:-moz-locale-dir(rtl) {
-  list-style-image: url("moz-icon://stock/gtk-go-forward-rtl?size=menu") !important;
-}
-
-/* Menu panel buttons */
-
-%include ../shared/toolbarbuttons.inc.css
-%include ../shared/menupanel.inc.css
-
-#main-window:not([customizing]) .toolbarbutton-1[disabled=true] > .toolbarbutton-icon,
-#main-window:not([customizing]) .toolbarbutton-1[disabled=true] > .toolbarbutton-menu-dropmarker,
-#main-window:not([customizing]) .toolbarbutton-1[disabled=true] > .toolbarbutton-menubutton-dropmarker,
-#main-window:not([customizing]) .toolbarbutton-1[disabled=true] > .toolbarbutton-menubutton-button > .toolbarbutton-icon,
-#main-window:not([customizing]) .toolbarbutton-1 > .toolbarbutton-menubutton-button[disabled=true] > .toolbarbutton-icon {
-  opacity: 0.4;
-}
-
-/* Fullscreen window controls */
-#window-controls {
-  -moz-box-align: start;
-  -moz-margin-start: 10px;
-}
-
-#minimize-button {
-  list-style-image: url("chrome://global/skin/icons/Minimize.gif");
-}
-#restore-button {
-  list-style-image: url("chrome://global/skin/icons/Restore.gif");
-}
-#close-button {
-  list-style-image: url("chrome://global/skin/icons/Close.gif");
-}
-
-/* Location bar */
-#nav-bar {
-  --urlbar-border-color: ThreeDShadow;
-}
-
-#nav-bar:-moz-lwtheme {
-  --urlbar-border-color: rgba(0,0,0,.3);
-}
-
-#urlbar,
-.searchbar-textbox {
-  -moz-appearance: none;
-  padding: 0;
-  border: 1px solid var(--urlbar-border-color);
-  border-radius: 2px;
-  background-clip: padding-box;
-  margin: 0 3px;
-}
-
-#urlbar[focused],
-.searchbar-textbox[focused] {
-  border-color: Highlight;
-}
-
-#urlbar {
-  background-color: -moz-field;
-}
-
-#urlbar:-moz-lwtheme,
-.searchbar-textbox:-moz-lwtheme {
-  background-color: rgba(255,255,255,.8);
-  color: black;
-}
-
-#urlbar:-moz-lwtheme[focused=true],
-.searchbar-textbox:-moz-lwtheme[focused=true] {
-  background-color: white;
-}
-
-.urlbar-textbox-container {
-  -moz-appearance: none;
-  -moz-box-align: stretch;
-}
-
-.urlbar-input-box {
-  -moz-margin-start: 0;
-}
-
-.urlbar-history-dropmarker {
-  -moz-appearance: toolbarbutton-dropdown;
-  transition: opacity 0.15s ease;
-}
-
-#navigator-toolbox:not(:hover) .urlbar-history-dropmarker {
-  opacity: 0;
-}
-
-#urlbar-container {
-  -moz-box-align: center;
-}
-
-@conditionalForwardWithUrlbar@ > #urlbar {
-  -moz-border-start: none;
-  margin-left: 0;
-}
-
-@conditionalForwardWithUrlbar@ > #urlbar:-moz-locale-dir(ltr) {
-  border-top-left-radius: 0;
-  border-bottom-left-radius: 0;
-}
-
-@conditionalForwardWithUrlbar@ > #urlbar:-moz-locale-dir(rtl) {
-  border-top-right-radius: 0;
-  border-bottom-right-radius: 0;
-}
-
-@conditionalForwardWithUrlbar@ {
-  clip-path: url("chrome://browser/content/browser.xul#urlbar-back-button-clip-path");
-  margin-inline-start: calc(-1 * var(--backbutton-urlbar-overlap));
-}
-
-@conditionalForwardWithUrlbar@:-moz-locale-dir(rtl),
-@conditionalForwardWithUrlbar@ > #urlbar:-moz-locale-dir(rtl) {
-  /* let urlbar-back-button-clip-path clip the urlbar's right side for RTL */
-  transform: scaleX(-1);
-}
-
-@conditionalForwardWithUrlbar@:-moz-locale-dir(rtl) {
-  -moz-box-direction: reverse;
-}
-
-#urlbar-icons {
-  -moz-box-align: center;
-}
-
-.urlbar-icon {
-  padding: 0 3px;
-  /* 16x16 icon with border-box sizing */
-  width: 22px;
-  height: 16px;
-}
-
-#urlbar-search-footer {
-  border-top: 1px solid hsla(210,4%,10%,.14);
-  background-color: hsla(210,4%,10%,.07);
-}
-
-#urlbar-search-settings {
-  -moz-appearance: none;
-  -moz-user-focus: ignore;
-  color: inherit;
-  margin: 0;
-  border: 0;
-  padding: 8px 20px;
-  background: transparent;
-}
-
-#urlbar-search-settings:hover {
-  background-color: hsla(210,4%,10%,.07);
-}
-
-#urlbar-search-settings:hover:active {
-  background-color: hsla(210,4%,10%,.12);
-}
-
-#urlbar-search-splitter {
-  -moz-appearance: none;
-  width: 8px;
-  -moz-margin-start: -4px;
-}
-
-#urlbar-search-splitter + #search-container > #searchbar > .searchbar-textbox {
-  -moz-margin-start: 0;
-}
-
-#urlbar-display-box {
-  margin-top: -1px;
-  margin-bottom: -1px;
-  -moz-border-end: 1px solid #AAA;
-  -moz-margin-end: 3px;
-}
-
-.urlbar-display {
-  margin-top: 0;
-  margin-bottom: 0;
-  -moz-margin-start: 0;
-  color: GrayText;
-}
-
-%include ../shared/urlbarSearchSuggestionsNotification.inc.css
-
-#search-container {
-  min-width: calc(54px + 11ch);
-}
-
-/* identity box */
-
-#identity-box:-moz-locale-dir(ltr) {
-  border-top-left-radius: 1.5px;
-  border-bottom-left-radius: 1.5px;
-}
-
-#identity-box:-moz-locale-dir(rtl) {
-  border-top-right-radius: 1.5px;
-  border-bottom-right-radius: 1.5px;
-}
-
-#identity-box.verifiedIdentity:not(:-moz-lwtheme):not(:hover):not([open=true]) {
-  background-color: var(--identity-box-verified-background-color);
-}
-
-#identity-box:-moz-focusring {
-  outline: 1px dotted #000;
-  outline-offset: -3px;
-}
-
-%include ../shared/identity-block/identity-block.inc.css
-
-%include ../shared/notification-icons.inc.css
-
-.popup-notification-body[popupid="addon-progress"],
-.popup-notification-body[popupid="addon-install-confirmation"] {
-  width: 28em;
-  max-width: 28em;
-}
-
-.addon-install-confirmation-name {
-  font-weight: bold;
-}
-
-/* Notification icon box */
-#notification-popup-box {
-  border-radius: 2.5px 0 0 2.5px;
-}
-
-.notification-anchor-icon:-moz-focusring {
-  outline: 1px dotted -moz-DialogText;
-}
-
-.indexedDB-notification-icon,
-#indexedDB-notification-icon {
-  list-style-image: url(moz-icon://stock/gtk-dialog-question?size=16);
-}
-
-/* Translation infobar */
-
-%include ../shared/translation/infobar.inc.css
-
-notification[value="translation"] {
-  min-height: 40px;
-}
-
-notification[value="translation"],
-notification[value="translation"] button,
-notification[value="translation"] menulist {
-  min-height: 30px;
-  color: #5A5959;
-}
-
-notification[value="translation"] {
-  background-color: #F2F1F0;
-}
-
-notification[value="translation"] button,
-notification[value="translation"] menulist {
-  -moz-padding-end: 1ch;
-}
-
-notification[value="translation"] menulist {
-  border: 1px solid #C1C1C1;
-  background-color: #FFF;
-}
-
-notification[value="translation"] button {
-  border: 1px solid #C1C1C1;
-  background-color: #F2F1F0;
-}
-
-notification[value="translation"] button,
-notification[value="translation"] menulist,
-notification[value="translation"] menulist > .menulist-label-box {
-  -moz-margin-start: 1ch;
-  -moz-margin-end: 1ch;
-}
-
-notification[value="translation"] button:hover,
-notification[value="translation"] button:active,
-notification[value="translation"] menulist:hover,
-notification[value="translation"] menulist:active {
-  background-color: #E2E1E0;
-}
-
-notification[value="translation"] button[anonid="translate"] {
-  color: #FFF;
-  background-image: linear-gradient(#9FB938, #8DA726);
-  box-shadow: none;
-  border: 1px solid #829C1C;
-}
-
-notification[value="translation"] button[anonid="translate"]:hover,
-notification[value="translation"] button[anonid="translate"]:active {
-  background-image: linear-gradient(#8DA726, #8DA726);
-}
-
-notification[value="translation"] button > .button-box,
-notification[value="translation"] button[type="menu"] > .button-box > .button-menu-dropmarker {
-  padding: 0;
-  -moz-margin-start: 3ch;
-}
-
-notification[value="translation"] button:not([type="menu"]) > .button-box {
-  -moz-margin-end: 3ch;
-}
-
-notification[value="translation"] menulist > .menulist-dropmarker {
-  display: block;
-}
-
-#treecolAutoCompleteImage {
-  max-width : 36px;
-}
-
-.ac-result-type-bookmark,
-.autocomplete-treebody::-moz-tree-image(bookmark, treecolAutoCompleteImage) {
-  list-style-image: url("chrome://browser/skin/places/autocomplete-star.png");
-  width: 16px;
-  height: 16px;
-}
-
-.ac-result-type-keyword,
-.autocomplete-treebody::-moz-tree-image(keyword, treecolAutoCompleteImage),
-richlistitem[type~="action"][actiontype="searchengine"] > .ac-title-box > .ac-site-icon {
-  list-style-image: url(chrome://global/skin/icons/autocomplete-search.svg#search-icon);
-  width: 16px;
-  height: 16px;
-}
-
-.ac-result-type-keyword[selected="true"],
-.autocomplete-treebody::-moz-tree-image(keyword, treecolAutoCompleteImage, selected),
-richlistitem[type~="action"][actiontype="searchengine"][selected="true"] > .ac-title-box > .ac-site-icon {
-  list-style-image: url(chrome://global/skin/icons/autocomplete-search.svg#search-icon-inverted);
-}
-
-.ac-result-type-tag,
-.autocomplete-treebody::-moz-tree-image(tag, treecolAutoCompleteImage) {
-  list-style-image: url("chrome://browser/skin/places/tag.png");
-  width: 16px;
-  height: 16px;
-}
-
-.ac-comment,
-#PopupAutoCompleteRichResult > hbox[anonid="search-suggestions-notification"] > description,
-#PopupAutoCompleteRichResult > hbox[anonid="search-suggestions-notification"] > button {
-  font-size: 1.05em;
-}
-
-.ac-extra > .ac-comment {
-  font-size: inherit;
-}
-
-.ac-url-text,
-.ac-action-text {
-  color: -moz-nativehyperlinktext;
-  font-size: 0.9em;
-}
-
-richlistitem[type~="action"][actiontype$="tab"] > .ac-url-box > .ac-action-icon {
-  list-style-image: url("chrome://browser/skin/actionicon-tab.png");
-  padding: 0 3px;
-}
-
-.autocomplete-treebody::-moz-tree-cell-text(treecolAutoCompleteComment) {
-  color: GrayText;
-}
-
-.ac-comment[selected="true"],
-.ac-url-text[selected="true"],
-.ac-action-text[selected="true"] {
-  color: inherit !important;
-}
-
-.autocomplete-treebody::-moz-tree-cell-text(suggesthint, treecolAutoCompleteComment),
-.autocomplete-treebody::-moz-tree-cell-text(suggestfirst, treecolAutoCompleteComment) {
-  color: GrayText;
-  font-size: smaller;
-}
-
-.autocomplete-treebody::-moz-tree-cell(suggesthint) {
-  border-top: 1px solid GrayText;
-}
-
-/* Combined go/reload/stop button in location bar */
-
-#urlbar-go-button,
-#urlbar-reload-button,
-#urlbar-stop-button {
-  -moz-appearance: none;
-  list-style-image: url("chrome://browser/skin/reload-stop-go.png");
-  padding: 0 9px;
-  margin-inline-start: 5px;
-  border-inline-start: 1px solid var(--urlbar-separator-color);
-  border-image: linear-gradient(transparent 15%,
-                                var(--urlbar-separator-color) 15%,
-                                var(--urlbar-separator-color) 85%,
-                                transparent 85%);
-  border-image-slice: 1;
-}
-
-#urlbar-reload-button {
-  -moz-image-region: rect(0, 14px, 14px, 0);
-}
-
-#urlbar-reload-button:not([disabled]):hover {
-  -moz-image-region: rect(14px, 14px, 28px, 0);
-}
-
-#urlbar-reload-button:not([disabled]):hover:active {
-  -moz-image-region: rect(28px, 14px, 42px, 0);
-}
-
-#urlbar-reload-button:-moz-locale-dir(rtl) > .toolbarbutton-icon {
-  transform: scaleX(-1);
-}
-
-#urlbar-go-button {
-  -moz-image-region: rect(0, 42px, 14px, 28px);
-}
-
-#urlbar-go-button:hover {
-  -moz-image-region: rect(14px, 42px, 28px, 28px);
-}
-
-#urlbar-go-button:hover:active {
-  -moz-image-region: rect(28px, 42px, 42px, 28px);
-}
-
-#urlbar-go-button:-moz-locale-dir(rtl) > .toolbarbutton-icon {
-  transform: scaleX(-1);
-}
-
-#urlbar-stop-button {
-  -moz-image-region: rect(0, 28px, 14px, 14px);
-}
-
-#urlbar-stop-button:not([disabled]):hover {
-  -moz-image-region: rect(14px, 28px, 28px, 14px);
-}
-
-#urlbar-stop-button:hover:active {
-  -moz-image-region: rect(28px, 28px, 42px, 14px);
-}
-
-@media (min-resolution: 1.1dppx) {
-  #urlbar-go-button,
-  #urlbar-reload-button,
-  #urlbar-stop-button {
-    list-style-image: url("chrome://browser/skin/reload-stop-go@2x.png");
-  }
-
-  #urlbar-go-button > .toolbarbutton-icon,
-  #urlbar-reload-button > .toolbarbutton-icon,
-  #urlbar-stop-button > .toolbarbutton-icon {
-    width: 14px;
-  }
-
-  #urlbar-go-button {
-    -moz-image-region: rect(0, 84px, 28px, 56px);
-  }
-
-  #urlbar-go-button:hover {
-    -moz-image-region: rect(28px, 84px, 56px, 56px);
-  }
-
-  #urlbar-go-button:hover:active {
-    -moz-image-region: rect(56px, 84px, 84px, 56px);
-  }
-
-  #urlbar-reload-button {
-    -moz-image-region: rect(0, 28px, 28px, 0);
-  }
-
-  #urlbar-reload-button:not([disabled]):hover {
-    -moz-image-region: rect(28px, 28px, 56px, 0);
-  }
-
-  #urlbar-reload-button:not([disabled]):hover:active {
-    -moz-image-region: rect(56px, 28px, 84px, 0);
-  }
-
-  #urlbar-stop-button {
-    -moz-image-region: rect(0, 56px, 28px, 28px);
-  }
-
-  #urlbar-stop-button:not([disabled]):hover {
-    -moz-image-region: rect(28px, 56px, 56px, 28px);
-  }
-
-  #urlbar-stop-button:hover:active {
-    -moz-image-region: rect(56px, 56px, 84px, 28px);
-  }
-}
-
-/* Popup blocker button */
-#page-report-button {
-  list-style-image: url("chrome://browser/skin/Info.png");
-}
-
-/* Reader mode button */
-
-#reader-mode-button {
-  list-style-image: url("chrome://browser/skin/readerMode.svg");
-  -moz-image-region: rect(0, 16px, 16px, 0);
-}
-
-#reader-mode-button:hover,
-#reader-mode-button[readeractive]:hover {
-  -moz-image-region: rect(0, 32px, 16px, 16px);
-}
-
-#reader-mode-button:hover:active,
-#reader-mode-button[readeractive] {
-  -moz-image-region: rect(0, 48px, 16px, 32px);
-}
-
-/* social share panel */
-
-.social-share-frame {
-  border-top: 1px solid #f8f8f8;
-  width: 756px;
-  height: 150px;
-}
-
-#share-container {
-  min-width: 756px;
-  background-color: white;
-  background-repeat: no-repeat;
-  background-position: center center;
-}
-#share-container[loading] {
-  background-image: url(chrome://browser/skin/tabbrowser/pendingpaint.png);
-}
-#share-container > browser {
-  transition: opacity 150ms ease-in-out;
-  opacity: 1;
-}
-#share-container[loading] > browser {
-  opacity: 0;
-}
-
-.social-share-toolbar {
-  border-bottom: 1px solid #dedede;
-  padding: 2px;
-}
-
-#social-share-provider-buttons {
-  padding: 0;
-  margin: 0;
-}
-
-.share-provider-button {
-  padding: 5px;
-  margin: 2px;
-}
-
-.share-provider-button > .toolbarbutton-text {
-  display: none;
-}
-.share-provider-button > .toolbarbutton-icon {
-  width: 16px;
-  min-height: 16px;
-  max-height: 16px;
-}
-
-/* social recommending panel */
-
-#social-mark-button {
-  -moz-image-region: rect(0, 16px, 16px, 0);
-}
-
-/* bookmarks menu-button */
-
-#bookmarks-menu-button[cui-areatype="toolbar"] > .toolbarbutton-menubutton-dropmarker {
-  -moz-appearance: none !important;
-  -moz-box-align: center;
-}
-
-#bookmarks-menu-button[cui-areatype="toolbar"] > .toolbarbutton-menubutton-dropmarker > .dropmarker-icon {
-  margin-top: 3px;
-  margin-bottom: 3px;
-}
-
-#bookmarks-menu-button[disabled][cui-areatype="toolbar"] > .toolbarbutton-icon,
-#bookmarks-menu-button[disabled][cui-areatype="toolbar"] > .toolbarbutton-menu-dropmarker,
-#bookmarks-menu-button[disabled][cui-areatype="toolbar"] > .toolbarbutton-menubutton-dropmarker,
-#bookmarks-menu-button[disabled][cui-areatype="toolbar"] > .toolbarbutton-menubutton-button > .toolbarbutton-icon,
-#bookmarks-menu-button[cui-areatype="toolbar"] > .toolbarbutton-menubutton-button[disabled] > .toolbarbutton-icon {
-  opacity: .4;
-}
-
-#BMB_bookmarksPopup[side="top"],
-#BMB_bookmarksPopup[side="bottom"] {
-  margin-left: -16px;
-  margin-right: -16px;
-}
-
-#BMB_bookmarksPopup[side="left"],
-#BMB_bookmarksPopup[side="right"] {
-  margin-top: -16px;
-  margin-bottom: -16px;
-}
-
-#nav-bar .toolbarbutton-1 > menupopup[side="top"].cui-widget-panel,
-#nav-bar .toolbarbutton-1 > menupopup[side="bottom"].cui-widget-panel {
-  margin-top: -4px;
-}
-
-/* Bookmarking panel */
-#editBookmarkPanelStarIcon {
-  list-style-image: url("chrome://browser/skin/places/starred48.png");
-  width: 48px;
-  height: 48px;
-}
-
-#editBookmarkPanelStarIcon[unstarred] {
-  list-style-image: url("chrome://browser/skin/places/unstarred48.png");
-}
-
-#editBookmarkPanelTitle {
-  font-size: 130%;
-}
-
-#editBookmarkPanelHeader,
-#editBookmarkPanelContent {
-  margin-bottom: .5em;
-}
-
-/* Implements editBookmarkPanel resizing on folderTree un-collapse. */
-#editBMPanel_folderTree {
-  min-width: 27em;
-}
-
-.panel-promo-box {
-  margin: 8px -10px -10px -10px;
-  padding: 8px 10px;
-  border-top: 1px solid ThreeDShadow;
-  background-image: linear-gradient(hsla(0,0%,0%,.15), hsla(0,0%,0%,.08) 6px);
-}
-
-.panel-promo-icon {
-  list-style-image: url("chrome://browser/skin/sync-notification-24.png");
-  -moz-margin-end: 10px;
-  vertical-align: middle;
-}
-
-.panel-promo-closebutton {
-  -moz-appearance: none;
-  height: 16px;
-  width: 16px;
-}
-
-.panel-promo-closebutton > .toolbarbutton-text {
-  padding: 0;
-}
-
-/* Content area */
-#sidebar {
-  background-color: Window;
-}
-
-#sidebar-header > .close-icon:not(:hover):-moz-lwtheme-brighttext {
-  background-image: -moz-image-rect(url("chrome://global/skin/icons/close.svg"), 0, 80, 16, 64);
-}
-
-.browserContainer > findbar {
-  background-color: -moz-dialog;
-  color: -moz-DialogText;
-  text-shadow: none;
-}
-
-/* Tabstrip */
-
-%include ../shared/tabs.inc.css
-
-#tabbrowser-tabs {
-  /* override the global style to allow the selected tab to be above the nav-bar */
-  z-index: auto;
-}
-
-#TabsToolbar {
-  min-height: 0;
-  padding: 0;
-  margin-bottom: calc(-1 * var(--tab-toolbar-navbar-overlap));
-}
-
-#TabsToolbar:not(:-moz-lwtheme) {
-  -moz-appearance: menubar;
-  color: -moz-menubartext;
-}
-
-#toolbar-menubar:not([autohide="true"]):not(:-moz-lwtheme):-moz-system-metric(menubar-drag),
-#TabsToolbar:not(:-moz-lwtheme):-moz-system-metric(menubar-drag) {
-  -moz-binding: url("chrome://browser/content/customizableui/toolbar.xml#toolbar-drag");
-}
-
-.tabbrowser-tab:focus > .tab-stack > .tab-content {
-  outline: 1px dotted;
-  outline-offset: -6px;
-}
-
-#context_reloadTab {
-  list-style-image: url("moz-icon://stock/gtk-refresh?size=menu");
-}
-
-#context_closeOtherTabs {
-  list-style-image: url("moz-icon://stock/gtk-clear?size=menu");
-}
-
-#context_closeOtherTabs[disabled] {
-  list-style-image: url("moz-icon://stock/gtk-clear?size=menu&state=disabled");
-}
-
-#context_undoCloseTab {
-  list-style-image: url("moz-icon://stock/gtk-undelete?size=menu");
-}
-
-#context_closeTab {
-  list-style-image: url("moz-icon://stock/gtk-close?size=menu");
-}
-
-/* Tab drag and drop */
-.tab-drop-indicator {
-  list-style-image: url(chrome://browser/skin/tabbrowser/tabDragIndicator.png);
-  margin-bottom: -9px;
-  z-index: 3;
-}
-
-/* Tab close button */
-.tab-close-button:not([visuallyselected]):not(:hover) {
-  background-image: -moz-image-rect(url("chrome://global/skin/icons/close.svg"), 0, 64, 16, 48);
-}
-
-.tab-close-button:not(:hover):-moz-lwtheme-brighttext,
-#TabsToolbar[brighttext] .tab-close-button:not([visuallyselected]):not(:hover) {
-  background-image: -moz-image-rect(url("chrome://global/skin/icons/close.svg"), 0, 80, 16, 64);
-}
-
-.tab-close-button:not(:hover):-moz-lwtheme-darktext {
-  background-image: -moz-image-rect(url("chrome://global/skin/icons/close.svg"), 0, 96, 16, 80);
-}
-
-/* Tabstrip new tab button */
-.tabs-newtab-button,
-#TabsToolbar > #new-tab-button ,
-#TabsToolbar > #wrapper-new-tab-button > #new-tab-button {
-  list-style-image: url("moz-icon://stock/gtk-add?size=menu");
-  -moz-image-region: auto;
-}
-
-/* Tabbrowser arrowscrollbox arrows */
-.tabbrowser-arrowscrollbox > .scrollbutton-up > .toolbarbutton-icon,
-.tabbrowser-arrowscrollbox > .scrollbutton-down > .toolbarbutton-icon {
-  -moz-appearance: none;
-}
-
-.tabbrowser-arrowscrollbox > .scrollbutton-up,
-.tabbrowser-arrowscrollbox > .scrollbutton-down {
-  -moz-appearance: none;
-  list-style-image: url("chrome://browser/skin/tabbrowser/tab-arrow-left.png");
-  margin: 0 0 var(--tab-toolbar-navbar-overlap);
-}
-
-#TabsToolbar[brighttext] > #tabbrowser-tabs > .tabbrowser-arrowscrollbox > .scrollbutton-up,
-#TabsToolbar[brighttext] > #tabbrowser-tabs > .tabbrowser-arrowscrollbox > .scrollbutton-down {
-  list-style-image: url(chrome://browser/skin/tabbrowser/tab-arrow-left-inverted.png);
-}
-
-.tabbrowser-arrowscrollbox > .scrollbutton-up[disabled],
-.tabbrowser-arrowscrollbox > .scrollbutton-down[disabled] {
-  opacity: .4;
-}
-
-.tabbrowser-arrowscrollbox > .scrollbutton-up:-moz-locale-dir(rtl),
-.tabbrowser-arrowscrollbox > .scrollbutton-down:-moz-locale-dir(ltr) {
-  transform: scaleX(-1);
-}
-
-.tabbrowser-arrowscrollbox > .scrollbutton-down {
-  transition: 1s background-color ease-out;
-}
-
-.tabbrowser-arrowscrollbox > .scrollbutton-down[notifybgtab] {
-  background-color: Highlight;
-  transition: none;
-}
-
-#TabsToolbar .toolbarbutton-1 {
-  margin-bottom: var(--tab-toolbar-navbar-overlap);
-}
-
-#alltabs-button {
-  list-style-image: url("chrome://browser/skin/tabbrowser/alltabs.png");
-}
-
-#TabsToolbar[brighttext] > #alltabs-button,
-#TabsToolbar[brighttext] > toolbarpaletteitem > #alltabs-button {
-  list-style-image: url("chrome://browser/skin/tabbrowser/alltabs-inverted.png");
-}
-
-#alltabs-button > .toolbarbutton-icon {
-  padding: 9px 6px 6px;
-}
-
-#alltabs-button > .toolbarbutton-menu-dropmarker {
-  display: none;
-}
-
-/* All tabs menupopup */
-.alltabs-item > .menu-iconic-left > .menu-iconic-icon {
-  list-style-image: url("chrome://mozapps/skin/places/defaultFavicon.png");
-}
-
-.alltabs-item[selected="true"] {
-  font-weight: bold;
-}
-
-.alltabs-item[busy] > .menu-iconic-left > .menu-iconic-icon {
-  list-style-image: url("chrome://global/skin/icons/loading_16.png");
-}
-
-.alltabs-item[tabIsVisible] {
-  /* box-shadow instead of background-color to work around native styling */
-  box-shadow: inset -5px 0 ThreeDShadow;
-}
-
-.alltabs-endimage[muted] {
-  list-style-image: url(chrome://browser/skin/tabbrowser/tab-audio.svg#tab-audio-menu-muted);
-}
-
-.alltabs-endimage[soundplaying] {
-  list-style-image: url(chrome://browser/skin/tabbrowser/tab-audio.svg#tab-audio-menu);
-}
-
-menuitem:hover > hbox > .alltabs-endimage[muted] {
-  list-style-image: url(chrome://browser/skin/tabbrowser/tab-audio.svg#tab-audio-menu-muted-hover);
-}
-
-menuitem:hover > hbox > .alltabs-endimage[soundplaying] {
-  list-style-image: url(chrome://browser/skin/tabbrowser/tab-audio.svg#tab-audio-menu-hover);
-}
-
-/* Sidebar */
-#sidebar-throbber[loading="true"] {
-  list-style-image: url("chrome://global/skin/icons/loading_16.png");
-  -moz-margin-end: 4px;
-}
-
-toolbarbutton.chevron {
-  list-style-image: url("chrome://global/skin/toolbar/chevron.gif") !important;
-}
-
-toolbar[brighttext] toolbarbutton.chevron:not(:hover):not([open="true"]) {
-  list-style-image: url("chrome://global/skin/toolbar/chevron-inverted.png") !important;
-}
-
-toolbarbutton.chevron:-moz-locale-dir(rtl) > .toolbarbutton-icon {
-  transform: scaleX(-1);
-}
-
-toolbarbutton.chevron > .toolbarbutton-text,
-toolbarbutton.chevron > .toolbarbutton-menu-dropmarker {
-  display: none;
-}
-
-toolbarbutton.chevron > .toolbarbutton-icon {
-  margin: 0;
-}
-
-/* Ctrl-Tab */
-
-.ctrlTab-preview {
-  -moz-appearance: toolbarbutton;
-}
-
-.tabPreview-canvas {
-  box-shadow: 0 0 5px ThreeDShadow;
-}
-
-.ctrlTab-preview:focus .tabPreview-canvas,
-.ctrlTab-preview:hover .tabPreview-canvas {
-  box-shadow: none;
-}
-
-.ctrlTab-favicon[src] {
-  background-color: white;
-  width: 20px;
-  height: 20px;
-  padding: 2px;
-}
-
-#ctrlTab-panel {
-  padding: 10px;
-}
-
-.ctrlTab-preview:not(#ctrlTab-showAll) .tabPreview-canvas {
-  margin-bottom: 2px;
-}
-
-#ctrlTab-showAll {
-  -moz-appearance: button;
-  color: ButtonText;
-  padding: 0 3px;
-  margin-top: 10px;
-}
-
-/* Sync Panel */
-
-.sync-panel-icon {
-  height:32px;
-  width: 32px;
-  background: url("chrome://browser/content/abouthome/sync.png") top left no-repeat;
-}
-
-.sync-panel-inner {
-  width: 0;
-  padding-left: 10px;
-}
-
-.sync-panel-button-box {
-  margin-top: 1em;
-}
-
-#sync-start-panel-title {
-  font-size: 120%;
-  font-weight: bold;
-  margin-bottom: 5px;
-}
-
-#sync-start-panel-subtitle {
-  margin-bottom: 0;
-}
-
-/* Status panel */
-
-.statuspanel-label {
-  margin: 0;
-  padding: 2px 4px;
-  background: linear-gradient(#fff, #ddd);
-  border: 1px none #ccc;
-  border-top-style: solid;
-  color: #333;
-  text-shadow: none;
-}
-
-.statuspanel-label:-moz-locale-dir(ltr):not([mirror]),
-.statuspanel-label:-moz-locale-dir(rtl)[mirror] {
-  border-right-style: solid;
-  border-top-right-radius: .3em;
-  margin-right: 1em;
-}
-
-.statuspanel-label:-moz-locale-dir(rtl):not([mirror]),
-.statuspanel-label:-moz-locale-dir(ltr)[mirror] {
-  border-left-style: solid;
-  border-top-left-radius: .3em;
-  margin-left: 1em;
-}
-
-%include ../shared/fullscreen/warning.inc.css
-%include ../../../devtools/client/themes/responsivedesign.inc.css
-%include ../../../devtools/client/themes/commandline.inc.css
-%include ../shared/plugin-doorhanger.inc.css
-%include ../shared/login-doorhanger.inc.css
-
-%include downloads/indicator.css
-
-.gcli-panel {
-  padding: 0;
-}
-
-.gclitoolbar-input-node > .textbox-input-box > html|*.textbox-input::-moz-selection {
-  color: hsl(210,11%,16%);
-}
-
-/* Error counter */
-
-#developer-toolbar-toolbox-button[error-count]:before {
-  color: #FDF3DE;
-  min-width: 16px;
-  text-shadow: none;
-  background-image: linear-gradient(#B4211B, #8A1915);
-  border-radius: 1px;
-  -moz-margin-end: 2px;
-}
-
-/* Social toolbar item */
-
-.social-activation-icon {
-  width: auto;
-  height: auto;
-  max-height: 64px;
-  max-width: 64px;
-}
-
-#social-activation-message {
-  max-width: 250px;
-}
-
-#social-activation-message > label {
-  margin: 0;
-}
-
-/* social toolbar provider menu */
-#social-statusarea-popup {
-  margin-top: 0;
-  margin-left: -12px;
-  margin-right: -12px;
-}
-
-.social-statusarea-user {
-  list-style-image:url("chrome://global/skin/icons/information-32.png");
-}
-
-.social-statusarea-user-portrait {
-  width: 32px;
-  height: 32px;
-  border-radius: 2px;
-  margin: 10px;
-}
-
-.social-panel > .panel-arrowcontainer > .panel-arrowcontent {
-  padding: 0;
-}
-
-%include ../shared/social/chat.inc.css
-
-/* Customization mode */
-
-%include ../shared/customizableui/customizeMode.inc.css
-
-#main-window[customize-entered] > #tab-view-deck {
-  background-image: url("chrome://browser/skin/customizableui/customizeMode-gridTexture.png"),
-                    linear-gradient(to bottom, #bcbcbc, #b5b5b5);
-  background-attachment: fixed;
-}
-
-#main-window[customization-lwtheme] > #tab-view-deck:-moz-lwtheme {
-  background-repeat: no-repeat;
-  background-position: right top;
-  background-attachment: fixed;
-  /* The image will get set from CustomizeMode.jsm */
-  background-image: none;
-  background-color: transparent;
-}
-
-#main-window[customization-lwtheme]:-moz-lwtheme {
-  background-image: url("chrome://browser/skin/customizableui/customizeMode-gridTexture.png"),
-                    url("chrome://browser/skin/customizableui/background-noise-toolbar.png"),
-                    linear-gradient(to bottom, #bcbcbc, #b5b5b5);
-  background-color: #b5b5b5;
-  background-repeat: repeat;
-  background-attachment: fixed;
-  background-position: left top;
-}
-
-#main-window[customize-entered] #browser-bottombox,
-#main-window[customize-entered] #navigator-toolbox > toolbar:not(#toolbar-menubar):not(#TabsToolbar),
-#main-window[customize-entered] #customization-container {
-  border: 3px solid hsla(0,0%,0%,.1);
-  border-top-width: 0;
-  background-clip: padding-box;
-  background-origin: padding-box;
-  -moz-border-right-colors: hsla(0,0%,0%,.05) hsla(0,0%,0%,.1) hsla(0,0%,0%,.2);
-  -moz-border-bottom-colors: hsla(0,0%,0%,.05) hsla(0,0%,0%,.1) hsla(0,0%,0%,.2);
-  -moz-border-left-colors: hsla(0,0%,0%,.05) hsla(0,0%,0%,.1) hsla(0,0%,0%,.2);
-}
-
-#main-window[customize-entered] #customization-container,
-#main-window[customize-entered] #navigator-toolbox > toolbar:not(#toolbar-menubar):not(#TabsToolbar) {
-  border-bottom-width: 0;
-}
-
-#main-window[customize-entered] #TabsToolbar {
-  -moz-appearance: none;
-  background-clip: padding-box;
-  border-right: 3px solid transparent;
-  border-left: 3px solid transparent;
-}
-
-/* The :hover:active style from toolkit doesn't seem to work in this panel so just use :active. */
-.customization-tipPanel-closeBox > .close-icon:active {
-  background-image: -moz-image-rect(url("chrome://global/skin/icons/close.svg"), 0, 48, 16, 32);
-}
-
-/* End customization mode */
-
-
-#main-window[privatebrowsingmode=temporary] #private-browsing-indicator {
-  background: url("chrome://browser/skin/privatebrowsing-mask.png") center no-repeat;
-  width: 40px;
-}
-
-%include ../shared/UITour.inc.css
-
-#UITourHighlight {
-  /* Below are some fixes for people without an X compositor on Linux.
-     This is why we can't have nice things: */
-  /* Animations don't repaint properly without an X compositor. */
-  animation-name: none !important;
-  /* Opacity rounds to 0 or 1 on Linux without an X compositor so make the
-     background be transparent in that case by having all alpha values < 0.5 */
-  background-image: radial-gradient(50% 100%, rgba(0,149,220,0.3) 50%, rgba(0,149,220,0.49) 100%);
-  /* The highlight isn't anti-aliased without an X compositor so make it thicker.
-     Make it a darker color since we don't have the box-shadow in this case. */
-  border: 4px solid rgb(0,149,220);
-}
-
-#UITourTooltipDescription {
-  font-size: 1.05rem;
-}
-
-#UITourTooltipClose {
-  -moz-margin-end: -4px;
-  height: 16px;
-  width: 16px;
-}
-
-#UITourTooltipButtons {
-  margin-bottom: -10px;
-}
-
-%include ../shared/contextmenu.inc.css
-
-#context-navigation > .menuitem-iconic > .menu-iconic-left {
-  visibility: visible;
-  /* override toolkit/themes/linux/global/menu.css */
-  -moz-padding-end: 0 !important;
-  -moz-margin-end: 0 !important;
-}
-
-.browser-extension-panel > .panel-arrowcontainer > .panel-arrowcontent {
-  padding: 0;
-  overflow: hidden;
-}
-
-%include ../shared/usercontext/usercontext.inc.css
diff --git a/browser/themes/linux/browser.css.rej b/browser/themes/linux/browser.css.rej
deleted file mode 100644
index 35adea8..0000000
--- a/browser/themes/linux/browser.css.rej
+++ /dev/null
@@ -1,13 +0,0 @@
---- browser/themes/linux/browser.css	2016-04-12 11:54:00 +0100
-+++ browser/themes/linux/browser.css	2016-04-12 16:57:53 +0100
-@@ -108,10 +104,6 @@
-   padding-bottom: 2px;
- }
- 
--#nav-bar:-moz-lwtheme {
--  box-shadow: 0 1px 0 @toolbarHighlightLWT@ inset;
--}
--
- #nav-bar-overflow-button {
-   -moz-image-region: rect(-5px, 12px, 11px, -4px);
- }
diff --git a/browser/themes/linux/linuxShared.inc.orig b/browser/themes/linux/linuxShared.inc.orig
deleted file mode 100644
index a968512..0000000
--- a/browser/themes/linux/linuxShared.inc.orig
+++ /dev/null
@@ -1,13 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-%filter substitution
-
-%define toolbarHighlight hsla(0,0%,100%,.05)
-%define toolbarHighlightLWT rgba(255,255,255,.4)
-/* navbarInsetHighlight is tightly coupled to the toolbarHighlight constant. */
-%define navbarInsetHighlight hsla(0,0%,100%,.4)
-%define fgTabTexture linear-gradient(transparent 2px, @toolbarHighlight@ 2px, @toolbarHighlight@)
-%define fgTabTextureLWT linear-gradient(transparent 2px, @toolbarHighlightLWT@ 2px, @toolbarHighlightLWT@)
-%define fgTabBackgroundColor -moz-dialog
diff --git a/browser/themes/linux/linuxShared.inc.rej b/browser/themes/linux/linuxShared.inc.rej
deleted file mode 100644
index dd1e7d7..0000000
--- a/browser/themes/linux/linuxShared.inc.rej
+++ /dev/null
@@ -1,13 +0,0 @@
---- browser/themes/linux/linuxShared.inc	2016-04-12 11:54:00 +0100
-+++ browser/themes/linux/linuxShared.inc	2016-04-12 16:57:53 +0100
-@@ -4,8 +4,7 @@
- 
- %filter substitution
- 
--%define toolbarHighlight hsla(0,0%,100%,.05)
--%define toolbarHighlightLWT rgba(255,255,255,.4)
-+%define toolbarHighlight rgba(255,255,255,.4)
- %define fgTabTexture linear-gradient(transparent 2px, @toolbarHighlight@ 2px, @toolbarHighlight@)
--%define fgTabTextureLWT linear-gradient(transparent 2px, @toolbarHighlightLWT@ 2px, @toolbarHighlightLWT@)
-+%define fgTabTextureLWT @fgTabTexture@
- %define fgTabBackgroundColor -moz-dialog
diff --git a/build/stlport/README.original b/build/stlport/README.original
deleted file mode 100644
index a759495..0000000
--- a/build/stlport/README.original
+++ /dev/null
@@ -1,64 +0,0 @@
-**********************************************************************
-* 	README file for STLport 5.0                                    *
-*                                                                    *
-**********************************************************************
-
-This directory contains the STLport-5.0 release.
-
-What's inside :
-
-README           - this file
-INSTALL          - installation instructions
-
-bin              - installation directory for STLport unit tests;
-                   it may contain more subdirs, if you use
-                   crosscompilation
-build/lib        - build directory for STLport library (if you use
-                   STLport iostreams and/or locale only)
-build/test/unit  - build directory for regression (unit) tests
-build/test/eh    - build directory for exception handling tests
-stlport          - main STLport include directory
-src              - source for iostreams implementation and other parts
-                   that aren't pure template code
-lib              - installation directory for STLport library (if you
-                   use STLport iostreams and/or locale only);
-                   it may contain more subdirs, if you use
-                   crosscompilation
-test/unit        - unit (regression) tests
-test/eh          - exception handling test using STLport iostreams
-etc              - miscellanous files (ChangeLog, TODO, scripts, etc.) 
-
-GETTING STLPORT
-
-To download the latest version of STLport, please be sure to visit
-https://sourceforge.net/project/showfiles.php?group_id=146814
-
-LEGALESE
-
-This software is being distributed under the following terms:
-
- *
- *
- * Copyright (c) 1994
- * Hewlett-Packard Company
- *
- * Copyright (c) 1996-1999
- * Silicon Graphics Computer Systems, Inc.
- *
- * Copyright (c) 1997
- * Moscow Center for SPARC Technology
- *
- * Copyright (c) 1999-2003
- * Boris Fomitchev
- *
- * This material is provided "as is", with absolutely no warranty expressed
- * or implied. Any use is at your own risk.
- *
- * Permission to use or copy this software for any purpose is hereby granted 
- * without fee, provided the above notices are retained on all copies.
- * Permission to modify the code and to distribute modified code is granted,
- * provided the above notices are retained, and a notice that the code was
- * modified is included with the above copyright notice.
- *
-
-**********************************************************************
diff --git a/intl/icu/source/acinclude.m4.orig b/intl/icu/source/acinclude.m4.orig
deleted file mode 100644
index b64e984..0000000
--- a/intl/icu/source/acinclude.m4.orig
+++ /dev/null
@@ -1,500 +0,0 @@
-# Copyright (c) 1999-2015, International Business Machines Corporation and
-# others. All Rights Reserved.
-# acinclude.m4 for ICU
-# Don't edit aclocal.m4, do edit acinclude.m4
-# Stephen F. Booth
-
-# @TOP@
-
-# ICU_CHECK_MH_FRAG
-AC_DEFUN([ICU_CHECK_MH_FRAG], [
-	AC_CACHE_CHECK(
-		[which Makefile fragment to use for ${host}],
-		[icu_cv_host_frag],
-		[
-case "${host}" in
-*-*-solaris*)
-	if test "$GCC" = yes; then	
-		icu_cv_host_frag=mh-solaris-gcc
-	else
-		icu_cv_host_frag=mh-solaris
-	fi ;;
-alpha*-*-linux-gnu)
-	if test "$GCC" = yes; then
-		icu_cv_host_frag=mh-alpha-linux-gcc
-	else
-		icu_cv_host_frag=mh-alpha-linux-cc
-	fi ;;
-powerpc*-*-linux*)
-	if test "$GCC" = yes; then
-		icu_cv_host_frag=mh-linux
-	else
-		icu_cv_host_frag=mh-linux-va
-	fi ;;
-*-*-linux*|*-*-gnu|*-*-k*bsd*-gnu|*-*-kopensolaris*-gnu) icu_cv_host_frag=mh-linux ;;
-i[[34567]]86-*-cygwin) 
-	if test "$GCC" = yes; then
-		icu_cv_host_frag=mh-cygwin
-	else
-		icu_cv_host_frag=mh-cygwin-msvc
-	fi ;;
-x86_64-*-cygwin) 
-	if test "$GCC" = yes; then
-		icu_cv_host_frag=mh-cygwin64
-	else
-		icu_cv_host_frag=mh-cygwin-msvc
-	fi ;;
-*-*-mingw*)
-	if test "$GCC" = yes; then
-                AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[
-#ifndef __MINGW64__
-#error This is not MinGW64
-#endif]])],                        [icu_cv_host_frag=mh-mingw64],
-                                   [icu_cv_host_frag=mh-mingw])
-	else
-	        case "${host}" in
-		*-*-mingw*) icu_cv_host_frag=mh-msys-msvc ;;
-		*-*-cygwin) icu_cv_host_frag=mh-cygwin-msvc ;;
-		esac
-	fi ;;
-*-*-*bsd*|*-*-dragonfly*) 	icu_cv_host_frag=mh-bsd-gcc ;;
-*-*-aix*)
-	if test "$GCC" = yes; then
-		icu_cv_host_frag=mh-aix-gcc
-	else
-		icu_cv_host_frag=mh-aix-va
-	fi ;;
-*-*-hpux*)
-	if test "$GCC" = yes; then
-		icu_cv_host_frag=mh-hpux-gcc
-	else
-		case "$CXX" in
-		*aCC)    icu_cv_host_frag=mh-hpux-acc ;;
-		esac
-	fi ;;
-*-*ibm-openedition*|*-*-os390*)	icu_cv_host_frag=mh-os390 ;;
-*-*-os400*)	icu_cv_host_frag=mh-os400 ;;
-*-apple-rhapsody*)	icu_cv_host_frag=mh-darwin ;;
-*-apple-darwin*)	icu_cv_host_frag=mh-darwin ;;
-*-*-beos)       icu_cv_host_frag=mh-beos ;; 
-*-*-haiku)      icu_cv_host_frag=mh-haiku ;; 
-*-*-irix*)	icu_cv_host_frag=mh-irix ;;
-*-dec-osf*) icu_cv_host_frag=mh-alpha-osf ;;
-*-*-nto*)	icu_cv_host_frag=mh-qnx ;;
-*-ncr-*)	icu_cv_host_frag=mh-mpras ;;
-*) 		icu_cv_host_frag=mh-unknown ;;
-esac
-		]
-	)
-])
-
-# ICU_PROG_LINK - Make sure that the linker is usable
-AC_DEFUN([ICU_PROG_LINK],
-[
-case "${host}" in
-    *-*-cygwin*|*-*-mingw*)
-        if test "$GCC" != yes && test -n "`link --version 2>&1 | grep 'GNU coreutils'`"; then
-            AC_MSG_ERROR([link.exe is not a valid linker. Your PATH is incorrect.
-                  Please follow the directions in ICU's readme.])
-        fi;;
-    *);;
-esac])
-
-# AC_SEARCH_LIBS_FIRST(FUNCTION, SEARCH-LIBS [, ACTION-IF-FOUND
-#            [, ACTION-IF-NOT-FOUND [, OTHER-LIBRARIES]]])
-# Search for a library defining FUNC, then see if it's not already available.
-
-AC_DEFUN([AC_SEARCH_LIBS_FIRST],
-[AC_PREREQ([2.13])
-AC_CACHE_CHECK([for library containing $1], [ac_cv_search_$1],
-[ac_func_search_save_LIBS="$LIBS"
-ac_cv_search_$1="no"
-for i in $2; do
-LIBS="-l$i $5 $ac_func_search_save_LIBS"
-AC_TRY_LINK_FUNC([$1],
-[ac_cv_search_$1="-l$i"
-break])
-done
-if test "$ac_cv_search_$1" = "no"; then
-AC_TRY_LINK_FUNC([$1], [ac_cv_search_$1="none required"])
-fi
-LIBS="$ac_func_search_save_LIBS"])
-if test "$ac_cv_search_$1" != "no"; then
-  test "$ac_cv_search_$1" = "none required" || LIBS="$ac_cv_search_$1 $LIBS"
-  $3
-else :
-  $4
-fi])
-
-
-
-# Check if we can build and use 64-bit libraries
-AC_DEFUN([AC_CHECK_64BIT_LIBS],
-[
-    BITS_REQ=nochange
-    ENABLE_64BIT_LIBS=unknown
-    ## revisit this for cross-compile.
-    
-    AC_ARG_ENABLE(64bit-libs,
-        [  --enable-64bit-libs     (deprecated, use --with-library-bits) build 64-bit libraries [default= platform default]],
-        [echo "note, use --with-library-bits instead of --*-64bit-libs"
-         case "${enableval}" in
-            no|false|32) with_library_bits=32;  ;;
-            yes|true|64) with_library_bits=64else32 ;;
-            nochange) with_library_bits=nochange; ;;
-            *) AC_MSG_ERROR(bad value ${enableval} for '--*-64bit-libs') ;;
-            esac]    )
-    
-
-    AC_ARG_WITH(library-bits,
-        [  --with-library-bits=bits specify how many bits to use for the library (32, 64, 64else32, nochange) [default=nochange]],
-        [case "${withval}" in
-            ""|nochange) BITS_REQ=$withval ;;
-            32|64|64else32) BITS_REQ=$withval ;;
-            *) AC_MSG_ERROR(bad value ${withval} for --with-library-bits) ;;
-            esac])
-        
-    # don't use these for cross compiling
-    if test "$cross_compiling" = "yes" -a "${BITS_REQ}" != "nochange"; then
-        AC_MSG_ERROR([Don't specify bitness when cross compiling. See readme.html for help with cross compilation., and set compiler options manually.])
-    fi
-    AC_CHECK_SIZEOF([void *])
-    AC_MSG_CHECKING([whether runnable 64 bit binaries are built by default])
-    case $ac_cv_sizeof_void_p in
-        8) DEFAULT_64BIT=yes ;;
-        4) DEFAULT_64BIT=no ;;
-        *) DEFAULT_64BIT=unknown
-    esac
-    BITS_GOT=unknown
-    
-    # 'OK' here means, we can exit any further checking, everything's copa
-    BITS_OK=yes
-
-    # do we need to check for buildable/runnable 32 or 64 bit?
-    BITS_CHECK_32=no
-    BITS_CHECK_64=no
-    
-    # later, can we run the 32/64 bit binaries so made?
-    BITS_RUN_32=no
-    BITS_RUN_64=no
-    
-    if test "$DEFAULT_64BIT" = "yes"; then
-        # we get 64 bits by default.
-        BITS_GOT=64
-        case "$BITS_REQ" in
-            32) 
-                # need to look for 32 bit support. 
-                BITS_CHECK_32=yes
-                # not copa.
-                BITS_OK=no;;
-            # everyone else is happy.
-            nochange) ;;
-            *) ;;
-        esac
-    elif test "$DEFAULT_64BIT" = "no"; then
-        # not 64 bit by default.
-        BITS_GOT=32
-        case "$BITS_REQ" in
-            64|64else32)
-                BITS_CHECK_64=yes
-                #BITS_CHECK_32=yes
-                BITS_OK=no;;
-            nochange) ;;
-            *) ;;
-        esac
-    elif test "$DEFAULT_64BIT" = "unknown"; then
-        # cross compiling.
-        BITS_GOT=unknown
-        case "$BITS_REQ" in
-            64|64else32) BITS_OK=no
-            BITS_CHECK_32=yes
-            BITS_CHECK_64=yes ;;
-            32) BITS_OK=no;;
-            nochange) ;;
-            *) ;;
-        esac
-    fi
-            
-    AC_MSG_RESULT($DEFAULT_64BIT);
-
-    if test "$BITS_OK" != "yes"; then
-        # not copa. back these up.
-        CFLAGS_OLD="${CFLAGS}"
-        CXXFLAGS_OLD="${CXXFLAGS}"
-        LDFLAGS_OLD="${LDFLAGS}"
-        ARFLAGS_OLD="${ARFLAGS}"        
-        
-        CFLAGS_32="${CFLAGS}"
-        CXXFLAGS_32="${CXXFLAGS}"
-        LDFLAGS_32="${LDFLAGS}"
-        ARFLAGS_32="${ARFLAGS}"        
-        
-        CFLAGS_64="${CFLAGS}"
-        CXXFLAGS_64="${CXXFLAGS}"
-        LDFLAGS_64="${LDFLAGS}"
-        ARFLAGS_64="${ARFLAGS}"        
-        
-        CAN_BUILD_64=unknown
-        CAN_BUILD_32=unknown
-        # These results can't be cached because is sets compiler flags.
-        if test "$BITS_CHECK_64" = "yes"; then
-            AC_MSG_CHECKING([how to build 64-bit executables])
-            CAN_BUILD_64=no
-            ####
-            # Find out if we think we can *build* for 64 bit. Doesn't check whether we can run it.
-            #  Note, we don't have to actually check if the options work- we'll try them before using them.
-            #  So, only try actually testing the options, if you are trying to decide between multiple options.
-            # On exit from the following clauses:
-            # if CAN_BUILD_64=yes:
-            #    *FLAGS are assumed to contain the right settings for 64bit
-            # else if CAN_BUILD_64=no: (default)
-            #    *FLAGS are assumed to be trashed, and will be reset from *FLAGS_OLD
-            
-            if test "$GCC" = yes; then
-                CFLAGS="${CFLAGS} -m64"
-                CXXFLAGS="${CXXFLAGS} -m64"
-                AC_COMPILE_IFELSE([AC_LANG_SOURCE([int main(void) {return (sizeof(void*)*8==64)?0:1;}])],
-                   CAN_BUILD_64=yes, CAN_BUILD_64=no)
-            else
-                case "${host}" in
-                sparc*-*-solaris*)
-                    # 1. try -m64
-                    CFLAGS="${CFLAGS} -m64"
-                    CXXFLAGS="${CXXFLAGS} -m64"
-                    AC_RUN_IFELSE([AC_LANG_SOURCE([int main(void) {return (sizeof(void*)*8==64)?0:1;}])],
-                       CAN_BUILD_64=yes, CAN_BUILD_64=no, CAN_BUILD_64=unknown)
-                    if test "$CAN_BUILD_64" != yes; then
-                        # Nope. back out changes.
-                        CFLAGS="${CFLAGS_OLD}"
-                        CXXFLAGS="${CXXFLAGS_OLD}"
-                        # 2. try xarch=v9 [deprecated]
-                        ## TODO: cross compile: the following won't work.
-                        SPARCV9=`isainfo -n 2>&1 | grep sparcv9`
-                        SOL64=`$CXX -xarch=v9 2>&1 && $CC -xarch=v9 2>&1 | grep -v usage:`
-                        # "Warning: -xarch=v9 is deprecated, use -m64 to create 64-bit programs"
-                        if test -z "$SOL64" && test -n "$SPARCV9"; then
-                            CFLAGS="${CFLAGS} -xtarget=ultra -xarch=v9"
-                            CXXFLAGS="${CXXFLAGS} -xtarget=ultra -xarch=v9"
-                            LDFLAGS="${LDFLAGS} -xtarget=ultra -xarch=v9"
-                            CAN_BUILD_64=yes
-                        fi
-                    fi
-                    ;;
-                i386-*-solaris*)
-                    # 1. try -m64
-                    CFLAGS="${CFLAGS} -m64"
-                    CXXFLAGS="${CXXFLAGS} -m64"
-                    AC_RUN_IFELSE([AC_LANG_SOURCE([int main(void) {return (sizeof(void*)*8==64)?0:1;}])],
-                       CAN_BUILD_64=yes, CAN_BUILD_64=no, CAN_BUILD_64=unknown)
-                    if test "$CAN_BUILD_64" != yes; then
-                        # Nope. back out changes.
-                        CFLAGS="${CFLAGS_OLD}"
-                        CXXFLAGS="${CXXFLAGS_OLD}"
-                        # 2. try the older compiler option
-                        ## TODO: cross compile problem
-                        AMD64=`isainfo -n 2>&1 | grep amd64`
-                        SOL64=`$CXX -xtarget=generic64 2>&1 && $CC -xtarget=generic64 2>&1 | grep -v usage:`
-                        if test -z "$SOL64" && test -n "$AMD64"; then
-                            CFLAGS="${CFLAGS} -xtarget=generic64"
-                            CXXFLAGS="${CXXFLAGS} -xtarget=generic64"
-                            CAN_BUILD_64=yes
-                        fi
-                    fi
-                    ;;
-                ia64-*-linux*)
-                    # check for ecc/ecpc compiler support
-                    ## TODO: cross compiler problem
-                    if test -n "`$CXX --help 2>&1 && $CC --help 2>&1 | grep -v Intel`"; then
-                        if test -n "`$CXX --help 2>&1 && $CC --help 2>&1 | grep -v Itanium`"; then
-                            CAN_BUILD_64=yes
-                        fi
-                    fi
-                    ;;
-                *-*-cygwin)
-                    # vcvarsamd64.bat should have been used to enable 64-bit builds.
-                    # We only do this check to display the correct answer.
-                    ## TODO: cross compiler problem
-                    if test -n "`$CXX -help 2>&1 | grep 'for x64'`"; then
-                        CAN_BUILD_64=yes
-                    fi
-                    ;;
-                *-*-aix*|powerpc64-*-linux*)
-                    CFLAGS="${CFLAGS} -q64"
-                    CXXFLAGS="${CXXFLAGS} -q64"
-                    LDFLAGS="${LDFLAGS} -q64"
-                    AC_COMPILE_IFELSE([AC_LANG_SOURCE([int main(void) {return (sizeof(void*)*8==64)?0:1;}])],
-                       CAN_BUILD_64=yes, CAN_BUILD_64=no)
-                    if test "$CAN_BUILD_64" = yes; then
-                        # worked- set other options.
-                        case "${host}" in
-                        *-*-aix*)
-                            # tell AIX what executable mode to use.
-                            ARFLAGS="${ARFLAGS} -X64"
-                        esac
-                    fi
-                    ;;
-                *-*-hpux*)
-                    # First we try the newer +DD64, if that doesn't work,
-                    # try other options.
-
-                    CFLAGS="${CFLAGS} +DD64"
-                    CXXFLAGS="${CXXFLAGS} +DD64"
-                    AC_COMPILE_IFELSE([AC_LANG_SOURCE([int main(void) {return (sizeof(void*)*8==64)?0:1;}])],
-                        CAN_BUILD_64=yes, CAN_BUILD_64=no)
-                    if test "$CAN_BUILD_64" != yes; then
-                        # reset
-                        CFLAGS="${CFLAGS_OLD}"
-                        CXXFLAGS="${CXXFLAGS_OLD}"
-                        # append
-                        CFLAGS="${CFLAGS} +DA2.0W"
-                        CXXFLAGS="${CXXFLAGS} +DA2.0W"
-                        AC_COMPILE_IFELSE([AC_LANG_SOURCE([int main(void) {return (sizeof(void*)*8==64)?0:1;}])],
-                            CAN_BUILD_64=yes, CAN_BUILD_64=no)
-                    fi
-                    ;;
-                *-*ibm-openedition*|*-*-os390*)
-                    CFLAGS="${CFLAGS} -Wc,lp64"
-                    CXXFLAGS="${CXXFLAGS} -Wc,lp64"
-                    LDFLAGS="${LDFLAGS} -Wl,lp64"
-                    AC_COMPILE_IFELSE([AC_LANG_SOURCE([int main(void) {return (sizeof(void*)*8==64)?0:1;}])],
-                       CAN_BUILD_64=yes, CAN_BUILD_64=no)
-                    ;;
-                *)
-                    # unknown platform.
-                    ;;
-                esac
-            fi
-            AC_MSG_RESULT($CAN_BUILD_64)
-            if test "$CAN_BUILD_64" = yes; then
-                AC_MSG_CHECKING([whether runnable 64-bit binaries are being built ])
-                AC_RUN_IFELSE([AC_LANG_SOURCE([int main(void) {return (sizeof(void*)*8==64)?0:1;}])],
-                   BITS_RUN_64=yes, BITS_RUN_64=no, BITS_RUN_64=unknown)
-                AC_MSG_RESULT($BITS_RUN_64);
-
-                CFLAGS_64="${CFLAGS}"
-                CXXFLAGS_64="${CXXFLAGS}"
-                LDFLAGS_64="${LDFLAGS}"
-                ARFLAGS_64="${ARFLAGS}"        
-            fi
-            # put it back.
-            CFLAGS="${CFLAGS_OLD}"
-            CXXFLAGS="${CXXFLAGS_OLD}"
-            LDFLAGS="${LDFLAGS_OLD}"
-            ARFLAGS="${ARFLAGS_OLD}"     
-        fi
-        if test "$BITS_CHECK_32" = "yes"; then
-            # see comment under 'if BITS_CHECK_64', above.
-            AC_MSG_CHECKING([how to build 32-bit executables])
-            if test "$GCC" = yes; then
-                CFLAGS="${CFLAGS} -m32"
-                CXXFLAGS="${CXXFLAGS} -m32"
-                AC_COMPILE_IFELSE([AC_LANG_SOURCE([int main(void) {return (sizeof(void*)*8==32)?0:1;}])],
-                   CAN_BUILD_32=yes, CAN_BUILD_32=no)
-            fi
-            AC_MSG_RESULT($CAN_BUILD_32)
-            if test "$CAN_BUILD_32" = yes; then
-                AC_MSG_CHECKING([whether runnable 32-bit binaries are being built ])
-                AC_RUN_IFELSE([AC_LANG_SOURCE([int main(void) {return (sizeof(void*)*8==32)?0:1;}])],
-                   BITS_RUN_32=yes, BITS_RUN_32=no, BITS_RUN_32=unknown)
-                AC_MSG_RESULT($BITS_RUN_32);
-                CFLAGS_32="${CFLAGS}"
-                CXXFLAGS_32="${CXXFLAGS}"
-                LDFLAGS_32="${LDFLAGS}"
-                ARFLAGS_32="${ARFLAGS}"        
-            fi
-            # put it back.
-            CFLAGS="${CFLAGS_OLD}"
-            CXXFLAGS="${CXXFLAGS_OLD}"
-            LDFLAGS="${LDFLAGS_OLD}"
-            ARFLAGS="${ARFLAGS_OLD}"     
-        fi
-        
-        ##
-        # OK. Now, we've tested for 32 and 64 bitness. Let's see what we'll do.
-        #
-        
-        # First, implement 64else32
-        if test "$BITS_REQ" = "64else32"; then
-            if test "$BITS_RUN_64" = "yes"; then
-                BITS_REQ=64
-            else
-                # no changes.
-                BITS_OK=yes 
-            fi
-        fi
-        
-        # implement.
-        if test "$BITS_REQ" = "32" -a "$BITS_RUN_32" = "yes"; then
-            CFLAGS="${CFLAGS_32}"
-            CXXFLAGS="${CXXFLAGS_32}"
-            LDFLAGS="${LDFLAGS_32}"
-            ARFLAGS="${ARFLAGS_32}"     
-            BITS_OK=yes
-        elif test "$BITS_REQ" = "64" -a "$BITS_RUN_64" = "yes"; then
-            CFLAGS="${CFLAGS_64}"
-            CXXFLAGS="${CXXFLAGS_64}"
-            LDFLAGS="${LDFLAGS_64}"
-            ARFLAGS="${ARFLAGS_64}"     
-            BITS_OK=yes
-        elif test "$BITS_OK" != "yes"; then
-            AC_MSG_ERROR([Requested $BITS_REQ bit binaries but could not compile and execute them. See readme.html for help with cross compilation., and set compiler options manually.])
-        fi
-     fi
-])
-
-# Strict compilation options.
-AC_DEFUN([AC_CHECK_STRICT_COMPILE],
-[
-    AC_MSG_CHECKING([whether strict compiling is on])
-    AC_ARG_ENABLE(strict,[  --enable-strict         compile with strict compiler options [default=yes]], [
-        if test "$enableval" = no
-        then
-            ac_use_strict_options=no
-        else
-            ac_use_strict_options=yes
-        fi
-      ], [ac_use_strict_options=yes])
-    AC_MSG_RESULT($ac_use_strict_options)
-
-    if test "$ac_use_strict_options" = yes
-    then
-        if test "$GCC" = yes
-        then
-            case "${host}" in
-            *)
-                # Do not use -ansi. It limits us to C90, and it breaks some platforms.
-                # We use -std=c99 to disable the gnu99 defaults and its associated warnings
-                CFLAGS="$CFLAGS -std=c99"
-                ;;
-            esac
-            
-            CFLAGS="$CFLAGS -Wall -pedantic -Wshadow -Wpointer-arith -Wmissing-prototypes -Wwrite-strings"
-        else
-            case "${host}" in
-            *-*-cygwin)
-                if test "`$CC /help 2>&1 | head -c9`" = "Microsoft"
-                then
-                    CFLAGS="$CFLAGS /W4"
-                fi ;;
-            *-*-mingw*)
-                CFLAGS="$CFLAGS -W4" ;;
-            esac
-        fi
-        if test "$GXX" = yes
-        then
-            CXXFLAGS="$CXXFLAGS -W -Wall -pedantic -Wpointer-arith -Wwrite-strings -Wno-long-long"
-        else
-            case "${host}" in
-            *-*-cygwin)
-                if test "`$CXX /help 2>&1 | head -c9`" = "Microsoft"
-                then
-                    CXXFLAGS="$CXXFLAGS /W4"
-                fi ;;
-            *-*-mingw*)
-                CFLAGS="$CFLAGS -W4" ;;
-            esac
-        fi
-    fi
-])
-
-
diff --git a/intl/icu/source/common/putilimp.h.orig b/intl/icu/source/common/putilimp.h.orig
deleted file mode 100644
index 5de801f..0000000
--- a/intl/icu/source/common/putilimp.h.orig
+++ /dev/null
@@ -1,607 +0,0 @@
-/*
-******************************************************************************
-*
-*   Copyright (C) 1997-2015, International Business Machines
-*   Corporation and others.  All Rights Reserved.
-*
-******************************************************************************
-*
-*  FILE NAME : putilimp.h
-*
-*   Date        Name        Description
-*   10/17/04    grhoten     Move internal functions from putil.h to this file.
-******************************************************************************
-*/
-
-#ifndef PUTILIMP_H
-#define PUTILIMP_H
-
-#include "unicode/utypes.h"
-#include "unicode/putil.h"
-
-/**
- * \def U_SIGNED_RIGHT_SHIFT_IS_ARITHMETIC
- * Nearly all CPUs and compilers implement a right-shift of a signed integer
- * as an Arithmetic Shift Right which copies the sign bit (the Most Significant Bit (MSB))
- * into the vacated bits (sign extension).
- * For example, (int32_t)0xfff5fff3>>4 becomes 0xffff5fff and -1>>1=-1.
- *
- * This can be useful for storing a signed value in the upper bits
- * and another bit field in the lower bits.
- * The signed value can be retrieved by simple right-shifting.
- *
- * This is consistent with the Java language.
- *
- * However, the C standard allows compilers to implement a right-shift of a signed integer
- * as a Logical Shift Right which copies a 0 into the vacated bits.
- * For example, (int32_t)0xfff5fff3>>4 becomes 0x0fff5fff and -1>>1=0x7fffffff.
- *
- * Code that depends on the natural behavior should be guarded with this macro,
- * with an alternate path for unusual platforms.
- * @internal
- */
-#ifdef U_SIGNED_RIGHT_SHIFT_IS_ARITHMETIC
-    /* Use the predefined value. */
-#else
-    /*
-     * Nearly all CPUs & compilers implement a right-shift of a signed integer
-     * as an Arithmetic Shift Right (with sign extension).
-     */
-#   define U_SIGNED_RIGHT_SHIFT_IS_ARITHMETIC 1
-#endif
-
-/** Define this to 1 if your platform supports IEEE 754 floating point,
-   to 0 if it does not. */
-#ifndef IEEE_754
-#   define IEEE_754 1
-#endif
-
-/**
- * uintptr_t is an optional part of the standard definitions in stdint.h.
- * The opengroup.org documentation for stdint.h says
- * "On XSI-conformant systems, the intptr_t and uintptr_t types are required;
- * otherwise, they are optional."
- * We assume that when uintptr_t is defined, UINTPTR_MAX is defined as well.
- *
- * Do not use ptrdiff_t since it is signed. size_t is unsigned.
- */
-/* TODO: This check fails on some z environments. Filed a ticket #9357 for this. */
-#if !defined(__intptr_t_defined) && !defined(UINTPTR_MAX) && (U_PLATFORM != U_PF_OS390)
-typedef size_t uintptr_t;
-#endif
-
-/**
- * \def U_HAVE_MSVC_2003_OR_EARLIER
- * Flag for workaround of MSVC 2003 optimization bugs
- * @internal
- */
-#if !defined(U_HAVE_MSVC_2003_OR_EARLIER) && defined(_MSC_VER) && (_MSC_VER < 1400)
-#define U_HAVE_MSVC_2003_OR_EARLIER
-#endif
-
-/*===========================================================================*/
-/** @{ Information about POSIX support                                       */
-/*===========================================================================*/
-
-#ifdef U_HAVE_NL_LANGINFO_CODESET
-    /* Use the predefined value. */
-#elif U_PLATFORM_HAS_WIN32_API || U_PLATFORM == U_PF_ANDROID || U_PLATFORM == U_PF_QNX
-#   define U_HAVE_NL_LANGINFO_CODESET 0
-#else
-#   define U_HAVE_NL_LANGINFO_CODESET 1
-#endif
-
-#ifdef U_NL_LANGINFO_CODESET
-    /* Use the predefined value. */
-#elif !U_HAVE_NL_LANGINFO_CODESET
-#   define U_NL_LANGINFO_CODESET -1
-#elif U_PLATFORM == U_PF_OS400
-   /* not defined */
-#else
-#   define U_NL_LANGINFO_CODESET CODESET
-#endif
-
-#ifdef U_TZSET
-    /* Use the predefined value. */
-#elif U_PLATFORM_USES_ONLY_WIN32_API
-#   define U_TZSET _tzset
-#elif U_PLATFORM == U_PF_OS400
-   /* not defined */
-#else
-#   define U_TZSET tzset
-#endif
-
-#if defined(U_TIMEZONE) || defined(U_HAVE_TIMEZONE)
-    /* Use the predefined value. */
-#elif U_PLATFORM == U_PF_ANDROID
-#   define U_TIMEZONE timezone
-#elif U_PLATFORM_IS_LINUX_BASED
-#   if defined(__UCLIBC__)
-       /* uClibc does not have __timezone or _timezone. */
-#   elif defined(_NEWLIB_VERSION)
-#      define U_TIMEZONE      _timezone
-#   elif defined(__GLIBC__)
-       /* glibc */
-#      define U_TIMEZONE      __timezone
-#   endif
-#elif U_PLATFORM_USES_ONLY_WIN32_API
-#   define U_TIMEZONE _timezone
-#elif U_PLATFORM == U_PF_BSD && !defined(__NetBSD__)
-   /* not defined */
-#elif U_PLATFORM == U_PF_OS400
-   /* not defined */
-#elif U_PLATFORM == U_PF_IPHONE
-   /* not defined */
-#else
-#   define U_TIMEZONE timezone
-#endif
-
-#ifdef U_TZNAME
-    /* Use the predefined value. */
-#elif U_PLATFORM_USES_ONLY_WIN32_API
-#   define U_TZNAME _tzname
-#elif U_PLATFORM == U_PF_OS400
-   /* not defined */
-#else
-#   define U_TZNAME tzname
-#endif
-
-#ifdef U_HAVE_MMAP
-    /* Use the predefined value. */
-#elif U_PLATFORM_HAS_WIN32_API
-#   define U_HAVE_MMAP 0
-#else
-#   define U_HAVE_MMAP 1
-#endif
-
-#ifdef U_HAVE_POPEN
-    /* Use the predefined value. */
-#elif U_PLATFORM_USES_ONLY_WIN32_API
-#   define U_HAVE_POPEN 0
-#elif U_PLATFORM == U_PF_OS400
-#   define U_HAVE_POPEN 0
-#else
-#   define U_HAVE_POPEN 1
-#endif
-
-/**
- * \def U_HAVE_DIRENT_H
- * Defines whether dirent.h is available.
- * @internal
- */
-#ifdef U_HAVE_DIRENT_H
-    /* Use the predefined value. */
-#elif U_PLATFORM_HAS_WIN32_API
-#   define U_HAVE_DIRENT_H 0
-#else
-#   define U_HAVE_DIRENT_H 1
-#endif
-
-/** @} */
-
-/*===========================================================================*/
-/** @{ GCC built in functions for atomic memory operations                   */
-/*===========================================================================*/
-
-/**
- * \def U_HAVE_GCC_ATOMICS
- * @internal
- */
-#ifdef U_HAVE_GCC_ATOMICS
-    /* Use the predefined value. */
-#elif U_PLATFORM == U_PF_MINGW
-    #define U_HAVE_GCC_ATOMICS 0
-#elif U_GCC_MAJOR_MINOR >= 404 || defined(__clang__)
-    /* TODO: Intel icc and IBM xlc on AIX also support gcc atomics.  (Intel originated them.)
-     *       Add them for these compilers.
-     * Note: Clang sets __GNUC__ defines for version 4.2, so misses the 4.4 test here.
-     */
-#   define U_HAVE_GCC_ATOMICS 1
-#else
-#   define U_HAVE_GCC_ATOMICS 0
-#endif
-
-/** @} */
-
-/**
- * \def U_HAVE_STD_ATOMICS
- * Defines whether the standard C++11 <atomic> is available.
- * ICU will use this when avialable,
- * otherwise will fall back to compiler or platform specific alternatives.
- * @internal
- */
-#ifdef U_HAVE_STD_ATOMICS
-    /* Use the predefined value. */
-#elif U_CPLUSPLUS_VERSION < 11
-    /* Not C++11, disable use of atomics */
-#   define U_HAVE_STD_ATOMICS 0
-#elif __clang__ && __clang_major__==3 && __clang_minor__<=1
-    /* Clang 3.1, has atomic variable initializer bug. */
-#   define U_HAVE_STD_ATOMICS 0
-#else 
-    /* U_HAVE_ATOMIC is typically set by an autoconf test of #include <atomic>  */
-    /*   Can be set manually, or left undefined, on platforms without autoconf. */
-#   if defined(U_HAVE_ATOMIC) &&  U_HAVE_ATOMIC 
-#      define U_HAVE_STD_ATOMICS 1
-#   else
-#      define U_HAVE_STD_ATOMICS 0
-#   endif
-#endif
-
-
-/**
- *  \def U_HAVE_CLANG_ATOMICS
- *  Defines whether Clang c11 style built-in atomics are avaialable.
- *  These are used in preference to gcc atomics when both are available.
- */
-#ifdef U_HAVE_CLANG_ATOMICS
-    /* Use the predefined value. */
-#elif __has_builtin(__c11_atomic_load) && \
-    __has_builtin(__c11_atomic_store) && \
-    __has_builtin(__c11_atomic_fetch_add) && \
-    __has_builtin(__c11_atomic_fetch_sub)
-#    define U_HAVE_CLANG_ATOMICS 1
-#else
-#    define U_HAVE_CLANG_ATOMICS 0
-#endif
-
-/*===========================================================================*/
-/** @{ Programs used by ICU code                                             */
-/*===========================================================================*/
-
-/**
- * \def U_MAKE_IS_NMAKE
- * Defines whether the "make" program is Windows nmake.
- */
-#ifdef U_MAKE_IS_NMAKE
-    /* Use the predefined value. */
-#elif U_PLATFORM == U_PF_WINDOWS
-#   define U_MAKE_IS_NMAKE 1
-#else
-#   define U_MAKE_IS_NMAKE 0
-#endif
-
-/** @} */
-
-/*==========================================================================*/
-/* Platform utilities                                                       */
-/*==========================================================================*/
-
-/**
- * Platform utilities isolates the platform dependencies of the
- * libarary.  For each platform which this code is ported to, these
- * functions may have to be re-implemented.
- */
-
-/**
- * Floating point utility to determine if a double is Not a Number (NaN).
- * @internal
- */
-U_INTERNAL UBool   U_EXPORT2 uprv_isNaN(double d);
-/**
- * Floating point utility to determine if a double has an infinite value.
- * @internal
- */
-U_INTERNAL UBool   U_EXPORT2 uprv_isInfinite(double d);
-/**
- * Floating point utility to determine if a double has a positive infinite value.
- * @internal
- */
-U_INTERNAL UBool   U_EXPORT2 uprv_isPositiveInfinity(double d);
-/**
- * Floating point utility to determine if a double has a negative infinite value.
- * @internal
- */
-U_INTERNAL UBool   U_EXPORT2 uprv_isNegativeInfinity(double d);
-/**
- * Floating point utility that returns a Not a Number (NaN) value.
- * @internal
- */
-U_INTERNAL double  U_EXPORT2 uprv_getNaN(void);
-/**
- * Floating point utility that returns an infinite value.
- * @internal
- */
-U_INTERNAL double  U_EXPORT2 uprv_getInfinity(void);
-
-/**
- * Floating point utility to truncate a double.
- * @internal
- */
-U_INTERNAL double  U_EXPORT2 uprv_trunc(double d);
-/**
- * Floating point utility to calculate the floor of a double.
- * @internal
- */
-U_INTERNAL double  U_EXPORT2 uprv_floor(double d);
-/**
- * Floating point utility to calculate the ceiling of a double.
- * @internal
- */
-U_INTERNAL double  U_EXPORT2 uprv_ceil(double d);
-/**
- * Floating point utility to calculate the absolute value of a double.
- * @internal
- */
-U_INTERNAL double  U_EXPORT2 uprv_fabs(double d);
-/**
- * Floating point utility to calculate the fractional and integer parts of a double.
- * @internal
- */
-U_INTERNAL double  U_EXPORT2 uprv_modf(double d, double* pinteger);
-/**
- * Floating point utility to calculate the remainder of a double divided by another double.
- * @internal
- */
-U_INTERNAL double  U_EXPORT2 uprv_fmod(double d, double y);
-/**
- * Floating point utility to calculate d to the power of exponent (d^exponent).
- * @internal
- */
-U_INTERNAL double  U_EXPORT2 uprv_pow(double d, double exponent);
-/**
- * Floating point utility to calculate 10 to the power of exponent (10^exponent).
- * @internal
- */
-U_INTERNAL double  U_EXPORT2 uprv_pow10(int32_t exponent);
-/**
- * Floating point utility to calculate the maximum value of two doubles.
- * @internal
- */
-U_INTERNAL double  U_EXPORT2 uprv_fmax(double d, double y);
-/**
- * Floating point utility to calculate the minimum value of two doubles.
- * @internal
- */
-U_INTERNAL double  U_EXPORT2 uprv_fmin(double d, double y);
-/**
- * Private utility to calculate the maximum value of two integers.
- * @internal
- */
-U_INTERNAL int32_t U_EXPORT2 uprv_max(int32_t d, int32_t y);
-/**
- * Private utility to calculate the minimum value of two integers.
- * @internal
- */
-U_INTERNAL int32_t U_EXPORT2 uprv_min(int32_t d, int32_t y);
-
-#if U_IS_BIG_ENDIAN
-#   define uprv_isNegative(number) (*((signed char *)&(number))<0)
-#else
-#   define uprv_isNegative(number) (*((signed char *)&(number)+sizeof(number)-1)<0)
-#endif
-
-/**
- * Return the largest positive number that can be represented by an integer
- * type of arbitrary bit length.
- * @internal
- */
-U_INTERNAL double  U_EXPORT2 uprv_maxMantissa(void);
-
-/**
- * Floating point utility to calculate the logarithm of a double.
- * @internal
- */
-U_INTERNAL double  U_EXPORT2 uprv_log(double d);
-
-/**
- * Does common notion of rounding e.g. uprv_floor(x + 0.5);
- * @param x the double number
- * @return the rounded double
- * @internal
- */
-U_INTERNAL double  U_EXPORT2 uprv_round(double x);
-
-#if 0
-/**
- * Returns the number of digits after the decimal point in a double number x.
- *
- * @param x the double number
- * @return the number of digits after the decimal point in a double number x.
- * @internal
- */
-/*U_INTERNAL int32_t  U_EXPORT2 uprv_digitsAfterDecimal(double x);*/
-#endif
-
-#if !U_CHARSET_IS_UTF8
-/**
- * Please use ucnv_getDefaultName() instead.
- * Return the default codepage for this platform and locale.
- * This function can call setlocale() on Unix platforms. Please read the
- * platform documentation on setlocale() before calling this function.
- * @return the default codepage for this platform 
- * @internal
- */
-U_INTERNAL const char*  U_EXPORT2 uprv_getDefaultCodepage(void);
-#endif
-
-/**
- * Please use uloc_getDefault() instead.
- * Return the default locale ID string by querying ths system, or
- *     zero if one cannot be found. 
- * This function can call setlocale() on Unix platforms. Please read the
- * platform documentation on setlocale() before calling this function.
- * @return the default locale ID string
- * @internal
- */
-U_INTERNAL const char*  U_EXPORT2 uprv_getDefaultLocaleID(void);
-
-/**
- * Time zone utilities
- *
- * Wrappers for C runtime library functions relating to timezones.
- * The t_tzset() function (similar to tzset) uses the current setting
- * of the environment variable TZ to assign values to three global
- * variables: daylight, timezone, and tzname. These variables have the
- * following meanings, and are declared in &lt;time.h&gt;.
- *
- *   daylight   Nonzero if daylight-saving-time zone (DST) is specified
- *              in TZ; otherwise, 0. Default value is 1.
- *   timezone   Difference in seconds between coordinated universal
- *              time and local time. E.g., -28,800 for PST (GMT-8hrs)
- *   tzname(0)  Three-letter time-zone name derived from TZ environment
- *              variable. E.g., "PST".
- *   tzname(1)  Three-letter DST zone name derived from TZ environment
- *              variable.  E.g., "PDT". If DST zone is omitted from TZ,
- *              tzname(1) is an empty string.
- *
- * Notes: For example, to set the TZ environment variable to correspond
- * to the current time zone in Germany, you can use one of the
- * following statements:
- *
- *   set TZ=GST1GDT
- *   set TZ=GST+1GDT
- *
- * If the TZ value is not set, t_tzset() attempts to use the time zone
- * information specified by the operating system. Under Windows NT
- * and Windows 95, this information is specified in the Control Panel's
- * Date/Time application.
- * @internal
- */
-U_INTERNAL void     U_EXPORT2 uprv_tzset(void);
-
-/**
- * Difference in seconds between coordinated universal
- * time and local time. E.g., -28,800 for PST (GMT-8hrs)
- * @return the difference in seconds between coordinated universal time and local time.
- * @internal
- */
-U_INTERNAL int32_t  U_EXPORT2 uprv_timezone(void);
-
-/**
- *   tzname(0)  Three-letter time-zone name derived from TZ environment
- *              variable. E.g., "PST".
- *   tzname(1)  Three-letter DST zone name derived from TZ environment
- *              variable.  E.g., "PDT". If DST zone is omitted from TZ,
- *              tzname(1) is an empty string.
- * @internal
- */
-U_INTERNAL const char* U_EXPORT2 uprv_tzname(int n);
-
-/**
- * Get UTC (GMT) time measured in milliseconds since 0:00 on 1/1/1970.
- * This function is affected by 'faketime' and should be the bottleneck for all user-visible ICU time functions.
- * @return the UTC time measured in milliseconds
- * @internal
- */
-U_INTERNAL UDate U_EXPORT2 uprv_getUTCtime(void);
-
-/**
- * Get UTC (GMT) time measured in milliseconds since 0:00 on 1/1/1970.
- * This function is not affected by 'faketime', so it should only be used by low level test functions- not by anything that
- * exposes time to the end user.
- * @return the UTC time measured in milliseconds
- * @internal
- */
-U_INTERNAL UDate U_EXPORT2 uprv_getRawUTCtime(void);
-
-/**
- * Determine whether a pathname is absolute or not, as defined by the platform.
- * @param path Pathname to test
- * @return TRUE if the path is absolute
- * @internal (ICU 3.0)
- */
-U_INTERNAL UBool U_EXPORT2 uprv_pathIsAbsolute(const char *path);
-
-/**
- * Use U_MAX_PTR instead of this function.
- * @param void pointer to test
- * @return the largest possible pointer greater than the base
- * @internal (ICU 3.8)
- */
-U_INTERNAL void * U_EXPORT2 uprv_maximumPtr(void *base);
-
-/**
- * Maximum value of a (void*) - use to indicate the limit of an 'infinite' buffer.
- * In fact, buffer sizes must not exceed 2GB so that the difference between
- * the buffer limit and the buffer start can be expressed in an int32_t.
- *
- * The definition of U_MAX_PTR must fulfill the following conditions:
- * - return the largest possible pointer greater than base
- * - return a valid pointer according to the machine architecture (AS/400, 64-bit, etc.)
- * - avoid wrapping around at high addresses
- * - make sure that the returned pointer is not farther from base than 0x7fffffff bytes
- *
- * @param base The beginning of a buffer to find the maximum offset from
- * @internal
- */
-#ifndef U_MAX_PTR
-#  if U_PLATFORM == U_PF_OS390 && !defined(_LP64)
-    /* We have 31-bit pointers. */
-#    define U_MAX_PTR(base) ((void *)0x7fffffff)
-#  elif U_PLATFORM == U_PF_OS400
-#    define U_MAX_PTR(base) uprv_maximumPtr((void *)base)
-#  elif 0
-    /*
-     * For platforms where pointers are scalar values (which is normal, but unlike i5/OS)
-     * but that do not define uintptr_t.
-     *
-     * However, this does not work on modern compilers:
-     * The C++ standard does not define pointer overflow, and allows compilers to
-     * assume that p+u>p for any pointer p and any integer u>0.
-     * Thus, modern compilers optimize away the ">" comparison.
-     * (See ICU tickets #7187 and #8096.)
-     */
-#    define U_MAX_PTR(base) \
-    ((void *)(((char *)(base)+0x7fffffffu) > (char *)(base) \
-        ? ((char *)(base)+0x7fffffffu) \
-        : (char *)-1))
-#  else
-    /* Default version. C++ standard compliant for scalar pointers. */
-#    define U_MAX_PTR(base) \
-    ((void *)(((uintptr_t)(base)+0x7fffffffu) > (uintptr_t)(base) \
-        ? ((uintptr_t)(base)+0x7fffffffu) \
-        : (uintptr_t)-1))
-#  endif
-#endif
-
-/*  Dynamic Library Functions */
-
-typedef void (UVoidFunction)(void);
-
-#if U_ENABLE_DYLOAD
-/**
- * Load a library
- * @internal (ICU 4.4)
- */
-U_INTERNAL void * U_EXPORT2 uprv_dl_open(const char *libName, UErrorCode *status);
-
-/**
- * Close a library
- * @internal (ICU 4.4)
- */
-U_INTERNAL void U_EXPORT2 uprv_dl_close( void *lib, UErrorCode *status);
-
-/**
- * Extract a symbol from a library (function)
- * @internal (ICU 4.8)
- */
-U_INTERNAL UVoidFunction* U_EXPORT2 uprv_dlsym_func( void *lib, const char *symbolName, UErrorCode *status);
-
-/**
- * Extract a symbol from a library (function)
- * Not implemented, no clients.
- * @internal
- */
-/* U_INTERNAL void * U_EXPORT2 uprv_dlsym_data( void *lib, const char *symbolName, UErrorCode *status); */
-
-#endif
-
-/**
- * Define malloc and related functions
- * @internal
- */
-#if U_PLATFORM == U_PF_OS400
-# define uprv_default_malloc(x) _C_TS_malloc(x)
-# define uprv_default_realloc(x,y) _C_TS_realloc(x,y)
-# define uprv_default_free(x) _C_TS_free(x)
-/* also _C_TS_calloc(x) */
-#else
-/* C defaults */
-# define uprv_default_malloc(x) malloc(x)
-# define uprv_default_realloc(x,y) realloc(x,y)
-# define uprv_default_free(x) free(x)
-#endif
-
-
-#endif
diff --git a/intl/icu/source/configure.orig b/intl/icu/source/configure.orig
deleted file mode 100644
index b405283..0000000
--- a/intl/icu/source/configure.orig
+++ /dev/null
@@ -1,9110 +0,0 @@
-#! /bin/sh
-# Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.69 for ICU 57.1.
-#
-# Report bugs to <http://icu-project.org/bugs>.
-#
-#  Copyright (c) 1999-2015, International Business Machines Corporation and others. All Rights Reserved.
-#
-#
-# Copyright (C) 1992-1996, 1998-2012 Free Software Foundation, Inc.
-#
-#
-# This configure script is free software; the Free Software Foundation
-# gives unlimited permission to copy, distribute and modify it.
-## -------------------- ##
-## M4sh Initialization. ##
-## -------------------- ##
-
-# Be more Bourne compatible
-DUALCASE=1; export DUALCASE # for MKS sh
-if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then :
-  emulate sh
-  NULLCMD=:
-  # Pre-4.2 versions of Zsh do word splitting on ${1+"$@"}, which
-  # is contrary to our usage.  Disable this feature.
-  alias -g '${1+"$@"}'='"$@"'
-  setopt NO_GLOB_SUBST
-else
-  case `(set -o) 2>/dev/null` in #(
-  *posix*) :
-    set -o posix ;; #(
-  *) :
-     ;;
-esac
-fi
-
-
-as_nl='
-'
-export as_nl
-# Printing a long string crashes Solaris 7 /usr/bin/printf.
-as_echo='\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'
-as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo
-as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo$as_echo
-# Prefer a ksh shell builtin over an external printf program on Solaris,
-# but without wasting forks for bash or zsh.
-if test -z "$BASH_VERSION$ZSH_VERSION" \
-    && (test "X`print -r -- $as_echo`" = "X$as_echo") 2>/dev/null; then
-  as_echo='print -r --'
-  as_echo_n='print -rn --'
-elif (test "X`printf %s $as_echo`" = "X$as_echo") 2>/dev/null; then
-  as_echo='printf %s\n'
-  as_echo_n='printf %s'
-else
-  if test "X`(/usr/ucb/echo -n -n $as_echo) 2>/dev/null`" = "X-n $as_echo"; then
-    as_echo_body='eval /usr/ucb/echo -n "$1$as_nl"'
-    as_echo_n='/usr/ucb/echo -n'
-  else
-    as_echo_body='eval expr "X$1" : "X\\(.*\\)"'
-    as_echo_n_body='eval
-      arg=$1;
-      case $arg in #(
-      *"$as_nl"*)
-	expr "X$arg" : "X\\(.*\\)$as_nl";
-	arg=`expr "X$arg" : ".*$as_nl\\(.*\\)"`;;
-      esac;
-      expr "X$arg" : "X\\(.*\\)" | tr -d "$as_nl"
-    '
-    export as_echo_n_body
-    as_echo_n='sh -c $as_echo_n_body as_echo'
-  fi
-  export as_echo_body
-  as_echo='sh -c $as_echo_body as_echo'
-fi
-
-# The user is always right.
-if test "${PATH_SEPARATOR+set}" != set; then
-  PATH_SEPARATOR=:
-  (PATH='/bin;/bin'; FPATH=$PATH; sh -c :) >/dev/null 2>&1 && {
-    (PATH='/bin:/bin'; FPATH=$PATH; sh -c :) >/dev/null 2>&1 ||
-      PATH_SEPARATOR=';'
-  }
-fi
-
-
-# IFS
-# We need space, tab and new line, in precisely that order.  Quoting is
-# there to prevent editors from complaining about space-tab.
-# (If _AS_PATH_WALK were called with IFS unset, it would disable word
-# splitting by setting IFS to empty value.)
-IFS=" ""	$as_nl"
-
-# Find who we are.  Look in the path if we contain no directory separator.
-as_myself=
-case $0 in #((
-  *[\\/]* ) as_myself=$0 ;;
-  *) as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
-  done
-IFS=$as_save_IFS
-
-     ;;
-esac
-# We did not find ourselves, most probably we were run as `sh COMMAND'
-# in which case we are not to be found in the path.
-if test "x$as_myself" = x; then
-  as_myself=$0
-fi
-if test ! -f "$as_myself"; then
-  $as_echo "$as_myself: error: cannot find myself; rerun with an absolute file name" >&2
-  exit 1
-fi
-
-# Unset variables that we do not need and which cause bugs (e.g. in
-# pre-3.0 UWIN ksh).  But do not cause bugs in bash 2.01; the "|| exit 1"
-# suppresses any "Segmentation fault" message there.  '((' could
-# trigger a bug in pdksh 5.2.14.
-for as_var in BASH_ENV ENV MAIL MAILPATH
-do eval test x\${$as_var+set} = xset \
-  && ( (unset $as_var) || exit 1) >/dev/null 2>&1 && unset $as_var || :
-done
-PS1='$ '
-PS2='> '
-PS4='+ '
-
-# NLS nuisances.
-LC_ALL=C
-export LC_ALL
-LANGUAGE=C
-export LANGUAGE
-
-# CDPATH.
-(unset CDPATH) >/dev/null 2>&1 && unset CDPATH
-
-# Use a proper internal environment variable to ensure we don't fall
-  # into an infinite loop, continuously re-executing ourselves.
-  if test x"${_as_can_reexec}" != xno && test "x$CONFIG_SHELL" != x; then
-    _as_can_reexec=no; export _as_can_reexec;
-    # We cannot yet assume a decent shell, so we have to provide a
-# neutralization value for shells without unset; and this also
-# works around shells that cannot unset nonexistent variables.
-# Preserve -v and -x to the replacement shell.
-BASH_ENV=/dev/null
-ENV=/dev/null
-(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
-case $- in # ((((
-  *v*x* | *x*v* ) as_opts=-vx ;;
-  *v* ) as_opts=-v ;;
-  *x* ) as_opts=-x ;;
-  * ) as_opts= ;;
-esac
-exec $CONFIG_SHELL $as_opts "$as_myself" ${1+"$@"}
-# Admittedly, this is quite paranoid, since all the known shells bail
-# out after a failed `exec'.
-$as_echo "$0: could not re-execute with $CONFIG_SHELL" >&2
-as_fn_exit 255
-  fi
-  # We don't want this to propagate to other subprocesses.
-          { _as_can_reexec=; unset _as_can_reexec;}
-if test "x$CONFIG_SHELL" = x; then
-  as_bourne_compatible="if test -n \"\${ZSH_VERSION+set}\" && (emulate sh) >/dev/null 2>&1; then :
-  emulate sh
-  NULLCMD=:
-  # Pre-4.2 versions of Zsh do word splitting on \${1+\"\$@\"}, which
-  # is contrary to our usage.  Disable this feature.
-  alias -g '\${1+\"\$@\"}'='\"\$@\"'
-  setopt NO_GLOB_SUBST
-else
-  case \`(set -o) 2>/dev/null\` in #(
-  *posix*) :
-    set -o posix ;; #(
-  *) :
-     ;;
-esac
-fi
-"
-  as_required="as_fn_return () { (exit \$1); }
-as_fn_success () { as_fn_return 0; }
-as_fn_failure () { as_fn_return 1; }
-as_fn_ret_success () { return 0; }
-as_fn_ret_failure () { return 1; }
-
-exitcode=0
-as_fn_success || { exitcode=1; echo as_fn_success failed.; }
-as_fn_failure && { exitcode=1; echo as_fn_failure succeeded.; }
-as_fn_ret_success || { exitcode=1; echo as_fn_ret_success failed.; }
-as_fn_ret_failure && { exitcode=1; echo as_fn_ret_failure succeeded.; }
-if ( set x; as_fn_ret_success y && test x = \"\$1\" ); then :
-
-else
-  exitcode=1; echo positional parameters were not saved.
-fi
-test x\$exitcode = x0 || exit 1
-test -x / || exit 1"
-  as_suggested="  as_lineno_1=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_1a=\$LINENO
-  as_lineno_2=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_2a=\$LINENO
-  eval 'test \"x\$as_lineno_1'\$as_run'\" != \"x\$as_lineno_2'\$as_run'\" &&
-  test \"x\`expr \$as_lineno_1'\$as_run' + 1\`\" = \"x\$as_lineno_2'\$as_run'\"' || exit 1
-test \$(( 1 + 1 )) = 2 || exit 1"
-  if (eval "$as_required") 2>/dev/null; then :
-  as_have_required=yes
-else
-  as_have_required=no
-fi
-  if test x$as_have_required = xyes && (eval "$as_suggested") 2>/dev/null; then :
-
-else
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-as_found=false
-for as_dir in /bin$PATH_SEPARATOR/usr/bin$PATH_SEPARATOR$PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  as_found=:
-  case $as_dir in #(
-	 /*)
-	   for as_base in sh bash ksh sh5; do
-	     # Try only shells that exist, to save several forks.
-	     as_shell=$as_dir/$as_base
-	     if { test -f "$as_shell" || test -f "$as_shell.exe"; } &&
-		    { $as_echo "$as_bourne_compatible""$as_required" | as_run=a "$as_shell"; } 2>/dev/null; then :
-  CONFIG_SHELL=$as_shell as_have_required=yes
-		   if { $as_echo "$as_bourne_compatible""$as_suggested" | as_run=a "$as_shell"; } 2>/dev/null; then :
-  break 2
-fi
-fi
-	   done;;
-       esac
-  as_found=false
-done
-$as_found || { if { test -f "$SHELL" || test -f "$SHELL.exe"; } &&
-	      { $as_echo "$as_bourne_compatible""$as_required" | as_run=a "$SHELL"; } 2>/dev/null; then :
-  CONFIG_SHELL=$SHELL as_have_required=yes
-fi; }
-IFS=$as_save_IFS
-
-
-      if test "x$CONFIG_SHELL" != x; then :
-  export CONFIG_SHELL
-             # We cannot yet assume a decent shell, so we have to provide a
-# neutralization value for shells without unset; and this also
-# works around shells that cannot unset nonexistent variables.
-# Preserve -v and -x to the replacement shell.
-BASH_ENV=/dev/null
-ENV=/dev/null
-(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
-case $- in # ((((
-  *v*x* | *x*v* ) as_opts=-vx ;;
-  *v* ) as_opts=-v ;;
-  *x* ) as_opts=-x ;;
-  * ) as_opts= ;;
-esac
-exec $CONFIG_SHELL $as_opts "$as_myself" ${1+"$@"}
-# Admittedly, this is quite paranoid, since all the known shells bail
-# out after a failed `exec'.
-$as_echo "$0: could not re-execute with $CONFIG_SHELL" >&2
-exit 255
-fi
-
-    if test x$as_have_required = xno; then :
-  $as_echo "$0: This script requires a shell more modern than all"
-  $as_echo "$0: the shells that I found on your system."
-  if test x${ZSH_VERSION+set} = xset ; then
-    $as_echo "$0: In particular, zsh $ZSH_VERSION has bugs and should"
-    $as_echo "$0: be upgraded to zsh 4.3.4 or later."
-  else
-    $as_echo "$0: Please tell bug-autoconf@gnu.org and
-$0: http://icu-project.org/bugs about your system,
-$0: including any error possibly output before this
-$0: message. Then install a modern shell, or manually run
-$0: the script under such a shell if you do have one."
-  fi
-  exit 1
-fi
-fi
-fi
-SHELL=${CONFIG_SHELL-/bin/sh}
-export SHELL
-# Unset more variables known to interfere with behavior of common tools.
-CLICOLOR_FORCE= GREP_OPTIONS=
-unset CLICOLOR_FORCE GREP_OPTIONS
-
-## --------------------- ##
-## M4sh Shell Functions. ##
-## --------------------- ##
-# as_fn_unset VAR
-# ---------------
-# Portably unset VAR.
-as_fn_unset ()
-{
-  { eval $1=; unset $1;}
-}
-as_unset=as_fn_unset
-
-# as_fn_set_status STATUS
-# -----------------------
-# Set $? to STATUS, without forking.
-as_fn_set_status ()
-{
-  return $1
-} # as_fn_set_status
-
-# as_fn_exit STATUS
-# -----------------
-# Exit the shell with STATUS, even in a "trap 0" or "set -e" context.
-as_fn_exit ()
-{
-  set +e
-  as_fn_set_status $1
-  exit $1
-} # as_fn_exit
-
-# as_fn_mkdir_p
-# -------------
-# Create "$as_dir" as a directory, including parents if necessary.
-as_fn_mkdir_p ()
-{
-
-  case $as_dir in #(
-  -*) as_dir=./$as_dir;;
-  esac
-  test -d "$as_dir" || eval $as_mkdir_p || {
-    as_dirs=
-    while :; do
-      case $as_dir in #(
-      *\'*) as_qdir=`$as_echo "$as_dir" | sed "s/'/'\\\\\\\\''/g"`;; #'(
-      *) as_qdir=$as_dir;;
-      esac
-      as_dirs="'$as_qdir' $as_dirs"
-      as_dir=`$as_dirname -- "$as_dir" ||
-$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
-	 X"$as_dir" : 'X\(//\)[^/]' \| \
-	 X"$as_dir" : 'X\(//\)$' \| \
-	 X"$as_dir" : 'X\(/\)' \| . 2>/dev/null ||
-$as_echo X"$as_dir" |
-    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\/\)[^/].*/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\/\)$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\).*/{
-	    s//\1/
-	    q
-	  }
-	  s/.*/./; q'`
-      test -d "$as_dir" && break
-    done
-    test -z "$as_dirs" || eval "mkdir $as_dirs"
-  } || test -d "$as_dir" || as_fn_error $? "cannot create directory $as_dir"
-
-
-} # as_fn_mkdir_p
-
-# as_fn_executable_p FILE
-# -----------------------
-# Test if FILE is an executable regular file.
-as_fn_executable_p ()
-{
-  test -f "$1" && test -x "$1"
-} # as_fn_executable_p
-# as_fn_append VAR VALUE
-# ----------------------
-# Append the text in VALUE to the end of the definition contained in VAR. Take
-# advantage of any shell optimizations that allow amortized linear growth over
-# repeated appends, instead of the typical quadratic growth present in naive
-# implementations.
-if (eval "as_var=1; as_var+=2; test x\$as_var = x12") 2>/dev/null; then :
-  eval 'as_fn_append ()
-  {
-    eval $1+=\$2
-  }'
-else
-  as_fn_append ()
-  {
-    eval $1=\$$1\$2
-  }
-fi # as_fn_append
-
-# as_fn_arith ARG...
-# ------------------
-# Perform arithmetic evaluation on the ARGs, and store the result in the
-# global $as_val. Take advantage of shells that can avoid forks. The arguments
-# must be portable across $(()) and expr.
-if (eval "test \$(( 1 + 1 )) = 2") 2>/dev/null; then :
-  eval 'as_fn_arith ()
-  {
-    as_val=$(( $* ))
-  }'
-else
-  as_fn_arith ()
-  {
-    as_val=`expr "$@" || test $? -eq 1`
-  }
-fi # as_fn_arith
-
-
-# as_fn_error STATUS ERROR [LINENO LOG_FD]
-# ----------------------------------------
-# Output "`basename $0`: error: ERROR" to stderr. If LINENO and LOG_FD are
-# provided, also output the error to LOG_FD, referencing LINENO. Then exit the
-# script with STATUS, using 1 if that was 0.
-as_fn_error ()
-{
-  as_status=$1; test $as_status -eq 0 && as_status=1
-  if test "$4"; then
-    as_lineno=${as_lineno-"$3"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
-    $as_echo "$as_me:${as_lineno-$LINENO}: error: $2" >&$4
-  fi
-  $as_echo "$as_me: error: $2" >&2
-  as_fn_exit $as_status
-} # as_fn_error
-
-if expr a : '\(a\)' >/dev/null 2>&1 &&
-   test "X`expr 00001 : '.*\(...\)'`" = X001; then
-  as_expr=expr
-else
-  as_expr=false
-fi
-
-if (basename -- /) >/dev/null 2>&1 && test "X`basename -- / 2>&1`" = "X/"; then
-  as_basename=basename
-else
-  as_basename=false
-fi
-
-if (as_dir=`dirname -- /` && test "X$as_dir" = X/) >/dev/null 2>&1; then
-  as_dirname=dirname
-else
-  as_dirname=false
-fi
-
-as_me=`$as_basename -- "$0" ||
-$as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
-	 X"$0" : 'X\(//\)$' \| \
-	 X"$0" : 'X\(/\)' \| . 2>/dev/null ||
-$as_echo X/"$0" |
-    sed '/^.*\/\([^/][^/]*\)\/*$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\/\(\/\/\)$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\/\(\/\).*/{
-	    s//\1/
-	    q
-	  }
-	  s/.*/./; q'`
-
-# Avoid depending upon Character Ranges.
-as_cr_letters='abcdefghijklmnopqrstuvwxyz'
-as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
-as_cr_Letters=$as_cr_letters$as_cr_LETTERS
-as_cr_digits='0123456789'
-as_cr_alnum=$as_cr_Letters$as_cr_digits
-
-
-  as_lineno_1=$LINENO as_lineno_1a=$LINENO
-  as_lineno_2=$LINENO as_lineno_2a=$LINENO
-  eval 'test "x$as_lineno_1'$as_run'" != "x$as_lineno_2'$as_run'" &&
-  test "x`expr $as_lineno_1'$as_run' + 1`" = "x$as_lineno_2'$as_run'"' || {
-  # Blame Lee E. McMahon (1931-1989) for sed's syntax.  :-)
-  sed -n '
-    p
-    /[$]LINENO/=
-  ' <$as_myself |
-    sed '
-      s/[$]LINENO.*/&-/
-      t lineno
-      b
-      :lineno
-      N
-      :loop
-      s/[$]LINENO\([^'$as_cr_alnum'_].*\n\)\(.*\)/\2\1\2/
-      t loop
-      s/-\n.*//
-    ' >$as_me.lineno &&
-  chmod +x "$as_me.lineno" ||
-    { $as_echo "$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&2; as_fn_exit 1; }
-
-  # If we had to re-execute with $CONFIG_SHELL, we're ensured to have
-  # already done that, so ensure we don't try to do so again and fall
-  # in an infinite loop.  This has already happened in practice.
-  _as_can_reexec=no; export _as_can_reexec
-  # Don't try to exec as it changes $[0], causing all sort of problems
-  # (the dirname of $[0] is not the place where we might find the
-  # original and so on.  Autoconf is especially sensitive to this).
-  . "./$as_me.lineno"
-  # Exit status is that of the last command.
-  exit
-}
-
-ECHO_C= ECHO_N= ECHO_T=
-case `echo -n x` in #(((((
--n*)
-  case `echo 'xy\c'` in
-  *c*) ECHO_T='	';;	# ECHO_T is single tab character.
-  xy)  ECHO_C='\c';;
-  *)   echo `echo ksh88 bug on AIX 6.1` > /dev/null
-       ECHO_T='	';;
-  esac;;
-*)
-  ECHO_N='-n';;
-esac
-
-rm -f conf$$ conf$$.exe conf$$.file
-if test -d conf$$.dir; then
-  rm -f conf$$.dir/conf$$.file
-else
-  rm -f conf$$.dir
-  mkdir conf$$.dir 2>/dev/null
-fi
-if (echo >conf$$.file) 2>/dev/null; then
-  if ln -s conf$$.file conf$$ 2>/dev/null; then
-    as_ln_s='ln -s'
-    # ... but there are two gotchas:
-    # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
-    # 2) DJGPP < 2.04 has no symlinks; `ln -s' creates a wrapper executable.
-    # In both cases, we have to default to `cp -pR'.
-    ln -s conf$$.file conf$$.dir 2>/dev/null && test ! -f conf$$.exe ||
-      as_ln_s='cp -pR'
-  elif ln conf$$.file conf$$ 2>/dev/null; then
-    as_ln_s=ln
-  else
-    as_ln_s='cp -pR'
-  fi
-else
-  as_ln_s='cp -pR'
-fi
-rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
-rmdir conf$$.dir 2>/dev/null
-
-if mkdir -p . 2>/dev/null; then
-  as_mkdir_p='mkdir -p "$as_dir"'
-else
-  test -d ./-p && rmdir ./-p
-  as_mkdir_p=false
-fi
-
-as_test_x='test -x'
-as_executable_p=as_fn_executable_p
-
-# Sed expression to map a string onto a valid CPP name.
-as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"
-
-# Sed expression to map a string onto a valid variable name.
-as_tr_sh="eval sed 'y%*+%pp%;s%[^_$as_cr_alnum]%_%g'"
-
-
-test -n "$DJDIR" || exec 7<&0 </dev/null
-exec 6>&1
-
-# Name of the host.
-# hostname on some systems (SVR3.2, old GNU/Linux) returns a bogus exit status,
-# so uname gets run too.
-ac_hostname=`(hostname || uname -n) 2>/dev/null | sed 1q`
-
-#
-# Initializations.
-#
-ac_default_prefix=/usr/local
-ac_clean_files=
-ac_config_libobj_dir=.
-LIBOBJS=
-cross_compiling=no
-subdirs=
-MFLAGS=
-MAKEFLAGS=
-
-# Identity of this package.
-PACKAGE_NAME='ICU'
-PACKAGE_TARNAME='International Components for Unicode'
-PACKAGE_VERSION='57.1'
-PACKAGE_STRING='ICU 57.1'
-PACKAGE_BUGREPORT='http://icu-project.org/bugs'
-PACKAGE_URL='http://icu-project.org'
-
-ac_unique_file="common/unicode/utypes.h"
-# Factoring default headers for most tests.
-ac_includes_default="\
-#include <stdio.h>
-#ifdef HAVE_SYS_TYPES_H
-# include <sys/types.h>
-#endif
-#ifdef HAVE_SYS_STAT_H
-# include <sys/stat.h>
-#endif
-#ifdef STDC_HEADERS
-# include <stdlib.h>
-# include <stddef.h>
-#else
-# ifdef HAVE_STDLIB_H
-#  include <stdlib.h>
-# endif
-#endif
-#ifdef HAVE_STRING_H
-# if !defined STDC_HEADERS && defined HAVE_MEMORY_H
-#  include <memory.h>
-# endif
-# include <string.h>
-#endif
-#ifdef HAVE_STRINGS_H
-# include <strings.h>
-#endif
-#ifdef HAVE_INTTYPES_H
-# include <inttypes.h>
-#endif
-#ifdef HAVE_STDINT_H
-# include <stdint.h>
-#endif
-#ifdef HAVE_UNISTD_H
-# include <unistd.h>
-#endif"
-
-ac_subst_vars='UCONFIG_CXXFLAGS
-UCONFIG_CFLAGS
-UCONFIG_CPPFLAGS
-LTLIBOBJS
-LIBOBJS
-LIBCXXFLAGS
-LIBCFLAGS
-platform_make_fragment
-platform_make_fragment_name
-platform
-ICUDATA_CHAR
-U_HAVE_SAMPLES
-SAMPLES_TRUE
-U_HAVE_TESTS
-TESTS_TRUE
-ICULIBSUFFIXCNAME
-U_HAVE_LIB_SUFFIX
-ICULIBSUFFIX
-DATA_PACKAGING_MODE
-thepkgicudatadir
-pkgicudatadir
-U_HAVE_TOOLS
-TOOLS_TRUE
-U_HAVE_LAYOUTEX
-LAYOUTEX_TRUE
-U_HAVE_LAYOUT
-LAYOUT_TRUE
-U_HAVE_ICUIO
-ICUIO_TRUE
-U_HAVE_EXTRAS
-EXTRAS_TRUE
-U_HAVE_WCSCPY
-U_HAVE_WCHAR_H
-U_TIMEZONE
-U_HAVE_TIMEZONE
-U_TZNAME
-U_HAVE_TZNAME
-U_TZSET
-U_HAVE_TZSET
-U_HAVE_POPEN
-U_HAVE_PLACEMENT_NEW
-U_OVERRIDE_CXX_ALLOCATION
-U_NL_LANGINFO_CODESET
-U_HAVE_NL_LANGINFO_CODESET
-U_IS_BIG_ENDIAN
-U_HAVE_DIRENT_H
-U_HAVE_INTTYPES_H
-GENCCODE_ASSEMBLY
-HAVE_MMAP
-LIB_THREAD
-U_HAVE_ATOMIC
-U_HAVE_STD_STRING
-ENABLE_RPATH
-U_ENABLE_DYLOAD
-U_HAVE_PLUGINS
-PLUGINS_TRUE
-U_ENABLE_TRACING
-U_DISABLE_RENAMING
-AR
-RANLIB
-U_DEFAULT_SHOW_DRAFT
-UCLN_NO_AUTO_CLEANUP
-ENABLE_STATIC
-ENABLE_SHARED
-LIB_M
-COMPILE_LINK_ENVVAR
-ARFLAGS
-EGREP
-GREP
-DOXYGEN
-cross_buildroot
-U_MAKE
-cross_compiling
-INSTALL_DATA
-INSTALL_SCRIPT
-INSTALL_PROGRAM
-CPP
-ICULEHB_LIBS
-ICULEHB_CFLAGS
-PKG_CONFIG_LIBDIR
-PKG_CONFIG_PATH
-PKG_CONFIG
-ac_ct_CXX
-CXXFLAGS
-CXX
-OBJEXT
-EXEEXT
-ac_ct_CC
-LDFLAGS
-CFLAGS
-CC
-ENABLE_RELEASE
-ENABLE_DEBUG
-CPPFLAGS
-host_os
-host_vendor
-host_cpu
-host
-build_os
-build_vendor
-build_cpu
-build
-UNICODE_VERSION
-LIB_VERSION_MAJOR
-LIB_VERSION
-VERSION
-ICU_ECHO_T
-ICU_ECHO_C
-ICU_ECHO_N
-PACKAGE
-target_alias
-host_alias
-build_alias
-LIBS
-ECHO_T
-ECHO_N
-ECHO_C
-DEFS
-mandir
-localedir
-libdir
-psdir
-pdfdir
-dvidir
-htmldir
-infodir
-docdir
-oldincludedir
-includedir
-localstatedir
-sharedstatedir
-sysconfdir
-datadir
-datarootdir
-libexecdir
-sbindir
-bindir
-program_transform_name
-prefix
-exec_prefix
-PACKAGE_URL
-PACKAGE_BUGREPORT
-PACKAGE_STRING
-PACKAGE_VERSION
-PACKAGE_TARNAME
-PACKAGE_NAME
-PATH_SEPARATOR
-SHELL'
-ac_subst_files=''
-ac_user_opts='
-enable_option_checking
-enable_debug
-enable_release
-with_cross_build
-enable_strict
-enable_64bit_libs
-with_library_bits
-enable_shared
-enable_static
-enable_auto_cleanup
-enable_draft
-enable_renaming
-enable_tracing
-enable_plugins
-enable_dyload
-enable_rpath
-enable_weak_threads
-enable_extras
-enable_icuio
-enable_layout
-enable_layoutex
-enable_tools
-with_data_packaging
-with_library_suffix
-enable_tests
-enable_samples
-'
-      ac_precious_vars='build_alias
-host_alias
-target_alias
-CC
-CFLAGS
-LDFLAGS
-LIBS
-CPPFLAGS
-CXX
-CXXFLAGS
-CCC
-PKG_CONFIG
-PKG_CONFIG_PATH
-PKG_CONFIG_LIBDIR
-ICULEHB_CFLAGS
-ICULEHB_LIBS
-CPP'
-
-
-# Initialize some variables set by options.
-ac_init_help=
-ac_init_version=false
-ac_unrecognized_opts=
-ac_unrecognized_sep=
-# The variables have the same names as the options, with
-# dashes changed to underlines.
-cache_file=/dev/null
-exec_prefix=NONE
-no_create=
-no_recursion=
-prefix=NONE
-program_prefix=NONE
-program_suffix=NONE
-program_transform_name=s,x,x,
-silent=
-site=
-srcdir=
-verbose=
-x_includes=NONE
-x_libraries=NONE
-
-# Installation directory options.
-# These are left unexpanded so users can "make install exec_prefix=/foo"
-# and all the variables that are supposed to be based on exec_prefix
-# by default will actually change.
-# Use braces instead of parens because sh, perl, etc. also accept them.
-# (The list follows the same order as the GNU Coding Standards.)
-bindir='${exec_prefix}/bin'
-sbindir='${exec_prefix}/sbin'
-libexecdir='${exec_prefix}/libexec'
-datarootdir='${prefix}/share'
-datadir='${datarootdir}'
-sysconfdir='${prefix}/etc'
-sharedstatedir='${prefix}/com'
-localstatedir='${prefix}/var'
-includedir='${prefix}/include'
-oldincludedir='/usr/include'
-docdir='${datarootdir}/doc/${PACKAGE_TARNAME}'
-infodir='${datarootdir}/info'
-htmldir='${docdir}'
-dvidir='${docdir}'
-pdfdir='${docdir}'
-psdir='${docdir}'
-libdir='${exec_prefix}/lib'
-localedir='${datarootdir}/locale'
-mandir='${datarootdir}/man'
-
-ac_prev=
-ac_dashdash=
-for ac_option
-do
-  # If the previous option needs an argument, assign it.
-  if test -n "$ac_prev"; then
-    eval $ac_prev=\$ac_option
-    ac_prev=
-    continue
-  fi
-
-  case $ac_option in
-  *=?*) ac_optarg=`expr "X$ac_option" : '[^=]*=\(.*\)'` ;;
-  *=)   ac_optarg= ;;
-  *)    ac_optarg=yes ;;
-  esac
-
-  # Accept the important Cygnus configure options, so we can diagnose typos.
-
-  case $ac_dashdash$ac_option in
-  --)
-    ac_dashdash=yes ;;
-
-  -bindir | --bindir | --bindi | --bind | --bin | --bi)
-    ac_prev=bindir ;;
-  -bindir=* | --bindir=* | --bindi=* | --bind=* | --bin=* | --bi=*)
-    bindir=$ac_optarg ;;
-
-  -build | --build | --buil | --bui | --bu)
-    ac_prev=build_alias ;;
-  -build=* | --build=* | --buil=* | --bui=* | --bu=*)
-    build_alias=$ac_optarg ;;
-
-  -cache-file | --cache-file | --cache-fil | --cache-fi \
-  | --cache-f | --cache- | --cache | --cach | --cac | --ca | --c)
-    ac_prev=cache_file ;;
-  -cache-file=* | --cache-file=* | --cache-fil=* | --cache-fi=* \
-  | --cache-f=* | --cache-=* | --cache=* | --cach=* | --cac=* | --ca=* | --c=*)
-    cache_file=$ac_optarg ;;
-
-  --config-cache | -C)
-    cache_file=config.cache ;;
-
-  -datadir | --datadir | --datadi | --datad)
-    ac_prev=datadir ;;
-  -datadir=* | --datadir=* | --datadi=* | --datad=*)
-    datadir=$ac_optarg ;;
-
-  -datarootdir | --datarootdir | --datarootdi | --datarootd | --dataroot \
-  | --dataroo | --dataro | --datar)
-    ac_prev=datarootdir ;;
-  -datarootdir=* | --datarootdir=* | --datarootdi=* | --datarootd=* \
-  | --dataroot=* | --dataroo=* | --dataro=* | --datar=*)
-    datarootdir=$ac_optarg ;;
-
-  -disable-* | --disable-*)
-    ac_useropt=`expr "x$ac_option" : 'x-*disable-\(.*\)'`
-    # Reject names that are not valid shell variable names.
-    expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
-      as_fn_error $? "invalid feature name: $ac_useropt"
-    ac_useropt_orig=$ac_useropt
-    ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
-    case $ac_user_opts in
-      *"
-"enable_$ac_useropt"
-"*) ;;
-      *) ac_unrecognized_opts="$ac_unrecognized_opts$ac_unrecognized_sep--disable-$ac_useropt_orig"
-	 ac_unrecognized_sep=', ';;
-    esac
-    eval enable_$ac_useropt=no ;;
-
-  -docdir | --docdir | --docdi | --doc | --do)
-    ac_prev=docdir ;;
-  -docdir=* | --docdir=* | --docdi=* | --doc=* | --do=*)
-    docdir=$ac_optarg ;;
-
-  -dvidir | --dvidir | --dvidi | --dvid | --dvi | --dv)
-    ac_prev=dvidir ;;
-  -dvidir=* | --dvidir=* | --dvidi=* | --dvid=* | --dvi=* | --dv=*)
-    dvidir=$ac_optarg ;;
-
-  -enable-* | --enable-*)
-    ac_useropt=`expr "x$ac_option" : 'x-*enable-\([^=]*\)'`
-    # Reject names that are not valid shell variable names.
-    expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
-      as_fn_error $? "invalid feature name: $ac_useropt"
-    ac_useropt_orig=$ac_useropt
-    ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
-    case $ac_user_opts in
-      *"
-"enable_$ac_useropt"
-"*) ;;
-      *) ac_unrecognized_opts="$ac_unrecognized_opts$ac_unrecognized_sep--enable-$ac_useropt_orig"
-	 ac_unrecognized_sep=', ';;
-    esac
-    eval enable_$ac_useropt=\$ac_optarg ;;
-
-  -exec-prefix | --exec_prefix | --exec-prefix | --exec-prefi \
-  | --exec-pref | --exec-pre | --exec-pr | --exec-p | --exec- \
-  | --exec | --exe | --ex)
-    ac_prev=exec_prefix ;;
-  -exec-prefix=* | --exec_prefix=* | --exec-prefix=* | --exec-prefi=* \
-  | --exec-pref=* | --exec-pre=* | --exec-pr=* | --exec-p=* | --exec-=* \
-  | --exec=* | --exe=* | --ex=*)
-    exec_prefix=$ac_optarg ;;
-
-  -gas | --gas | --ga | --g)
-    # Obsolete; use --with-gas.
-    with_gas=yes ;;
-
-  -help | --help | --hel | --he | -h)
-    ac_init_help=long ;;
-  -help=r* | --help=r* | --hel=r* | --he=r* | -hr*)
-    ac_init_help=recursive ;;
-  -help=s* | --help=s* | --hel=s* | --he=s* | -hs*)
-    ac_init_help=short ;;
-
-  -host | --host | --hos | --ho)
-    ac_prev=host_alias ;;
-  -host=* | --host=* | --hos=* | --ho=*)
-    host_alias=$ac_optarg ;;
-
-  -htmldir | --htmldir | --htmldi | --htmld | --html | --htm | --ht)
-    ac_prev=htmldir ;;
-  -htmldir=* | --htmldir=* | --htmldi=* | --htmld=* | --html=* | --htm=* \
-  | --ht=*)
-    htmldir=$ac_optarg ;;
-
-  -includedir | --includedir | --includedi | --included | --include \
-  | --includ | --inclu | --incl | --inc)
-    ac_prev=includedir ;;
-  -includedir=* | --includedir=* | --includedi=* | --included=* | --include=* \
-  | --includ=* | --inclu=* | --incl=* | --inc=*)
-    includedir=$ac_optarg ;;
-
-  -infodir | --infodir | --infodi | --infod | --info | --inf)
-    ac_prev=infodir ;;
-  -infodir=* | --infodir=* | --infodi=* | --infod=* | --info=* | --inf=*)
-    infodir=$ac_optarg ;;
-
-  -libdir | --libdir | --libdi | --libd)
-    ac_prev=libdir ;;
-  -libdir=* | --libdir=* | --libdi=* | --libd=*)
-    libdir=$ac_optarg ;;
-
-  -libexecdir | --libexecdir | --libexecdi | --libexecd | --libexec \
-  | --libexe | --libex | --libe)
-    ac_prev=libexecdir ;;
-  -libexecdir=* | --libexecdir=* | --libexecdi=* | --libexecd=* | --libexec=* \
-  | --libexe=* | --libex=* | --libe=*)
-    libexecdir=$ac_optarg ;;
-
-  -localedir | --localedir | --localedi | --localed | --locale)
-    ac_prev=localedir ;;
-  -localedir=* | --localedir=* | --localedi=* | --localed=* | --locale=*)
-    localedir=$ac_optarg ;;
-
-  -localstatedir | --localstatedir | --localstatedi | --localstated \
-  | --localstate | --localstat | --localsta | --localst | --locals)
-    ac_prev=localstatedir ;;
-  -localstatedir=* | --localstatedir=* | --localstatedi=* | --localstated=* \
-  | --localstate=* | --localstat=* | --localsta=* | --localst=* | --locals=*)
-    localstatedir=$ac_optarg ;;
-
-  -mandir | --mandir | --mandi | --mand | --man | --ma | --m)
-    ac_prev=mandir ;;
-  -mandir=* | --mandir=* | --mandi=* | --mand=* | --man=* | --ma=* | --m=*)
-    mandir=$ac_optarg ;;
-
-  -nfp | --nfp | --nf)
-    # Obsolete; use --without-fp.
-    with_fp=no ;;
-
-  -no-create | --no-create | --no-creat | --no-crea | --no-cre \
-  | --no-cr | --no-c | -n)
-    no_create=yes ;;
-
-  -no-recursion | --no-recursion | --no-recursio | --no-recursi \
-  | --no-recurs | --no-recur | --no-recu | --no-rec | --no-re | --no-r)
-    no_recursion=yes ;;
-
-  -oldincludedir | --oldincludedir | --oldincludedi | --oldincluded \
-  | --oldinclude | --oldinclud | --oldinclu | --oldincl | --oldinc \
-  | --oldin | --oldi | --old | --ol | --o)
-    ac_prev=oldincludedir ;;
-  -oldincludedir=* | --oldincludedir=* | --oldincludedi=* | --oldincluded=* \
-  | --oldinclude=* | --oldinclud=* | --oldinclu=* | --oldincl=* | --oldinc=* \
-  | --oldin=* | --oldi=* | --old=* | --ol=* | --o=*)
-    oldincludedir=$ac_optarg ;;
-
-  -prefix | --prefix | --prefi | --pref | --pre | --pr | --p)
-    ac_prev=prefix ;;
-  -prefix=* | --prefix=* | --prefi=* | --pref=* | --pre=* | --pr=* | --p=*)
-    prefix=$ac_optarg ;;
-
-  -program-prefix | --program-prefix | --program-prefi | --program-pref \
-  | --program-pre | --program-pr | --program-p)
-    ac_prev=program_prefix ;;
-  -program-prefix=* | --program-prefix=* | --program-prefi=* \
-  | --program-pref=* | --program-pre=* | --program-pr=* | --program-p=*)
-    program_prefix=$ac_optarg ;;
-
-  -program-suffix | --program-suffix | --program-suffi | --program-suff \
-  | --program-suf | --program-su | --program-s)
-    ac_prev=program_suffix ;;
-  -program-suffix=* | --program-suffix=* | --program-suffi=* \
-  | --program-suff=* | --program-suf=* | --program-su=* | --program-s=*)
-    program_suffix=$ac_optarg ;;
-
-  -program-transform-name | --program-transform-name \
-  | --program-transform-nam | --program-transform-na \
-  | --program-transform-n | --program-transform- \
-  | --program-transform | --program-transfor \
-  | --program-transfo | --program-transf \
-  | --program-trans | --program-tran \
-  | --progr-tra | --program-tr | --program-t)
-    ac_prev=program_transform_name ;;
-  -program-transform-name=* | --program-transform-name=* \
-  | --program-transform-nam=* | --program-transform-na=* \
-  | --program-transform-n=* | --program-transform-=* \
-  | --program-transform=* | --program-transfor=* \
-  | --program-transfo=* | --program-transf=* \
-  | --program-trans=* | --program-tran=* \
-  | --progr-tra=* | --program-tr=* | --program-t=*)
-    program_transform_name=$ac_optarg ;;
-
-  -pdfdir | --pdfdir | --pdfdi | --pdfd | --pdf | --pd)
-    ac_prev=pdfdir ;;
-  -pdfdir=* | --pdfdir=* | --pdfdi=* | --pdfd=* | --pdf=* | --pd=*)
-    pdfdir=$ac_optarg ;;
-
-  -psdir | --psdir | --psdi | --psd | --ps)
-    ac_prev=psdir ;;
-  -psdir=* | --psdir=* | --psdi=* | --psd=* | --ps=*)
-    psdir=$ac_optarg ;;
-
-  -q | -quiet | --quiet | --quie | --qui | --qu | --q \
-  | -silent | --silent | --silen | --sile | --sil)
-    silent=yes ;;
-
-  -sbindir | --sbindir | --sbindi | --sbind | --sbin | --sbi | --sb)
-    ac_prev=sbindir ;;
-  -sbindir=* | --sbindir=* | --sbindi=* | --sbind=* | --sbin=* \
-  | --sbi=* | --sb=*)
-    sbindir=$ac_optarg ;;
-
-  -sharedstatedir | --sharedstatedir | --sharedstatedi \
-  | --sharedstated | --sharedstate | --sharedstat | --sharedsta \
-  | --sharedst | --shareds | --shared | --share | --shar \
-  | --sha | --sh)
-    ac_prev=sharedstatedir ;;
-  -sharedstatedir=* | --sharedstatedir=* | --sharedstatedi=* \
-  | --sharedstated=* | --sharedstate=* | --sharedstat=* | --sharedsta=* \
-  | --sharedst=* | --shareds=* | --shared=* | --share=* | --shar=* \
-  | --sha=* | --sh=*)
-    sharedstatedir=$ac_optarg ;;
-
-  -site | --site | --sit)
-    ac_prev=site ;;
-  -site=* | --site=* | --sit=*)
-    site=$ac_optarg ;;
-
-  -srcdir | --srcdir | --srcdi | --srcd | --src | --sr)
-    ac_prev=srcdir ;;
-  -srcdir=* | --srcdir=* | --srcdi=* | --srcd=* | --src=* | --sr=*)
-    srcdir=$ac_optarg ;;
-
-  -sysconfdir | --sysconfdir | --sysconfdi | --sysconfd | --sysconf \
-  | --syscon | --sysco | --sysc | --sys | --sy)
-    ac_prev=sysconfdir ;;
-  -sysconfdir=* | --sysconfdir=* | --sysconfdi=* | --sysconfd=* | --sysconf=* \
-  | --syscon=* | --sysco=* | --sysc=* | --sys=* | --sy=*)
-    sysconfdir=$ac_optarg ;;
-
-  -target | --target | --targe | --targ | --tar | --ta | --t)
-    ac_prev=target_alias ;;
-  -target=* | --target=* | --targe=* | --targ=* | --tar=* | --ta=* | --t=*)
-    target_alias=$ac_optarg ;;
-
-  -v | -verbose | --verbose | --verbos | --verbo | --verb)
-    verbose=yes ;;
-
-  -version | --version | --versio | --versi | --vers | -V)
-    ac_init_version=: ;;
-
-  -with-* | --with-*)
-    ac_useropt=`expr "x$ac_option" : 'x-*with-\([^=]*\)'`
-    # Reject names that are not valid shell variable names.
-    expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
-      as_fn_error $? "invalid package name: $ac_useropt"
-    ac_useropt_orig=$ac_useropt
-    ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
-    case $ac_user_opts in
-      *"
-"with_$ac_useropt"
-"*) ;;
-      *) ac_unrecognized_opts="$ac_unrecognized_opts$ac_unrecognized_sep--with-$ac_useropt_orig"
-	 ac_unrecognized_sep=', ';;
-    esac
-    eval with_$ac_useropt=\$ac_optarg ;;
-
-  -without-* | --without-*)
-    ac_useropt=`expr "x$ac_option" : 'x-*without-\(.*\)'`
-    # Reject names that are not valid shell variable names.
-    expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
-      as_fn_error $? "invalid package name: $ac_useropt"
-    ac_useropt_orig=$ac_useropt
-    ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
-    case $ac_user_opts in
-      *"
-"with_$ac_useropt"
-"*) ;;
-      *) ac_unrecognized_opts="$ac_unrecognized_opts$ac_unrecognized_sep--without-$ac_useropt_orig"
-	 ac_unrecognized_sep=', ';;
-    esac
-    eval with_$ac_useropt=no ;;
-
-  --x)
-    # Obsolete; use --with-x.
-    with_x=yes ;;
-
-  -x-includes | --x-includes | --x-include | --x-includ | --x-inclu \
-  | --x-incl | --x-inc | --x-in | --x-i)
-    ac_prev=x_includes ;;
-  -x-includes=* | --x-includes=* | --x-include=* | --x-includ=* | --x-inclu=* \
-  | --x-incl=* | --x-inc=* | --x-in=* | --x-i=*)
-    x_includes=$ac_optarg ;;
-
-  -x-libraries | --x-libraries | --x-librarie | --x-librari \
-  | --x-librar | --x-libra | --x-libr | --x-lib | --x-li | --x-l)
-    ac_prev=x_libraries ;;
-  -x-libraries=* | --x-libraries=* | --x-librarie=* | --x-librari=* \
-  | --x-librar=* | --x-libra=* | --x-libr=* | --x-lib=* | --x-li=* | --x-l=*)
-    x_libraries=$ac_optarg ;;
-
-  -*) as_fn_error $? "unrecognized option: \`$ac_option'
-Try \`$0 --help' for more information"
-    ;;
-
-  *=*)
-    ac_envvar=`expr "x$ac_option" : 'x\([^=]*\)='`
-    # Reject names that are not valid shell variable names.
-    case $ac_envvar in #(
-      '' | [0-9]* | *[!_$as_cr_alnum]* )
-      as_fn_error $? "invalid variable name: \`$ac_envvar'" ;;
-    esac
-    eval $ac_envvar=\$ac_optarg
-    export $ac_envvar ;;
-
-  *)
-    # FIXME: should be removed in autoconf 3.0.
-    $as_echo "$as_me: WARNING: you should use --build, --host, --target" >&2
-    expr "x$ac_option" : ".*[^-._$as_cr_alnum]" >/dev/null &&
-      $as_echo "$as_me: WARNING: invalid host type: $ac_option" >&2
-    : "${build_alias=$ac_option} ${host_alias=$ac_option} ${target_alias=$ac_option}"
-    ;;
-
-  esac
-done
-
-if test -n "$ac_prev"; then
-  ac_option=--`echo $ac_prev | sed 's/_/-/g'`
-  as_fn_error $? "missing argument to $ac_option"
-fi
-
-if test -n "$ac_unrecognized_opts"; then
-  case $enable_option_checking in
-    no) ;;
-    fatal) as_fn_error $? "unrecognized options: $ac_unrecognized_opts" ;;
-    *)     $as_echo "$as_me: WARNING: unrecognized options: $ac_unrecognized_opts" >&2 ;;
-  esac
-fi
-
-# Check all directory arguments for consistency.
-for ac_var in	exec_prefix prefix bindir sbindir libexecdir datarootdir \
-		datadir sysconfdir sharedstatedir localstatedir includedir \
-		oldincludedir docdir infodir htmldir dvidir pdfdir psdir \
-		libdir localedir mandir
-do
-  eval ac_val=\$$ac_var
-  # Remove trailing slashes.
-  case $ac_val in
-    */ )
-      ac_val=`expr "X$ac_val" : 'X\(.*[^/]\)' \| "X$ac_val" : 'X\(.*\)'`
-      eval $ac_var=\$ac_val;;
-  esac
-  # Be sure to have absolute directory names.
-  case $ac_val in
-    [\\/$]* | ?:[\\/]* )  continue;;
-    NONE | '' ) case $ac_var in *prefix ) continue;; esac;;
-  esac
-  as_fn_error $? "expected an absolute directory name for --$ac_var: $ac_val"
-done
-
-# There might be people who depend on the old broken behavior: `$host'
-# used to hold the argument of --host etc.
-# FIXME: To remove some day.
-build=$build_alias
-host=$host_alias
-target=$target_alias
-
-# FIXME: To remove some day.
-if test "x$host_alias" != x; then
-  if test "x$build_alias" = x; then
-    cross_compiling=maybe
-  elif test "x$build_alias" != "x$host_alias"; then
-    cross_compiling=yes
-  fi
-fi
-
-ac_tool_prefix=
-test -n "$host_alias" && ac_tool_prefix=$host_alias-
-
-test "$silent" = yes && exec 6>/dev/null
-
-
-ac_pwd=`pwd` && test -n "$ac_pwd" &&
-ac_ls_di=`ls -di .` &&
-ac_pwd_ls_di=`cd "$ac_pwd" && ls -di .` ||
-  as_fn_error $? "working directory cannot be determined"
-test "X$ac_ls_di" = "X$ac_pwd_ls_di" ||
-  as_fn_error $? "pwd does not report name of working directory"
-
-
-# Find the source files, if location was not specified.
-if test -z "$srcdir"; then
-  ac_srcdir_defaulted=yes
-  # Try the directory containing this script, then the parent directory.
-  ac_confdir=`$as_dirname -- "$as_myself" ||
-$as_expr X"$as_myself" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
-	 X"$as_myself" : 'X\(//\)[^/]' \| \
-	 X"$as_myself" : 'X\(//\)$' \| \
-	 X"$as_myself" : 'X\(/\)' \| . 2>/dev/null ||
-$as_echo X"$as_myself" |
-    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\/\)[^/].*/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\/\)$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\).*/{
-	    s//\1/
-	    q
-	  }
-	  s/.*/./; q'`
-  srcdir=$ac_confdir
-  if test ! -r "$srcdir/$ac_unique_file"; then
-    srcdir=..
-  fi
-else
-  ac_srcdir_defaulted=no
-fi
-if test ! -r "$srcdir/$ac_unique_file"; then
-  test "$ac_srcdir_defaulted" = yes && srcdir="$ac_confdir or .."
-  as_fn_error $? "cannot find sources ($ac_unique_file) in $srcdir"
-fi
-ac_msg="sources are in $srcdir, but \`cd $srcdir' does not work"
-ac_abs_confdir=`(
-	cd "$srcdir" && test -r "./$ac_unique_file" || as_fn_error $? "$ac_msg"
-	pwd)`
-# When building in place, set srcdir=.
-if test "$ac_abs_confdir" = "$ac_pwd"; then
-  srcdir=.
-fi
-# Remove unnecessary trailing slashes from srcdir.
-# Double slashes in file names in object file debugging info
-# mess up M-x gdb in Emacs.
-case $srcdir in
-*/) srcdir=`expr "X$srcdir" : 'X\(.*[^/]\)' \| "X$srcdir" : 'X\(.*\)'`;;
-esac
-for ac_var in $ac_precious_vars; do
-  eval ac_env_${ac_var}_set=\${${ac_var}+set}
-  eval ac_env_${ac_var}_value=\$${ac_var}
-  eval ac_cv_env_${ac_var}_set=\${${ac_var}+set}
-  eval ac_cv_env_${ac_var}_value=\$${ac_var}
-done
-
-#
-# Report the --help message.
-#
-if test "$ac_init_help" = "long"; then
-  # Omit some internal or obsolete options to make the list less imposing.
-  # This message is too long to be a string in the A/UX 3.1 sh.
-  cat <<_ACEOF
-\`configure' configures ICU 57.1 to adapt to many kinds of systems.
-
-Usage: $0 [OPTION]... [VAR=VALUE]...
-
-To assign environment variables (e.g., CC, CFLAGS...), specify them as
-VAR=VALUE.  See below for descriptions of some of the useful variables.
-
-Defaults for the options are specified in brackets.
-
-Configuration:
-  -h, --help              display this help and exit
-      --help=short        display options specific to this package
-      --help=recursive    display the short help of all the included packages
-  -V, --version           display version information and exit
-  -q, --quiet, --silent   do not print \`checking ...' messages
-      --cache-file=FILE   cache test results in FILE [disabled]
-  -C, --config-cache      alias for \`--cache-file=config.cache'
-  -n, --no-create         do not create output files
-      --srcdir=DIR        find the sources in DIR [configure dir or \`..']
-
-Installation directories:
-  --prefix=PREFIX         install architecture-independent files in PREFIX
-                          [$ac_default_prefix]
-  --exec-prefix=EPREFIX   install architecture-dependent files in EPREFIX
-                          [PREFIX]
-
-By default, \`make install' will install all the files in
-\`$ac_default_prefix/bin', \`$ac_default_prefix/lib' etc.  You can specify
-an installation prefix other than \`$ac_default_prefix' using \`--prefix',
-for instance \`--prefix=\$HOME'.
-
-For better control, use the options below.
-
-Fine tuning of the installation directories:
-  --bindir=DIR            user executables [EPREFIX/bin]
-  --sbindir=DIR           system admin executables [EPREFIX/sbin]
-  --libexecdir=DIR        program executables [EPREFIX/libexec]
-  --sysconfdir=DIR        read-only single-machine data [PREFIX/etc]
-  --sharedstatedir=DIR    modifiable architecture-independent data [PREFIX/com]
-  --localstatedir=DIR     modifiable single-machine data [PREFIX/var]
-  --libdir=DIR            object code libraries [EPREFIX/lib]
-  --includedir=DIR        C header files [PREFIX/include]
-  --oldincludedir=DIR     C header files for non-gcc [/usr/include]
-  --datarootdir=DIR       read-only arch.-independent data root [PREFIX/share]
-  --datadir=DIR           read-only architecture-independent data [DATAROOTDIR]
-  --infodir=DIR           info documentation [DATAROOTDIR/info]
-  --localedir=DIR         locale-dependent data [DATAROOTDIR/locale]
-  --mandir=DIR            man documentation [DATAROOTDIR/man]
-  --docdir=DIR            documentation root [DATAROOTDIR/doc/International
-                          Components for Unicode]
-  --htmldir=DIR           html documentation [DOCDIR]
-  --dvidir=DIR            dvi documentation [DOCDIR]
-  --pdfdir=DIR            pdf documentation [DOCDIR]
-  --psdir=DIR             ps documentation [DOCDIR]
-_ACEOF
-
-  cat <<\_ACEOF
-
-System types:
-  --build=BUILD     configure for building on BUILD [guessed]
-  --host=HOST       cross-compile to build programs to run on HOST [BUILD]
-_ACEOF
-fi
-
-if test -n "$ac_init_help"; then
-  case $ac_init_help in
-     short | recursive ) echo "Configuration of ICU 57.1:";;
-   esac
-  cat <<\_ACEOF
-
-Optional Features:
-  --disable-option-checking  ignore unrecognized --enable/--with options
-  --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
-  --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]
-  --enable-debug          build debug libraries and enable the U_DEBUG define default=no
-  --enable-release        build release libraries default=yes
-  --enable-strict         compile with strict compiler options default=yes
-  --enable-64bit-libs     (deprecated, use --with-library-bits) build 64-bit libraries default= platform default
-  --enable-shared         build shared libraries default=yes
-  --enable-static         build static libraries default=no
-  --enable-auto-cleanup   enable auto cleanup of libraries default=no
-  --enable-draft          enable draft APIs (and internal APIs) default=yes
-  --enable-renaming       add a version suffix to symbols default=yes
-  --enable-tracing        enable function and data tracing default=no
-  --enable-plugins        enable plugins default=no
-  --disable-dyload        disable dynamic loading default=no
-  --enable-rpath          use rpath when linking default is only if necessary
-  --enable-weak-threads   weakly reference the threading library default=no
-  --enable-extras         build ICU extras default=yes
-  --enable-icuio          build ICU's icuio library default=yes
-  --enable-layout         build ICU's DEPRECATED layout library default=yes
-  --enable-layoutex         build ICU's Paragraph Layout library default=same-as-layout.
-            If not building with the ICU Layout library, then icu-le-hb must be installed via pkg-config.
-            See http://harfbuzz.org
-  --enable-tools         build ICU's tools default=yes
-  --enable-tests          build ICU tests default=yes
-  --enable-samples        build ICU samples default=yes
-
-Additionally, the variable FORCE_LIBS may be set before calling configure.
-If set, it will REPLACE any automatic list of libraries.
-
-Optional Packages:
-  --with-PACKAGE[=ARG]    use PACKAGE [ARG=yes]
-  --without-PACKAGE       do not use PACKAGE (same as --with-PACKAGE=no)
-  --with-cross-build=dir specify an absolute path to the build directory of an ICU built for the current platform default=no cross dir
-  --with-library-bits=bits specify how many bits to use for the library (32, 64, 64else32, nochange) default=nochange
-  --with-data-packaging     specify how to package ICU data. Possible values:
-        files    raw files (.res, etc)
-        archive  build a single icudtXX.dat file
-        library  shared library (.dll/.so/etc.)
-        static   static library (.a/.lib/etc.)
-        auto     build shared if possible (default)
-           See http://userguide.icu-project.org/icudata for more info.
-  --with-library-suffix=suffix    tag a suffix to the library names default=
-
-Some influential environment variables:
-  CC          C compiler command
-  CFLAGS      C compiler flags
-  LDFLAGS     linker flags, e.g. -L<lib dir> if you have libraries in a
-              nonstandard directory <lib dir>
-  LIBS        libraries to pass to the linker, e.g. -l<library>
-  CPPFLAGS    (Objective) C/C++ preprocessor flags, e.g. -I<include dir> if
-              you have headers in a nonstandard directory <include dir>
-  CXX         C++ compiler command
-  CXXFLAGS    C++ compiler flags
-  PKG_CONFIG  path to pkg-config utility
-  PKG_CONFIG_PATH
-              directories to add to pkg-config's search path
-  PKG_CONFIG_LIBDIR
-              path overriding pkg-config's built-in search path
-  ICULEHB_CFLAGS
-              C compiler flags for ICULEHB, overriding pkg-config
-  ICULEHB_LIBS
-              linker flags for ICULEHB, overriding pkg-config
-  CPP         C preprocessor
-
-Use these variables to override the choices made by `configure' or to help
-it to find libraries and programs with nonstandard names/locations.
-
-Report bugs to <http://icu-project.org/bugs>.
-ICU home page: <http://icu-project.org>.
-_ACEOF
-ac_status=$?
-fi
-
-if test "$ac_init_help" = "recursive"; then
-  # If there are subdirs, report their specific --help.
-  for ac_dir in : $ac_subdirs_all; do test "x$ac_dir" = x: && continue
-    test -d "$ac_dir" ||
-      { cd "$srcdir" && ac_pwd=`pwd` && srcdir=. && test -d "$ac_dir"; } ||
-      continue
-    ac_builddir=.
-
-case "$ac_dir" in
-.) ac_dir_suffix= ac_top_builddir_sub=. ac_top_build_prefix= ;;
-*)
-  ac_dir_suffix=/`$as_echo "$ac_dir" | sed 's|^\.[\\/]||'`
-  # A ".." for each directory in $ac_dir_suffix.
-  ac_top_builddir_sub=`$as_echo "$ac_dir_suffix" | sed 's|/[^\\/]*|/..|g;s|/||'`
-  case $ac_top_builddir_sub in
-  "") ac_top_builddir_sub=. ac_top_build_prefix= ;;
-  *)  ac_top_build_prefix=$ac_top_builddir_sub/ ;;
-  esac ;;
-esac
-ac_abs_top_builddir=$ac_pwd
-ac_abs_builddir=$ac_pwd$ac_dir_suffix
-# for backward compatibility:
-ac_top_builddir=$ac_top_build_prefix
-
-case $srcdir in
-  .)  # We are building in place.
-    ac_srcdir=.
-    ac_top_srcdir=$ac_top_builddir_sub
-    ac_abs_top_srcdir=$ac_pwd ;;
-  [\\/]* | ?:[\\/]* )  # Absolute name.
-    ac_srcdir=$srcdir$ac_dir_suffix;
-    ac_top_srcdir=$srcdir
-    ac_abs_top_srcdir=$srcdir ;;
-  *) # Relative name.
-    ac_srcdir=$ac_top_build_prefix$srcdir$ac_dir_suffix
-    ac_top_srcdir=$ac_top_build_prefix$srcdir
-    ac_abs_top_srcdir=$ac_pwd/$srcdir ;;
-esac
-ac_abs_srcdir=$ac_abs_top_srcdir$ac_dir_suffix
-
-    cd "$ac_dir" || { ac_status=$?; continue; }
-    # Check for guested configure.
-    if test -f "$ac_srcdir/configure.gnu"; then
-      echo &&
-      $SHELL "$ac_srcdir/configure.gnu" --help=recursive
-    elif test -f "$ac_srcdir/configure"; then
-      echo &&
-      $SHELL "$ac_srcdir/configure" --help=recursive
-    else
-      $as_echo "$as_me: WARNING: no configuration information is in $ac_dir" >&2
-    fi || ac_status=$?
-    cd "$ac_pwd" || { ac_status=$?; break; }
-  done
-fi
-
-test -n "$ac_init_help" && exit $ac_status
-if $ac_init_version; then
-  cat <<\_ACEOF
-ICU configure 57.1
-generated by GNU Autoconf 2.69
-
-Copyright (C) 2012 Free Software Foundation, Inc.
-This configure script is free software; the Free Software Foundation
-gives unlimited permission to copy, distribute and modify it.
-
- Copyright (c) 1999-2015, International Business Machines Corporation and others. All Rights Reserved.
-_ACEOF
-  exit
-fi
-
-## ------------------------ ##
-## Autoconf initialization. ##
-## ------------------------ ##
-
-# ac_fn_c_try_compile LINENO
-# --------------------------
-# Try to compile conftest.$ac_ext, and return whether this succeeded.
-ac_fn_c_try_compile ()
-{
-  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
-  rm -f conftest.$ac_objext
-  if { { ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
-$as_echo "$ac_try_echo"; } >&5
-  (eval "$ac_compile") 2>conftest.err
-  ac_status=$?
-  if test -s conftest.err; then
-    grep -v '^ *+' conftest.err >conftest.er1
-    cat conftest.er1 >&5
-    mv -f conftest.er1 conftest.err
-  fi
-  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then :
-  ac_retval=0
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_retval=1
-fi
-  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
-  as_fn_set_status $ac_retval
-
-} # ac_fn_c_try_compile
-
-# ac_fn_cxx_try_compile LINENO
-# ----------------------------
-# Try to compile conftest.$ac_ext, and return whether this succeeded.
-ac_fn_cxx_try_compile ()
-{
-  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
-  rm -f conftest.$ac_objext
-  if { { ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
-$as_echo "$ac_try_echo"; } >&5
-  (eval "$ac_compile") 2>conftest.err
-  ac_status=$?
-  if test -s conftest.err; then
-    grep -v '^ *+' conftest.err >conftest.er1
-    cat conftest.er1 >&5
-    mv -f conftest.er1 conftest.err
-  fi
-  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; } && {
-	 test -z "$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then :
-  ac_retval=0
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_retval=1
-fi
-  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
-  as_fn_set_status $ac_retval
-
-} # ac_fn_cxx_try_compile
-
-# ac_fn_c_try_cpp LINENO
-# ----------------------
-# Try to preprocess conftest.$ac_ext, and return whether this succeeded.
-ac_fn_c_try_cpp ()
-{
-  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
-  if { { ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
-$as_echo "$ac_try_echo"; } >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.err
-  ac_status=$?
-  if test -s conftest.err; then
-    grep -v '^ *+' conftest.err >conftest.er1
-    cat conftest.er1 >&5
-    mv -f conftest.er1 conftest.err
-  fi
-  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; } > conftest.i && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then :
-  ac_retval=0
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-    ac_retval=1
-fi
-  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
-  as_fn_set_status $ac_retval
-
-} # ac_fn_c_try_cpp
-
-# ac_fn_cxx_try_link LINENO
-# -------------------------
-# Try to link conftest.$ac_ext, and return whether this succeeded.
-ac_fn_cxx_try_link ()
-{
-  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
-  rm -f conftest.$ac_objext conftest$ac_exeext
-  if { { ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
-$as_echo "$ac_try_echo"; } >&5
-  (eval "$ac_link") 2>conftest.err
-  ac_status=$?
-  if test -s conftest.err; then
-    grep -v '^ *+' conftest.err >conftest.er1
-    cat conftest.er1 >&5
-    mv -f conftest.er1 conftest.err
-  fi
-  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; } && {
-	 test -z "$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 test -x conftest$ac_exeext
-       }; then :
-  ac_retval=0
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_retval=1
-fi
-  # Delete the IPA/IPO (Inter Procedural Analysis/Optimization) information
-  # created by the PGI compiler (conftest_ipa8_conftest.oo), as it would
-  # interfere with the next link command; also delete a directory that is
-  # left behind by Apple's compiler.  We do this before executing the actions.
-  rm -rf conftest.dSYM conftest_ipa8_conftest.oo
-  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
-  as_fn_set_status $ac_retval
-
-} # ac_fn_cxx_try_link
-
-# ac_fn_c_try_run LINENO
-# ----------------------
-# Try to link conftest.$ac_ext, and return whether this succeeded. Assumes
-# that executables *can* be run.
-ac_fn_c_try_run ()
-{
-  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
-  if { { ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
-$as_echo "$ac_try_echo"; } >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; } && { ac_try='./conftest$ac_exeext'
-  { { case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
-$as_echo "$ac_try_echo"; } >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; }; }; then :
-  ac_retval=0
-else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-       $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-       ac_retval=$ac_status
-fi
-  rm -rf conftest.dSYM conftest_ipa8_conftest.oo
-  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
-  as_fn_set_status $ac_retval
-
-} # ac_fn_c_try_run
-
-# ac_fn_c_compute_int LINENO EXPR VAR INCLUDES
-# --------------------------------------------
-# Tries to find the compile-time value of EXPR in a program that includes
-# INCLUDES, setting VAR accordingly. Returns whether the value could be
-# computed
-ac_fn_c_compute_int ()
-{
-  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
-  if test "$cross_compiling" = yes; then
-    # Depending upon the size, compute the lo and hi bounds.
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-$4
-int
-main ()
-{
-static int test_array [1 - 2 * !(($2) >= 0)];
-test_array [0] = 0;
-return test_array [0];
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  ac_lo=0 ac_mid=0
-  while :; do
-    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-$4
-int
-main ()
-{
-static int test_array [1 - 2 * !(($2) <= $ac_mid)];
-test_array [0] = 0;
-return test_array [0];
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  ac_hi=$ac_mid; break
-else
-  as_fn_arith $ac_mid + 1 && ac_lo=$as_val
-			if test $ac_lo -le $ac_mid; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			as_fn_arith 2 '*' $ac_mid + 1 && ac_mid=$as_val
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-$4
-int
-main ()
-{
-static int test_array [1 - 2 * !(($2) < 0)];
-test_array [0] = 0;
-return test_array [0];
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  ac_hi=-1 ac_mid=-1
-  while :; do
-    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-$4
-int
-main ()
-{
-static int test_array [1 - 2 * !(($2) >= $ac_mid)];
-test_array [0] = 0;
-return test_array [0];
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  ac_lo=$ac_mid; break
-else
-  as_fn_arith '(' $ac_mid ')' - 1 && ac_hi=$as_val
-			if test $ac_mid -le $ac_hi; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			as_fn_arith 2 '*' $ac_mid && ac_mid=$as_val
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
-else
-  ac_lo= ac_hi=
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-# Binary search between lo and hi bounds.
-while test "x$ac_lo" != "x$ac_hi"; do
-  as_fn_arith '(' $ac_hi - $ac_lo ')' / 2 + $ac_lo && ac_mid=$as_val
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-$4
-int
-main ()
-{
-static int test_array [1 - 2 * !(($2) <= $ac_mid)];
-test_array [0] = 0;
-return test_array [0];
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  ac_hi=$ac_mid
-else
-  as_fn_arith '(' $ac_mid ')' + 1 && ac_lo=$as_val
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-done
-case $ac_lo in #((
-?*) eval "$3=\$ac_lo"; ac_retval=0 ;;
-'') ac_retval=1 ;;
-esac
-  else
-    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-$4
-static long int longval () { return $2; }
-static unsigned long int ulongval () { return $2; }
-#include <stdio.h>
-#include <stdlib.h>
-int
-main ()
-{
-
-  FILE *f = fopen ("conftest.val", "w");
-  if (! f)
-    return 1;
-  if (($2) < 0)
-    {
-      long int i = longval ();
-      if (i != ($2))
-	return 1;
-      fprintf (f, "%ld", i);
-    }
-  else
-    {
-      unsigned long int i = ulongval ();
-      if (i != ($2))
-	return 1;
-      fprintf (f, "%lu", i);
-    }
-  /* Do not output a trailing newline, as this causes \r\n confusion
-     on some platforms.  */
-  return ferror (f) || fclose (f) != 0;
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_run "$LINENO"; then :
-  echo >>conftest.val; read $3 <conftest.val; ac_retval=0
-else
-  ac_retval=1
-fi
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
-  conftest.$ac_objext conftest.beam conftest.$ac_ext
-rm -f conftest.val
-
-  fi
-  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
-  as_fn_set_status $ac_retval
-
-} # ac_fn_c_compute_int
-
-# ac_fn_c_check_header_compile LINENO HEADER VAR INCLUDES
-# -------------------------------------------------------
-# Tests whether HEADER exists and can be compiled using the include files in
-# INCLUDES, setting the cache variable VAR accordingly.
-ac_fn_c_check_header_compile ()
-{
-  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
-$as_echo_n "checking for $2... " >&6; }
-if eval \${$3+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-$4
-#include <$2>
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  eval "$3=yes"
-else
-  eval "$3=no"
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-eval ac_res=\$$3
-	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
-
-} # ac_fn_c_check_header_compile
-
-# ac_fn_c_try_link LINENO
-# -----------------------
-# Try to link conftest.$ac_ext, and return whether this succeeded.
-ac_fn_c_try_link ()
-{
-  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
-  rm -f conftest.$ac_objext conftest$ac_exeext
-  if { { ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
-$as_echo "$ac_try_echo"; } >&5
-  (eval "$ac_link") 2>conftest.err
-  ac_status=$?
-  if test -s conftest.err; then
-    grep -v '^ *+' conftest.err >conftest.er1
-    cat conftest.er1 >&5
-    mv -f conftest.er1 conftest.err
-  fi
-  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 test -x conftest$ac_exeext
-       }; then :
-  ac_retval=0
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_retval=1
-fi
-  # Delete the IPA/IPO (Inter Procedural Analysis/Optimization) information
-  # created by the PGI compiler (conftest_ipa8_conftest.oo), as it would
-  # interfere with the next link command; also delete a directory that is
-  # left behind by Apple's compiler.  We do this before executing the actions.
-  rm -rf conftest.dSYM conftest_ipa8_conftest.oo
-  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
-  as_fn_set_status $ac_retval
-
-} # ac_fn_c_try_link
-
-# ac_fn_c_check_header_mongrel LINENO HEADER VAR INCLUDES
-# -------------------------------------------------------
-# Tests whether HEADER exists, giving a warning if it cannot be compiled using
-# the include files in INCLUDES and setting the cache variable VAR
-# accordingly.
-ac_fn_c_check_header_mongrel ()
-{
-  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
-  if eval \${$3+:} false; then :
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
-$as_echo_n "checking for $2... " >&6; }
-if eval \${$3+:} false; then :
-  $as_echo_n "(cached) " >&6
-fi
-eval ac_res=\$$3
-	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-else
-  # Is the header compilable?
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking $2 usability" >&5
-$as_echo_n "checking $2 usability... " >&6; }
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-$4
-#include <$2>
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  ac_header_compiler=yes
-else
-  ac_header_compiler=no
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_header_compiler" >&5
-$as_echo "$ac_header_compiler" >&6; }
-
-# Is the header present?
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking $2 presence" >&5
-$as_echo_n "checking $2 presence... " >&6; }
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <$2>
-_ACEOF
-if ac_fn_c_try_cpp "$LINENO"; then :
-  ac_header_preproc=yes
-else
-  ac_header_preproc=no
-fi
-rm -f conftest.err conftest.i conftest.$ac_ext
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_header_preproc" >&5
-$as_echo "$ac_header_preproc" >&6; }
-
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in #((
-  yes:no: )
-    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: accepted by the compiler, rejected by the preprocessor!" >&5
-$as_echo "$as_me: WARNING: $2: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: proceeding with the compiler's result" >&5
-$as_echo "$as_me: WARNING: $2: proceeding with the compiler's result" >&2;}
-    ;;
-  no:yes:* )
-    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: present but cannot be compiled" >&5
-$as_echo "$as_me: WARNING: $2: present but cannot be compiled" >&2;}
-    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2:     check for missing prerequisite headers?" >&5
-$as_echo "$as_me: WARNING: $2:     check for missing prerequisite headers?" >&2;}
-    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: see the Autoconf documentation" >&5
-$as_echo "$as_me: WARNING: $2: see the Autoconf documentation" >&2;}
-    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2:     section \"Present But Cannot Be Compiled\"" >&5
-$as_echo "$as_me: WARNING: $2:     section \"Present But Cannot Be Compiled\"" >&2;}
-    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: proceeding with the compiler's result" >&5
-$as_echo "$as_me: WARNING: $2: proceeding with the compiler's result" >&2;}
-( $as_echo "## ------------------------------------------ ##
-## Report this to http://icu-project.org/bugs ##
-## ------------------------------------------ ##"
-     ) | sed "s/^/$as_me: WARNING:     /" >&2
-    ;;
-esac
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
-$as_echo_n "checking for $2... " >&6; }
-if eval \${$3+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  eval "$3=\$ac_header_compiler"
-fi
-eval ac_res=\$$3
-	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-fi
-  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
-
-} # ac_fn_c_check_header_mongrel
-
-# ac_fn_c_check_func LINENO FUNC VAR
-# ----------------------------------
-# Tests whether FUNC exists, setting the cache variable VAR accordingly
-ac_fn_c_check_func ()
-{
-  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
-$as_echo_n "checking for $2... " >&6; }
-if eval \${$3+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-/* Define $2 to an innocuous variant, in case <limits.h> declares $2.
-   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
-#define $2 innocuous_$2
-
-/* System header to define __stub macros and hopefully few prototypes,
-    which can conflict with char $2 (); below.
-    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-    <limits.h> exists even on freestanding compilers.  */
-
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
-
-#undef $2
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char $2 ();
-/* The GNU C library defines this for functions which it implements
-    to always fail with ENOSYS.  Some functions are actually named
-    something starting with __ and the normal name is an alias.  */
-#if defined __stub_$2 || defined __stub___$2
-choke me
-#endif
-
-int
-main ()
-{
-return $2 ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  eval "$3=yes"
-else
-  eval "$3=no"
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-fi
-eval ac_res=\$$3
-	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
-
-} # ac_fn_c_check_func
-
-# ac_fn_c_check_type LINENO TYPE VAR INCLUDES
-# -------------------------------------------
-# Tests whether TYPE exists after having included INCLUDES, setting cache
-# variable VAR accordingly.
-ac_fn_c_check_type ()
-{
-  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
-$as_echo_n "checking for $2... " >&6; }
-if eval \${$3+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  eval "$3=no"
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-$4
-int
-main ()
-{
-if (sizeof ($2))
-	 return 0;
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-$4
-int
-main ()
-{
-if (sizeof (($2)))
-	    return 0;
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-
-else
-  eval "$3=yes"
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-eval ac_res=\$$3
-	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
-
-} # ac_fn_c_check_type
-cat >config.log <<_ACEOF
-This file contains any messages produced by compilers while
-running configure, to aid debugging if configure makes a mistake.
-
-It was created by ICU $as_me 57.1, which was
-generated by GNU Autoconf 2.69.  Invocation command line was
-
-  $ $0 $@
-
-_ACEOF
-exec 5>>config.log
-{
-cat <<_ASUNAME
-## --------- ##
-## Platform. ##
-## --------- ##
-
-hostname = `(hostname || uname -n) 2>/dev/null | sed 1q`
-uname -m = `(uname -m) 2>/dev/null || echo unknown`
-uname -r = `(uname -r) 2>/dev/null || echo unknown`
-uname -s = `(uname -s) 2>/dev/null || echo unknown`
-uname -v = `(uname -v) 2>/dev/null || echo unknown`
-
-/usr/bin/uname -p = `(/usr/bin/uname -p) 2>/dev/null || echo unknown`
-/bin/uname -X     = `(/bin/uname -X) 2>/dev/null     || echo unknown`
-
-/bin/arch              = `(/bin/arch) 2>/dev/null              || echo unknown`
-/usr/bin/arch -k       = `(/usr/bin/arch -k) 2>/dev/null       || echo unknown`
-/usr/convex/getsysinfo = `(/usr/convex/getsysinfo) 2>/dev/null || echo unknown`
-/usr/bin/hostinfo      = `(/usr/bin/hostinfo) 2>/dev/null      || echo unknown`
-/bin/machine           = `(/bin/machine) 2>/dev/null           || echo unknown`
-/usr/bin/oslevel       = `(/usr/bin/oslevel) 2>/dev/null       || echo unknown`
-/bin/universe          = `(/bin/universe) 2>/dev/null          || echo unknown`
-
-_ASUNAME
-
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    $as_echo "PATH: $as_dir"
-  done
-IFS=$as_save_IFS
-
-} >&5
-
-cat >&5 <<_ACEOF
-
-
-## ----------- ##
-## Core tests. ##
-## ----------- ##
-
-_ACEOF
-
-
-# Keep a trace of the command line.
-# Strip out --no-create and --no-recursion so they do not pile up.
-# Strip out --silent because we don't want to record it for future runs.
-# Also quote any args containing shell meta-characters.
-# Make two passes to allow for proper duplicate-argument suppression.
-ac_configure_args=
-ac_configure_args0=
-ac_configure_args1=
-ac_must_keep_next=false
-for ac_pass in 1 2
-do
-  for ac_arg
-  do
-    case $ac_arg in
-    -no-create | --no-c* | -n | -no-recursion | --no-r*) continue ;;
-    -q | -quiet | --quiet | --quie | --qui | --qu | --q \
-    | -silent | --silent | --silen | --sile | --sil)
-      continue ;;
-    *\'*)
-      ac_arg=`$as_echo "$ac_arg" | sed "s/'/'\\\\\\\\''/g"` ;;
-    esac
-    case $ac_pass in
-    1) as_fn_append ac_configure_args0 " '$ac_arg'" ;;
-    2)
-      as_fn_append ac_configure_args1 " '$ac_arg'"
-      if test $ac_must_keep_next = true; then
-	ac_must_keep_next=false # Got value, back to normal.
-      else
-	case $ac_arg in
-	  *=* | --config-cache | -C | -disable-* | --disable-* \
-	  | -enable-* | --enable-* | -gas | --g* | -nfp | --nf* \
-	  | -q | -quiet | --q* | -silent | --sil* | -v | -verb* \
-	  | -with-* | --with-* | -without-* | --without-* | --x)
-	    case "$ac_configure_args0 " in
-	      "$ac_configure_args1"*" '$ac_arg' "* ) continue ;;
-	    esac
-	    ;;
-	  -* ) ac_must_keep_next=true ;;
-	esac
-      fi
-      as_fn_append ac_configure_args " '$ac_arg'"
-      ;;
-    esac
-  done
-done
-{ ac_configure_args0=; unset ac_configure_args0;}
-{ ac_configure_args1=; unset ac_configure_args1;}
-
-# When interrupted or exit'd, cleanup temporary files, and complete
-# config.log.  We remove comments because anyway the quotes in there
-# would cause problems or look ugly.
-# WARNING: Use '\'' to represent an apostrophe within the trap.
-# WARNING: Do not start the trap code with a newline, due to a FreeBSD 4.0 bug.
-trap 'exit_status=$?
-  # Save into config.log some information that might help in debugging.
-  {
-    echo
-
-    $as_echo "## ---------------- ##
-## Cache variables. ##
-## ---------------- ##"
-    echo
-    # The following way of writing the cache mishandles newlines in values,
-(
-  for ac_var in `(set) 2>&1 | sed -n '\''s/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'\''`; do
-    eval ac_val=\$$ac_var
-    case $ac_val in #(
-    *${as_nl}*)
-      case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
-$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
-      esac
-      case $ac_var in #(
-      _ | IFS | as_nl) ;; #(
-      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) { eval $ac_var=; unset $ac_var;} ;;
-      esac ;;
-    esac
-  done
-  (set) 2>&1 |
-    case $as_nl`(ac_space='\'' '\''; set) 2>&1` in #(
-    *${as_nl}ac_space=\ *)
-      sed -n \
-	"s/'\''/'\''\\\\'\'''\''/g;
-	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\''\\2'\''/p"
-      ;; #(
-    *)
-      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
-      ;;
-    esac |
-    sort
-)
-    echo
-
-    $as_echo "## ----------------- ##
-## Output variables. ##
-## ----------------- ##"
-    echo
-    for ac_var in $ac_subst_vars
-    do
-      eval ac_val=\$$ac_var
-      case $ac_val in
-      *\'\''*) ac_val=`$as_echo "$ac_val" | sed "s/'\''/'\''\\\\\\\\'\'''\''/g"`;;
-      esac
-      $as_echo "$ac_var='\''$ac_val'\''"
-    done | sort
-    echo
-
-    if test -n "$ac_subst_files"; then
-      $as_echo "## ------------------- ##
-## File substitutions. ##
-## ------------------- ##"
-      echo
-      for ac_var in $ac_subst_files
-      do
-	eval ac_val=\$$ac_var
-	case $ac_val in
-	*\'\''*) ac_val=`$as_echo "$ac_val" | sed "s/'\''/'\''\\\\\\\\'\'''\''/g"`;;
-	esac
-	$as_echo "$ac_var='\''$ac_val'\''"
-      done | sort
-      echo
-    fi
-
-    if test -s confdefs.h; then
-      $as_echo "## ----------- ##
-## confdefs.h. ##
-## ----------- ##"
-      echo
-      cat confdefs.h
-      echo
-    fi
-    test "$ac_signal" != 0 &&
-      $as_echo "$as_me: caught signal $ac_signal"
-    $as_echo "$as_me: exit $exit_status"
-  } >&5
-  rm -f core *.core core.conftest.* &&
-    rm -f -r conftest* confdefs* conf$$* $ac_clean_files &&
-    exit $exit_status
-' 0
-for ac_signal in 1 2 13 15; do
-  trap 'ac_signal='$ac_signal'; as_fn_exit 1' $ac_signal
-done
-ac_signal=0
-
-# confdefs.h avoids OS command line length limits that DEFS can exceed.
-rm -f -r conftest* confdefs.h
-
-$as_echo "/* confdefs.h */" > confdefs.h
-
-# Predefined preprocessor variables.
-
-cat >>confdefs.h <<_ACEOF
-#define PACKAGE_NAME "$PACKAGE_NAME"
-_ACEOF
-
-cat >>confdefs.h <<_ACEOF
-#define PACKAGE_TARNAME "$PACKAGE_TARNAME"
-_ACEOF
-
-cat >>confdefs.h <<_ACEOF
-#define PACKAGE_VERSION "$PACKAGE_VERSION"
-_ACEOF
-
-cat >>confdefs.h <<_ACEOF
-#define PACKAGE_STRING "$PACKAGE_STRING"
-_ACEOF
-
-cat >>confdefs.h <<_ACEOF
-#define PACKAGE_BUGREPORT "$PACKAGE_BUGREPORT"
-_ACEOF
-
-cat >>confdefs.h <<_ACEOF
-#define PACKAGE_URL "$PACKAGE_URL"
-_ACEOF
-
-
-# Let the site file select an alternate cache file if it wants to.
-# Prefer an explicitly selected file to automatically selected ones.
-ac_site_file1=NONE
-ac_site_file2=NONE
-if test -n "$CONFIG_SITE"; then
-  # We do not want a PATH search for config.site.
-  case $CONFIG_SITE in #((
-    -*)  ac_site_file1=./$CONFIG_SITE;;
-    */*) ac_site_file1=$CONFIG_SITE;;
-    *)   ac_site_file1=./$CONFIG_SITE;;
-  esac
-elif test "x$prefix" != xNONE; then
-  ac_site_file1=$prefix/share/config.site
-  ac_site_file2=$prefix/etc/config.site
-else
-  ac_site_file1=$ac_default_prefix/share/config.site
-  ac_site_file2=$ac_default_prefix/etc/config.site
-fi
-for ac_site_file in "$ac_site_file1" "$ac_site_file2"
-do
-  test "x$ac_site_file" = xNONE && continue
-  if test /dev/null != "$ac_site_file" && test -r "$ac_site_file"; then
-    { $as_echo "$as_me:${as_lineno-$LINENO}: loading site script $ac_site_file" >&5
-$as_echo "$as_me: loading site script $ac_site_file" >&6;}
-    sed 's/^/| /' "$ac_site_file" >&5
-    . "$ac_site_file" \
-      || { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error $? "failed to load site script $ac_site_file
-See \`config.log' for more details" "$LINENO" 5; }
-  fi
-done
-
-if test -r "$cache_file"; then
-  # Some versions of bash will fail to source /dev/null (special files
-  # actually), so we avoid doing that.  DJGPP emulates it as a regular file.
-  if test /dev/null != "$cache_file" && test -f "$cache_file"; then
-    { $as_echo "$as_me:${as_lineno-$LINENO}: loading cache $cache_file" >&5
-$as_echo "$as_me: loading cache $cache_file" >&6;}
-    case $cache_file in
-      [\\/]* | ?:[\\/]* ) . "$cache_file";;
-      *)                      . "./$cache_file";;
-    esac
-  fi
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: creating cache $cache_file" >&5
-$as_echo "$as_me: creating cache $cache_file" >&6;}
-  >$cache_file
-fi
-
-# Check that the precious variables saved in the cache have kept the same
-# value.
-ac_cache_corrupted=false
-for ac_var in $ac_precious_vars; do
-  eval ac_old_set=\$ac_cv_env_${ac_var}_set
-  eval ac_new_set=\$ac_env_${ac_var}_set
-  eval ac_old_val=\$ac_cv_env_${ac_var}_value
-  eval ac_new_val=\$ac_env_${ac_var}_value
-  case $ac_old_set,$ac_new_set in
-    set,)
-      { $as_echo "$as_me:${as_lineno-$LINENO}: error: \`$ac_var' was set to \`$ac_old_val' in the previous run" >&5
-$as_echo "$as_me: error: \`$ac_var' was set to \`$ac_old_val' in the previous run" >&2;}
-      ac_cache_corrupted=: ;;
-    ,set)
-      { $as_echo "$as_me:${as_lineno-$LINENO}: error: \`$ac_var' was not set in the previous run" >&5
-$as_echo "$as_me: error: \`$ac_var' was not set in the previous run" >&2;}
-      ac_cache_corrupted=: ;;
-    ,);;
-    *)
-      if test "x$ac_old_val" != "x$ac_new_val"; then
-	# differences in whitespace do not lead to failure.
-	ac_old_val_w=`echo x $ac_old_val`
-	ac_new_val_w=`echo x $ac_new_val`
-	if test "$ac_old_val_w" != "$ac_new_val_w"; then
-	  { $as_echo "$as_me:${as_lineno-$LINENO}: error: \`$ac_var' has changed since the previous run:" >&5
-$as_echo "$as_me: error: \`$ac_var' has changed since the previous run:" >&2;}
-	  ac_cache_corrupted=:
-	else
-	  { $as_echo "$as_me:${as_lineno-$LINENO}: warning: ignoring whitespace changes in \`$ac_var' since the previous run:" >&5
-$as_echo "$as_me: warning: ignoring whitespace changes in \`$ac_var' since the previous run:" >&2;}
-	  eval $ac_var=\$ac_old_val
-	fi
-	{ $as_echo "$as_me:${as_lineno-$LINENO}:   former value:  \`$ac_old_val'" >&5
-$as_echo "$as_me:   former value:  \`$ac_old_val'" >&2;}
-	{ $as_echo "$as_me:${as_lineno-$LINENO}:   current value: \`$ac_new_val'" >&5
-$as_echo "$as_me:   current value: \`$ac_new_val'" >&2;}
-      fi;;
-  esac
-  # Pass precious variables to config.status.
-  if test "$ac_new_set" = set; then
-    case $ac_new_val in
-    *\'*) ac_arg=$ac_var=`$as_echo "$ac_new_val" | sed "s/'/'\\\\\\\\''/g"` ;;
-    *) ac_arg=$ac_var=$ac_new_val ;;
-    esac
-    case " $ac_configure_args " in
-      *" '$ac_arg' "*) ;; # Avoid dups.  Use of quotes ensures accuracy.
-      *) as_fn_append ac_configure_args " '$ac_arg'" ;;
-    esac
-  fi
-done
-if $ac_cache_corrupted; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-  { $as_echo "$as_me:${as_lineno-$LINENO}: error: changes in the environment can compromise the build" >&5
-$as_echo "$as_me: error: changes in the environment can compromise the build" >&2;}
-  as_fn_error $? "run \`make distclean' and/or \`rm $cache_file' and start over" "$LINENO" 5
-fi
-## -------------------- ##
-## Main body of script. ##
-## -------------------- ##
-
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-
-
-
-
-
-
-PACKAGE="icu"
-
-
-# Use custom echo test for newline option
-# Current autoconf (2.65) gives incorrect echo newline option
-# for icu-config
-# This may be removed later - mow (June 17, 2010)
-ICU_ECHO_C= ICU_ECHO_N= ICU_ECHO_T=
-case `/bin/sh -c "echo -n x"` in
--n*)
-  case `/bin/sh -c "echo 'x\c'"` in
-  *c*) ICU_ECHO_T=' ';;     # ECHO_T is single tab character.
-  *)   ICU_ECHO_C='\c';;
-  esac;;
-*)
-  ICU_ECHO_N='-n';;
-esac
-
-
-
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for ICU version numbers" >&5
-$as_echo_n "checking for ICU version numbers... " >&6; }
-
-# Get the ICU version from uversion.h or other headers
-geticuversion() {
-    sed -n 's/^[ 	]*#[ 	]*define[ 	]*U_ICU_VERSION[ 	]*"\([^"]*\)".*/\1/p' "$@"
-}
-getuversion() {
-    sed -n 's/^[ 	]*#[ 	]*define[ 	]*U_UNICODE_VERSION[ 	]*"\([^"]*\)".*/\1/p' "$@"
-}
-VERSION=`geticuversion $srcdir/common/unicode/uvernum.h`
-if test x"$VERSION" = x; then
-   as_fn_error $? "Cannot determine ICU version number from uvernum.h header file" "$LINENO" 5
-fi
-
-#TODO: IcuBug:8502
-#if test "$VERSION" != "$PACKAGE_VERSION"; then
-#   AC_MSG_ERROR([configure was generated for $PACKAGE_VERSION but uvernum.h has $VERSION - please rerun autoconf])
-#fi
-
-UNICODE_VERSION=`getuversion $srcdir/common/unicode/uchar.h`
-if test x"$UNICODE_VERSION" = x; then
-    as_fn_error $? "Cannot determine Unicode version number from uchar.h header file" "$LINENO" 5
-fi
-# Compute a reasonable library version from the release version. This is
-# very bad, but that's wanted... We want to make sure that the LIB_VERSION
-# has at least a dot in it, so we'll add a .0 if needed.
-#[LIB_VERSION=`echo $VERSION | sed -e 's/\.//' -e 's/^\([^.]*\)$/\1.0/'`]
-LIB_VERSION=$VERSION
-LIB_VERSION_MAJOR=`echo $LIB_VERSION | sed 's/\..*//'`
-
-
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: release $VERSION, library $LIB_VERSION, unicode version $UNICODE_VERSION" >&5
-$as_echo "release $VERSION, library $LIB_VERSION, unicode version $UNICODE_VERSION" >&6; }
-
-
-
-# Determine the host system
-ac_aux_dir=
-for ac_dir in "$srcdir" "$srcdir/.." "$srcdir/../.."; do
-  if test -f "$ac_dir/install-sh"; then
-    ac_aux_dir=$ac_dir
-    ac_install_sh="$ac_aux_dir/install-sh -c"
-    break
-  elif test -f "$ac_dir/install.sh"; then
-    ac_aux_dir=$ac_dir
-    ac_install_sh="$ac_aux_dir/install.sh -c"
-    break
-  elif test -f "$ac_dir/shtool"; then
-    ac_aux_dir=$ac_dir
-    ac_install_sh="$ac_aux_dir/shtool install -c"
-    break
-  fi
-done
-if test -z "$ac_aux_dir"; then
-  as_fn_error $? "cannot find install-sh, install.sh, or shtool in \"$srcdir\" \"$srcdir/..\" \"$srcdir/../..\"" "$LINENO" 5
-fi
-
-# These three variables are undocumented and unsupported,
-# and are intended to be withdrawn in a future Autoconf release.
-# They can cause serious problems if a builder's source tree is in a directory
-# whose full name contains unusual characters.
-ac_config_guess="$SHELL $ac_aux_dir/config.guess"  # Please don't use this var.
-ac_config_sub="$SHELL $ac_aux_dir/config.sub"  # Please don't use this var.
-ac_configure="$SHELL $ac_aux_dir/configure"  # Please don't use this var.
-
-
-# Make sure we can run config.sub.
-$SHELL "$ac_aux_dir/config.sub" sun4 >/dev/null 2>&1 ||
-  as_fn_error $? "cannot run $SHELL $ac_aux_dir/config.sub" "$LINENO" 5
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking build system type" >&5
-$as_echo_n "checking build system type... " >&6; }
-if ${ac_cv_build+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_build_alias=$build_alias
-test "x$ac_build_alias" = x &&
-  ac_build_alias=`$SHELL "$ac_aux_dir/config.guess"`
-test "x$ac_build_alias" = x &&
-  as_fn_error $? "cannot guess build type; you must specify one" "$LINENO" 5
-ac_cv_build=`$SHELL "$ac_aux_dir/config.sub" $ac_build_alias` ||
-  as_fn_error $? "$SHELL $ac_aux_dir/config.sub $ac_build_alias failed" "$LINENO" 5
-
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_build" >&5
-$as_echo "$ac_cv_build" >&6; }
-case $ac_cv_build in
-*-*-*) ;;
-*) as_fn_error $? "invalid value of canonical build" "$LINENO" 5;;
-esac
-build=$ac_cv_build
-ac_save_IFS=$IFS; IFS='-'
-set x $ac_cv_build
-shift
-build_cpu=$1
-build_vendor=$2
-shift; shift
-# Remember, the first character of IFS is used to create $*,
-# except with old shells:
-build_os=$*
-IFS=$ac_save_IFS
-case $build_os in *\ *) build_os=`echo "$build_os" | sed 's/ /-/g'`;; esac
-
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking host system type" >&5
-$as_echo_n "checking host system type... " >&6; }
-if ${ac_cv_host+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  if test "x$host_alias" = x; then
-  ac_cv_host=$ac_cv_build
-else
-  ac_cv_host=`$SHELL "$ac_aux_dir/config.sub" $host_alias` ||
-    as_fn_error $? "$SHELL $ac_aux_dir/config.sub $host_alias failed" "$LINENO" 5
-fi
-
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_host" >&5
-$as_echo "$ac_cv_host" >&6; }
-case $ac_cv_host in
-*-*-*) ;;
-*) as_fn_error $? "invalid value of canonical host" "$LINENO" 5;;
-esac
-host=$ac_cv_host
-ac_save_IFS=$IFS; IFS='-'
-set x $ac_cv_host
-shift
-host_cpu=$1
-host_vendor=$2
-shift; shift
-# Remember, the first character of IFS is used to create $*,
-# except with old shells:
-host_os=$*
-IFS=$ac_save_IFS
-case $host_os in *\ *) host_os=`echo "$host_os" | sed 's/ /-/g'`;; esac
-
-
-
-
-
-# This variable is needed on z/OS because the C++ compiler only recognizes .C
-_CXX_CXXSUFFIX=cpp
-export _CXX_CXXSUFFIX
-
-# Accumulate #defines
-
-# CONFIG_CPPFLAGS: These are defines that are set for ICU Build time only.
-# They are only needed for building ICU itself. Example: platform stuff
-CONFIG_CPPFLAGS=""
-# UCONFIG_CPPFLAGS: These are defines which are set for ICU build time,
-# and also a notice is output that they need to be set
-# for end-users of ICU also. uconfig.h.prepend is generated
-# with, for example, "#define U_DISABLE_RENAMING 1"
-# Example: ICU configuration stuff
-UCONFIG_CPPFLAGS=""
-# UCONFIG_CFLAGS: contains a copy of anything that needs to be set by end users
-# such as -std
-UCONFIG_CFLAGS=""
-
-# Check whether to build debug libraries
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether to build debug libraries" >&5
-$as_echo_n "checking whether to build debug libraries... " >&6; }
-enabled=no
-ENABLE_DEBUG=0
-# Check whether --enable-debug was given.
-if test "${enable_debug+set}" = set; then :
-  enableval=$enable_debug;  case "${enableval}" in
-         yes|"") enabled=yes; ENABLE_DEBUG=1; CONFIG_CPPFLAGS="$CONFIG_CPPFLAGS -DU_DEBUG=1" ;;
-         *) ;;
-    esac
-fi
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $enabled" >&5
-$as_echo "$enabled" >&6; }
-
-
-# Check whether to build release libraries
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether to build release libraries" >&5
-$as_echo_n "checking whether to build release libraries... " >&6; }
-enabled=yes
-ENABLE_RELEASE=1
-# Check whether --enable-release was given.
-if test "${enable_release+set}" = set; then :
-  enableval=$enable_release;  case "${enableval}" in
-         no) enabled=no; ENABLE_RELEASE=0 ;;
-         *) ;;
-    esac
-fi
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $enabled" >&5
-$as_echo "$enabled" >&6; }
-
-
-# Don't use the default C/CXXFLags
-: ${CFLAGS=""}
-: ${CXXFLAGS=""}
-
-# Checks for compilers
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-if test -n "$ac_tool_prefix"; then
-  for ac_prog in clang gcc cc c99 c89 xlc_r xlc cl.exe icc
-  do
-    # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
-set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if ${ac_cv_prog_CC+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$CC"; then
-  ac_cv_prog_CC="$CC" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_exec_ext in '' $ac_executable_extensions; do
-  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
-    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-  done
-IFS=$as_save_IFS
-
-fi
-fi
-CC=$ac_cv_prog_CC
-if test -n "$CC"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
-$as_echo "$CC" >&6; }
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-fi
-
-
-    test -n "$CC" && break
-  done
-fi
-if test -z "$CC"; then
-  ac_ct_CC=$CC
-  for ac_prog in clang gcc cc c99 c89 xlc_r xlc cl.exe icc
-do
-  # Extract the first word of "$ac_prog", so it can be a program name with args.
-set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if ${ac_cv_prog_ac_ct_CC+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$ac_ct_CC"; then
-  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_exec_ext in '' $ac_executable_extensions; do
-  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_ac_ct_CC="$ac_prog"
-    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-  done
-IFS=$as_save_IFS
-
-fi
-fi
-ac_ct_CC=$ac_cv_prog_ac_ct_CC
-if test -n "$ac_ct_CC"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CC" >&5
-$as_echo "$ac_ct_CC" >&6; }
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-fi
-
-
-  test -n "$ac_ct_CC" && break
-done
-
-  if test "x$ac_ct_CC" = x; then
-    CC=""
-  else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
-$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
-ac_tool_warned=yes ;;
-esac
-    CC=$ac_ct_CC
-  fi
-fi
-
-
-test -z "$CC" && { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error $? "no acceptable C compiler found in \$PATH
-See \`config.log' for more details" "$LINENO" 5; }
-
-# Provide some information about the compiler.
-$as_echo "$as_me:${as_lineno-$LINENO}: checking for C compiler version" >&5
-set X $ac_compile
-ac_compiler=$2
-for ac_option in --version -v -V -qversion; do
-  { { ac_try="$ac_compiler $ac_option >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
-$as_echo "$ac_try_echo"; } >&5
-  (eval "$ac_compiler $ac_option >&5") 2>conftest.err
-  ac_status=$?
-  if test -s conftest.err; then
-    sed '10a\
-... rest of stderr output deleted ...
-         10q' conftest.err >conftest.er1
-    cat conftest.er1 >&5
-  fi
-  rm -f conftest.er1 conftest.err
-  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; }
-done
-
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-ac_clean_files_save=$ac_clean_files
-ac_clean_files="$ac_clean_files a.out a.out.dSYM a.exe b.out"
-# Try to create an executable without -o first, disregard a.out.
-# It will help us diagnose broken compilers, and finding out an intuition
-# of exeext.
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the C compiler works" >&5
-$as_echo_n "checking whether the C compiler works... " >&6; }
-ac_link_default=`$as_echo "$ac_link" | sed 's/ -o *conftest[^ ]*//'`
-
-# The possible output files:
-ac_files="a.out conftest.exe conftest a.exe a_out.exe b.out conftest.*"
-
-ac_rmfiles=
-for ac_file in $ac_files
-do
-  case $ac_file in
-    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM | *.o | *.obj ) ;;
-    * ) ac_rmfiles="$ac_rmfiles $ac_file";;
-  esac
-done
-rm -f $ac_rmfiles
-
-if { { ac_try="$ac_link_default"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
-$as_echo "$ac_try_echo"; } >&5
-  (eval "$ac_link_default") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; }; then :
-  # Autoconf-2.13 could set the ac_cv_exeext variable to `no'.
-# So ignore a value of `no', otherwise this would lead to `EXEEXT = no'
-# in a Makefile.  We should not override ac_cv_exeext if it was cached,
-# so that the user can short-circuit this test for compilers unknown to
-# Autoconf.
-for ac_file in $ac_files ''
-do
-  test -f "$ac_file" || continue
-  case $ac_file in
-    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM | *.o | *.obj )
-	;;
-    [ab].out )
-	# We found the default executable, but exeext='' is most
-	# certainly right.
-	break;;
-    *.* )
-	if test "${ac_cv_exeext+set}" = set && test "$ac_cv_exeext" != no;
-	then :; else
-	   ac_cv_exeext=`expr "$ac_file" : '[^.]*\(\..*\)'`
-	fi
-	# We set ac_cv_exeext here because the later test for it is not
-	# safe: cross compilers may not add the suffix if given an `-o'
-	# argument, so we may need to know it at that point already.
-	# Even if this section looks crufty: it has the advantage of
-	# actually working.
-	break;;
-    * )
-	break;;
-  esac
-done
-test "$ac_cv_exeext" = no && ac_cv_exeext=
-
-else
-  ac_file=''
-fi
-if test -z "$ac_file"; then :
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-{ { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error 77 "C compiler cannot create executables
-See \`config.log' for more details" "$LINENO" 5; }
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
-$as_echo "yes" >&6; }
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for C compiler default output file name" >&5
-$as_echo_n "checking for C compiler default output file name... " >&6; }
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_file" >&5
-$as_echo "$ac_file" >&6; }
-ac_exeext=$ac_cv_exeext
-
-rm -f -r a.out a.out.dSYM a.exe conftest$ac_cv_exeext b.out
-ac_clean_files=$ac_clean_files_save
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for suffix of executables" >&5
-$as_echo_n "checking for suffix of executables... " >&6; }
-if { { ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
-$as_echo "$ac_try_echo"; } >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; }; then :
-  # If both `conftest.exe' and `conftest' are `present' (well, observable)
-# catch `conftest.exe'.  For instance with Cygwin, `ls conftest' will
-# work properly (i.e., refer to `conftest.exe'), while it won't with
-# `rm'.
-for ac_file in conftest.exe conftest conftest.*; do
-  test -f "$ac_file" || continue
-  case $ac_file in
-    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM | *.o | *.obj ) ;;
-    *.* ) ac_cv_exeext=`expr "$ac_file" : '[^.]*\(\..*\)'`
-	  break;;
-    * ) break;;
-  esac
-done
-else
-  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error $? "cannot compute suffix of executables: cannot compile and link
-See \`config.log' for more details" "$LINENO" 5; }
-fi
-rm -f conftest conftest$ac_cv_exeext
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_exeext" >&5
-$as_echo "$ac_cv_exeext" >&6; }
-
-rm -f conftest.$ac_ext
-EXEEXT=$ac_cv_exeext
-ac_exeext=$EXEEXT
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <stdio.h>
-int
-main ()
-{
-FILE *f = fopen ("conftest.out", "w");
- return ferror (f) || fclose (f) != 0;
-
-  ;
-  return 0;
-}
-_ACEOF
-ac_clean_files="$ac_clean_files conftest.out"
-# Check that the compiler produces executables we can run.  If not, either
-# the compiler is broken, or we cross compile.
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are cross compiling" >&5
-$as_echo_n "checking whether we are cross compiling... " >&6; }
-if test "$cross_compiling" != yes; then
-  { { ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
-$as_echo "$ac_try_echo"; } >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; }
-  if { ac_try='./conftest$ac_cv_exeext'
-  { { case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
-$as_echo "$ac_try_echo"; } >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; }; }; then
-    cross_compiling=no
-  else
-    if test "$cross_compiling" = maybe; then
-	cross_compiling=yes
-    else
-	{ { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error $? "cannot run C compiled programs.
-If you meant to cross compile, use \`--host'.
-See \`config.log' for more details" "$LINENO" 5; }
-    fi
-  fi
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cross_compiling" >&5
-$as_echo "$cross_compiling" >&6; }
-
-rm -f conftest.$ac_ext conftest$ac_cv_exeext conftest.out
-ac_clean_files=$ac_clean_files_save
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for suffix of object files" >&5
-$as_echo_n "checking for suffix of object files... " >&6; }
-if ${ac_cv_objext+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.o conftest.obj
-if { { ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
-$as_echo "$ac_try_echo"; } >&5
-  (eval "$ac_compile") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; }; then :
-  for ac_file in conftest.o conftest.obj conftest.*; do
-  test -f "$ac_file" || continue;
-  case $ac_file in
-    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM ) ;;
-    *) ac_cv_objext=`expr "$ac_file" : '.*\.\(.*\)'`
-       break;;
-  esac
-done
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-{ { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error $? "cannot compute suffix of object files: cannot compile
-See \`config.log' for more details" "$LINENO" 5; }
-fi
-rm -f conftest.$ac_cv_objext conftest.$ac_ext
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_objext" >&5
-$as_echo "$ac_cv_objext" >&6; }
-OBJEXT=$ac_cv_objext
-ac_objext=$OBJEXT
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are using the GNU C compiler" >&5
-$as_echo_n "checking whether we are using the GNU C compiler... " >&6; }
-if ${ac_cv_c_compiler_gnu+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-int
-main ()
-{
-#ifndef __GNUC__
-       choke me
-#endif
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  ac_compiler_gnu=yes
-else
-  ac_compiler_gnu=no
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-ac_cv_c_compiler_gnu=$ac_compiler_gnu
-
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_c_compiler_gnu" >&5
-$as_echo "$ac_cv_c_compiler_gnu" >&6; }
-if test $ac_compiler_gnu = yes; then
-  GCC=yes
-else
-  GCC=
-fi
-ac_test_CFLAGS=${CFLAGS+set}
-ac_save_CFLAGS=$CFLAGS
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CC accepts -g" >&5
-$as_echo_n "checking whether $CC accepts -g... " >&6; }
-if ${ac_cv_prog_cc_g+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_save_c_werror_flag=$ac_c_werror_flag
-   ac_c_werror_flag=yes
-   ac_cv_prog_cc_g=no
-   CFLAGS="-g"
-   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  ac_cv_prog_cc_g=yes
-else
-  CFLAGS=""
-      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-
-else
-  ac_c_werror_flag=$ac_save_c_werror_flag
-	 CFLAGS="-g"
-	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  ac_cv_prog_cc_g=yes
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-   ac_c_werror_flag=$ac_save_c_werror_flag
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_g" >&5
-$as_echo "$ac_cv_prog_cc_g" >&6; }
-if test "$ac_test_CFLAGS" = set; then
-  CFLAGS=$ac_save_CFLAGS
-elif test $ac_cv_prog_cc_g = yes; then
-  if test "$GCC" = yes; then
-    CFLAGS="-g -O2"
-  else
-    CFLAGS="-g"
-  fi
-else
-  if test "$GCC" = yes; then
-    CFLAGS="-O2"
-  else
-    CFLAGS=
-  fi
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $CC option to accept ISO C89" >&5
-$as_echo_n "checking for $CC option to accept ISO C89... " >&6; }
-if ${ac_cv_prog_cc_c89+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_cv_prog_cc_c89=no
-ac_save_CC=$CC
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <stdarg.h>
-#include <stdio.h>
-struct stat;
-/* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
-struct buf { int x; };
-FILE * (*rcsopen) (struct buf *, struct stat *, int);
-static char *e (p, i)
-     char **p;
-     int i;
-{
-  return p[i];
-}
-static char *f (char * (*g) (char **, int), char **p, ...)
-{
-  char *s;
-  va_list v;
-  va_start (v,p);
-  s = g (p, va_arg (v,int));
-  va_end (v);
-  return s;
-}
-
-/* OSF 4.0 Compaq cc is some sort of almost-ANSI by default.  It has
-   function prototypes and stuff, but not '\xHH' hex character constants.
-   These don't provoke an error unfortunately, instead are silently treated
-   as 'x'.  The following induces an error, until -std is added to get
-   proper ANSI mode.  Curiously '\x00'!='x' always comes out true, for an
-   array size at least.  It's necessary to write '\x00'==0 to get something
-   that's true only with -std.  */
-int osf4_cc_array ['\x00' == 0 ? 1 : -1];
-
-/* IBM C 6 for AIX is almost-ANSI by default, but it replaces macro parameters
-   inside strings and character constants.  */
-#define FOO(x) 'x'
-int xlc6_cc_array[FOO(a) == 'x' ? 1 : -1];
-
-int test (int i, double x);
-struct s1 {int (*f) (int a);};
-struct s2 {int (*f) (double a);};
-int pairnames (int, char **, FILE *(*)(struct buf *, struct stat *, int), int, int);
-int argc;
-char **argv;
-int
-main ()
-{
-return f (e, argv, 0) != argv[0]  ||  f (e, argv, 1) != argv[1];
-  ;
-  return 0;
-}
-_ACEOF
-for ac_arg in '' -qlanglvl=extc89 -qlanglvl=ansi -std \
-	-Ae "-Aa -D_HPUX_SOURCE" "-Xc -D__EXTENSIONS__"
-do
-  CC="$ac_save_CC $ac_arg"
-  if ac_fn_c_try_compile "$LINENO"; then :
-  ac_cv_prog_cc_c89=$ac_arg
-fi
-rm -f core conftest.err conftest.$ac_objext
-  test "x$ac_cv_prog_cc_c89" != "xno" && break
-done
-rm -f conftest.$ac_ext
-CC=$ac_save_CC
-
-fi
-# AC_CACHE_VAL
-case "x$ac_cv_prog_cc_c89" in
-  x)
-    { $as_echo "$as_me:${as_lineno-$LINENO}: result: none needed" >&5
-$as_echo "none needed" >&6; } ;;
-  xno)
-    { $as_echo "$as_me:${as_lineno-$LINENO}: result: unsupported" >&5
-$as_echo "unsupported" >&6; } ;;
-  *)
-    CC="$CC $ac_cv_prog_cc_c89"
-    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_c89" >&5
-$as_echo "$ac_cv_prog_cc_c89" >&6; } ;;
-esac
-if test "x$ac_cv_prog_cc_c89" != xno; then :
-
-fi
-
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-
-# Make sure that we try clang++ first, which provides C++11 support.
-# The g++ compiler is less likely to support C++11.
-ac_ext=cpp
-ac_cpp='$CXXCPP $CPPFLAGS'
-ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
-if test -z "$CXX"; then
-  if test -n "$CCC"; then
-    CXX=$CCC
-  else
-    if test -n "$ac_tool_prefix"; then
-  for ac_prog in clang++ g++ c++ gpp xlC_r xlC aCC CC cxx cc++ cl.exe icc FCC KCC RCC
-  do
-    # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
-set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if ${ac_cv_prog_CXX+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$CXX"; then
-  ac_cv_prog_CXX="$CXX" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_exec_ext in '' $ac_executable_extensions; do
-  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_CXX="$ac_tool_prefix$ac_prog"
-    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-  done
-IFS=$as_save_IFS
-
-fi
-fi
-CXX=$ac_cv_prog_CXX
-if test -n "$CXX"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CXX" >&5
-$as_echo "$CXX" >&6; }
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-fi
-
-
-    test -n "$CXX" && break
-  done
-fi
-if test -z "$CXX"; then
-  ac_ct_CXX=$CXX
-  for ac_prog in clang++ g++ c++ gpp xlC_r xlC aCC CC cxx cc++ cl.exe icc FCC KCC RCC
-do
-  # Extract the first word of "$ac_prog", so it can be a program name with args.
-set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if ${ac_cv_prog_ac_ct_CXX+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$ac_ct_CXX"; then
-  ac_cv_prog_ac_ct_CXX="$ac_ct_CXX" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_exec_ext in '' $ac_executable_extensions; do
-  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_ac_ct_CXX="$ac_prog"
-    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-  done
-IFS=$as_save_IFS
-
-fi
-fi
-ac_ct_CXX=$ac_cv_prog_ac_ct_CXX
-if test -n "$ac_ct_CXX"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CXX" >&5
-$as_echo "$ac_ct_CXX" >&6; }
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-fi
-
-
-  test -n "$ac_ct_CXX" && break
-done
-
-  if test "x$ac_ct_CXX" = x; then
-    CXX="g++"
-  else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
-$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
-ac_tool_warned=yes ;;
-esac
-    CXX=$ac_ct_CXX
-  fi
-fi
-
-  fi
-fi
-# Provide some information about the compiler.
-$as_echo "$as_me:${as_lineno-$LINENO}: checking for C++ compiler version" >&5
-set X $ac_compile
-ac_compiler=$2
-for ac_option in --version -v -V -qversion; do
-  { { ac_try="$ac_compiler $ac_option >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
-$as_echo "$ac_try_echo"; } >&5
-  (eval "$ac_compiler $ac_option >&5") 2>conftest.err
-  ac_status=$?
-  if test -s conftest.err; then
-    sed '10a\
-... rest of stderr output deleted ...
-         10q' conftest.err >conftest.er1
-    cat conftest.er1 >&5
-  fi
-  rm -f conftest.er1 conftest.err
-  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; }
-done
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are using the GNU C++ compiler" >&5
-$as_echo_n "checking whether we are using the GNU C++ compiler... " >&6; }
-if ${ac_cv_cxx_compiler_gnu+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-int
-main ()
-{
-#ifndef __GNUC__
-       choke me
-#endif
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_cxx_try_compile "$LINENO"; then :
-  ac_compiler_gnu=yes
-else
-  ac_compiler_gnu=no
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-ac_cv_cxx_compiler_gnu=$ac_compiler_gnu
-
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_cxx_compiler_gnu" >&5
-$as_echo "$ac_cv_cxx_compiler_gnu" >&6; }
-if test $ac_compiler_gnu = yes; then
-  GXX=yes
-else
-  GXX=
-fi
-ac_test_CXXFLAGS=${CXXFLAGS+set}
-ac_save_CXXFLAGS=$CXXFLAGS
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CXX accepts -g" >&5
-$as_echo_n "checking whether $CXX accepts -g... " >&6; }
-if ${ac_cv_prog_cxx_g+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_save_cxx_werror_flag=$ac_cxx_werror_flag
-   ac_cxx_werror_flag=yes
-   ac_cv_prog_cxx_g=no
-   CXXFLAGS="-g"
-   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_cxx_try_compile "$LINENO"; then :
-  ac_cv_prog_cxx_g=yes
-else
-  CXXFLAGS=""
-      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_cxx_try_compile "$LINENO"; then :
-
-else
-  ac_cxx_werror_flag=$ac_save_cxx_werror_flag
-	 CXXFLAGS="-g"
-	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_cxx_try_compile "$LINENO"; then :
-  ac_cv_prog_cxx_g=yes
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-   ac_cxx_werror_flag=$ac_save_cxx_werror_flag
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cxx_g" >&5
-$as_echo "$ac_cv_prog_cxx_g" >&6; }
-if test "$ac_test_CXXFLAGS" = set; then
-  CXXFLAGS=$ac_save_CXXFLAGS
-elif test $ac_cv_prog_cxx_g = yes; then
-  if test "$GXX" = yes; then
-    CXXFLAGS="-g -O2"
-  else
-    CXXFLAGS="-g"
-  fi
-else
-  if test "$GXX" = yes; then
-    CXXFLAGS="-O2"
-  else
-    CXXFLAGS=
-  fi
-fi
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-
-
-# pkg-config is needed for harfbuzz support
-
-
-
-
-
-
-
-if test "x$ac_cv_env_PKG_CONFIG_set" != "xset"; then
-	if test -n "$ac_tool_prefix"; then
-  # Extract the first word of "${ac_tool_prefix}pkg-config", so it can be a program name with args.
-set dummy ${ac_tool_prefix}pkg-config; ac_word=$2
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if ${ac_cv_path_PKG_CONFIG+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  case $PKG_CONFIG in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_PKG_CONFIG="$PKG_CONFIG" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_exec_ext in '' $ac_executable_extensions; do
-  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_path_PKG_CONFIG="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-  done
-IFS=$as_save_IFS
-
-  ;;
-esac
-fi
-PKG_CONFIG=$ac_cv_path_PKG_CONFIG
-if test -n "$PKG_CONFIG"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $PKG_CONFIG" >&5
-$as_echo "$PKG_CONFIG" >&6; }
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-fi
-
-
-fi
-if test -z "$ac_cv_path_PKG_CONFIG"; then
-  ac_pt_PKG_CONFIG=$PKG_CONFIG
-  # Extract the first word of "pkg-config", so it can be a program name with args.
-set dummy pkg-config; ac_word=$2
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if ${ac_cv_path_ac_pt_PKG_CONFIG+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  case $ac_pt_PKG_CONFIG in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_ac_pt_PKG_CONFIG="$ac_pt_PKG_CONFIG" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_exec_ext in '' $ac_executable_extensions; do
-  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_path_ac_pt_PKG_CONFIG="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-  done
-IFS=$as_save_IFS
-
-  ;;
-esac
-fi
-ac_pt_PKG_CONFIG=$ac_cv_path_ac_pt_PKG_CONFIG
-if test -n "$ac_pt_PKG_CONFIG"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_pt_PKG_CONFIG" >&5
-$as_echo "$ac_pt_PKG_CONFIG" >&6; }
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-fi
-
-  if test "x$ac_pt_PKG_CONFIG" = x; then
-    PKG_CONFIG=""
-  else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
-$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
-ac_tool_warned=yes ;;
-esac
-    PKG_CONFIG=$ac_pt_PKG_CONFIG
-  fi
-else
-  PKG_CONFIG="$ac_cv_path_PKG_CONFIG"
-fi
-
-fi
-if test -n "$PKG_CONFIG"; then
-	_pkg_min_version=0.20
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking pkg-config is at least version $_pkg_min_version" >&5
-$as_echo_n "checking pkg-config is at least version $_pkg_min_version... " >&6; }
-	if $PKG_CONFIG --atleast-pkgconfig-version $_pkg_min_version; then
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
-$as_echo "yes" >&6; }
-	else
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-		PKG_CONFIG=""
-	fi
-fi
-
-pkg_failed=no
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for ICULEHB" >&5
-$as_echo_n "checking for ICULEHB... " >&6; }
-
-if test -n "$ICULEHB_CFLAGS"; then
-    pkg_cv_ICULEHB_CFLAGS="$ICULEHB_CFLAGS"
- elif test -n "$PKG_CONFIG"; then
-    if test -n "$PKG_CONFIG" && \
-    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"icu-le-hb\""; } >&5
-  ($PKG_CONFIG --exists --print-errors "icu-le-hb") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; }; then
-  pkg_cv_ICULEHB_CFLAGS=`$PKG_CONFIG --cflags "icu-le-hb" 2>/dev/null`
-		      test "x$?" != "x0" && pkg_failed=yes
-else
-  pkg_failed=yes
-fi
- else
-    pkg_failed=untried
-fi
-if test -n "$ICULEHB_LIBS"; then
-    pkg_cv_ICULEHB_LIBS="$ICULEHB_LIBS"
- elif test -n "$PKG_CONFIG"; then
-    if test -n "$PKG_CONFIG" && \
-    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"icu-le-hb\""; } >&5
-  ($PKG_CONFIG --exists --print-errors "icu-le-hb") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; }; then
-  pkg_cv_ICULEHB_LIBS=`$PKG_CONFIG --libs "icu-le-hb" 2>/dev/null`
-		      test "x$?" != "x0" && pkg_failed=yes
-else
-  pkg_failed=yes
-fi
- else
-    pkg_failed=untried
-fi
-
-
-
-if test $pkg_failed = yes; then
-   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-
-if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
-        _pkg_short_errors_supported=yes
-else
-        _pkg_short_errors_supported=no
-fi
-        if test $_pkg_short_errors_supported = yes; then
-	        ICULEHB_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "icu-le-hb" 2>&1`
-        else
-	        ICULEHB_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "icu-le-hb" 2>&1`
-        fi
-	# Put the nasty error message in config.log where it belongs
-	echo "$ICULEHB_PKG_ERRORS" >&5
-
-	:
-elif test $pkg_failed = untried; then
-     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-	:
-else
-	ICULEHB_CFLAGS=$pkg_cv_ICULEHB_CFLAGS
-	ICULEHB_LIBS=$pkg_cv_ICULEHB_LIBS
-        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
-$as_echo "yes" >&6; }
-	have_icu_le_hb=true
-fi
-
-# Ensure that if CXXFLAGS/CFLAGS were not set when calling configure, set it correctly based on (enable/disable) debug or release option
-# The release mode use is the default one for autoconf
-if test "$GCC" = yes; then
-    if test "$CFLAGS" = ""; then
-        if test "$ENABLE_DEBUG" = 1; then
-            CFLAGS=-g
-        fi
-        if test "$ENABLE_RELEASE" = 1; then
-            CFLAGS="$CFLAGS -O2"
-        fi
-    fi
-    if test "$CXXFLAGS" = ""; then
-        if test "$ENABLE_DEBUG" = 1; then
-            CXXFLAGS=-g
-        fi
-        if test "$ENABLE_RELEASE" = 1; then
-            CXXFLAGS="$CXXFLAGS -O2"
-        fi
-    fi
-fi
-
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to run the C preprocessor" >&5
-$as_echo_n "checking how to run the C preprocessor... " >&6; }
-# On Suns, sometimes $CPP names a directory.
-if test -n "$CPP" && test -d "$CPP"; then
-  CPP=
-fi
-if test -z "$CPP"; then
-  if ${ac_cv_prog_CPP+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-      # Double quotes because CPP needs to be expanded
-    for CPP in "$CC -E" "$CC -E -traditional-cpp" "/lib/cpp"
-    do
-      ac_preproc_ok=false
-for ac_c_preproc_warn_flag in '' yes
-do
-  # Use a header file that comes with gcc, so configuring glibc
-  # with a fresh cross-compiler works.
-  # Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-  # <limits.h> exists even on freestanding compilers.
-  # On the NeXT, cc -E runs the code through the compiler's parser,
-  # not just through cpp. "Syntax error" is here to catch this case.
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
-		     Syntax error
-_ACEOF
-if ac_fn_c_try_cpp "$LINENO"; then :
-
-else
-  # Broken: fails on valid input.
-continue
-fi
-rm -f conftest.err conftest.i conftest.$ac_ext
-
-  # OK, works on sane cases.  Now check whether nonexistent headers
-  # can be detected and how.
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <ac_nonexistent.h>
-_ACEOF
-if ac_fn_c_try_cpp "$LINENO"; then :
-  # Broken: success on invalid input.
-continue
-else
-  # Passes both tests.
-ac_preproc_ok=:
-break
-fi
-rm -f conftest.err conftest.i conftest.$ac_ext
-
-done
-# Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.i conftest.err conftest.$ac_ext
-if $ac_preproc_ok; then :
-  break
-fi
-
-    done
-    ac_cv_prog_CPP=$CPP
-
-fi
-  CPP=$ac_cv_prog_CPP
-else
-  ac_cv_prog_CPP=$CPP
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $CPP" >&5
-$as_echo "$CPP" >&6; }
-ac_preproc_ok=false
-for ac_c_preproc_warn_flag in '' yes
-do
-  # Use a header file that comes with gcc, so configuring glibc
-  # with a fresh cross-compiler works.
-  # Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-  # <limits.h> exists even on freestanding compilers.
-  # On the NeXT, cc -E runs the code through the compiler's parser,
-  # not just through cpp. "Syntax error" is here to catch this case.
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
-		     Syntax error
-_ACEOF
-if ac_fn_c_try_cpp "$LINENO"; then :
-
-else
-  # Broken: fails on valid input.
-continue
-fi
-rm -f conftest.err conftest.i conftest.$ac_ext
-
-  # OK, works on sane cases.  Now check whether nonexistent headers
-  # can be detected and how.
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <ac_nonexistent.h>
-_ACEOF
-if ac_fn_c_try_cpp "$LINENO"; then :
-  # Broken: success on invalid input.
-continue
-else
-  # Passes both tests.
-ac_preproc_ok=:
-break
-fi
-rm -f conftest.err conftest.i conftest.$ac_ext
-
-done
-# Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.i conftest.err conftest.$ac_ext
-if $ac_preproc_ok; then :
-
-else
-  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error $? "C preprocessor \"$CPP\" fails sanity check
-See \`config.log' for more details" "$LINENO" 5; }
-fi
-
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-
-
-# Find a good install program.  We prefer a C program (faster),
-# so one script is as good as another.  But avoid the broken or
-# incompatible versions:
-# SysV /etc/install, /usr/sbin/install
-# SunOS /usr/etc/install
-# IRIX /sbin/install
-# AIX /bin/install
-# AmigaOS /C/install, which installs bootblocks on floppy discs
-# AIX 4 /usr/bin/installbsd, which doesn't work without a -g flag
-# AFS /usr/afsws/bin/install, which mishandles nonexistent args
-# SVR4 /usr/ucb/install, which tries to use the nonexistent group "staff"
-# OS/2's system install, which has a completely different semantic
-# ./install, which can be erroneously created by make from ./install.sh.
-# Reject install programs that cannot install multiple files.
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for a BSD-compatible install" >&5
-$as_echo_n "checking for a BSD-compatible install... " >&6; }
-if test -z "$INSTALL"; then
-if ${ac_cv_path_install+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    # Account for people who put trailing slashes in PATH elements.
-case $as_dir/ in #((
-  ./ | .// | /[cC]/* | \
-  /etc/* | /usr/sbin/* | /usr/etc/* | /sbin/* | /usr/afsws/bin/* | \
-  ?:[\\/]os2[\\/]install[\\/]* | ?:[\\/]OS2[\\/]INSTALL[\\/]* | \
-  /usr/ucb/* ) ;;
-  *)
-    # OSF1 and SCO ODT 3.0 have their own names for install.
-    # Don't use installbsd from OSF since it installs stuff as root
-    # by default.
-    for ac_prog in ginstall scoinst install; do
-      for ac_exec_ext in '' $ac_executable_extensions; do
-	if as_fn_executable_p "$as_dir/$ac_prog$ac_exec_ext"; then
-	  if test $ac_prog = install &&
-	    grep dspmsg "$as_dir/$ac_prog$ac_exec_ext" >/dev/null 2>&1; then
-	    # AIX install.  It has an incompatible calling convention.
-	    :
-	  elif test $ac_prog = install &&
-	    grep pwplus "$as_dir/$ac_prog$ac_exec_ext" >/dev/null 2>&1; then
-	    # program-specific install script used by HP pwplus--don't use.
-	    :
-	  else
-	    rm -rf conftest.one conftest.two conftest.dir
-	    echo one > conftest.one
-	    echo two > conftest.two
-	    mkdir conftest.dir
-	    if "$as_dir/$ac_prog$ac_exec_ext" -c conftest.one conftest.two "`pwd`/conftest.dir" &&
-	      test -s conftest.one && test -s conftest.two &&
-	      test -s conftest.dir/conftest.one &&
-	      test -s conftest.dir/conftest.two
-	    then
-	      ac_cv_path_install="$as_dir/$ac_prog$ac_exec_ext -c"
-	      break 3
-	    fi
-	  fi
-	fi
-      done
-    done
-    ;;
-esac
-
-  done
-IFS=$as_save_IFS
-
-rm -rf conftest.one conftest.two conftest.dir
-
-fi
-  if test "${ac_cv_path_install+set}" = set; then
-    INSTALL=$ac_cv_path_install
-  else
-    # As a last resort, use the slow shell script.  Don't cache a
-    # value for INSTALL within a source directory, because that will
-    # break other packages using the cache if that directory is
-    # removed, or if the value is a relative name.
-    INSTALL=$ac_install_sh
-  fi
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $INSTALL" >&5
-$as_echo "$INSTALL" >&6; }
-
-# Use test -z because SunOS4 sh mishandles braces in ${var-val}.
-# It thinks the first close brace ends the variable substitution.
-test -z "$INSTALL_PROGRAM" && INSTALL_PROGRAM='${INSTALL}'
-
-test -z "$INSTALL_SCRIPT" && INSTALL_SCRIPT='${INSTALL}'
-
-test -z "$INSTALL_DATA" && INSTALL_DATA='${INSTALL} -m 644'
-
-
-
-
-ac_ext=cpp
-ac_cpp='$CXXCPP $CPPFLAGS'
-ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
-
-
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_cxx_try_link "$LINENO"; then :
-
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-
-
-# make sure install is relative to srcdir - if a script
-if test "$srcdir" = "."; then
-  # If srcdir isn't just ., then (srcdir) is already prepended.
-  if test "${ac_install_sh}" = "${INSTALL}"; then
-   INSTALL="\\\$(top_srcdir)/${ac_install_sh}"
-  fi
-fi
-
-#AC_CHECK_PROG(AUTOCONF, autoconf, autoconf, true)
-#AC_CHECK_PROG(STRIP, strip, strip, true)
-
-# Check for the platform make
-for ac_prog in gmake gnumake
-do
-  # Extract the first word of "$ac_prog", so it can be a program name with args.
-set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if ${ac_cv_path_U_MAKE+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  case $U_MAKE in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_U_MAKE="$U_MAKE" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_exec_ext in '' $ac_executable_extensions; do
-  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_path_U_MAKE="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-  done
-IFS=$as_save_IFS
-
-  ;;
-esac
-fi
-U_MAKE=$ac_cv_path_U_MAKE
-if test -n "$U_MAKE"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $U_MAKE" >&5
-$as_echo "$U_MAKE" >&6; }
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-fi
-
-
-  test -n "$U_MAKE" && break
-done
-test -n "$U_MAKE" || U_MAKE="make"
-
-
-
-
-
-# Check whether --with-cross-build was given.
-if test "${with_cross_build+set}" = set; then :
-  withval=$with_cross_build; cross_buildroot="${withval}"
-else
-  cross_buildroot=""
-fi
-
-
-if test "X$cross_buildroot" = "X"; then
-    if test "$cross_compiling" = "yes"; then
-        as_fn_error $? "Error! Cross compiling but no --with-cross-build option specified - please supply the path to an executable ICU's build root" "$LINENO" 5
-	    fi
-else
-    if test -f "${cross_buildroot}/config/icucross.mk"; then
-        { $as_echo "$as_me:${as_lineno-$LINENO}: result: Using cross buildroot: $cross_buildroot" >&5
-$as_echo "Using cross buildroot: $cross_buildroot" >&6; }
-    else
-        if test -d "${cross_buildroot}"; then
-            as_fn_error $? "${cross_buildroot}/config/icucross.mk not found. Please build ICU in ${cross_buildroot} first." "$LINENO" 5
-        else
-            as_fn_error $? "No such directory ${cross_buildroot} supplied as the argument to --with-cross-build. Use an absolute path." "$LINENO" 5
-        fi
-    fi
-fi
-
-
-# Check for doxygen to generate documentation
-# Extract the first word of "doxygen", so it can be a program name with args.
-set dummy doxygen; ac_word=$2
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if ${ac_cv_path_DOXYGEN+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  case $DOXYGEN in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_DOXYGEN="$DOXYGEN" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-as_dummy="$PATH:/usr/local/bin:/usr/bin"
-for as_dir in $as_dummy
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_exec_ext in '' $ac_executable_extensions; do
-  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_path_DOXYGEN="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-  done
-IFS=$as_save_IFS
-
-  ;;
-esac
-fi
-DOXYGEN=$ac_cv_path_DOXYGEN
-if test -n "$DOXYGEN"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $DOXYGEN" >&5
-$as_echo "$DOXYGEN" >&6; }
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-fi
-
-
-
-# Check that the linker is usable
-
-case "${host}" in
-    *-*-cygwin*|*-*-mingw*)
-        if test "$GCC" != yes && test -n "`link --version 2>&1 | grep 'GNU coreutils'`"; then
-            as_fn_error $? "link.exe is not a valid linker. Your PATH is incorrect.
-                  Please follow the directions in ICU's readme." "$LINENO" 5
-        fi;;
-    *);;
-esac
-
-# Determine the executable suffix
-# We don't use AC_EXEEXT because some compilers output separate debugging
-# files, which confuses the AC_EXEEXT macro.
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking checking for executable suffix" >&5
-$as_echo_n "checking checking for executable suffix... " >&6; }
-case "${host}" in
-    *-*-cygwin*|*-*-mingw*)  EXEEXT=.exe ;;
-    *)      EXEEXT="" ;;
-esac
-ac_exeext=$EXEEXT
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $EXEEXT" >&5
-$as_echo "$EXEEXT" >&6; }
-
-
-# Determine how strict we want to be when compiling
-
-    { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether strict compiling is on" >&5
-$as_echo_n "checking whether strict compiling is on... " >&6; }
-    # Check whether --enable-strict was given.
-if test "${enable_strict+set}" = set; then :
-  enableval=$enable_strict;
-        if test "$enableval" = no
-        then
-            ac_use_strict_options=no
-        else
-            ac_use_strict_options=yes
-        fi
-
-else
-  ac_use_strict_options=yes
-fi
-
-    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_use_strict_options" >&5
-$as_echo "$ac_use_strict_options" >&6; }
-
-    if test "$ac_use_strict_options" = yes
-    then
-        if test "$GCC" = yes
-        then
-            case "${host}" in
-            *)
-                # Do not use -ansi. It limits us to C90, and it breaks some platforms.
-                # We use -std=c99 to disable the gnu99 defaults and its associated warnings
-                CFLAGS="$CFLAGS -std=c99"
-                ;;
-            esac
-
-            CFLAGS="$CFLAGS -Wall -pedantic -Wshadow -Wpointer-arith -Wmissing-prototypes -Wwrite-strings"
-        else
-            case "${host}" in
-            *-*-cygwin)
-                if test "`$CC /help 2>&1 | head -c9`" = "Microsoft"
-                then
-                    CFLAGS="$CFLAGS /W4"
-                fi ;;
-            *-*-mingw*)
-                CFLAGS="$CFLAGS -W4" ;;
-            esac
-        fi
-        if test "$GXX" = yes
-        then
-            CXXFLAGS="$CXXFLAGS -W -Wall -pedantic -Wpointer-arith -Wwrite-strings -Wno-long-long"
-        else
-            case "${host}" in
-            *-*-cygwin)
-                if test "`$CXX /help 2>&1 | head -c9`" = "Microsoft"
-                then
-                    CXXFLAGS="$CXXFLAGS /W4"
-                fi ;;
-            *-*-mingw*)
-                CFLAGS="$CFLAGS -W4" ;;
-            esac
-        fi
-    fi
-
-
-# Check if we can build and use 64-bit libraries
-
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for grep that handles long lines and -e" >&5
-$as_echo_n "checking for grep that handles long lines and -e... " >&6; }
-if ${ac_cv_path_GREP+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  if test -z "$GREP"; then
-  ac_path_GREP_found=false
-  # Loop through the user's path and test for each of PROGNAME-LIST
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH$PATH_SEPARATOR/usr/xpg4/bin
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_prog in grep ggrep; do
-    for ac_exec_ext in '' $ac_executable_extensions; do
-      ac_path_GREP="$as_dir/$ac_prog$ac_exec_ext"
-      as_fn_executable_p "$ac_path_GREP" || continue
-# Check for GNU ac_path_GREP and select it if it is found.
-  # Check for GNU $ac_path_GREP
-case `"$ac_path_GREP" --version 2>&1` in
-*GNU*)
-  ac_cv_path_GREP="$ac_path_GREP" ac_path_GREP_found=:;;
-*)
-  ac_count=0
-  $as_echo_n 0123456789 >"conftest.in"
-  while :
-  do
-    cat "conftest.in" "conftest.in" >"conftest.tmp"
-    mv "conftest.tmp" "conftest.in"
-    cp "conftest.in" "conftest.nl"
-    $as_echo 'GREP' >> "conftest.nl"
-    "$ac_path_GREP" -e 'GREP$' -e '-(cannot match)-' < "conftest.nl" >"conftest.out" 2>/dev/null || break
-    diff "conftest.out" "conftest.nl" >/dev/null 2>&1 || break
-    as_fn_arith $ac_count + 1 && ac_count=$as_val
-    if test $ac_count -gt ${ac_path_GREP_max-0}; then
-      # Best one so far, save it but keep looking for a better one
-      ac_cv_path_GREP="$ac_path_GREP"
-      ac_path_GREP_max=$ac_count
-    fi
-    # 10*(2^10) chars as input seems more than enough
-    test $ac_count -gt 10 && break
-  done
-  rm -f conftest.in conftest.tmp conftest.nl conftest.out;;
-esac
-
-      $ac_path_GREP_found && break 3
-    done
-  done
-  done
-IFS=$as_save_IFS
-  if test -z "$ac_cv_path_GREP"; then
-    as_fn_error $? "no acceptable grep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" "$LINENO" 5
-  fi
-else
-  ac_cv_path_GREP=$GREP
-fi
-
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_path_GREP" >&5
-$as_echo "$ac_cv_path_GREP" >&6; }
- GREP="$ac_cv_path_GREP"
-
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for egrep" >&5
-$as_echo_n "checking for egrep... " >&6; }
-if ${ac_cv_path_EGREP+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  if echo a | $GREP -E '(a|b)' >/dev/null 2>&1
-   then ac_cv_path_EGREP="$GREP -E"
-   else
-     if test -z "$EGREP"; then
-  ac_path_EGREP_found=false
-  # Loop through the user's path and test for each of PROGNAME-LIST
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH$PATH_SEPARATOR/usr/xpg4/bin
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_prog in egrep; do
-    for ac_exec_ext in '' $ac_executable_extensions; do
-      ac_path_EGREP="$as_dir/$ac_prog$ac_exec_ext"
-      as_fn_executable_p "$ac_path_EGREP" || continue
-# Check for GNU ac_path_EGREP and select it if it is found.
-  # Check for GNU $ac_path_EGREP
-case `"$ac_path_EGREP" --version 2>&1` in
-*GNU*)
-  ac_cv_path_EGREP="$ac_path_EGREP" ac_path_EGREP_found=:;;
-*)
-  ac_count=0
-  $as_echo_n 0123456789 >"conftest.in"
-  while :
-  do
-    cat "conftest.in" "conftest.in" >"conftest.tmp"
-    mv "conftest.tmp" "conftest.in"
-    cp "conftest.in" "conftest.nl"
-    $as_echo 'EGREP' >> "conftest.nl"
-    "$ac_path_EGREP" 'EGREP$' < "conftest.nl" >"conftest.out" 2>/dev/null || break
-    diff "conftest.out" "conftest.nl" >/dev/null 2>&1 || break
-    as_fn_arith $ac_count + 1 && ac_count=$as_val
-    if test $ac_count -gt ${ac_path_EGREP_max-0}; then
-      # Best one so far, save it but keep looking for a better one
-      ac_cv_path_EGREP="$ac_path_EGREP"
-      ac_path_EGREP_max=$ac_count
-    fi
-    # 10*(2^10) chars as input seems more than enough
-    test $ac_count -gt 10 && break
-  done
-  rm -f conftest.in conftest.tmp conftest.nl conftest.out;;
-esac
-
-      $ac_path_EGREP_found && break 3
-    done
-  done
-  done
-IFS=$as_save_IFS
-  if test -z "$ac_cv_path_EGREP"; then
-    as_fn_error $? "no acceptable egrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" "$LINENO" 5
-  fi
-else
-  ac_cv_path_EGREP=$EGREP
-fi
-
-   fi
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_path_EGREP" >&5
-$as_echo "$ac_cv_path_EGREP" >&6; }
- EGREP="$ac_cv_path_EGREP"
-
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for ANSI C header files" >&5
-$as_echo_n "checking for ANSI C header files... " >&6; }
-if ${ac_cv_header_stdc+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <stdlib.h>
-#include <stdarg.h>
-#include <string.h>
-#include <float.h>
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  ac_cv_header_stdc=yes
-else
-  ac_cv_header_stdc=no
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-
-if test $ac_cv_header_stdc = yes; then
-  # SunOS 4.x string.h does not declare mem*, contrary to ANSI.
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <string.h>
-
-_ACEOF
-if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "memchr" >/dev/null 2>&1; then :
-
-else
-  ac_cv_header_stdc=no
-fi
-rm -f conftest*
-
-fi
-
-if test $ac_cv_header_stdc = yes; then
-  # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <stdlib.h>
-
-_ACEOF
-if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "free" >/dev/null 2>&1; then :
-
-else
-  ac_cv_header_stdc=no
-fi
-rm -f conftest*
-
-fi
-
-if test $ac_cv_header_stdc = yes; then
-  # /bin/cc in Irix-4.0.5 gets non-ANSI ctype macros unless using -ansi.
-  if test "$cross_compiling" = yes; then :
-  :
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <ctype.h>
-#include <stdlib.h>
-#if ((' ' & 0x0FF) == 0x020)
-# define ISLOWER(c) ('a' <= (c) && (c) <= 'z')
-# define TOUPPER(c) (ISLOWER(c) ? 'A' + ((c) - 'a') : (c))
-#else
-# define ISLOWER(c) \
-		   (('a' <= (c) && (c) <= 'i') \
-		     || ('j' <= (c) && (c) <= 'r') \
-		     || ('s' <= (c) && (c) <= 'z'))
-# define TOUPPER(c) (ISLOWER(c) ? ((c) | 0x40) : (c))
-#endif
-
-#define XOR(e, f) (((e) && !(f)) || (!(e) && (f)))
-int
-main ()
-{
-  int i;
-  for (i = 0; i < 256; i++)
-    if (XOR (islower (i), ISLOWER (i))
-	|| toupper (i) != TOUPPER (i))
-      return 2;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_run "$LINENO"; then :
-
-else
-  ac_cv_header_stdc=no
-fi
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
-  conftest.$ac_objext conftest.beam conftest.$ac_ext
-fi
-
-fi
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_header_stdc" >&5
-$as_echo "$ac_cv_header_stdc" >&6; }
-if test $ac_cv_header_stdc = yes; then
-
-$as_echo "#define STDC_HEADERS 1" >>confdefs.h
-
-fi
-
-# On IRIX 5.3, sys/types and inttypes.h are conflicting.
-for ac_header in sys/types.h sys/stat.h stdlib.h string.h memory.h strings.h \
-		  inttypes.h stdint.h unistd.h
-do :
-  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-ac_fn_c_check_header_compile "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default
-"
-if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
-_ACEOF
-
-fi
-
-done
-
-
-
-    BITS_REQ=nochange
-    ENABLE_64BIT_LIBS=unknown
-    ## revisit this for cross-compile.
-
-    # Check whether --enable-64bit-libs was given.
-if test "${enable_64bit_libs+set}" = set; then :
-  enableval=$enable_64bit_libs; echo "note, use --with-library-bits instead of --*-64bit-libs"
-         case "${enableval}" in
-            no|false|32) with_library_bits=32;  ;;
-            yes|true|64) with_library_bits=64else32 ;;
-            nochange) with_library_bits=nochange; ;;
-            *) as_fn_error $? "bad value ${enableval} for '--*-64bit-libs'" "$LINENO" 5 ;;
-            esac
-fi
-
-
-
-
-# Check whether --with-library-bits was given.
-if test "${with_library_bits+set}" = set; then :
-  withval=$with_library_bits; case "${withval}" in
-            ""|nochange) BITS_REQ=$withval ;;
-            32|64|64else32) BITS_REQ=$withval ;;
-            *) as_fn_error $? "bad value ${withval} for --with-library-bits" "$LINENO" 5 ;;
-            esac
-fi
-
-
-    # don't use these for cross compiling
-    if test "$cross_compiling" = "yes" -a "${BITS_REQ}" != "nochange"; then
-        as_fn_error $? "Don't specify bitness when cross compiling. See readme.html for help with cross compilation., and set compiler options manually." "$LINENO" 5
-    fi
-    # The cast to long int works around a bug in the HP C Compiler
-# version HP92453-01 B.11.11.23709.GP, which incorrectly rejects
-# declarations like `int a3[[(sizeof (unsigned char)) >= 0]];'.
-# This bug is HP SR number 8606223364.
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking size of void *" >&5
-$as_echo_n "checking size of void *... " >&6; }
-if ${ac_cv_sizeof_void_p+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  if ac_fn_c_compute_int "$LINENO" "(long int) (sizeof (void *))" "ac_cv_sizeof_void_p"        "$ac_includes_default"; then :
-
-else
-  if test "$ac_cv_type_void_p" = yes; then
-     { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error 77 "cannot compute sizeof (void *)
-See \`config.log' for more details" "$LINENO" 5; }
-   else
-     ac_cv_sizeof_void_p=0
-   fi
-fi
-
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_sizeof_void_p" >&5
-$as_echo "$ac_cv_sizeof_void_p" >&6; }
-
-
-
-cat >>confdefs.h <<_ACEOF
-#define SIZEOF_VOID_P $ac_cv_sizeof_void_p
-_ACEOF
-
-
-    { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether runnable 64 bit binaries are built by default" >&5
-$as_echo_n "checking whether runnable 64 bit binaries are built by default... " >&6; }
-    case $ac_cv_sizeof_void_p in
-        8) DEFAULT_64BIT=yes ;;
-        4) DEFAULT_64BIT=no ;;
-        *) DEFAULT_64BIT=unknown
-    esac
-    BITS_GOT=unknown
-
-    # 'OK' here means, we can exit any further checking, everything's copa
-    BITS_OK=yes
-
-    # do we need to check for buildable/runnable 32 or 64 bit?
-    BITS_CHECK_32=no
-    BITS_CHECK_64=no
-
-    # later, can we run the 32/64 bit binaries so made?
-    BITS_RUN_32=no
-    BITS_RUN_64=no
-
-    if test "$DEFAULT_64BIT" = "yes"; then
-        # we get 64 bits by default.
-        BITS_GOT=64
-        case "$BITS_REQ" in
-            32)
-                # need to look for 32 bit support.
-                BITS_CHECK_32=yes
-                # not copa.
-                BITS_OK=no;;
-            # everyone else is happy.
-            nochange) ;;
-            *) ;;
-        esac
-    elif test "$DEFAULT_64BIT" = "no"; then
-        # not 64 bit by default.
-        BITS_GOT=32
-        case "$BITS_REQ" in
-            64|64else32)
-                BITS_CHECK_64=yes
-                #BITS_CHECK_32=yes
-                BITS_OK=no;;
-            nochange) ;;
-            *) ;;
-        esac
-    elif test "$DEFAULT_64BIT" = "unknown"; then
-        # cross compiling.
-        BITS_GOT=unknown
-        case "$BITS_REQ" in
-            64|64else32) BITS_OK=no
-            BITS_CHECK_32=yes
-            BITS_CHECK_64=yes ;;
-            32) BITS_OK=no;;
-            nochange) ;;
-            *) ;;
-        esac
-    fi
-
-    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $DEFAULT_64BIT" >&5
-$as_echo "$DEFAULT_64BIT" >&6; };
-
-    if test "$BITS_OK" != "yes"; then
-        # not copa. back these up.
-        CFLAGS_OLD="${CFLAGS}"
-        CXXFLAGS_OLD="${CXXFLAGS}"
-        LDFLAGS_OLD="${LDFLAGS}"
-        ARFLAGS_OLD="${ARFLAGS}"
-
-        CFLAGS_32="${CFLAGS}"
-        CXXFLAGS_32="${CXXFLAGS}"
-        LDFLAGS_32="${LDFLAGS}"
-        ARFLAGS_32="${ARFLAGS}"
-
-        CFLAGS_64="${CFLAGS}"
-        CXXFLAGS_64="${CXXFLAGS}"
-        LDFLAGS_64="${LDFLAGS}"
-        ARFLAGS_64="${ARFLAGS}"
-
-        CAN_BUILD_64=unknown
-        CAN_BUILD_32=unknown
-        # These results can't be cached because is sets compiler flags.
-        if test "$BITS_CHECK_64" = "yes"; then
-            { $as_echo "$as_me:${as_lineno-$LINENO}: checking how to build 64-bit executables" >&5
-$as_echo_n "checking how to build 64-bit executables... " >&6; }
-            CAN_BUILD_64=no
-            ####
-            # Find out if we think we can *build* for 64 bit. Doesn't check whether we can run it.
-            #  Note, we don't have to actually check if the options work- we'll try them before using them.
-            #  So, only try actually testing the options, if you are trying to decide between multiple options.
-            # On exit from the following clauses:
-            # if CAN_BUILD_64=yes:
-            #    *FLAGS are assumed to contain the right settings for 64bit
-            # else if CAN_BUILD_64=no: (default)
-            #    *FLAGS are assumed to be trashed, and will be reset from *FLAGS_OLD
-
-            if test "$GCC" = yes; then
-                CFLAGS="${CFLAGS} -m64"
-                CXXFLAGS="${CXXFLAGS} -m64"
-                cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-int main(void) {return (sizeof(void*)*8==64)?0:1;}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  CAN_BUILD_64=yes
-else
-  CAN_BUILD_64=no
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-            else
-                case "${host}" in
-                sparc*-*-solaris*)
-                    # 1. try -m64
-                    CFLAGS="${CFLAGS} -m64"
-                    CXXFLAGS="${CXXFLAGS} -m64"
-                    if test "$cross_compiling" = yes; then :
-  CAN_BUILD_64=unknown
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-int main(void) {return (sizeof(void*)*8==64)?0:1;}
-_ACEOF
-if ac_fn_c_try_run "$LINENO"; then :
-  CAN_BUILD_64=yes
-else
-  CAN_BUILD_64=no
-fi
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
-  conftest.$ac_objext conftest.beam conftest.$ac_ext
-fi
-
-                    if test "$CAN_BUILD_64" != yes; then
-                        # Nope. back out changes.
-                        CFLAGS="${CFLAGS_OLD}"
-                        CXXFLAGS="${CXXFLAGS_OLD}"
-                        # 2. try xarch=v9 [deprecated]
-                        ## TODO: cross compile: the following won't work.
-                        SPARCV9=`isainfo -n 2>&1 | grep sparcv9`
-                        SOL64=`$CXX -xarch=v9 2>&1 && $CC -xarch=v9 2>&1 | grep -v usage:`
-                        # "Warning: -xarch=v9 is deprecated, use -m64 to create 64-bit programs"
-                        if test -z "$SOL64" && test -n "$SPARCV9"; then
-                            CFLAGS="${CFLAGS} -xtarget=ultra -xarch=v9"
-                            CXXFLAGS="${CXXFLAGS} -xtarget=ultra -xarch=v9"
-                            LDFLAGS="${LDFLAGS} -xtarget=ultra -xarch=v9"
-                            CAN_BUILD_64=yes
-                        fi
-                    fi
-                    ;;
-                i386-*-solaris*)
-                    # 1. try -m64
-                    CFLAGS="${CFLAGS} -m64"
-                    CXXFLAGS="${CXXFLAGS} -m64"
-                    if test "$cross_compiling" = yes; then :
-  CAN_BUILD_64=unknown
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-int main(void) {return (sizeof(void*)*8==64)?0:1;}
-_ACEOF
-if ac_fn_c_try_run "$LINENO"; then :
-  CAN_BUILD_64=yes
-else
-  CAN_BUILD_64=no
-fi
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
-  conftest.$ac_objext conftest.beam conftest.$ac_ext
-fi
-
-                    if test "$CAN_BUILD_64" != yes; then
-                        # Nope. back out changes.
-                        CFLAGS="${CFLAGS_OLD}"
-                        CXXFLAGS="${CXXFLAGS_OLD}"
-                        # 2. try the older compiler option
-                        ## TODO: cross compile problem
-                        AMD64=`isainfo -n 2>&1 | grep amd64`
-                        SOL64=`$CXX -xtarget=generic64 2>&1 && $CC -xtarget=generic64 2>&1 | grep -v usage:`
-                        if test -z "$SOL64" && test -n "$AMD64"; then
-                            CFLAGS="${CFLAGS} -xtarget=generic64"
-                            CXXFLAGS="${CXXFLAGS} -xtarget=generic64"
-                            CAN_BUILD_64=yes
-                        fi
-                    fi
-                    ;;
-                ia64-*-linux*)
-                    # check for ecc/ecpc compiler support
-                    ## TODO: cross compiler problem
-                    if test -n "`$CXX --help 2>&1 && $CC --help 2>&1 | grep -v Intel`"; then
-                        if test -n "`$CXX --help 2>&1 && $CC --help 2>&1 | grep -v Itanium`"; then
-                            CAN_BUILD_64=yes
-                        fi
-                    fi
-                    ;;
-                *-*-cygwin)
-                    # vcvarsamd64.bat should have been used to enable 64-bit builds.
-                    # We only do this check to display the correct answer.
-                    ## TODO: cross compiler problem
-                    if test -n "`$CXX -help 2>&1 | grep 'for x64'`"; then
-                        CAN_BUILD_64=yes
-                    fi
-                    ;;
-                *-*-aix*|powerpc64-*-linux*)
-                    CFLAGS="${CFLAGS} -q64"
-                    CXXFLAGS="${CXXFLAGS} -q64"
-                    LDFLAGS="${LDFLAGS} -q64"
-                    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-int main(void) {return (sizeof(void*)*8==64)?0:1;}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  CAN_BUILD_64=yes
-else
-  CAN_BUILD_64=no
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-                    if test "$CAN_BUILD_64" = yes; then
-                        # worked- set other options.
-                        case "${host}" in
-                        *-*-aix*)
-                            # tell AIX what executable mode to use.
-                            ARFLAGS="${ARFLAGS} -X64"
-                        esac
-                    fi
-                    ;;
-                *-*-hpux*)
-                    # First we try the newer +DD64, if that doesn't work,
-                    # try other options.
-
-                    CFLAGS="${CFLAGS} +DD64"
-                    CXXFLAGS="${CXXFLAGS} +DD64"
-                    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-int main(void) {return (sizeof(void*)*8==64)?0:1;}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  CAN_BUILD_64=yes
-else
-  CAN_BUILD_64=no
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-                    if test "$CAN_BUILD_64" != yes; then
-                        # reset
-                        CFLAGS="${CFLAGS_OLD}"
-                        CXXFLAGS="${CXXFLAGS_OLD}"
-                        # append
-                        CFLAGS="${CFLAGS} +DA2.0W"
-                        CXXFLAGS="${CXXFLAGS} +DA2.0W"
-                        cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-int main(void) {return (sizeof(void*)*8==64)?0:1;}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  CAN_BUILD_64=yes
-else
-  CAN_BUILD_64=no
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-                    fi
-                    ;;
-                *-*ibm-openedition*|*-*-os390*)
-                    CFLAGS="${CFLAGS} -Wc,lp64"
-                    CXXFLAGS="${CXXFLAGS} -Wc,lp64"
-                    LDFLAGS="${LDFLAGS} -Wl,lp64"
-                    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-int main(void) {return (sizeof(void*)*8==64)?0:1;}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  CAN_BUILD_64=yes
-else
-  CAN_BUILD_64=no
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-                    ;;
-                *)
-                    # unknown platform.
-                    ;;
-                esac
-            fi
-            { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CAN_BUILD_64" >&5
-$as_echo "$CAN_BUILD_64" >&6; }
-            if test "$CAN_BUILD_64" = yes; then
-                { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether runnable 64-bit binaries are being built " >&5
-$as_echo_n "checking whether runnable 64-bit binaries are being built ... " >&6; }
-                if test "$cross_compiling" = yes; then :
-  BITS_RUN_64=unknown
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-int main(void) {return (sizeof(void*)*8==64)?0:1;}
-_ACEOF
-if ac_fn_c_try_run "$LINENO"; then :
-  BITS_RUN_64=yes
-else
-  BITS_RUN_64=no
-fi
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
-  conftest.$ac_objext conftest.beam conftest.$ac_ext
-fi
-
-                { $as_echo "$as_me:${as_lineno-$LINENO}: result: $BITS_RUN_64" >&5
-$as_echo "$BITS_RUN_64" >&6; };
-
-                CFLAGS_64="${CFLAGS}"
-                CXXFLAGS_64="${CXXFLAGS}"
-                LDFLAGS_64="${LDFLAGS}"
-                ARFLAGS_64="${ARFLAGS}"
-            fi
-            # put it back.
-            CFLAGS="${CFLAGS_OLD}"
-            CXXFLAGS="${CXXFLAGS_OLD}"
-            LDFLAGS="${LDFLAGS_OLD}"
-            ARFLAGS="${ARFLAGS_OLD}"
-        fi
-        if test "$BITS_CHECK_32" = "yes"; then
-            # see comment under 'if BITS_CHECK_64', above.
-            { $as_echo "$as_me:${as_lineno-$LINENO}: checking how to build 32-bit executables" >&5
-$as_echo_n "checking how to build 32-bit executables... " >&6; }
-            if test "$GCC" = yes; then
-                CFLAGS="${CFLAGS} -m32"
-                CXXFLAGS="${CXXFLAGS} -m32"
-                cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-int main(void) {return (sizeof(void*)*8==32)?0:1;}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  CAN_BUILD_32=yes
-else
-  CAN_BUILD_32=no
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-            fi
-            { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CAN_BUILD_32" >&5
-$as_echo "$CAN_BUILD_32" >&6; }
-            if test "$CAN_BUILD_32" = yes; then
-                { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether runnable 32-bit binaries are being built " >&5
-$as_echo_n "checking whether runnable 32-bit binaries are being built ... " >&6; }
-                if test "$cross_compiling" = yes; then :
-  BITS_RUN_32=unknown
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-int main(void) {return (sizeof(void*)*8==32)?0:1;}
-_ACEOF
-if ac_fn_c_try_run "$LINENO"; then :
-  BITS_RUN_32=yes
-else
-  BITS_RUN_32=no
-fi
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
-  conftest.$ac_objext conftest.beam conftest.$ac_ext
-fi
-
-                { $as_echo "$as_me:${as_lineno-$LINENO}: result: $BITS_RUN_32" >&5
-$as_echo "$BITS_RUN_32" >&6; };
-                CFLAGS_32="${CFLAGS}"
-                CXXFLAGS_32="${CXXFLAGS}"
-                LDFLAGS_32="${LDFLAGS}"
-                ARFLAGS_32="${ARFLAGS}"
-            fi
-            # put it back.
-            CFLAGS="${CFLAGS_OLD}"
-            CXXFLAGS="${CXXFLAGS_OLD}"
-            LDFLAGS="${LDFLAGS_OLD}"
-            ARFLAGS="${ARFLAGS_OLD}"
-        fi
-
-        ##
-        # OK. Now, we've tested for 32 and 64 bitness. Let's see what we'll do.
-        #
-
-        # First, implement 64else32
-        if test "$BITS_REQ" = "64else32"; then
-            if test "$BITS_RUN_64" = "yes"; then
-                BITS_REQ=64
-            else
-                # no changes.
-                BITS_OK=yes
-            fi
-        fi
-
-        # implement.
-        if test "$BITS_REQ" = "32" -a "$BITS_RUN_32" = "yes"; then
-            CFLAGS="${CFLAGS_32}"
-            CXXFLAGS="${CXXFLAGS_32}"
-            LDFLAGS="${LDFLAGS_32}"
-            ARFLAGS="${ARFLAGS_32}"
-            BITS_OK=yes
-        elif test "$BITS_REQ" = "64" -a "$BITS_RUN_64" = "yes"; then
-            CFLAGS="${CFLAGS_64}"
-            CXXFLAGS="${CXXFLAGS_64}"
-            LDFLAGS="${LDFLAGS_64}"
-            ARFLAGS="${ARFLAGS_64}"
-            BITS_OK=yes
-        elif test "$BITS_OK" != "yes"; then
-            as_fn_error $? "Requested $BITS_REQ bit binaries but could not compile and execute them. See readme.html for help with cross compilation., and set compiler options manually." "$LINENO" 5
-        fi
-     fi
-
-
-
-
-# Determine the Makefile fragment
-
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking which Makefile fragment to use for ${host}" >&5
-$as_echo_n "checking which Makefile fragment to use for ${host}... " >&6; }
-if ${icu_cv_host_frag+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-
-case "${host}" in
-*-*-solaris*)
-	if test "$GCC" = yes; then
-		icu_cv_host_frag=mh-solaris-gcc
-	else
-		icu_cv_host_frag=mh-solaris
-	fi ;;
-alpha*-*-linux-gnu)
-	if test "$GCC" = yes; then
-		icu_cv_host_frag=mh-alpha-linux-gcc
-	else
-		icu_cv_host_frag=mh-alpha-linux-cc
-	fi ;;
-powerpc*-*-linux*)
-	if test "$GCC" = yes; then
-		icu_cv_host_frag=mh-linux
-	else
-		icu_cv_host_frag=mh-linux-va
-	fi ;;
-*-*-linux*|*-*-gnu|*-*-k*bsd*-gnu|*-*-kopensolaris*-gnu) icu_cv_host_frag=mh-linux ;;
-i[34567]86-*-cygwin)
-	if test "$GCC" = yes; then
-		icu_cv_host_frag=mh-cygwin
-	else
-		icu_cv_host_frag=mh-cygwin-msvc
-	fi ;;
-x86_64-*-cygwin)
-	if test "$GCC" = yes; then
-		icu_cv_host_frag=mh-cygwin64
-	else
-		icu_cv_host_frag=mh-cygwin-msvc
-	fi ;;
-*-*-mingw*)
-	if test "$GCC" = yes; then
-                cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-#ifndef __MINGW64__
-#error This is not MinGW64
-#endif
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  icu_cv_host_frag=mh-mingw64
-else
-  icu_cv_host_frag=mh-mingw
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-	else
-	        case "${host}" in
-		*-*-mingw*) icu_cv_host_frag=mh-msys-msvc ;;
-		*-*-cygwin) icu_cv_host_frag=mh-cygwin-msvc ;;
-		esac
-	fi ;;
-*-*-*bsd*|*-*-dragonfly*) 	icu_cv_host_frag=mh-bsd-gcc ;;
-*-*-aix*)
-	if test "$GCC" = yes; then
-		icu_cv_host_frag=mh-aix-gcc
-	else
-		icu_cv_host_frag=mh-aix-va
-	fi ;;
-*-*-hpux*)
-	if test "$GCC" = yes; then
-		icu_cv_host_frag=mh-hpux-gcc
-	else
-		case "$CXX" in
-		*aCC)    icu_cv_host_frag=mh-hpux-acc ;;
-		esac
-	fi ;;
-*-*ibm-openedition*|*-*-os390*)	icu_cv_host_frag=mh-os390 ;;
-*-*-os400*)	icu_cv_host_frag=mh-os400 ;;
-*-apple-rhapsody*)	icu_cv_host_frag=mh-darwin ;;
-*-apple-darwin*)	icu_cv_host_frag=mh-darwin ;;
-*-*-beos)       icu_cv_host_frag=mh-beos ;;
-*-*-haiku)      icu_cv_host_frag=mh-haiku ;;
-*-*-irix*)	icu_cv_host_frag=mh-irix ;;
-*-dec-osf*) icu_cv_host_frag=mh-alpha-osf ;;
-*-*-nto*)	icu_cv_host_frag=mh-qnx ;;
-*-ncr-*)	icu_cv_host_frag=mh-mpras ;;
-*) 		icu_cv_host_frag=mh-unknown ;;
-esac
-
-
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $icu_cv_host_frag" >&5
-$as_echo "$icu_cv_host_frag" >&6; }
-
-
-# Checks for libraries and other host specific stuff
-# On HP/UX, don't link to -lm from a shared lib because it isn't
-#  PIC (at least on 10.2)
-case "${host}" in
-	*-*-hpux*) 	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for floor in -lm" >&5
-$as_echo_n "checking for floor in -lm... " >&6; }
-if ${ac_cv_lib_m_floor+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lm  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char floor ();
-int
-main ()
-{
-return floor ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_m_floor=yes
-else
-  ac_cv_lib_m_floor=no
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_m_floor" >&5
-$as_echo "$ac_cv_lib_m_floor" >&6; }
-if test "x$ac_cv_lib_m_floor" = xyes; then :
-  LIB_M="-lm"
-fi
- ;;
-
-	*) 		{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for floor in -lm" >&5
-$as_echo_n "checking for floor in -lm... " >&6; }
-if ${ac_cv_lib_m_floor+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lm  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char floor ();
-int
-main ()
-{
-return floor ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_m_floor=yes
-else
-  ac_cv_lib_m_floor=no
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_m_floor" >&5
-$as_echo "$ac_cv_lib_m_floor" >&6; }
-if test "x$ac_cv_lib_m_floor" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_LIBM 1
-_ACEOF
-
-  LIBS="-lm $LIBS"
-
-fi
-
-			LIB_M="" ;;
-esac
-
-
-# Check whether to build shared libraries
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether to build shared libraries" >&5
-$as_echo_n "checking whether to build shared libraries... " >&6; }
-enabled=no
-# Check whether --enable-shared was given.
-if test "${enable_shared+set}" = set; then :
-  enableval=$enable_shared;  case "${enableval}" in
-	     yes|"") enabled=yes; ENABLE_SHARED=YES ;;
-	     no);;
-	     *) ;;
-    esac
-else
-  enabled=yes; ENABLE_SHARED=YES
-
-fi
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $enabled" >&5
-$as_echo "$enabled" >&6; }
-
-
-# Check whether to build static libraries
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether to build static libraries" >&5
-$as_echo_n "checking whether to build static libraries... " >&6; }
-enabled=no
-# Check whether --enable-static was given.
-if test "${enable_static+set}" = set; then :
-  enableval=$enable_static;  case "${enableval}" in
-	     yes|"") enabled=yes; ENABLE_STATIC=YES ;;
-	     no) ;;
-	     *) ;;
-    esac
-fi
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $enabled" >&5
-$as_echo "$enabled" >&6; }
-
-
-# When building release static library, there might be some optimization flags we can use
-if test "$ENABLE_STATIC" = "YES"; then
-    if test "$ENABLE_SHARED" != "YES"; then
-        if test "$ENABLE_RELEASE" = 1; then
-            { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we can use static library optimization option" >&5
-$as_echo_n "checking whether we can use static library optimization option... " >&6; }
-            CHECK_STATIC_OPT_FLAG=no
-
-            OLD_CPPFLAGS="${CPPFLAGS}"
-            OLD_LDFLAGS="${LDFLAGS}"
-
-            case "${host}" in
-            *-linux*|i*86-*-*bsd*|i*86-pc-gnu)
-                if test "$GCC" = yes; then
-                    CPPFLAGS="${CPPFLAGS} -ffunction-sections -fdata-sections"
-                    LDFLAGS="${LDFLAGS} -Wl,--gc-sections"
-                fi
-                ;;
-            *)
-                ;;
-            esac
-
-            cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  CHECK_STATIC_OPT_FLAG=yes
-else
-  CHECK_STATIC_OPT_FLAG=no
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-            { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CHECK_STATIC_OPT_FLAG" >&5
-$as_echo "$CHECK_STATIC_OPT_FLAG" >&6; }
-            if test "$CHECK_STATIC_OPT_FLAG" = no; then
-                CPPFLAGS="${OLD_CPPFLAGS}"
-                LDFLAGS="${OLD_LDFLAGS}"
-            fi
-        fi
-    fi
-fi
-
-
-# Check whether to enable auto cleanup of libraries
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether to enable auto cleanup of libraries" >&5
-$as_echo_n "checking whether to enable auto cleanup of libraries... " >&6; }
-enabled=no
-UCLN_NO_AUTO_CLEANUP=1
-# Check whether --enable-auto-cleanup was given.
-if test "${enable_auto_cleanup+set}" = set; then :
-  enableval=$enable_auto_cleanup;  case "${enableval}" in
-         yes) enabled=yes;
-         CONFIG_CPPFLAGS="$CONFIG_CPPFLAGS -DUCLN_NO_AUTO_CLEANUP=0";
-         UCLN_NO_AUTO_CLEANUP=0
-          ;;
-         *) ;;
-    esac
-fi
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $enabled" >&5
-$as_echo "$enabled" >&6; }
-
-
-# MSVC floating-point option
-MSVC_RELEASE_FLAG=""
-if test $enabled = yes
-then
-    if test $icu_cv_host_frag = mh-cygwin-msvc -o $icu_cv_host_frag = mh-msys-msvc
-    then
-        cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-    #if defined _MSC_VER && _MSC_VER >= 1400
-    #else
-    Microsoft Visual C++ < 2005
-    #endif
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  MSVC_RELEASE_FLAG="/fp:precise"
-else
-  MSVC_RELEASE_FLAG="/Op"
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-
-        CFLAGS="${CFLAGS} ${MSVC_RELEASE_FLAG}"
-        CXXFLAGS="${CXXFLAGS} ${MSVC_RELEASE_FLAG}"
-    fi
-fi
-
-# Check whether to enabled draft APIs
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether to enable draft APIs" >&5
-$as_echo_n "checking whether to enable draft APIs... " >&6; }
-enabled=yes
-U_DEFAULT_SHOW_DRAFT=1
-# Check whether --enable-draft was given.
-if test "${enable_draft+set}" = set; then :
-  enableval=$enable_draft;  case "${enableval}" in
-         no) enabled=no; U_DEFAULT_SHOW_DRAFT=0;
-         CONFIG_CPPFLAGS="$CONFIG_CPPFLAGS -DU_DEFAULT_SHOW_DRAFT=0"
-          ;;
-         *) ;;
-    esac
-fi
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $enabled" >&5
-$as_echo "$enabled" >&6; }
-# Make sure that we can use draft API in ICU.
-if test "$U_DEFAULT_SHOW_DRAFT" = 0; then
-    CONFIG_CPPFLAGS="$CONFIG_CPPFLAGS -DU_SHOW_DRAFT_API"
-fi
-
-
-if test -n "$ac_tool_prefix"; then
-  # Extract the first word of "${ac_tool_prefix}ranlib", so it can be a program name with args.
-set dummy ${ac_tool_prefix}ranlib; ac_word=$2
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if ${ac_cv_prog_RANLIB+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$RANLIB"; then
-  ac_cv_prog_RANLIB="$RANLIB" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_exec_ext in '' $ac_executable_extensions; do
-  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_RANLIB="${ac_tool_prefix}ranlib"
-    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-  done
-IFS=$as_save_IFS
-
-fi
-fi
-RANLIB=$ac_cv_prog_RANLIB
-if test -n "$RANLIB"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $RANLIB" >&5
-$as_echo "$RANLIB" >&6; }
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-fi
-
-
-fi
-if test -z "$ac_cv_prog_RANLIB"; then
-  ac_ct_RANLIB=$RANLIB
-  # Extract the first word of "ranlib", so it can be a program name with args.
-set dummy ranlib; ac_word=$2
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if ${ac_cv_prog_ac_ct_RANLIB+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$ac_ct_RANLIB"; then
-  ac_cv_prog_ac_ct_RANLIB="$ac_ct_RANLIB" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_exec_ext in '' $ac_executable_extensions; do
-  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_ac_ct_RANLIB="ranlib"
-    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-  done
-IFS=$as_save_IFS
-
-fi
-fi
-ac_ct_RANLIB=$ac_cv_prog_ac_ct_RANLIB
-if test -n "$ac_ct_RANLIB"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_RANLIB" >&5
-$as_echo "$ac_ct_RANLIB" >&6; }
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-fi
-
-  if test "x$ac_ct_RANLIB" = x; then
-    RANLIB=":"
-  else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
-$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
-ac_tool_warned=yes ;;
-esac
-    RANLIB=$ac_ct_RANLIB
-  fi
-else
-  RANLIB="$ac_cv_prog_RANLIB"
-fi
-
-
-# look for 'ar' the proper way
-if test -n "$ac_tool_prefix"; then
-  # Extract the first word of "${ac_tool_prefix}ar", so it can be a program name with args.
-set dummy ${ac_tool_prefix}ar; ac_word=$2
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if ${ac_cv_prog_AR+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$AR"; then
-  ac_cv_prog_AR="$AR" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_exec_ext in '' $ac_executable_extensions; do
-  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_AR="${ac_tool_prefix}ar"
-    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-  done
-IFS=$as_save_IFS
-
-fi
-fi
-AR=$ac_cv_prog_AR
-if test -n "$AR"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $AR" >&5
-$as_echo "$AR" >&6; }
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-fi
-
-
-fi
-if test -z "$ac_cv_prog_AR"; then
-  ac_ct_AR=$AR
-  # Extract the first word of "ar", so it can be a program name with args.
-set dummy ar; ac_word=$2
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if ${ac_cv_prog_ac_ct_AR+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$ac_ct_AR"; then
-  ac_cv_prog_ac_ct_AR="$ac_ct_AR" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_exec_ext in '' $ac_executable_extensions; do
-  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_ac_ct_AR="ar"
-    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-  done
-IFS=$as_save_IFS
-
-fi
-fi
-ac_ct_AR=$ac_cv_prog_ac_ct_AR
-if test -n "$ac_ct_AR"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_AR" >&5
-$as_echo "$ac_ct_AR" >&6; }
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-fi
-
-  if test "x$ac_ct_AR" = x; then
-    AR="false"
-  else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
-$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
-ac_tool_warned=yes ;;
-esac
-    AR=$ac_ct_AR
-  fi
-else
-  AR="$ac_cv_prog_AR"
-fi
-
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether to enable renaming of symbols" >&5
-$as_echo_n "checking whether to enable renaming of symbols... " >&6; }
-enabled=yes
-U_DISABLE_RENAMING=0
-# Check whether --enable-renaming was given.
-if test "${enable_renaming+set}" = set; then :
-  enableval=$enable_renaming;  case "${enableval}" in
-	     yes|"") enabled=yes ;;
-	     no) enabled=no; U_DISABLE_RENAMING=1;
-             UCONFIG_CPPFLAGS="${UCONFIG_CPPFLAGS} -DU_DISABLE_RENAMING=1"
-              ;;
-	     *) ;;
-    esac
-fi
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $enabled" >&5
-$as_echo "$enabled" >&6; }
-
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether to enable function and data tracing" >&5
-$as_echo_n "checking whether to enable function and data tracing... " >&6; }
-enabled=no
-U_ENABLE_TRACING=0
-# Check whether --enable-tracing was given.
-if test "${enable_tracing+set}" = set; then :
-  enableval=$enable_tracing;  case "${enableval}" in
-	     yes|"") enabled=yes;
-                     CONFIG_CPPFLAGS="$CONFIG_CPPFLAGS -DU_ENABLE_TRACING=1";
-                     U_ENABLE_TRACING=1 ;;
-	     no) enabled=no; U_ENABLE_TRACING=0 ;;
-	     *) ;;
-    esac
-fi
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $enabled" >&5
-$as_echo "$enabled" >&6; }
-
-
-# check if elf.h is present.
-for ac_header in elf.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "elf.h" "ac_cv_header_elf_h" "$ac_includes_default"
-if test "x$ac_cv_header_elf_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_ELF_H 1
-_ACEOF
-
-fi
-
-done
-
-if test "x$ac_cv_header_elf_h" = "xyes"; then
-    CONFIG_CPPFLAGS="$CONFIG_CPPFLAGS -DU_HAVE_ELF_H=1";
-fi
-
-# Enable/disable plugins
-# Check whether --enable-plugins was given.
-if test "${enable_plugins+set}" = set; then :
-  enableval=$enable_plugins; case "${enableval}" in
-		yes) plugins=true ;;
-		no)  plugins=false ;;
-		*) as_fn_error $? "bad value ${enableval} for --enable-plugins" "$LINENO" 5 ;;
-		esac
-else
-  plugins=false
-fi
-
-
-
-if test "$plugins" = true; then
-  PLUGINS_TRUE=
-  U_HAVE_PLUGINS=1
-else
-  PLUGINS_TRUE='#'
-  U_HAVE_PLUGINS=0
-fi
-
-if test "x$plugins" = "xtrue"; then
-   UCONFIG_CPPFLAGS="$UCONFIG_CPPFLAGS -DUCONFIG_ENABLE_PLUGINS=1"
-fi
-
-
-U_ENABLE_DYLOAD=1
-enable=yes
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether to enable dynamic loading of plugins. Ignored if plugins disabled." >&5
-$as_echo_n "checking whether to enable dynamic loading of plugins. Ignored if plugins disabled.... " >&6; }
-# Check whether --enable-dyload was given.
-if test "${enable_dyload+set}" = set; then :
-  enableval=$enable_dyload;  case "${enableval}" in
-	     yes|"")
-		     U_ENABLE_DYLOAD=1
-                     enable=yes
-                     ;;
-	     no)
-	     	 U_ENABLE_DYLOAD=0;
-                 enable=no;
-                 CONFIG_CPPFLAGS="$CONFIG_CPPFLAGS -DU_ENABLE_DYLOAD=0";
-                 ;;
-	     *) ;;
-    esac
-fi
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $enable" >&5
-$as_echo "$enable" >&6; }
-
-
-if test "$enable" = "yes"; then
-   for ac_header in dlfcn.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "dlfcn.h" "ac_cv_header_dlfcn_h" "$ac_includes_default"
-if test "x$ac_cv_header_dlfcn_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_DLFCN_H 1
-_ACEOF
-
-fi
-
-done
-
-   #AC_MSG_RESULT($enabled)
-   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing dlopen" >&5
-$as_echo_n "checking for library containing dlopen... " >&6; }
-if ${ac_cv_search_dlopen+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_func_search_save_LIBS=$LIBS
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char dlopen ();
-int
-main ()
-{
-return dlopen ();
-  ;
-  return 0;
-}
-_ACEOF
-for ac_lib in '' dl; do
-  if test -z "$ac_lib"; then
-    ac_res="none required"
-  else
-    ac_res=-l$ac_lib
-    LIBS="-l$ac_lib  $ac_func_search_save_LIBS"
-  fi
-  if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_search_dlopen=$ac_res
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext
-  if ${ac_cv_search_dlopen+:} false; then :
-  break
-fi
-done
-if ${ac_cv_search_dlopen+:} false; then :
-
-else
-  ac_cv_search_dlopen=no
-fi
-rm conftest.$ac_ext
-LIBS=$ac_func_search_save_LIBS
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_search_dlopen" >&5
-$as_echo "$ac_cv_search_dlopen" >&6; }
-ac_res=$ac_cv_search_dlopen
-if test "$ac_res" != no; then :
-  test "$ac_res" = "none required" || LIBS="$ac_res $LIBS"
-
-fi
-
-   for ac_func in dlopen
-do :
-  ac_fn_c_check_func "$LINENO" "dlopen" "ac_cv_func_dlopen"
-if test "x$ac_cv_func_dlopen" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_DLOPEN 1
-_ACEOF
-
-fi
-done
-
-
-   if test "x$ac_cv_func_dlopen" != xyes; then
-      CONFIG_CPPFLAGS="$CONFIG_CPPFLAGS -DHAVE_DLOPEN=0"
-   fi
-fi
-
-# Check for miscellanous functions.
-# So, use for putil / tools only.
-# Note that this will generate HAVE_GETTIMEOFDAY, not U_HAVE_GETTIMEOFDAY
-for ac_func in gettimeofday
-do :
-  ac_fn_c_check_func "$LINENO" "gettimeofday" "ac_cv_func_gettimeofday"
-if test "x$ac_cv_func_gettimeofday" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_GETTIMEOFDAY 1
-_ACEOF
-
-fi
-done
-
-
-
-# Check whether to use the evil rpath or not
-# Check whether --enable-rpath was given.
-if test "${enable_rpath+set}" = set; then :
-  enableval=$enable_rpath;  case "${enableval}" in
-	     yes|"") ENABLE_RPATH=YES ;;
-	     no) ;;
-	     *) ;;
-    esac
-else
-  ENABLE_RPATH=NO
-
-fi
-
-
-
-
-
-ac_ext=cpp
-ac_cpp='$CXXCPP $CPPFLAGS'
-ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if we have a C++ compiler" >&5
-$as_echo_n "checking if we have a C++ compiler... " >&6; }
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_cxx_try_compile "$LINENO"; then :
-  cxx_okay=yes
-else
-  cxx_okay=no
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-if test $cxx_okay = yes
-then
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: Good" >&5
-$as_echo "Good" >&6; }
-else
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-	as_fn_error $? "C++ compiler $CXX does not work or no compiler found" "$LINENO" 5
-fi
-
-if [ "$GXX" = yes ]; then
-    # if CXXFLAGS does not have a "-std=" setting, set it now to -std=c++0x,
-    # and check that the compiler still works.
-    if ! echo "$CXXFLAGS" | grep '\-std=' >/dev/null 2>&1; then
-        OLD_CXXFLAGS="${CXXFLAGS}"
-        CXXFLAGS="$CXXFLAGS --std=c++0x"
-        { $as_echo "$as_me:${as_lineno-$LINENO}: checking if we have a C++11 compiler" >&5
-$as_echo_n "checking if we have a C++11 compiler... " >&6; }
-        cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_cxx_try_compile "$LINENO"; then :
-  cxx11_okay=yes
-else
-  cxx11_okay=no
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-        { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cxx11_okay" >&5
-$as_echo "$cxx11_okay" >&6; }
-        if [ $cxx11_okay = yes ]; then
-            { $as_echo "$as_me:${as_lineno-$LINENO}: Adding CXXFLAGS option --std=c++0x" >&5
-$as_echo "$as_me: Adding CXXFLAGS option --std=c++0x" >&6;}
-            UCONFIG_CXXFLAGS="${UCONFIG_CXXFLAGS} --std=c++0x"
-        else
-            CXXFLAGS="$OLD_CXXFLAGS"
-        fi
-    fi
-fi
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if #include <string> works" >&5
-$as_echo_n "checking if #include <string> works... " >&6; }
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <string>
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_cxx_try_compile "$LINENO"; then :
-  ac_cv_header_stdstring=yes
-else
-  ac_cv_header_stdstring=no
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_header_stdstring" >&5
-$as_echo "$ac_cv_header_stdstring" >&6; }
-if test $ac_cv_header_stdstring = yes
-then
-	U_HAVE_STD_STRING=1
-else
-        U_HAVE_STD_STRING=0
-        CONFIG_CPPFLAGS="${CONFIG_CPPFLAGS} -DU_HAVE_STD_STRING=0"
-fi
-
-
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if #include <atomic> works" >&5
-$as_echo_n "checking if #include <atomic> works... " >&6; }
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <atomic>
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_cxx_try_compile "$LINENO"; then :
-  ac_cv_header_atomic=yes
-else
-  ac_cv_header_atomic=no
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_header_atomic" >&5
-$as_echo "$ac_cv_header_atomic" >&6; }
-if test $ac_cv_header_atomic = yes
-then
-	U_HAVE_ATOMIC=1
-else
-        U_HAVE_ATOMIC=0
-fi
-# Make this available via CPPFLAGS
-CONFIG_CPPFLAGS="${CONFIG_CPPFLAGS} -DU_HAVE_ATOMIC=${U_HAVE_ATOMIC}"
-
-
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-
-
-# Always build ICU with multi-threading support.
-OLD_LIBS=${LIBS}
-
-# For Compaq Tru64 (OSF1), we must look for pthread_attr_init
-# and must do this before seaching for pthread_mutex_destroy, or
-# we will pick up libpthreads.so not libpthread.so
-# If this fails, then we must test for HPUX specials, before
-# moving on to a more generic test
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for pthread_attr_init in -lpthread" >&5
-$as_echo_n "checking for pthread_attr_init in -lpthread... " >&6; }
-if ${ac_cv_lib_pthread_pthread_attr_init+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lpthread  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char pthread_attr_init ();
-int
-main ()
-{
-return pthread_attr_init ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_pthread_pthread_attr_init=yes
-else
-  ac_cv_lib_pthread_pthread_attr_init=no
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pthread_pthread_attr_init" >&5
-$as_echo "$ac_cv_lib_pthread_pthread_attr_init" >&6; }
-if test "x$ac_cv_lib_pthread_pthread_attr_init" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_LIBPTHREAD 1
-_ACEOF
-
-  LIBS="-lpthread $LIBS"
-
-fi
-
-if test $ac_cv_lib_pthread_pthread_attr_init = yes; then
-  :
-else
-  # Locate the right library for POSIX threads. We look for the
-  # symbols in the libraries first, because on Solaris libc provides
-  # pthread_create but libpthread has the real code :(
-  # AIX uses libpthreads instead of libpthread, and HP/UX uses libpthread
-  # FreeBSD users may need libpthread if they do not have libc_r.
-
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing pthread_mutex_destroy" >&5
-$as_echo_n "checking for library containing pthread_mutex_destroy... " >&6; }
-if ${ac_cv_search_pthread_mutex_destroy+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_func_search_save_LIBS="$LIBS"
-ac_cv_search_pthread_mutex_destroy="no"
-for i in pthread pthreads c_r ; do
-LIBS="-l$i  $ac_func_search_save_LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char pthread_mutex_destroy ();
-int
-main ()
-{
-return pthread_mutex_destroy ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_search_pthread_mutex_destroy="-l$i"
-break
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-done
-if test "$ac_cv_search_pthread_mutex_destroy" = "no"; then
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char pthread_mutex_destroy ();
-int
-main ()
-{
-return pthread_mutex_destroy ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_search_pthread_mutex_destroy="none required"
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-fi
-LIBS="$ac_func_search_save_LIBS"
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_search_pthread_mutex_destroy" >&5
-$as_echo "$ac_cv_search_pthread_mutex_destroy" >&6; }
-if test "$ac_cv_search_pthread_mutex_destroy" != "no"; then
-  test "$ac_cv_search_pthread_mutex_destroy" = "none required" || LIBS="$ac_cv_search_pthread_mutex_destroy $LIBS"
-
-else :
-
-fi
-
-  if test "$ac_cv_search_pthread_mutex_destroy" != no; then
-    :
-  else
-    # For HP 11
-    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for pthread_mutex_init in -lpthread" >&5
-$as_echo_n "checking for pthread_mutex_init in -lpthread... " >&6; }
-if ${ac_cv_lib_pthread_pthread_mutex_init+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lpthread  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char pthread_mutex_init ();
-int
-main ()
-{
-return pthread_mutex_init ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_pthread_pthread_mutex_init=yes
-else
-  ac_cv_lib_pthread_pthread_mutex_init=no
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pthread_pthread_mutex_init" >&5
-$as_echo "$ac_cv_lib_pthread_pthread_mutex_init" >&6; }
-if test "x$ac_cv_lib_pthread_pthread_mutex_init" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_LIBPTHREAD 1
-_ACEOF
-
-  LIBS="-lpthread $LIBS"
-
-fi
-
-    if test $ac_cv_lib_pthread_pthread_mutex_init = yes; then
-      :
-    fi
-  fi
-
-  ac_fn_c_check_func "$LINENO" "pthread_mutex_lock" "ac_cv_func_pthread_mutex_lock"
-if test "x$ac_cv_func_pthread_mutex_lock" = xyes; then :
-
-fi
-
-
-  if test $ac_cv_func_pthread_mutex_lock = yes; then
-    :
-  fi
-fi
-# Check to see if we are using CygWin with MSVC
-case "${host}" in
-*-pc-cygwin*|*-pc-mingw*)
-  # For gcc, the thread options are set by mh-mingw/mh-cygwin
-  # For msvc, the thread options are set by runConfigureICU
-  :
-  ;;
-*-*-hpux*)
-  # Add -mt because it does several nice things on newer compilers.
-  case "${icu_cv_host_frag}" in
-    mh-hpux-acc)
-      OLD_CXXFLAGS="${CXXFLAGS}"
-      CXXFLAGS="${CXXFLAGS} -mt"
-      if test x"`${CXX} ${CXXFLAGS} 2>&1`" != x""; then
-         CXXFLAGS="${OLD_CXXFLAGS}"
-      else
-         UCONFIG_CXXFLAGS="${UCONFIG_CXXFLAGS} -mt"
-      fi
-    ;;
-  esac
-  ;;
-*-*-solaris*)
-  case "${icu_cv_host_frag}" in
-    mh-solaris)
-         LIBS="${LIBS} -mt"
-    ;;
-  esac
-  ;;
-esac
-
-# Check whether --enable-weak-threads was given.
-if test "${enable_weak_threads+set}" = set; then :
-  enableval=$enable_weak_threads; case "${enableval}" in
-		yes)
-            LIB_THREAD="${LIBS%${OLD_LIBS}}"
-            LIBS=${OLD_LIBS}
-            ;;
-		no)  ;;
-		*) as_fn_error $? "bad value ${enableval} for --enable-weak-threads" "$LINENO" 5 ;;
-		esac
-fi
-
-
-
-# Check for mmap()
-
-# The AC_FUNC_MMAP macro doesn't work properly.  It seems to be too specific.
-# Do this check instead.
-HAVE_MMAP=0
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for mmap" >&5
-$as_echo_n "checking for mmap... " >&6; }
-if ${ac_cv_func_mmap_ok+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <unistd.h>
-#include <sys/mman.h>
-#include <sys/stat.h>
-#include <fcntl.h>
-int
-main ()
-{
-mmap((void *)0, 0, PROT_READ, 0, 0, 0);
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_func_mmap_ok=yes
-else
-  ac_cv_func_mmap_ok=no
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-fi
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_func_mmap_ok" >&5
-$as_echo "$ac_cv_func_mmap_ok" >&6; }
-if test $ac_cv_func_mmap_ok = yes
-then
-    HAVE_MMAP=1
-else
-    CONFIG_CPPFLAGS="${CONFIG_CPPFLAGS} -DU_HAVE_MMAP=0"
-fi
-
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for genccode assembly" >&5
-$as_echo_n "checking for genccode assembly... " >&6; }
-
-# Check to see if genccode can generate simple assembly.
-GENCCODE_ASSEMBLY=
-case "${host}" in
-*-linux*|*-kfreebsd*-gnu*|i*86-*-*bsd*|i*86-pc-gnu)
-    if test "$GCC" = yes; then
-        # We're using gcc, and the simple -a gcc command line works for genccode
-        GENCCODE_ASSEMBLY="-a gcc"
-    fi ;;
-i*86-*-solaris*)
-    if test "$GCC" = yes; then
-        # When using gcc, look if we're also using GNU as.
-        # When using GNU as, the simple -a gcc command line works for genccode.
-        asv=`"${CC}" -print-prog-name=as 2>/dev/null`
-        asv=`"${asv}" --version 2>/dev/null`
-        case "X${asv}" in
-        X*GNU*) GENCCODE_ASSEMBLY="-a gcc" ;;
-        X*) GENCCODE_ASSEMBLY="-a sun-x86" ;;
-        esac
-        unset asv
-    else
-        GENCCODE_ASSEMBLY="-a sun-x86"
-    fi ;;
-sparc-*-solaris*)
-    GENCCODE_ASSEMBLY="-a sun"
-    ;;
-ia64-*-hpux*)
-# There has been some issues with building ICU data on HPUX ia64 aCC
-# when using the assemble code setting below.  For now, build without
-# assemble code for this platform.  This will increase the build time.
-#    GENCCODE_ASSEMBLY="-a aCC-ia64"
-    ;;
-esac
-
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $GENCCODE_ASSEMBLY" >&5
-$as_echo "$GENCCODE_ASSEMBLY" >&6; }
-
-# Checks for header files
-for ac_header in inttypes.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "inttypes.h" "ac_cv_header_inttypes_h" "$ac_includes_default"
-if test "x$ac_cv_header_inttypes_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_INTTYPES_H 1
-_ACEOF
-
-fi
-
-done
-
-if test $ac_cv_header_inttypes_h = no; then
- U_HAVE_INTTYPES_H=0
- CONFIG_CPPFLAGS="${CONFIG_CPPFLAGS} -DU_HAVE_INTTYPES_H=0"
-else
- U_HAVE_INTTYPES_H=1
-fi
-if test "$CC" = ccc; then
- { $as_echo "$as_me:${as_lineno-$LINENO}: result: \"C compiler set to CCC ${CC}\" " >&5
-$as_echo "\"C compiler set to CCC ${CC}\" " >&6; }
- case "${host}" in
-        alpha*-*-*) U_HAVE_INTTYPES_H=0;
-        CONFIG_CPPFLAGS="${CONFIG_CPPFLAGS} -DU_HAVE_INTTYPES_H=0"
- esac
-fi
-
-
-
-for ac_header in dirent.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "dirent.h" "ac_cv_header_dirent_h" "$ac_includes_default"
-if test "x$ac_cv_header_dirent_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_DIRENT_H 1
-_ACEOF
-
-fi
-
-done
-
-if test $ac_cv_header_dirent_h = no; then
- U_HAVE_DIRENT_H=0
- CONFIG_CPPFLAGS="${CONFIG_CPPFLAGS} -DU_HAVE_DIRENT_H=0"
-else
- U_HAVE_DIRENT_H=1
-fi
-
-
-
-# Check for endianness
- { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether byte ordering is bigendian" >&5
-$as_echo_n "checking whether byte ordering is bigendian... " >&6; }
-if ${ac_cv_c_bigendian+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_cv_c_bigendian=unknown
-    # See if we're dealing with a universal compiler.
-    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#ifndef __APPLE_CC__
-	       not a universal capable compiler
-	     #endif
-	     typedef int dummy;
-
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-
-	# Check for potential -arch flags.  It is not universal unless
-	# there are at least two -arch flags with different values.
-	ac_arch=
-	ac_prev=
-	for ac_word in $CC $CFLAGS $CPPFLAGS $LDFLAGS; do
-	 if test -n "$ac_prev"; then
-	   case $ac_word in
-	     i?86 | x86_64 | ppc | ppc64)
-	       if test -z "$ac_arch" || test "$ac_arch" = "$ac_word"; then
-		 ac_arch=$ac_word
-	       else
-		 ac_cv_c_bigendian=universal
-		 break
-	       fi
-	       ;;
-	   esac
-	   ac_prev=
-	 elif test "x$ac_word" = "x-arch"; then
-	   ac_prev=arch
-	 fi
-       done
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-    if test $ac_cv_c_bigendian = unknown; then
-      # See if sys/param.h defines the BYTE_ORDER macro.
-      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <sys/types.h>
-	     #include <sys/param.h>
-
-int
-main ()
-{
-#if ! (defined BYTE_ORDER && defined BIG_ENDIAN \
-		     && defined LITTLE_ENDIAN && BYTE_ORDER && BIG_ENDIAN \
-		     && LITTLE_ENDIAN)
-	      bogus endian macros
-	     #endif
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  # It does; now see whether it defined to BIG_ENDIAN or not.
-	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <sys/types.h>
-		#include <sys/param.h>
-
-int
-main ()
-{
-#if BYTE_ORDER != BIG_ENDIAN
-		 not big endian
-		#endif
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  ac_cv_c_bigendian=yes
-else
-  ac_cv_c_bigendian=no
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-    fi
-    if test $ac_cv_c_bigendian = unknown; then
-      # See if <limits.h> defines _LITTLE_ENDIAN or _BIG_ENDIAN (e.g., Solaris).
-      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <limits.h>
-
-int
-main ()
-{
-#if ! (defined _LITTLE_ENDIAN || defined _BIG_ENDIAN)
-	      bogus endian macros
-	     #endif
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  # It does; now see whether it defined to _BIG_ENDIAN or not.
-	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <limits.h>
-
-int
-main ()
-{
-#ifndef _BIG_ENDIAN
-		 not big endian
-		#endif
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  ac_cv_c_bigendian=yes
-else
-  ac_cv_c_bigendian=no
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-    fi
-    if test $ac_cv_c_bigendian = unknown; then
-      # Compile a test program.
-      if test "$cross_compiling" = yes; then :
-  # Try to guess by grepping values from an object file.
-	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-short int ascii_mm[] =
-		  { 0x4249, 0x4765, 0x6E44, 0x6961, 0x6E53, 0x7953, 0 };
-		short int ascii_ii[] =
-		  { 0x694C, 0x5454, 0x656C, 0x6E45, 0x6944, 0x6E61, 0 };
-		int use_ascii (int i) {
-		  return ascii_mm[i] + ascii_ii[i];
-		}
-		short int ebcdic_ii[] =
-		  { 0x89D3, 0xE3E3, 0x8593, 0x95C5, 0x89C4, 0x9581, 0 };
-		short int ebcdic_mm[] =
-		  { 0xC2C9, 0xC785, 0x95C4, 0x8981, 0x95E2, 0xA8E2, 0 };
-		int use_ebcdic (int i) {
-		  return ebcdic_mm[i] + ebcdic_ii[i];
-		}
-		extern int foo;
-
-int
-main ()
-{
-return use_ascii (foo) == use_ebcdic (foo);
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  if grep BIGenDianSyS conftest.$ac_objext >/dev/null; then
-	      ac_cv_c_bigendian=yes
-	    fi
-	    if grep LiTTleEnDian conftest.$ac_objext >/dev/null ; then
-	      if test "$ac_cv_c_bigendian" = unknown; then
-		ac_cv_c_bigendian=no
-	      else
-		# finding both strings is unlikely to happen, but who knows?
-		ac_cv_c_bigendian=unknown
-	      fi
-	    fi
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-
-	     /* Are we little or big endian?  From Harbison&Steele.  */
-	     union
-	     {
-	       long int l;
-	       char c[sizeof (long int)];
-	     } u;
-	     u.l = 1;
-	     return u.c[sizeof (long int) - 1] == 1;
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_run "$LINENO"; then :
-  ac_cv_c_bigendian=no
-else
-  ac_cv_c_bigendian=yes
-fi
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
-  conftest.$ac_objext conftest.beam conftest.$ac_ext
-fi
-
-    fi
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_c_bigendian" >&5
-$as_echo "$ac_cv_c_bigendian" >&6; }
- case $ac_cv_c_bigendian in #(
-   yes)
-     $as_echo "#define WORDS_BIGENDIAN 1" >>confdefs.h
-;; #(
-   no)
-      ;; #(
-   universal)
-
-$as_echo "#define AC_APPLE_UNIVERSAL_BUILD 1" >>confdefs.h
-
-     ;; #(
-   *)
-     as_fn_error $? "unknown endianness
- presetting ac_cv_c_bigendian=no (or yes) will help" "$LINENO" 5 ;;
- esac
-
-if test $ac_cv_c_bigendian = no; then
-U_IS_BIG_ENDIAN=0
-U_ENDIAN_CHAR="l"
-else
-U_IS_BIG_ENDIAN=1
-U_ENDIAN_CHAR="b"
-fi
-
-
-# Do various POSIX related checks
-U_HAVE_NL_LANGINFO_CODESET=0
-U_NL_LANGINFO_CODESET=-1
-ac_fn_c_check_func "$LINENO" "nl_langinfo" "ac_cv_func_nl_langinfo"
-if test "x$ac_cv_func_nl_langinfo" = xyes; then :
-  U_HAVE_NL_LANGINFO=1
-else
-  U_HAVE_NL_LANGINFO=0
-fi
-
-if test $U_HAVE_NL_LANGINFO -eq 1; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for nl_langinfo's argument to obtain the codeset" >&5
-$as_echo_n "checking for nl_langinfo's argument to obtain the codeset... " >&6; }
-if ${ac_cv_nl_langinfo_codeset+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_cv_nl_langinfo_codeset="unknown"
-  for a in CODESET _NL_CTYPE_CODESET_NAME; do
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <langinfo.h>
-int
-main ()
-{
-nl_langinfo($a);
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_nl_langinfo_codeset="$a"; break
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-  done
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_nl_langinfo_codeset" >&5
-$as_echo "$ac_cv_nl_langinfo_codeset" >&6; }
-  if test x$ac_cv_nl_langinfo_codeset != xunknown
-  then
-      U_HAVE_NL_LANGINFO_CODESET=1
-      U_NL_LANGINFO_CODESET=$ac_cv_nl_langinfo_codeset
-      if test "x${ac_cv_nl_langinfo_codeset}" != "xCODESET"
-      then
-        CONFIG_CPPFLAGS="${CONFIG_CPPFLAGS} -DNL_LANGINFO_CODESET=${ac_cv_nl_langinfo_codeset}"
-      fi
-  else
-      CONFIG_CPPFLAGS="${CONFIG_CPPFLAGS} -DU_HAVE_NL_LANGINFO_CODESET=0"
-  fi
-fi
-
-
-
-# Namespace support checks
-ac_ext=cpp
-ac_cpp='$CXXCPP $CPPFLAGS'
-ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for namespace support" >&5
-$as_echo_n "checking for namespace support... " >&6; }
-if ${ac_cv_namespace_ok+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-namespace x_version {void f(){}}
-    namespace x = x_version;
-    using namespace x_version;
-
-int
-main ()
-{
-f();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_cxx_try_link "$LINENO"; then :
-  ac_cv_namespace_ok=yes
-else
-  ac_cv_namespace_ok=no
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-fi
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_namespace_ok" >&5
-$as_echo "$ac_cv_namespace_ok" >&6; }
-if test $ac_cv_namespace_ok = no
-then
-    as_fn_error $? "Namespace support is required to build ICU." "$LINENO" 5
-fi
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for properly overriding new and delete" >&5
-$as_echo_n "checking for properly overriding new and delete... " >&6; }
-U_OVERRIDE_CXX_ALLOCATION=0
-U_HAVE_PLACEMENT_NEW=0
-if ${ac_cv_override_cxx_allocation_ok+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <stdlib.h>
-    class UMemory {
-    public:
-    void *operator new(size_t size) {return malloc(size);}
-    void *operator new[](size_t size) {return malloc(size);}
-    void operator delete(void *p) {free(p);}
-    void operator delete[](void *p) {free(p);}
-    };
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_cxx_try_link "$LINENO"; then :
-  ac_cv_override_cxx_allocation_ok=yes
-else
-  ac_cv_override_cxx_allocation_ok=no
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-fi
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_override_cxx_allocation_ok" >&5
-$as_echo "$ac_cv_override_cxx_allocation_ok" >&6; }
-if test $ac_cv_override_cxx_allocation_ok = yes
-then
-    U_OVERRIDE_CXX_ALLOCATION=1
-    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for placement new and delete" >&5
-$as_echo_n "checking for placement new and delete... " >&6; }
-    if ${ac_cv_override_placement_new_ok+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <stdlib.h>
-        class UMemory {
-        public:
-        void *operator new(size_t size) {return malloc(size);}
-        void *operator new[](size_t size) {return malloc(size);}
-        void operator delete(void *p) {free(p);}
-        void operator delete[](void *p) {free(p);}
-        void * operator new(size_t, void *ptr) { return ptr; }
-        void operator delete(void *, void *) {}
-        };
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_cxx_try_link "$LINENO"; then :
-  ac_cv_override_placement_new_ok=yes
-else
-  ac_cv_override_placement_new_ok=no
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-fi
-
-    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_override_placement_new_ok" >&5
-$as_echo "$ac_cv_override_placement_new_ok" >&6; }
-    if test $ac_cv_override_placement_new_ok = yes
-    then
-        U_HAVE_PLACEMENT_NEW=1
-    else
-        CONFIG_CPPFLAGS="${CONFIG_CPPFLAGS} -DU_HAVE_PLACEMENT_NEW=0"
-    fi
-else
-    CONFIG_CPPFLAGS="${CONFIG_CPPFLAGS} -DU_OVERRIDE_CXX_ALLOCATION=0"
-fi
-
-
-
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-
-ac_fn_c_check_func "$LINENO" "popen" "ac_cv_func_popen"
-if test "x$ac_cv_func_popen" = xyes; then :
-
-fi
-
-if test x$ac_cv_func_popen = xyes
-then
-     U_HAVE_POPEN=1
-else
-     CONFIG_CPPFLAGS="${CONFIG_CPPFLAGS} -DU_HAVE_POPEN=0"
-     U_HAVE_POPEN=0
-fi
-
-
-ac_fn_c_check_func "$LINENO" "tzset" "ac_cv_func_tzset"
-if test "x$ac_cv_func_tzset" = xyes; then :
-
-fi
-
-U_HAVE_TZSET=0
-if test x$ac_cv_func_tzset = xyes
-then
-    U_TZSET=tzset
-    U_HAVE_TZSET=1
-else
-    ac_fn_c_check_func "$LINENO" "_tzset" "ac_cv_func__tzset"
-if test "x$ac_cv_func__tzset" = xyes; then :
-
-fi
-
-    if test x$ac_cv_func__tzset = xyes
-    then
-        U_TZSET=_tzset
-        U_HAVE_TZSET=1
-    else
-      CONFIG_CPPFLAGS="${CONFIG_CPPFLAGS} -DU_HAVE_TZSET=0"
-    fi
-fi
-
-
-
-U_HAVE_TZNAME=0
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for tzname" >&5
-$as_echo_n "checking for tzname... " >&6; }
-if ${ac_cv_var_tzname+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#ifndef __USE_POSIX
-#define __USE_POSIX
-#endif
-#include <stdlib.h>
-#include <time.h>
-#ifndef tzname /* For SGI.  */
-extern char *tzname[]; /* RS6000 and others reject char **tzname.  */
-#endif
-int
-main ()
-{
-atoi(*tzname);
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_var_tzname=yes
-else
-  ac_cv_var_tzname=no
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_var_tzname" >&5
-$as_echo "$ac_cv_var_tzname" >&6; }
-if test $ac_cv_var_tzname = yes; then
-  U_TZNAME=tzname
-  U_HAVE_TZNAME=1
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for _tzname" >&5
-$as_echo_n "checking for _tzname... " >&6; }
-if ${ac_cv_var__tzname+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <stdlib.h>
-  #include <time.h>
-  extern char *_tzname[];
-int
-main ()
-{
-atoi(*_tzname);
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_var__tzname=yes
-else
-  ac_cv_var__tzname=no
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_var__tzname" >&5
-$as_echo "$ac_cv_var__tzname" >&6; }
-    if test $ac_cv_var__tzname = yes; then
-      U_TZNAME=_tzname
-      U_HAVE_TZNAME=1
-    else
-     CONFIG_CPPFLAGS="${CONFIG_CPPFLAGS} -DU_HAVE_TZNAME=0"
-    fi
-fi
-
-
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for timezone" >&5
-$as_echo_n "checking for timezone... " >&6; }
-if ${ac_cv_var_timezone+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#ifndef __USE_POSIX
-#define __USE_POSIX
-#endif
-#ifndef __USE_XOPEN
-#define __USE_XOPEN
-#endif
-#include <time.h>
-
-int
-main ()
-{
-timezone = 1;
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_var_timezone=yes
-else
-  ac_cv_var_timezone=no
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_var_timezone" >&5
-$as_echo "$ac_cv_var_timezone" >&6; }
-U_HAVE_TIMEZONE=0
-if test $ac_cv_var_timezone = yes; then
-  U_TIMEZONE=timezone
-  U_HAVE_TIMEZONE=1
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for __timezone" >&5
-$as_echo_n "checking for __timezone... " >&6; }
-if ${ac_cv_var___timezone+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <time.h>
-int
-main ()
-{
-__timezone = 1;
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_var___timezone=yes
-else
-  ac_cv_var___timezone=no
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_var___timezone" >&5
-$as_echo "$ac_cv_var___timezone" >&6; }
-  if test $ac_cv_var___timezone = yes; then
-    U_TIMEZONE=__timezone
-    U_HAVE_TIMEZONE=1
-  else
-    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for _timezone" >&5
-$as_echo_n "checking for _timezone... " >&6; }
-if ${ac_cv_var__timezone+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <time.h>
-int
-main ()
-{
-_timezone = 1;
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_var__timezone=yes
-else
-  ac_cv_var__timezone=no
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_var__timezone" >&5
-$as_echo "$ac_cv_var__timezone" >&6; }
-    if test $ac_cv_var__timezone = yes; then
-      U_TIMEZONE=_timezone
-      U_HAVE_TIMEZONE=1
-    else
-     CONFIG_CPPFLAGS="${CONFIG_CPPFLAGS} -DU_HAVE_TIMEZONE=0"
-    fi
-  fi
-fi
-
-
-
-# Checks for typedefs
-ac_fn_c_check_type "$LINENO" "int8_t" "ac_cv_type_int8_t" "$ac_includes_default"
-if test "x$ac_cv_type_int8_t" = xyes; then :
-
-else
-
-cat >>confdefs.h <<_ACEOF
-#define int8_t signed char
-_ACEOF
-
-fi
-
-ac_fn_c_check_type "$LINENO" "uint8_t" "ac_cv_type_uint8_t" "$ac_includes_default"
-if test "x$ac_cv_type_uint8_t" = xyes; then :
-
-else
-
-cat >>confdefs.h <<_ACEOF
-#define uint8_t unsigned char
-_ACEOF
-
-fi
-
-ac_fn_c_check_type "$LINENO" "int16_t" "ac_cv_type_int16_t" "$ac_includes_default"
-if test "x$ac_cv_type_int16_t" = xyes; then :
-
-else
-
-cat >>confdefs.h <<_ACEOF
-#define int16_t signed short
-_ACEOF
-
-fi
-
-ac_fn_c_check_type "$LINENO" "uint16_t" "ac_cv_type_uint16_t" "$ac_includes_default"
-if test "x$ac_cv_type_uint16_t" = xyes; then :
-
-else
-
-cat >>confdefs.h <<_ACEOF
-#define uint16_t unsigned short
-_ACEOF
-
-fi
-
-ac_fn_c_check_type "$LINENO" "int32_t" "ac_cv_type_int32_t" "$ac_includes_default"
-if test "x$ac_cv_type_int32_t" = xyes; then :
-
-else
-
-cat >>confdefs.h <<_ACEOF
-#define int32_t signed long
-_ACEOF
-
-fi
-
-ac_fn_c_check_type "$LINENO" "uint32_t" "ac_cv_type_uint32_t" "$ac_includes_default"
-if test "x$ac_cv_type_uint32_t" = xyes; then :
-
-else
-
-cat >>confdefs.h <<_ACEOF
-#define uint32_t unsigned long
-_ACEOF
-
-fi
-
-ac_fn_c_check_type "$LINENO" "int64_t" "ac_cv_type_int64_t" "$ac_includes_default"
-if test "x$ac_cv_type_int64_t" = xyes; then :
-
-else
-
-cat >>confdefs.h <<_ACEOF
-#define int64_t signed long long
-_ACEOF
-
-fi
-
-ac_fn_c_check_type "$LINENO" "uint64_t" "ac_cv_type_uint64_t" "$ac_includes_default"
-if test "x$ac_cv_type_uint64_t" = xyes; then :
-
-else
-
-cat >>confdefs.h <<_ACEOF
-#define uint64_t unsigned long long
-_ACEOF
-
-fi
-
-
-if test $ac_cv_type_int8_t = no; then
-CONFIG_CPPFLAGS="${CONFIG_CPPFLAGS} -DU_HAVE_INT8_T=0"
-fi
-
-if test $ac_cv_type_uint8_t = no; then
-CONFIG_CPPFLAGS="${CONFIG_CPPFLAGS} -DU_HAVE_UINT8_T=0"
-fi
-
-if test $ac_cv_type_int16_t = no; then
-CONFIG_CPPFLAGS="${CONFIG_CPPFLAGS} -DU_HAVE_INT16_T=0"
-fi
-
-if test $ac_cv_type_uint16_t = no; then
-CONFIG_CPPFLAGS="${CONFIG_CPPFLAGS} -DU_HAVE_UINT16_T=0"
-fi
-
-if test $ac_cv_type_int32_t = no; then
-CONFIG_CPPFLAGS="${CONFIG_CPPFLAGS} -DU_HAVE_INT32_T=0"
-fi
-
-if test $ac_cv_type_uint32_t = no; then
-CONFIG_CPPFLAGS="${CONFIG_CPPFLAGS} -DU_HAVE_UINT32_T=0"
-fi
-
-if test $ac_cv_type_int64_t = no; then
-CONFIG_CPPFLAGS="${CONFIG_CPPFLAGS} -DU_HAVE_INT64_T=0"
-fi
-
-if test $ac_cv_type_uint64_t = no; then
-CONFIG_CPPFLAGS="${CONFIG_CPPFLAGS} -DU_HAVE_UINT64_T=0"
-fi
-
-# Do various wchar_t related checks
-ac_fn_c_check_header_mongrel "$LINENO" "wchar.h" "ac_cv_header_wchar_h" "$ac_includes_default"
-if test "x$ac_cv_header_wchar_h" = xyes; then :
-
-fi
-
-
-if test "$ac_cv_header_wchar_h" = no
-then
-    U_HAVE_WCHAR_H=0
-    U_HAVE_WCSCPY=0
-    CONFIG_CPPFLAGS="${CONFIG_CPPFLAGS} -DU_HAVE_WCHAR_H=0 -DU_HAVE_WCSCPY=0"
-else
-
-$as_echo "#define HAVE_WCHAR_H 1" >>confdefs.h
-
-    U_HAVE_WCHAR_H=1
-    # Some broken systems have wchar.h but not some of its functions...
-    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing wcscpy" >&5
-$as_echo_n "checking for library containing wcscpy... " >&6; }
-if ${ac_cv_search_wcscpy+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_func_search_save_LIBS=$LIBS
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char wcscpy ();
-int
-main ()
-{
-return wcscpy ();
-  ;
-  return 0;
-}
-_ACEOF
-for ac_lib in '' wcs w; do
-  if test -z "$ac_lib"; then
-    ac_res="none required"
-  else
-    ac_res=-l$ac_lib
-    LIBS="-l$ac_lib  $ac_func_search_save_LIBS"
-  fi
-  if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_search_wcscpy=$ac_res
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext
-  if ${ac_cv_search_wcscpy+:} false; then :
-  break
-fi
-done
-if ${ac_cv_search_wcscpy+:} false; then :
-
-else
-  ac_cv_search_wcscpy=no
-fi
-rm conftest.$ac_ext
-LIBS=$ac_func_search_save_LIBS
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_search_wcscpy" >&5
-$as_echo "$ac_cv_search_wcscpy" >&6; }
-ac_res=$ac_cv_search_wcscpy
-if test "$ac_res" != no; then :
-  test "$ac_res" = "none required" || LIBS="$ac_res $LIBS"
-
-fi
-
-    if test "$ac_cv_search_wcscpy" != no; then
-      U_HAVE_WCSCPY=1
-    else
-      U_HAVE_WCSCPY=0
-      CONFIG_CPPFLAGS="${CONFIG_CPPFLAGS} -DU_HAVE_WCSCPY=0"
-    fi
-fi
-
-
-
-# The cast to long int works around a bug in the HP C Compiler
-# version HP92453-01 B.11.11.23709.GP, which incorrectly rejects
-# declarations like `int a3[[(sizeof (unsigned char)) >= 0]];'.
-# This bug is HP SR number 8606223364.
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking size of wchar_t" >&5
-$as_echo_n "checking size of wchar_t... " >&6; }
-if ${ac_cv_sizeof_wchar_t+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  if ac_fn_c_compute_int "$LINENO" "(long int) (sizeof (wchar_t))" "ac_cv_sizeof_wchar_t"        "
-#if STDC_HEADERS
-#include <stddef.h>
-#endif
-#include <stdlib.h>
-#if HAVE_WCHAR_H
-#include <string.h>
-#include <wchar.h>
-#endif
-"; then :
-
-else
-  if test "$ac_cv_type_wchar_t" = yes; then
-     { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error 77 "cannot compute sizeof (wchar_t)
-See \`config.log' for more details" "$LINENO" 5; }
-   else
-     ac_cv_sizeof_wchar_t=0
-   fi
-fi
-
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_sizeof_wchar_t" >&5
-$as_echo "$ac_cv_sizeof_wchar_t" >&6; }
-
-
-
-cat >>confdefs.h <<_ACEOF
-#define SIZEOF_WCHAR_T $ac_cv_sizeof_wchar_t
-_ACEOF
-
-
-U_SIZEOF_WCHAR_T=$ac_cv_sizeof_wchar_t
-# We do this check to verify that everything is okay.
-if test $U_SIZEOF_WCHAR_T = 0; then
-    if test $U_HAVE_WCHAR_H=1; then
-       as_fn_error $? "There is wchar.h but the size of wchar_t is 0" "$LINENO" 5
-    fi
-fi
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for UTF-16 string literal support" >&5
-$as_echo_n "checking for UTF-16 string literal support... " >&6; }
-U_CHECK_UTF16_STRING=1
-CHECK_UTF16_STRING_RESULT="unknown"
-
-case "${host}" in
-*-*-aix*|powerpc64-*-linux*)
-    if test "$GCC" = no; then
-        OLD_CFLAGS="${CFLAGS}"
-        OLD_CXXFLAGS="${CXXFLAGS}"
-        CFLAGS="${CFLAGS} -qutf"
-        CXXFLAGS="${CXXFLAGS} -qutf"
-        cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-const unsigned short hello[] = u"hello";
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  U_CHECK_UTF16_STRING=1
-else
-  U_CHECK_UTF16_STRING=0
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-        if test "$U_CHECK_UTF16_STRING" = 0; then
-            CFLAGS="${OLD_CFLAGS}"
-            CXXFLAGS="${OLD_CXXFLAGS}"
-        else
-            UCONFIG_CXXFLAGS="${UCONFIG_CXXFLAGS} -qutf"
-            CHECK_UTF16_STRING_RESULT="-qutf"
-        fi
-    fi
-    ;;
-*-*-solaris*)
-    if test "$GCC" = no; then
-        OLD_CFLAGS="${CFLAGS}"
-        OLD_CXXFLAGS="${CXXFLAGS}"
-        CFLAGS="${CFLAGS} -xustr=ascii_utf16_ushort"
-        CXXFLAGS="${CXXFLAGS} -xustr=ascii_utf16_ushort"
-        cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-const unsigned short hello[] = U"hello";
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  U_CHECK_UTF16_STRING=1
-else
-  U_CHECK_UTF16_STRING=0
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-        if test "$U_CHECK_UTF16_STRING" = 0; then
-            CFLAGS="${OLD_CFLAGS}"
-            CXXFLAGS="${OLD_CXXFLAGS}"
-        else
-            CHECK_UTF16_STRING_RESULT="-xustr=ascii_utf16_ushort"
-            UCONFIG_CXXFLAGS="${UCONFIG_CXXFLAGS} -xustr=ascii_utf16_ushort"
-            UCONFIG_CFLAGS="${UCONFIG_CFLAGS} -xustr=ascii_utf16_ushort"
-            # Since we can't detect the availability of this UTF-16 syntax at compile time,
-            # we depend on configure telling us that we can use it.
-            # Since we can't ensure ICU users use -xustr=ascii_utf16_ushort,
-            # we only use this macro within ICU.
-            # If an ICU user uses icu-config, this feature will be enabled.
-            CONFIG_CPPFLAGS="${CONFIG_CPPFLAGS} -DU_CHECK_UTF16_STRING=1"
-            U_CHECK_UTF16_STRING=0
-        fi
-    fi
-    ;;
-*-*-hpux*)
-    if test "$GCC" = no; then
-        # The option will be detected at compile time without additional compiler options.
-        CHECK_UTF16_STRING_RESULT="available"
-    fi
-    ;;
-*-*-cygwin)
-    # wchar_t can be used
-    CHECK_UTF16_STRING_RESULT="available"
-    ;;
-*)
-    ;;
-esac
-
-# GCC >= 4.4 supports UTF16 string literals. The CFLAGS and CXXFLAGS may change in the future.
-if test "$CHECK_UTF16_STRING_RESULT" = "unknown"; then
-    if test "$GCC" = yes; then
-        OLD_CFLAGS="${CFLAGS}"
-        CFLAGS="${CFLAGS} -std=gnu99"
-        cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-static const char16_t test[] = u"This is a UTF16 literal string.";
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  CC_UTF16_STRING=1
-else
-  CC_UTF16_STRING=0
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-        if test "$CC_UTF16_STRING" = 1; then
-            UCONFIG_CFLAGS="${UCONFIG_CFLAGS} -std=gnu99"
-            CHECK_UTF16_STRING_RESULT="C only";
-        else
-            CFLAGS="${OLD_CFLAGS}"
-        fi
-    fi
-    if test "$GXX" = yes; then
-        # -Wno-return-type-c-linkage is desired so that stable ICU API is not warned about.
-        ac_ext=cpp
-ac_cpp='$CXXCPP $CPPFLAGS'
-ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
-
-        cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-static const char16_t test[] = u"This is a UTF16 literal string.";
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_cxx_try_compile "$LINENO"; then :
-  CXX_UTF16_STRING=1
-else
-  CXX_UTF16_STRING=0
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-        ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-
-        if test "$CXX_UTF16_STRING" = 1; then
-            if test "$CC_UTF16_STRING" = 1; then
-                CHECK_UTF16_STRING_RESULT="available";
-            else
-                CHECK_UTF16_STRING_RESULT="C++ only";
-            fi
-        fi
-    fi
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $CHECK_UTF16_STRING_RESULT" >&5
-$as_echo "$CHECK_UTF16_STRING_RESULT" >&6; }
-
-# Enable/disable extras
-# Check whether --enable-extras was given.
-if test "${enable_extras+set}" = set; then :
-  enableval=$enable_extras; case "${enableval}" in
-		yes) extras=true ;;
-		no)  extras=false ;;
-		*) as_fn_error $? "bad value ${enableval} for --enable-extras" "$LINENO" 5 ;;
-		esac
-else
-  extras=true
-fi
-
-
-
-if test "$extras" = true; then
-  EXTRAS_TRUE=
-  U_HAVE_EXTRAS=1
-else
-  EXTRAS_TRUE='#'
-  U_HAVE_EXTRAS=0
-fi
-# Check whether --enable-icuio was given.
-if test "${enable_icuio+set}" = set; then :
-  enableval=$enable_icuio; case "${enableval}" in
-		yes) icuio=true ;;
-		no)  icuio=false ;;
-		*) as_fn_error $? "bad value ${enableval} for --enable-icuio" "$LINENO" 5 ;;
-		esac
-else
-  icuio=true
-fi
-
-
-
-if test "$icuio" = true; then
-  ICUIO_TRUE=
-  U_HAVE_ICUIO=1
-else
-  ICUIO_TRUE='#'
-  U_HAVE_ICUIO=0
-fi
-
-# Enable/disable layout
-# Check whether --enable-layout was given.
-if test "${enable_layout+set}" = set; then :
-  enableval=$enable_layout; case "${enableval}" in
-		yes) layout=true ;;
-		no)  layout=false ;;
-		*) as_fn_error $? "bad value ${enableval} for --enable-layout" "$LINENO" 5 ;;
-		esac
-else
-  layout=true
-fi
-
-
-
-if test "$layout" = true; then
-  LAYOUT_TRUE=
-  U_HAVE_LAYOUT=1
-else
-  LAYOUT_TRUE='#'
-  U_HAVE_LAYOUT=0
-fi
-
-# Enable/disable layoutex
-# Check whether --enable-layoutex was given.
-if test "${enable_layoutex+set}" = set; then :
-  enableval=$enable_layoutex; case "${enableval}" in
-		yes) layoutex=true ;;
-		no)  layoutex=false ;;
-		*) as_fn_error $? "bad value ${enableval} for --enable-layoutex" "$LINENO" 5 ;;
-		esac
-else
-  layoutex=$layout
-fi
-
-
-
-if test "$layoutex" = true; then
-  LAYOUTEX_TRUE=
-  U_HAVE_LAYOUTEX=1
-else
-  LAYOUTEX_TRUE='#'
-  U_HAVE_LAYOUTEX=0
-fi
-
-# Enable/disable tools
-# Check whether --enable-tools was given.
-if test "${enable_tools+set}" = set; then :
-  enableval=$enable_tools; case "${enableval}" in
-		yes) tools=true ;;
-		no)  tools=false ;;
-		*) as_fn_error $? "bad value ${enableval} for --enable-tools" "$LINENO" 5 ;;
-		esac
-else
-  tools=true
-fi
-
-
-
-if test "$tools" = true; then
-  TOOLS_TRUE=
-  U_HAVE_TOOLS=1
-else
-  TOOLS_TRUE='#'
-  U_HAVE_TOOLS=0
-fi
-
-
-# Check whether --with-data-packaging was given.
-if test "${with_data_packaging+set}" = set; then :
-  withval=$with_data_packaging; case "${withval}" in
-                files|archive|library) datapackaging=$withval ;;
-		auto) datapackaging=$withval ;;
-		common) datapackaging=archive ;;
-		dll) datapackaging=library ;;
-		static) datapackaging=static ;;
-		*) as_fn_error $? "bad value ${withval} for --with-data-packaging" "$LINENO" 5 ;;
-		esac
-else
-  datapackaging=
-fi
-
-
-# Note:  'thesysconfdir' is an evaluated version, for Man pages, so also for thedatadir, thelibdir, etc..
-# thesysconfdir=`eval echo $sysconfdir`
-thedatadir=`eval echo $datadir`
-# Always put raw data files in share/icu/{version}, etc.   Never use lib/icu/{version} for data files.. Actual shared libraries will go in {libdir}.
-pkgicudatadir=$datadir
-thepkgicudatadir=$thedatadir
-
-
-
-
-if test x"$datapackaging" = x -o x"$datapackaging" = xauto; then
-	# default to library
-	datapackaging=library
-	if test "$ENABLE_STATIC" = "YES"; then
-		if test "$ENABLE_SHARED" != "YES"; then
-			datapackaging=static
-		fi
-	fi
-fi
-
-datapackaging_dir=`eval echo $thedatadir`"/icu/${VERSION}"
-
-datapackaging_msg="(No explaination for mode $datapackaging.)"
-
-datapackaging_msg_path="ICU will look in $datapackaging_dir which is the installation location. Call u_setDataDirectory() or use the ICU_DATA environment variable to override."
-datapackaging_msg_set="ICU will use the linked data library. If linked with the stub library located in stubdata/, the application can use udata_setCommonData() or set a data path to override."
-datapackaging_howfound="(unknown)"
-
-case "$datapackaging" in
-    files)
-    DATA_PACKAGING_MODE=files
-    datapackaging_msg="ICU data will be stored in individual files."
-    datapackaging_howfound="$datapackaging_msg_path"
-    ;;
-    archive)
-    DATA_PACKAGING_MODE=common
-    datapackaging_msg="ICU data will be stored in a single .dat file."
-    datapackaging_howfound="$datapackaging_msg_path"
-    ;;
-    library)
-    DATA_PACKAGING_MODE=dll
-    datapackaging_msg="ICU data will be linked with ICU."
-    if test "$ENABLE_STATIC" = "YES"; then
-        datapackaging_msg="$datapackaging_msg A static data library will be built. "
-    fi
-    if test "$ENABLE_SHARED" = "YES"; then
-        datapackaging_msg="$datapackaging_msg A shared data library will be built. "
-    fi
-    datapackaging_howfound="$datapackaging_msg_set"
-    ;;
-    static)
-    DATA_PACKAGING_MODE=static
-    datapackaging_msg="ICU data will be stored in a static library."
-    datapackaging_howfound="$datapackaging_msg_set"
-    ;;
-esac
-
-
-# Sets a library suffix
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for a library suffix to use" >&5
-$as_echo_n "checking for a library suffix to use... " >&6; }
-
-# Check whether --with-library-suffix was given.
-if test "${with_library_suffix+set}" = set; then :
-  withval=$with_library_suffix; ICULIBSUFFIX="${withval}"
-else
-  ICULIBSUFFIX=
-fi
-
-msg=$ICULIBSUFFIX
-if test "$msg" = ""; then
-    msg=none
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $msg" >&5
-$as_echo "$msg" >&6; }
-
-if test "$ICULIBSUFFIX" != ""
-then
-    U_HAVE_LIB_SUFFIX=1
-    ICULIBSUFFIXCNAME=`echo _$ICULIBSUFFIX | sed 's/^A-Za-z0-9_/_/g'`
-    UCONFIG_CPPFLAGS="${UCONFIG_CPPFLAGS} -DU_HAVE_LIB_SUFFIX=1 -DU_LIB_SUFFIX_C_NAME=${ICULIBSUFFIXCNAME} "
-else
-    U_HAVE_LIB_SUFFIX=0
-fi
-
-
-
-# Enable/disable tests
-# Check whether --enable-tests was given.
-if test "${enable_tests+set}" = set; then :
-  enableval=$enable_tests; case "${enableval}" in
-		yes) tests=true ;;
-		no)  tests=false ;;
-		*) as_fn_error $? "bad value ${enableval} for --enable-tests" "$LINENO" 5 ;;
-		esac
-else
-  tests=true
-fi
-
-
-
-if test "$tests" = true; then
-  TESTS_TRUE=
-  U_HAVE_TESTS=1
-else
-  TESTS_TRUE='#'
-  U_HAVE_TESTS=0
-fi
-
-# Enable/disable samples
-# Check whether --enable-samples was given.
-if test "${enable_samples+set}" = set; then :
-  enableval=$enable_samples; case "${enableval}" in
-		yes) samples=true ;;
-		no)  samples=false ;;
-		*) as_fn_error $? "bad value ${enableval} for --enable-samples" "$LINENO" 5 ;;
-		esac
-else
-  samples=true
-fi
-
-
-
-if test "$samples" = true; then
-  SAMPLES_TRUE=
-  U_HAVE_SAMPLES=1
-else
-  SAMPLES_TRUE='#'
-  U_HAVE_SAMPLES=0
-fi
-
-ICUDATA_CHAR=$U_ENDIAN_CHAR
-
-# Platform-specific Makefile setup
-# set ICUDATA_CHAR to 'e' for any EBCDIC (which should be big endian) platform.
-case "${host}" in
-	*-*-solaris*) 	platform=U_SOLARIS ;;
-	*-*-linux*|*-*-gnu|*-*-k*bsd*-gnu|*-*-kopensolaris*-gnu)        platform=U_LINUX ;;
-	*-*-*bsd*|*-*-dragonfly*) 	platform=U_BSD ;;
-	*-*-aix*) 	platform=U_AIX ;;
-	*-*-hpux*) 	platform=U_HPUX ;;
-	*-apple-darwin*|*-apple-rhapsody*)	platform=U_DARWIN ;;
-	*-*-cygwin*)	platform=U_CYGWIN ;;
-	*-*-mingw*)	platform=U_MINGW ;;
-	*-*ibm-openedition*|*-*-os390*)	platform=OS390
-			if test "${ICU_ENABLE_ASCII_STRINGS}" != "1"; then
-				ICUDATA_CHAR="e"
-			fi ;;
-	*-*-os400*)	platform=OS400
-			if test "${ICU_ENABLE_ASCII_STRINGS}" != "1"; then
-				ICUDATA_CHAR="e"
-			fi ;;
-	*-*-nto*)	platform=U_QNX ;;
-	*-dec-osf*) 	platform=U_OSF ;;
-	*-*-beos)		platform=U_BEOS ;;
-	*-*-irix*)		platform=U_IRIX ;;
-	*-ncr-*)		platform=U_MPRAS ;;
-	*) 		platform=U_UNKNOWN_PLATFORM ;;
-esac
-
-
-platform_make_fragment_name="$icu_cv_host_frag"
-platform_make_fragment='$(top_srcdir)/config/'"$platform_make_fragment_name"
-
-
-
-if test "${FORCE_LIBS}" != ""; then
-   echo " *** Overriding automatically chosen LIBS=$LIBS, using instead FORCE_LIBS=${FORCE_LIBS}"  1>&6
-   LIBS=${FORCE_LIBS}
-fi
-
-# Now that we're done using CPPFLAGS etc. for tests, we can change it
-# for build.
-
-if test "${CC}" == "clang"; then
-   CLANGCFLAGS="-Qunused-arguments -Wno-parentheses-equality"
-else
-   CLANGCFLAGS=""
-fi
-
-if test "${CXX}" == "clang++"; then
-   CLANGCXXFLAGS="-Qunused-arguments -Wno-parentheses-equality"
-else
-   CLANGCXXFLAGS=""
-fi
-
-CPPFLAGS="$CPPFLAGS \$(THREADSCPPFLAGS)"
-CFLAGS="$CFLAGS \$(THREADSCFLAGS) $CLANGCFLAGS"
-CXXFLAGS="$CXXFLAGS \$(THREADSCXXFLAGS) $CLANGCXXFLAGS"
-
-
-
-
-# append all config cppflags
-CPPFLAGS="$CPPFLAGS $CONFIG_CPPFLAGS $UCONFIG_CPPFLAGS"
-
-echo "CPPFLAGS=$CPPFLAGS"
-echo "CFLAGS=$CFLAGS"
-echo "CXXFLAGS=$CXXFLAGS"
-
-
-# output the Makefiles
-ac_config_files="$ac_config_files icudefs.mk Makefile data/pkgdataMakefile config/Makefile.inc config/icu.pc config/pkgdataMakefile data/Makefile stubdata/Makefile common/Makefile i18n/Makefile layout/Makefile layoutex/Makefile io/Makefile extra/Makefile extra/uconv/Makefile extra/uconv/pkgdataMakefile extra/scrptrun/Makefile tools/Makefile tools/ctestfw/Makefile tools/toolutil/Makefile tools/makeconv/Makefile tools/genrb/Makefile tools/genccode/Makefile tools/gencmn/Makefile tools/gencnval/Makefile tools/gendict/Makefile tools/gentest/Makefile tools/gennorm2/Makefile tools/genbrk/Makefile tools/gensprep/Makefile tools/icuinfo/Makefile tools/icupkg/Makefile tools/icuswap/Makefile tools/pkgdata/Makefile tools/tzcode/Makefile tools/gencfu/Makefile test/Makefile test/compat/Makefile test/testdata/Makefile test/testdata/pkgdataMakefile test/hdrtst/Makefile test/intltest/Makefile test/cintltst/Makefile test/iotest/Makefile test/letest/Makefile test/perf/Makefile test/perf/collationperf/Makefile test/perf/collperf/Makefile test/perf/collperf2/Makefile test/perf/dicttrieperf/Makefile test/perf/ubrkperf/Makefile test/perf/charperf/Makefile test/perf/convperf/Makefile test/perf/normperf/Makefile test/perf/DateFmtPerf/Makefile test/perf/howExpensiveIs/Makefile test/perf/strsrchperf/Makefile test/perf/unisetperf/Makefile test/perf/usetperf/Makefile test/perf/ustrperf/Makefile test/perf/utfperf/Makefile test/perf/utrie2perf/Makefile test/perf/leperf/Makefile samples/Makefile samples/date/Makefile samples/cal/Makefile samples/layout/Makefile"
-
-cat >confcache <<\_ACEOF
-# This file is a shell script that caches the results of configure
-# tests run on this system so they can be shared between configure
-# scripts and configure runs, see configure's option --config-cache.
-# It is not useful on other systems.  If it contains results you don't
-# want to keep, you may remove or edit it.
-#
-# config.status only pays attention to the cache file if you give it
-# the --recheck option to rerun configure.
-#
-# `ac_cv_env_foo' variables (set or unset) will be overridden when
-# loading this file, other *unset* `ac_cv_foo' will be assigned the
-# following values.
-
-_ACEOF
-
-# The following way of writing the cache mishandles newlines in values,
-# but we know of no workaround that is simple, portable, and efficient.
-# So, we kill variables containing newlines.
-# Ultrix sh set writes to stderr and can't be redirected directly,
-# and sets the high bit in the cache file unless we assign to the vars.
-(
-  for ac_var in `(set) 2>&1 | sed -n 's/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'`; do
-    eval ac_val=\$$ac_var
-    case $ac_val in #(
-    *${as_nl}*)
-      case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
-$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
-      esac
-      case $ac_var in #(
-      _ | IFS | as_nl) ;; #(
-      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) { eval $ac_var=; unset $ac_var;} ;;
-      esac ;;
-    esac
-  done
-
-  (set) 2>&1 |
-    case $as_nl`(ac_space=' '; set) 2>&1` in #(
-    *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes: double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \.
-      sed -n \
-	"s/'/'\\\\''/g;
-	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
-      ;; #(
-    *)
-      # `set' quotes correctly as required by POSIX, so do not add quotes.
-      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
-      ;;
-    esac |
-    sort
-) |
-  sed '
-     /^ac_cv_env_/b end
-     t clear
-     :clear
-     s/^\([^=]*\)=\(.*[{}].*\)$/test "${\1+set}" = set || &/
-     t end
-     s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
-     :end' >>confcache
-if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
-  if test -w "$cache_file"; then
-    if test "x$cache_file" != "x/dev/null"; then
-      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
-$as_echo "$as_me: updating cache $cache_file" >&6;}
-      if test ! -f "$cache_file" || test -h "$cache_file"; then
-	cat confcache >"$cache_file"
-      else
-        case $cache_file in #(
-        */* | ?:*)
-	  mv -f confcache "$cache_file"$$ &&
-	  mv -f "$cache_file"$$ "$cache_file" ;; #(
-        *)
-	  mv -f confcache "$cache_file" ;;
-	esac
-      fi
-    fi
-  else
-    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
-$as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
-  fi
-fi
-rm -f confcache
-
-test "x$prefix" = xNONE && prefix=$ac_default_prefix
-# Let make expand exec_prefix.
-test "x$exec_prefix" = xNONE && exec_prefix='${prefix}'
-
-# Transform confdefs.h into DEFS.
-# Protect against shell expansion while executing Makefile rules.
-# Protect against Makefile macro expansion.
-#
-# If the first sed substitution is executed (which looks for macros that
-# take arguments), then branch to the quote section.  Otherwise,
-# look for a macro that doesn't take arguments.
-ac_script='
-:mline
-/\\$/{
- N
- s,\\\n,,
- b mline
-}
-t clear
-:clear
-s/^[	 ]*#[	 ]*define[	 ][	 ]*\([^	 (][^	 (]*([^)]*)\)[	 ]*\(.*\)/-D\1=\2/g
-t quote
-s/^[	 ]*#[	 ]*define[	 ][	 ]*\([^	 ][^	 ]*\)[	 ]*\(.*\)/-D\1=\2/g
-t quote
-b any
-:quote
-s/[	 `~#$^&*(){}\\|;'\''"<>?]/\\&/g
-s/\[/\\&/g
-s/\]/\\&/g
-s/\$/$$/g
-H
-:any
-${
-	g
-	s/^\n//
-	s/\n/ /g
-	p
-}
-'
-DEFS=`sed -n "$ac_script" confdefs.h`
-
-
-ac_libobjs=
-ac_ltlibobjs=
-U=
-for ac_i in : $LIBOBJS; do test "x$ac_i" = x: && continue
-  # 1. Remove the extension, and $U if already installed.
-  ac_script='s/\$U\././;s/\.o$//;s/\.obj$//'
-  ac_i=`$as_echo "$ac_i" | sed "$ac_script"`
-  # 2. Prepend LIBOBJDIR.  When used with automake>=1.10 LIBOBJDIR
-  #    will be set to the directory where LIBOBJS objects are built.
-  as_fn_append ac_libobjs " \${LIBOBJDIR}$ac_i\$U.$ac_objext"
-  as_fn_append ac_ltlibobjs " \${LIBOBJDIR}$ac_i"'$U.lo'
-done
-LIBOBJS=$ac_libobjs
-
-LTLIBOBJS=$ac_ltlibobjs
-
-
-
-
-: "${CONFIG_STATUS=./config.status}"
-ac_write_fail=0
-ac_clean_files_save=$ac_clean_files
-ac_clean_files="$ac_clean_files $CONFIG_STATUS"
-{ $as_echo "$as_me:${as_lineno-$LINENO}: creating $CONFIG_STATUS" >&5
-$as_echo "$as_me: creating $CONFIG_STATUS" >&6;}
-as_write_fail=0
-cat >$CONFIG_STATUS <<_ASEOF || as_write_fail=1
-#! $SHELL
-# Generated by $as_me.
-# Run this file to recreate the current configuration.
-# Compiler output produced by configure, useful for debugging
-# configure, is in config.log if it exists.
-
-debug=false
-ac_cs_recheck=false
-ac_cs_silent=false
-
-SHELL=\${CONFIG_SHELL-$SHELL}
-export SHELL
-_ASEOF
-cat >>$CONFIG_STATUS <<\_ASEOF || as_write_fail=1
-## -------------------- ##
-## M4sh Initialization. ##
-## -------------------- ##
-
-# Be more Bourne compatible
-DUALCASE=1; export DUALCASE # for MKS sh
-if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then :
-  emulate sh
-  NULLCMD=:
-  # Pre-4.2 versions of Zsh do word splitting on ${1+"$@"}, which
-  # is contrary to our usage.  Disable this feature.
-  alias -g '${1+"$@"}'='"$@"'
-  setopt NO_GLOB_SUBST
-else
-  case `(set -o) 2>/dev/null` in #(
-  *posix*) :
-    set -o posix ;; #(
-  *) :
-     ;;
-esac
-fi
-
-
-as_nl='
-'
-export as_nl
-# Printing a long string crashes Solaris 7 /usr/bin/printf.
-as_echo='\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'
-as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo
-as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo$as_echo
-# Prefer a ksh shell builtin over an external printf program on Solaris,
-# but without wasting forks for bash or zsh.
-if test -z "$BASH_VERSION$ZSH_VERSION" \
-    && (test "X`print -r -- $as_echo`" = "X$as_echo") 2>/dev/null; then
-  as_echo='print -r --'
-  as_echo_n='print -rn --'
-elif (test "X`printf %s $as_echo`" = "X$as_echo") 2>/dev/null; then
-  as_echo='printf %s\n'
-  as_echo_n='printf %s'
-else
-  if test "X`(/usr/ucb/echo -n -n $as_echo) 2>/dev/null`" = "X-n $as_echo"; then
-    as_echo_body='eval /usr/ucb/echo -n "$1$as_nl"'
-    as_echo_n='/usr/ucb/echo -n'
-  else
-    as_echo_body='eval expr "X$1" : "X\\(.*\\)"'
-    as_echo_n_body='eval
-      arg=$1;
-      case $arg in #(
-      *"$as_nl"*)
-	expr "X$arg" : "X\\(.*\\)$as_nl";
-	arg=`expr "X$arg" : ".*$as_nl\\(.*\\)"`;;
-      esac;
-      expr "X$arg" : "X\\(.*\\)" | tr -d "$as_nl"
-    '
-    export as_echo_n_body
-    as_echo_n='sh -c $as_echo_n_body as_echo'
-  fi
-  export as_echo_body
-  as_echo='sh -c $as_echo_body as_echo'
-fi
-
-# The user is always right.
-if test "${PATH_SEPARATOR+set}" != set; then
-  PATH_SEPARATOR=:
-  (PATH='/bin;/bin'; FPATH=$PATH; sh -c :) >/dev/null 2>&1 && {
-    (PATH='/bin:/bin'; FPATH=$PATH; sh -c :) >/dev/null 2>&1 ||
-      PATH_SEPARATOR=';'
-  }
-fi
-
-
-# IFS
-# We need space, tab and new line, in precisely that order.  Quoting is
-# there to prevent editors from complaining about space-tab.
-# (If _AS_PATH_WALK were called with IFS unset, it would disable word
-# splitting by setting IFS to empty value.)
-IFS=" ""	$as_nl"
-
-# Find who we are.  Look in the path if we contain no directory separator.
-as_myself=
-case $0 in #((
-  *[\\/]* ) as_myself=$0 ;;
-  *) as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
-  done
-IFS=$as_save_IFS
-
-     ;;
-esac
-# We did not find ourselves, most probably we were run as `sh COMMAND'
-# in which case we are not to be found in the path.
-if test "x$as_myself" = x; then
-  as_myself=$0
-fi
-if test ! -f "$as_myself"; then
-  $as_echo "$as_myself: error: cannot find myself; rerun with an absolute file name" >&2
-  exit 1
-fi
-
-# Unset variables that we do not need and which cause bugs (e.g. in
-# pre-3.0 UWIN ksh).  But do not cause bugs in bash 2.01; the "|| exit 1"
-# suppresses any "Segmentation fault" message there.  '((' could
-# trigger a bug in pdksh 5.2.14.
-for as_var in BASH_ENV ENV MAIL MAILPATH
-do eval test x\${$as_var+set} = xset \
-  && ( (unset $as_var) || exit 1) >/dev/null 2>&1 && unset $as_var || :
-done
-PS1='$ '
-PS2='> '
-PS4='+ '
-
-# NLS nuisances.
-LC_ALL=C
-export LC_ALL
-LANGUAGE=C
-export LANGUAGE
-
-# CDPATH.
-(unset CDPATH) >/dev/null 2>&1 && unset CDPATH
-
-
-# as_fn_error STATUS ERROR [LINENO LOG_FD]
-# ----------------------------------------
-# Output "`basename $0`: error: ERROR" to stderr. If LINENO and LOG_FD are
-# provided, also output the error to LOG_FD, referencing LINENO. Then exit the
-# script with STATUS, using 1 if that was 0.
-as_fn_error ()
-{
-  as_status=$1; test $as_status -eq 0 && as_status=1
-  if test "$4"; then
-    as_lineno=${as_lineno-"$3"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
-    $as_echo "$as_me:${as_lineno-$LINENO}: error: $2" >&$4
-  fi
-  $as_echo "$as_me: error: $2" >&2
-  as_fn_exit $as_status
-} # as_fn_error
-
-
-# as_fn_set_status STATUS
-# -----------------------
-# Set $? to STATUS, without forking.
-as_fn_set_status ()
-{
-  return $1
-} # as_fn_set_status
-
-# as_fn_exit STATUS
-# -----------------
-# Exit the shell with STATUS, even in a "trap 0" or "set -e" context.
-as_fn_exit ()
-{
-  set +e
-  as_fn_set_status $1
-  exit $1
-} # as_fn_exit
-
-# as_fn_unset VAR
-# ---------------
-# Portably unset VAR.
-as_fn_unset ()
-{
-  { eval $1=; unset $1;}
-}
-as_unset=as_fn_unset
-# as_fn_append VAR VALUE
-# ----------------------
-# Append the text in VALUE to the end of the definition contained in VAR. Take
-# advantage of any shell optimizations that allow amortized linear growth over
-# repeated appends, instead of the typical quadratic growth present in naive
-# implementations.
-if (eval "as_var=1; as_var+=2; test x\$as_var = x12") 2>/dev/null; then :
-  eval 'as_fn_append ()
-  {
-    eval $1+=\$2
-  }'
-else
-  as_fn_append ()
-  {
-    eval $1=\$$1\$2
-  }
-fi # as_fn_append
-
-# as_fn_arith ARG...
-# ------------------
-# Perform arithmetic evaluation on the ARGs, and store the result in the
-# global $as_val. Take advantage of shells that can avoid forks. The arguments
-# must be portable across $(()) and expr.
-if (eval "test \$(( 1 + 1 )) = 2") 2>/dev/null; then :
-  eval 'as_fn_arith ()
-  {
-    as_val=$(( $* ))
-  }'
-else
-  as_fn_arith ()
-  {
-    as_val=`expr "$@" || test $? -eq 1`
-  }
-fi # as_fn_arith
-
-
-if expr a : '\(a\)' >/dev/null 2>&1 &&
-   test "X`expr 00001 : '.*\(...\)'`" = X001; then
-  as_expr=expr
-else
-  as_expr=false
-fi
-
-if (basename -- /) >/dev/null 2>&1 && test "X`basename -- / 2>&1`" = "X/"; then
-  as_basename=basename
-else
-  as_basename=false
-fi
-
-if (as_dir=`dirname -- /` && test "X$as_dir" = X/) >/dev/null 2>&1; then
-  as_dirname=dirname
-else
-  as_dirname=false
-fi
-
-as_me=`$as_basename -- "$0" ||
-$as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
-	 X"$0" : 'X\(//\)$' \| \
-	 X"$0" : 'X\(/\)' \| . 2>/dev/null ||
-$as_echo X/"$0" |
-    sed '/^.*\/\([^/][^/]*\)\/*$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\/\(\/\/\)$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\/\(\/\).*/{
-	    s//\1/
-	    q
-	  }
-	  s/.*/./; q'`
-
-# Avoid depending upon Character Ranges.
-as_cr_letters='abcdefghijklmnopqrstuvwxyz'
-as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
-as_cr_Letters=$as_cr_letters$as_cr_LETTERS
-as_cr_digits='0123456789'
-as_cr_alnum=$as_cr_Letters$as_cr_digits
-
-ECHO_C= ECHO_N= ECHO_T=
-case `echo -n x` in #(((((
--n*)
-  case `echo 'xy\c'` in
-  *c*) ECHO_T='	';;	# ECHO_T is single tab character.
-  xy)  ECHO_C='\c';;
-  *)   echo `echo ksh88 bug on AIX 6.1` > /dev/null
-       ECHO_T='	';;
-  esac;;
-*)
-  ECHO_N='-n';;
-esac
-
-rm -f conf$$ conf$$.exe conf$$.file
-if test -d conf$$.dir; then
-  rm -f conf$$.dir/conf$$.file
-else
-  rm -f conf$$.dir
-  mkdir conf$$.dir 2>/dev/null
-fi
-if (echo >conf$$.file) 2>/dev/null; then
-  if ln -s conf$$.file conf$$ 2>/dev/null; then
-    as_ln_s='ln -s'
-    # ... but there are two gotchas:
-    # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
-    # 2) DJGPP < 2.04 has no symlinks; `ln -s' creates a wrapper executable.
-    # In both cases, we have to default to `cp -pR'.
-    ln -s conf$$.file conf$$.dir 2>/dev/null && test ! -f conf$$.exe ||
-      as_ln_s='cp -pR'
-  elif ln conf$$.file conf$$ 2>/dev/null; then
-    as_ln_s=ln
-  else
-    as_ln_s='cp -pR'
-  fi
-else
-  as_ln_s='cp -pR'
-fi
-rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
-rmdir conf$$.dir 2>/dev/null
-
-
-# as_fn_mkdir_p
-# -------------
-# Create "$as_dir" as a directory, including parents if necessary.
-as_fn_mkdir_p ()
-{
-
-  case $as_dir in #(
-  -*) as_dir=./$as_dir;;
-  esac
-  test -d "$as_dir" || eval $as_mkdir_p || {
-    as_dirs=
-    while :; do
-      case $as_dir in #(
-      *\'*) as_qdir=`$as_echo "$as_dir" | sed "s/'/'\\\\\\\\''/g"`;; #'(
-      *) as_qdir=$as_dir;;
-      esac
-      as_dirs="'$as_qdir' $as_dirs"
-      as_dir=`$as_dirname -- "$as_dir" ||
-$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
-	 X"$as_dir" : 'X\(//\)[^/]' \| \
-	 X"$as_dir" : 'X\(//\)$' \| \
-	 X"$as_dir" : 'X\(/\)' \| . 2>/dev/null ||
-$as_echo X"$as_dir" |
-    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\/\)[^/].*/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\/\)$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\).*/{
-	    s//\1/
-	    q
-	  }
-	  s/.*/./; q'`
-      test -d "$as_dir" && break
-    done
-    test -z "$as_dirs" || eval "mkdir $as_dirs"
-  } || test -d "$as_dir" || as_fn_error $? "cannot create directory $as_dir"
-
-
-} # as_fn_mkdir_p
-if mkdir -p . 2>/dev/null; then
-  as_mkdir_p='mkdir -p "$as_dir"'
-else
-  test -d ./-p && rmdir ./-p
-  as_mkdir_p=false
-fi
-
-
-# as_fn_executable_p FILE
-# -----------------------
-# Test if FILE is an executable regular file.
-as_fn_executable_p ()
-{
-  test -f "$1" && test -x "$1"
-} # as_fn_executable_p
-as_test_x='test -x'
-as_executable_p=as_fn_executable_p
-
-# Sed expression to map a string onto a valid CPP name.
-as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"
-
-# Sed expression to map a string onto a valid variable name.
-as_tr_sh="eval sed 'y%*+%pp%;s%[^_$as_cr_alnum]%_%g'"
-
-
-exec 6>&1
-## ----------------------------------- ##
-## Main body of $CONFIG_STATUS script. ##
-## ----------------------------------- ##
-_ASEOF
-test $as_write_fail = 0 && chmod +x $CONFIG_STATUS || ac_write_fail=1
-
-cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
-# Save the log message, to keep $0 and so on meaningful, and to
-# report actual input values of CONFIG_FILES etc. instead of their
-# values after options handling.
-ac_log="
-This file was extended by ICU $as_me 57.1, which was
-generated by GNU Autoconf 2.69.  Invocation command line was
-
-  CONFIG_FILES    = $CONFIG_FILES
-  CONFIG_HEADERS  = $CONFIG_HEADERS
-  CONFIG_LINKS    = $CONFIG_LINKS
-  CONFIG_COMMANDS = $CONFIG_COMMANDS
-  $ $0 $@
-
-on `(hostname || uname -n) 2>/dev/null | sed 1q`
-"
-
-_ACEOF
-
-case $ac_config_files in *"
-"*) set x $ac_config_files; shift; ac_config_files=$*;;
-esac
-
-
-
-cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
-# Files that config.status was made for.
-config_files="$ac_config_files"
-
-_ACEOF
-
-cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
-ac_cs_usage="\
-\`$as_me' instantiates files and other configuration actions
-from templates according to the current configuration.  Unless the files
-and actions are specified as TAGs, all are instantiated by default.
-
-Usage: $0 [OPTION]... [TAG]...
-
-  -h, --help       print this help, then exit
-  -V, --version    print version number and configuration settings, then exit
-      --config     print configuration, then exit
-  -q, --quiet, --silent
-                   do not print progress messages
-  -d, --debug      don't remove temporary files
-      --recheck    update $as_me by reconfiguring in the same conditions
-      --file=FILE[:TEMPLATE]
-                   instantiate the configuration file FILE
-
-Configuration files:
-$config_files
-
-Report bugs to <http://icu-project.org/bugs>.
-ICU home page: <http://icu-project.org>."
-
-_ACEOF
-cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
-ac_cs_config="`$as_echo "$ac_configure_args" | sed 's/^ //; s/[\\""\`\$]/\\\\&/g'`"
-ac_cs_version="\\
-ICU config.status 57.1
-configured by $0, generated by GNU Autoconf 2.69,
-  with options \\"\$ac_cs_config\\"
-
-Copyright (C) 2012 Free Software Foundation, Inc.
-This config.status script is free software; the Free Software Foundation
-gives unlimited permission to copy, distribute and modify it."
-
-ac_pwd='$ac_pwd'
-srcdir='$srcdir'
-INSTALL='$INSTALL'
-test -n "\$AWK" || AWK=awk
-_ACEOF
-
-cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
-# The default lists apply if the user does not specify any file.
-ac_need_defaults=:
-while test $# != 0
-do
-  case $1 in
-  --*=?*)
-    ac_option=`expr "X$1" : 'X\([^=]*\)='`
-    ac_optarg=`expr "X$1" : 'X[^=]*=\(.*\)'`
-    ac_shift=:
-    ;;
-  --*=)
-    ac_option=`expr "X$1" : 'X\([^=]*\)='`
-    ac_optarg=
-    ac_shift=:
-    ;;
-  *)
-    ac_option=$1
-    ac_optarg=$2
-    ac_shift=shift
-    ;;
-  esac
-
-  case $ac_option in
-  # Handling of the options.
-  -recheck | --recheck | --rechec | --reche | --rech | --rec | --re | --r)
-    ac_cs_recheck=: ;;
-  --version | --versio | --versi | --vers | --ver | --ve | --v | -V )
-    $as_echo "$ac_cs_version"; exit ;;
-  --config | --confi | --conf | --con | --co | --c )
-    $as_echo "$ac_cs_config"; exit ;;
-  --debug | --debu | --deb | --de | --d | -d )
-    debug=: ;;
-  --file | --fil | --fi | --f )
-    $ac_shift
-    case $ac_optarg in
-    *\'*) ac_optarg=`$as_echo "$ac_optarg" | sed "s/'/'\\\\\\\\''/g"` ;;
-    '') as_fn_error $? "missing file argument" ;;
-    esac
-    as_fn_append CONFIG_FILES " '$ac_optarg'"
-    ac_need_defaults=false;;
-  --he | --h |  --help | --hel | -h )
-    $as_echo "$ac_cs_usage"; exit ;;
-  -q | -quiet | --quiet | --quie | --qui | --qu | --q \
-  | -silent | --silent | --silen | --sile | --sil | --si | --s)
-    ac_cs_silent=: ;;
-
-  # This is an error.
-  -*) as_fn_error $? "unrecognized option: \`$1'
-Try \`$0 --help' for more information." ;;
-
-  *) as_fn_append ac_config_targets " $1"
-     ac_need_defaults=false ;;
-
-  esac
-  shift
-done
-
-ac_configure_extra_args=
-
-if $ac_cs_silent; then
-  exec 6>/dev/null
-  ac_configure_extra_args="$ac_configure_extra_args --silent"
-fi
-
-_ACEOF
-cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
-if \$ac_cs_recheck; then
-  set X $SHELL '$0' $ac_configure_args \$ac_configure_extra_args --no-create --no-recursion
-  shift
-  \$as_echo "running CONFIG_SHELL=$SHELL \$*" >&6
-  CONFIG_SHELL='$SHELL'
-  export CONFIG_SHELL
-  exec "\$@"
-fi
-
-_ACEOF
-cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
-exec 5>>config.log
-{
-  echo
-  sed 'h;s/./-/g;s/^.../## /;s/...$/ ##/;p;x;p;x' <<_ASBOX
-## Running $as_me. ##
-_ASBOX
-  $as_echo "$ac_log"
-} >&5
-
-_ACEOF
-cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
-_ACEOF
-
-cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
-
-# Handling of arguments.
-for ac_config_target in $ac_config_targets
-do
-  case $ac_config_target in
-    "icudefs.mk") CONFIG_FILES="$CONFIG_FILES icudefs.mk" ;;
-    "Makefile") CONFIG_FILES="$CONFIG_FILES Makefile" ;;
-    "data/pkgdataMakefile") CONFIG_FILES="$CONFIG_FILES data/pkgdataMakefile" ;;
-    "config/Makefile.inc") CONFIG_FILES="$CONFIG_FILES config/Makefile.inc" ;;
-    "config/icu.pc") CONFIG_FILES="$CONFIG_FILES config/icu.pc" ;;
-    "config/pkgdataMakefile") CONFIG_FILES="$CONFIG_FILES config/pkgdataMakefile" ;;
-    "data/Makefile") CONFIG_FILES="$CONFIG_FILES data/Makefile" ;;
-    "stubdata/Makefile") CONFIG_FILES="$CONFIG_FILES stubdata/Makefile" ;;
-    "common/Makefile") CONFIG_FILES="$CONFIG_FILES common/Makefile" ;;
-    "i18n/Makefile") CONFIG_FILES="$CONFIG_FILES i18n/Makefile" ;;
-    "layout/Makefile") CONFIG_FILES="$CONFIG_FILES layout/Makefile" ;;
-    "layoutex/Makefile") CONFIG_FILES="$CONFIG_FILES layoutex/Makefile" ;;
-    "io/Makefile") CONFIG_FILES="$CONFIG_FILES io/Makefile" ;;
-    "extra/Makefile") CONFIG_FILES="$CONFIG_FILES extra/Makefile" ;;
-    "extra/uconv/Makefile") CONFIG_FILES="$CONFIG_FILES extra/uconv/Makefile" ;;
-    "extra/uconv/pkgdataMakefile") CONFIG_FILES="$CONFIG_FILES extra/uconv/pkgdataMakefile" ;;
-    "extra/scrptrun/Makefile") CONFIG_FILES="$CONFIG_FILES extra/scrptrun/Makefile" ;;
-    "tools/Makefile") CONFIG_FILES="$CONFIG_FILES tools/Makefile" ;;
-    "tools/ctestfw/Makefile") CONFIG_FILES="$CONFIG_FILES tools/ctestfw/Makefile" ;;
-    "tools/toolutil/Makefile") CONFIG_FILES="$CONFIG_FILES tools/toolutil/Makefile" ;;
-    "tools/makeconv/Makefile") CONFIG_FILES="$CONFIG_FILES tools/makeconv/Makefile" ;;
-    "tools/genrb/Makefile") CONFIG_FILES="$CONFIG_FILES tools/genrb/Makefile" ;;
-    "tools/genccode/Makefile") CONFIG_FILES="$CONFIG_FILES tools/genccode/Makefile" ;;
-    "tools/gencmn/Makefile") CONFIG_FILES="$CONFIG_FILES tools/gencmn/Makefile" ;;
-    "tools/gencnval/Makefile") CONFIG_FILES="$CONFIG_FILES tools/gencnval/Makefile" ;;
-    "tools/gendict/Makefile") CONFIG_FILES="$CONFIG_FILES tools/gendict/Makefile" ;;
-    "tools/gentest/Makefile") CONFIG_FILES="$CONFIG_FILES tools/gentest/Makefile" ;;
-    "tools/gennorm2/Makefile") CONFIG_FILES="$CONFIG_FILES tools/gennorm2/Makefile" ;;
-    "tools/genbrk/Makefile") CONFIG_FILES="$CONFIG_FILES tools/genbrk/Makefile" ;;
-    "tools/gensprep/Makefile") CONFIG_FILES="$CONFIG_FILES tools/gensprep/Makefile" ;;
-    "tools/icuinfo/Makefile") CONFIG_FILES="$CONFIG_FILES tools/icuinfo/Makefile" ;;
-    "tools/icupkg/Makefile") CONFIG_FILES="$CONFIG_FILES tools/icupkg/Makefile" ;;
-    "tools/icuswap/Makefile") CONFIG_FILES="$CONFIG_FILES tools/icuswap/Makefile" ;;
-    "tools/pkgdata/Makefile") CONFIG_FILES="$CONFIG_FILES tools/pkgdata/Makefile" ;;
-    "tools/tzcode/Makefile") CONFIG_FILES="$CONFIG_FILES tools/tzcode/Makefile" ;;
-    "tools/gencfu/Makefile") CONFIG_FILES="$CONFIG_FILES tools/gencfu/Makefile" ;;
-    "test/Makefile") CONFIG_FILES="$CONFIG_FILES test/Makefile" ;;
-    "test/compat/Makefile") CONFIG_FILES="$CONFIG_FILES test/compat/Makefile" ;;
-    "test/testdata/Makefile") CONFIG_FILES="$CONFIG_FILES test/testdata/Makefile" ;;
-    "test/testdata/pkgdataMakefile") CONFIG_FILES="$CONFIG_FILES test/testdata/pkgdataMakefile" ;;
-    "test/hdrtst/Makefile") CONFIG_FILES="$CONFIG_FILES test/hdrtst/Makefile" ;;
-    "test/intltest/Makefile") CONFIG_FILES="$CONFIG_FILES test/intltest/Makefile" ;;
-    "test/cintltst/Makefile") CONFIG_FILES="$CONFIG_FILES test/cintltst/Makefile" ;;
-    "test/iotest/Makefile") CONFIG_FILES="$CONFIG_FILES test/iotest/Makefile" ;;
-    "test/letest/Makefile") CONFIG_FILES="$CONFIG_FILES test/letest/Makefile" ;;
-    "test/perf/Makefile") CONFIG_FILES="$CONFIG_FILES test/perf/Makefile" ;;
-    "test/perf/collationperf/Makefile") CONFIG_FILES="$CONFIG_FILES test/perf/collationperf/Makefile" ;;
-    "test/perf/collperf/Makefile") CONFIG_FILES="$CONFIG_FILES test/perf/collperf/Makefile" ;;
-    "test/perf/collperf2/Makefile") CONFIG_FILES="$CONFIG_FILES test/perf/collperf2/Makefile" ;;
-    "test/perf/dicttrieperf/Makefile") CONFIG_FILES="$CONFIG_FILES test/perf/dicttrieperf/Makefile" ;;
-    "test/perf/ubrkperf/Makefile") CONFIG_FILES="$CONFIG_FILES test/perf/ubrkperf/Makefile" ;;
-    "test/perf/charperf/Makefile") CONFIG_FILES="$CONFIG_FILES test/perf/charperf/Makefile" ;;
-    "test/perf/convperf/Makefile") CONFIG_FILES="$CONFIG_FILES test/perf/convperf/Makefile" ;;
-    "test/perf/normperf/Makefile") CONFIG_FILES="$CONFIG_FILES test/perf/normperf/Makefile" ;;
-    "test/perf/DateFmtPerf/Makefile") CONFIG_FILES="$CONFIG_FILES test/perf/DateFmtPerf/Makefile" ;;
-    "test/perf/howExpensiveIs/Makefile") CONFIG_FILES="$CONFIG_FILES test/perf/howExpensiveIs/Makefile" ;;
-    "test/perf/strsrchperf/Makefile") CONFIG_FILES="$CONFIG_FILES test/perf/strsrchperf/Makefile" ;;
-    "test/perf/unisetperf/Makefile") CONFIG_FILES="$CONFIG_FILES test/perf/unisetperf/Makefile" ;;
-    "test/perf/usetperf/Makefile") CONFIG_FILES="$CONFIG_FILES test/perf/usetperf/Makefile" ;;
-    "test/perf/ustrperf/Makefile") CONFIG_FILES="$CONFIG_FILES test/perf/ustrperf/Makefile" ;;
-    "test/perf/utfperf/Makefile") CONFIG_FILES="$CONFIG_FILES test/perf/utfperf/Makefile" ;;
-    "test/perf/utrie2perf/Makefile") CONFIG_FILES="$CONFIG_FILES test/perf/utrie2perf/Makefile" ;;
-    "test/perf/leperf/Makefile") CONFIG_FILES="$CONFIG_FILES test/perf/leperf/Makefile" ;;
-    "samples/Makefile") CONFIG_FILES="$CONFIG_FILES samples/Makefile" ;;
-    "samples/date/Makefile") CONFIG_FILES="$CONFIG_FILES samples/date/Makefile" ;;
-    "samples/cal/Makefile") CONFIG_FILES="$CONFIG_FILES samples/cal/Makefile" ;;
-    "samples/layout/Makefile") CONFIG_FILES="$CONFIG_FILES samples/layout/Makefile" ;;
-
-  *) as_fn_error $? "invalid argument: \`$ac_config_target'" "$LINENO" 5;;
-  esac
-done
-
-
-# If the user did not use the arguments to specify the items to instantiate,
-# then the envvar interface is used.  Set only those that are not.
-# We use the long form for the default assignment because of an extremely
-# bizarre bug on SunOS 4.1.3.
-if $ac_need_defaults; then
-  test "${CONFIG_FILES+set}" = set || CONFIG_FILES=$config_files
-fi
-
-# Have a temporary directory for convenience.  Make it in the build tree
-# simply because there is no reason against having it here, and in addition,
-# creating and moving files from /tmp can sometimes cause problems.
-# Hook for its removal unless debugging.
-# Note that there is a small window in which the directory will not be cleaned:
-# after its creation but before its name has been assigned to `$tmp'.
-$debug ||
-{
-  tmp= ac_tmp=
-  trap 'exit_status=$?
-  : "${ac_tmp:=$tmp}"
-  { test ! -d "$ac_tmp" || rm -fr "$ac_tmp"; } && exit $exit_status
-' 0
-  trap 'as_fn_exit 1' 1 2 13 15
-}
-# Create a (secure) tmp directory for tmp files.
-
-{
-  tmp=`(umask 077 && mktemp -d "./confXXXXXX") 2>/dev/null` &&
-  test -d "$tmp"
-}  ||
-{
-  tmp=./conf$$-$RANDOM
-  (umask 077 && mkdir "$tmp")
-} || as_fn_error $? "cannot create a temporary directory in ." "$LINENO" 5
-ac_tmp=$tmp
-
-# Set up the scripts for CONFIG_FILES section.
-# No need to generate them if there are no CONFIG_FILES.
-# This happens for instance with `./config.status config.h'.
-if test -n "$CONFIG_FILES"; then
-
-
-ac_cr=`echo X | tr X '\015'`
-# On cygwin, bash can eat \r inside `` if the user requested igncr.
-# But we know of no other shell where ac_cr would be empty at this
-# point, so we can use a bashism as a fallback.
-if test "x$ac_cr" = x; then
-  eval ac_cr=\$\'\\r\'
-fi
-ac_cs_awk_cr=`$AWK 'BEGIN { print "a\rb" }' </dev/null 2>/dev/null`
-if test "$ac_cs_awk_cr" = "a${ac_cr}b"; then
-  ac_cs_awk_cr='\\r'
-else
-  ac_cs_awk_cr=$ac_cr
-fi
-
-echo 'BEGIN {' >"$ac_tmp/subs1.awk" &&
-_ACEOF
-
-
-{
-  echo "cat >conf$$subs.awk <<_ACEOF" &&
-  echo "$ac_subst_vars" | sed 's/.*/&!$&$ac_delim/' &&
-  echo "_ACEOF"
-} >conf$$subs.sh ||
-  as_fn_error $? "could not make $CONFIG_STATUS" "$LINENO" 5
-ac_delim_num=`echo "$ac_subst_vars" | grep -c '^'`
-ac_delim='%!_!# '
-for ac_last_try in false false false false false :; do
-  . ./conf$$subs.sh ||
-    as_fn_error $? "could not make $CONFIG_STATUS" "$LINENO" 5
-
-  ac_delim_n=`sed -n "s/.*$ac_delim\$/X/p" conf$$subs.awk | grep -c X`
-  if test $ac_delim_n = $ac_delim_num; then
-    break
-  elif $ac_last_try; then
-    as_fn_error $? "could not make $CONFIG_STATUS" "$LINENO" 5
-  else
-    ac_delim="$ac_delim!$ac_delim _$ac_delim!! "
-  fi
-done
-rm -f conf$$subs.sh
-
-cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
-cat >>"\$ac_tmp/subs1.awk" <<\\_ACAWK &&
-_ACEOF
-sed -n '
-h
-s/^/S["/; s/!.*/"]=/
-p
-g
-s/^[^!]*!//
-:repl
-t repl
-s/'"$ac_delim"'$//
-t delim
-:nl
-h
-s/\(.\{148\}\)..*/\1/
-t more1
-s/["\\]/\\&/g; s/^/"/; s/$/\\n"\\/
-p
-n
-b repl
-:more1
-s/["\\]/\\&/g; s/^/"/; s/$/"\\/
-p
-g
-s/.\{148\}//
-t nl
-:delim
-h
-s/\(.\{148\}\)..*/\1/
-t more2
-s/["\\]/\\&/g; s/^/"/; s/$/"/
-p
-b
-:more2
-s/["\\]/\\&/g; s/^/"/; s/$/"\\/
-p
-g
-s/.\{148\}//
-t delim
-' <conf$$subs.awk | sed '
-/^[^""]/{
-  N
-  s/\n//
-}
-' >>$CONFIG_STATUS || ac_write_fail=1
-rm -f conf$$subs.awk
-cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
-_ACAWK
-cat >>"\$ac_tmp/subs1.awk" <<_ACAWK &&
-  for (key in S) S_is_set[key] = 1
-  FS = ""
-
-}
-{
-  line = $ 0
-  nfields = split(line, field, "@")
-  substed = 0
-  len = length(field[1])
-  for (i = 2; i < nfields; i++) {
-    key = field[i]
-    keylen = length(key)
-    if (S_is_set[key]) {
-      value = S[key]
-      line = substr(line, 1, len) "" value "" substr(line, len + keylen + 3)
-      len += length(value) + length(field[++i])
-      substed = 1
-    } else
-      len += 1 + keylen
-  }
-
-  print line
-}
-
-_ACAWK
-_ACEOF
-cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
-if sed "s/$ac_cr//" < /dev/null > /dev/null 2>&1; then
-  sed "s/$ac_cr\$//; s/$ac_cr/$ac_cs_awk_cr/g"
-else
-  cat
-fi < "$ac_tmp/subs1.awk" > "$ac_tmp/subs.awk" \
-  || as_fn_error $? "could not setup config files machinery" "$LINENO" 5
-_ACEOF
-
-# VPATH may cause trouble with some makes, so we remove sole $(srcdir),
-# ${srcdir} and @srcdir@ entries from VPATH if srcdir is ".", strip leading and
-# trailing colons and then remove the whole line if VPATH becomes empty
-# (actually we leave an empty line to preserve line numbers).
-if test "x$srcdir" = x.; then
-  ac_vpsub='/^[	 ]*VPATH[	 ]*=[	 ]*/{
-h
-s///
-s/^/:/
-s/[	 ]*$/:/
-s/:\$(srcdir):/:/g
-s/:\${srcdir}:/:/g
-s/:@srcdir@:/:/g
-s/^:*//
-s/:*$//
-x
-s/\(=[	 ]*\).*/\1/
-G
-s/\n//
-s/^[^=]*=[	 ]*$//
-}'
-fi
-
-cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
-fi # test -n "$CONFIG_FILES"
-
-
-eval set X "  :F $CONFIG_FILES      "
-shift
-for ac_tag
-do
-  case $ac_tag in
-  :[FHLC]) ac_mode=$ac_tag; continue;;
-  esac
-  case $ac_mode$ac_tag in
-  :[FHL]*:*);;
-  :L* | :C*:*) as_fn_error $? "invalid tag \`$ac_tag'" "$LINENO" 5;;
-  :[FH]-) ac_tag=-:-;;
-  :[FH]*) ac_tag=$ac_tag:$ac_tag.in;;
-  esac
-  ac_save_IFS=$IFS
-  IFS=:
-  set x $ac_tag
-  IFS=$ac_save_IFS
-  shift
-  ac_file=$1
-  shift
-
-  case $ac_mode in
-  :L) ac_source=$1;;
-  :[FH])
-    ac_file_inputs=
-    for ac_f
-    do
-      case $ac_f in
-      -) ac_f="$ac_tmp/stdin";;
-      *) # Look for the file first in the build tree, then in the source tree
-	 # (if the path is not absolute).  The absolute path cannot be DOS-style,
-	 # because $ac_f cannot contain `:'.
-	 test -f "$ac_f" ||
-	   case $ac_f in
-	   [\\/$]*) false;;
-	   *) test -f "$srcdir/$ac_f" && ac_f="$srcdir/$ac_f";;
-	   esac ||
-	   as_fn_error 1 "cannot find input file: \`$ac_f'" "$LINENO" 5;;
-      esac
-      case $ac_f in *\'*) ac_f=`$as_echo "$ac_f" | sed "s/'/'\\\\\\\\''/g"`;; esac
-      as_fn_append ac_file_inputs " '$ac_f'"
-    done
-
-    # Let's still pretend it is `configure' which instantiates (i.e., don't
-    # use $as_me), people would be surprised to read:
-    #    /* config.h.  Generated by config.status.  */
-    configure_input='Generated from '`
-	  $as_echo "$*" | sed 's|^[^:]*/||;s|:[^:]*/|, |g'
-	`' by configure.'
-    if test x"$ac_file" != x-; then
-      configure_input="$ac_file.  $configure_input"
-      { $as_echo "$as_me:${as_lineno-$LINENO}: creating $ac_file" >&5
-$as_echo "$as_me: creating $ac_file" >&6;}
-    fi
-    # Neutralize special characters interpreted by sed in replacement strings.
-    case $configure_input in #(
-    *\&* | *\|* | *\\* )
-       ac_sed_conf_input=`$as_echo "$configure_input" |
-       sed 's/[\\\\&|]/\\\\&/g'`;; #(
-    *) ac_sed_conf_input=$configure_input;;
-    esac
-
-    case $ac_tag in
-    *:-:* | *:-) cat >"$ac_tmp/stdin" \
-      || as_fn_error $? "could not create $ac_file" "$LINENO" 5 ;;
-    esac
-    ;;
-  esac
-
-  ac_dir=`$as_dirname -- "$ac_file" ||
-$as_expr X"$ac_file" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
-	 X"$ac_file" : 'X\(//\)[^/]' \| \
-	 X"$ac_file" : 'X\(//\)$' \| \
-	 X"$ac_file" : 'X\(/\)' \| . 2>/dev/null ||
-$as_echo X"$ac_file" |
-    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\/\)[^/].*/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\/\)$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\).*/{
-	    s//\1/
-	    q
-	  }
-	  s/.*/./; q'`
-  as_dir="$ac_dir"; as_fn_mkdir_p
-  ac_builddir=.
-
-case "$ac_dir" in
-.) ac_dir_suffix= ac_top_builddir_sub=. ac_top_build_prefix= ;;
-*)
-  ac_dir_suffix=/`$as_echo "$ac_dir" | sed 's|^\.[\\/]||'`
-  # A ".." for each directory in $ac_dir_suffix.
-  ac_top_builddir_sub=`$as_echo "$ac_dir_suffix" | sed 's|/[^\\/]*|/..|g;s|/||'`
-  case $ac_top_builddir_sub in
-  "") ac_top_builddir_sub=. ac_top_build_prefix= ;;
-  *)  ac_top_build_prefix=$ac_top_builddir_sub/ ;;
-  esac ;;
-esac
-ac_abs_top_builddir=$ac_pwd
-ac_abs_builddir=$ac_pwd$ac_dir_suffix
-# for backward compatibility:
-ac_top_builddir=$ac_top_build_prefix
-
-case $srcdir in
-  .)  # We are building in place.
-    ac_srcdir=.
-    ac_top_srcdir=$ac_top_builddir_sub
-    ac_abs_top_srcdir=$ac_pwd ;;
-  [\\/]* | ?:[\\/]* )  # Absolute name.
-    ac_srcdir=$srcdir$ac_dir_suffix;
-    ac_top_srcdir=$srcdir
-    ac_abs_top_srcdir=$srcdir ;;
-  *) # Relative name.
-    ac_srcdir=$ac_top_build_prefix$srcdir$ac_dir_suffix
-    ac_top_srcdir=$ac_top_build_prefix$srcdir
-    ac_abs_top_srcdir=$ac_pwd/$srcdir ;;
-esac
-ac_abs_srcdir=$ac_abs_top_srcdir$ac_dir_suffix
-
-
-  case $ac_mode in
-  :F)
-  #
-  # CONFIG_FILE
-  #
-
-  case $INSTALL in
-  [\\/$]* | ?:[\\/]* ) ac_INSTALL=$INSTALL ;;
-  *) ac_INSTALL=$ac_top_build_prefix$INSTALL ;;
-  esac
-_ACEOF
-
-cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
-# If the template does not know about datarootdir, expand it.
-# FIXME: This hack should be removed a few years after 2.60.
-ac_datarootdir_hack=; ac_datarootdir_seen=
-ac_sed_dataroot='
-/datarootdir/ {
-  p
-  q
-}
-/@datadir@/p
-/@docdir@/p
-/@infodir@/p
-/@localedir@/p
-/@mandir@/p'
-case `eval "sed -n \"\$ac_sed_dataroot\" $ac_file_inputs"` in
-*datarootdir*) ac_datarootdir_seen=yes;;
-*@datadir@*|*@docdir@*|*@infodir@*|*@localedir@*|*@mandir@*)
-  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $ac_file_inputs seems to ignore the --datarootdir setting" >&5
-$as_echo "$as_me: WARNING: $ac_file_inputs seems to ignore the --datarootdir setting" >&2;}
-_ACEOF
-cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
-  ac_datarootdir_hack='
-  s&@datadir@&$datadir&g
-  s&@docdir@&$docdir&g
-  s&@infodir@&$infodir&g
-  s&@localedir@&$localedir&g
-  s&@mandir@&$mandir&g
-  s&\\\${datarootdir}&$datarootdir&g' ;;
-esac
-_ACEOF
-
-# Neutralize VPATH when `$srcdir' = `.'.
-# Shell code in configure.ac might set extrasub.
-# FIXME: do we really want to maintain this feature?
-cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
-ac_sed_extra="$ac_vpsub
-$extrasub
-_ACEOF
-cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
-:t
-/@[a-zA-Z_][a-zA-Z_0-9]*@/!b
-s|@configure_input@|$ac_sed_conf_input|;t t
-s&@top_builddir@&$ac_top_builddir_sub&;t t
-s&@top_build_prefix@&$ac_top_build_prefix&;t t
-s&@srcdir@&$ac_srcdir&;t t
-s&@abs_srcdir@&$ac_abs_srcdir&;t t
-s&@top_srcdir@&$ac_top_srcdir&;t t
-s&@abs_top_srcdir@&$ac_abs_top_srcdir&;t t
-s&@builddir@&$ac_builddir&;t t
-s&@abs_builddir@&$ac_abs_builddir&;t t
-s&@abs_top_builddir@&$ac_abs_top_builddir&;t t
-s&@INSTALL@&$ac_INSTALL&;t t
-$ac_datarootdir_hack
-"
-eval sed \"\$ac_sed_extra\" "$ac_file_inputs" | $AWK -f "$ac_tmp/subs.awk" \
-  >$ac_tmp/out || as_fn_error $? "could not create $ac_file" "$LINENO" 5
-
-test -z "$ac_datarootdir_hack$ac_datarootdir_seen" &&
-  { ac_out=`sed -n '/\${datarootdir}/p' "$ac_tmp/out"`; test -n "$ac_out"; } &&
-  { ac_out=`sed -n '/^[	 ]*datarootdir[	 ]*:*=/p' \
-      "$ac_tmp/out"`; test -z "$ac_out"; } &&
-  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $ac_file contains a reference to the variable \`datarootdir'
-which seems to be undefined.  Please make sure it is defined" >&5
-$as_echo "$as_me: WARNING: $ac_file contains a reference to the variable \`datarootdir'
-which seems to be undefined.  Please make sure it is defined" >&2;}
-
-  rm -f "$ac_tmp/stdin"
-  case $ac_file in
-  -) cat "$ac_tmp/out" && rm -f "$ac_tmp/out";;
-  *) rm -f "$ac_file" && mv "$ac_tmp/out" "$ac_file";;
-  esac \
-  || as_fn_error $? "could not create $ac_file" "$LINENO" 5
- ;;
-
-
-
-  esac
-
-done # for ac_tag
-
-
-as_fn_exit 0
-_ACEOF
-ac_clean_files=$ac_clean_files_save
-
-test $ac_write_fail = 0 ||
-  as_fn_error $? "write failure creating $CONFIG_STATUS" "$LINENO" 5
-
-
-# configure is writing to config.log, and then calls config.status.
-# config.status does its own redirection, appending to config.log.
-# Unfortunately, on DOS this fails, as config.log is still kept open
-# by configure, so config.status won't be able to write to it; its
-# output is simply discarded.  So we exec the FD to /dev/null,
-# effectively closing config.log, so it can be properly (re)opened and
-# appended to by config.status.  When coming back to configure, we
-# need to make the FD available again.
-if test "$no_create" != yes; then
-  ac_cs_success=:
-  ac_config_status_args=
-  test "$silent" = yes &&
-    ac_config_status_args="$ac_config_status_args --quiet"
-  exec 5>/dev/null
-  $SHELL $CONFIG_STATUS $ac_config_status_args || ac_cs_success=false
-  exec 5>>config.log
-  # Use ||, not &&, to avoid exiting from the if with $? = 1, which
-  # would make configure fail if this is the last instruction.
-  $ac_cs_success || as_fn_exit 1
-fi
-if test -n "$ac_unrecognized_opts" && test "$enable_option_checking" != no; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: unrecognized options: $ac_unrecognized_opts" >&5
-$as_echo "$as_me: WARNING: unrecognized options: $ac_unrecognized_opts" >&2;}
-fi
-
-
-echo
-echo "ICU for C/C++ $VERSION is ready to be built."
-echo "=== Important Notes: ==="
-
-echo "Data Packaging: $datapackaging"
-echo " This means: $datapackaging_msg"
-echo " To locate data: $datapackaging_howfound"
-
-if test -n "`$U_MAKE -v 2>&1 | grep '^GNU Make'`"; then
-echo "Building ICU: Use a GNU make such as $U_MAKE to build ICU."
-else
-echo "** WARNING: $U_MAKE may not be GNU make."
-echo "This may cause ICU to fail to build. Please make sure that GNU make"
-echo "is in your PATH so that the configure script can detect its location."
-fi
-if test "x$AR" = "xfalse"; then
-  echo "*** WARNING: Archiver ar not found. Set AR= or fix PATH. Some builds (such as static) may fail."
-fi
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking the version of \"$U_MAKE\"" >&5
-$as_echo_n "checking the version of \"$U_MAKE\"... " >&6; }
-if "$U_MAKE" -f "$srcdir/config/gmakever.mk" PLATFORM="$platform"; then
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: ok" >&5
-$as_echo "ok" >&6; }
-else
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: too old or test failed - try upgrading GNU Make" >&5
-$as_echo "too old or test failed - try upgrading GNU Make" >&6; }
-fi
-
-
-if test -n "$UCONFIG_CPPFLAGS"; then
-   HDRFILE="uconfig.h.prepend"
-   echo "*** WARNING: You must set the following flags before code compiled against this ICU will function properly:"
-   echo
-   echo "   ${UCONFIG_CPPFLAGS}"
-   echo
-   echo 'The recommended way to do this is to prepend the following lines to source/common/unicode/uconfig.h or #include them near the top of that file.'
-   echo "Creating the file ${HDRFILE}"
-   echo
-   echo '---------------   ' "${HDRFILE}"
-   echo > "${HDRFILE}"
-   echo '/* ICU customizations: put these lines at the top of uconfig.h */' >> "${HDRFILE}"
-   echo >> "${HDRFILE}"
-   for flag in ${UCONFIG_CPPFLAGS};
-   do
-        echo " /* $flag */" >> "${HDRFILE}"
-        case "${flag}" in
-        -D*=*)
-           \echo "${flag}" | sed -n 's%-D\([^=]*\)=%#define \1 %p' >> "${HDRFILE}"
-          \echo >> "${HDRFILE}"
-          ;;
-        -D*)
-           \echo "${flag}" | sed -n 's%-D\([^=]*\)%#define \1 %p' >> "${HDRFILE}"
-          \echo >> "${HDRFILE}"
-          ;;
-        *)
-          \echo "/*  Not sure how to handle this argument: ${flag} */" >> "${HDRFILE}"
-          \echo >> "${HDRFILE}"
-          ;;
-        esac
-   done
-   cat "${HDRFILE}"
-   \echo  "/* End of ${HDRFILE} ------------ */" >> "${HDRFILE}"
-   echo >> "${HDRFILE}"
-   echo '--------------- end ' "${HDRFILE}"
-fi
-
-
-if test -n "$UCONFIG_CFLAGS"; then
-   echo "C   apps may want to build with CFLAGS   = ${UCONFIG_CFLAGS}"
-fi
-
-if test -n "$UCONFIG_CXXFLAGS"; then
-   echo "C++ apps may want to build with CXXFLAGS = ${UCONFIG_CXXFLAGS}"
-fi
-
-if test "$tools" = false;
-then
-        echo "## Note: you have disabled ICU's tools. This ICU cannot build its own data or tests."
-        echo "## Expect build failures in the 'data', 'test', and other directories."
-fi
-
-$as_unset _CXX_CXXSUFFIX
diff --git a/intl/icu/source/data/in/uprops.icu.orig b/intl/icu/source/data/in/uprops.icu.orig
deleted file mode 100644
index 6e13b3d..0000000
Binary files a/intl/icu/source/data/in/uprops.icu.orig and /dev/null differ
diff --git a/intl/icu/source/data/in/uprops.icu.rej b/intl/icu/source/data/in/uprops.icu.rej
deleted file mode 100644
index 98d40df..0000000
Binary files a/intl/icu/source/data/in/uprops.icu.rej and /dev/null differ
diff --git a/intl/icu/source/i18n/timezone.cpp.orig b/intl/icu/source/i18n/timezone.cpp.orig
deleted file mode 100644
index 00eca38..0000000
--- a/intl/icu/source/i18n/timezone.cpp.orig
+++ /dev/null
@@ -1,1698 +0,0 @@
-/*
-*******************************************************************************
-* Copyright (C) 1997-2015, International Business Machines Corporation and
-* others. All Rights Reserved.
-*******************************************************************************
-*
-* File TIMEZONE.CPP
-*
-* Modification History:
-*
-*   Date        Name        Description
-*   12/05/96    clhuang     Creation.
-*   04/21/97    aliu        General clean-up and bug fixing.
-*   05/08/97    aliu        Fixed Hashtable code per code review.
-*   07/09/97    helena      Changed createInstance to createDefault.
-*   07/29/97    aliu        Updated with all-new list of 96 UNIX-derived
-*                           TimeZones.  Changed mechanism to load from static
-*                           array rather than resource bundle.
-*   07/07/1998  srl         Bugfixes from the Java side: UTC GMT CAT NST
-*                           Added getDisplayName API
-*                           going to add custom parsing.
-*
-*                           ISSUES:
-*                               - should getDisplayName cache something?
-*                               - should custom time zones be cached? [probably]
-*  08/10/98     stephen     Brought getDisplayName() API in-line w/ conventions
-*  08/19/98     stephen     Changed createTimeZone() to never return 0
-*  09/02/98     stephen     Added getOffset(monthLen) and hasSameRules()
-*  09/15/98     stephen     Added getStaticClassID()
-*  02/22/99     stephen     Removed character literals for EBCDIC safety
-*  05/04/99     stephen     Changed initDefault() for Mutex issues
-*  07/12/99     helena      HPUX 11 CC Port.
-*  12/03/99     aliu        Moved data out of static table into icudata.dll.
-*                           Substantial rewrite of zone lookup, default zone, and
-*                           available IDs code.  Misc. cleanup.
-*********************************************************************************/
-
-#include "utypeinfo.h"  // for 'typeid' to work
-
-#include "unicode/utypes.h"
-#include "unicode/ustring.h"
-#include "uassert.h"
-#include "ustr_imp.h"
-
-#ifdef U_DEBUG_TZ
-# include <stdio.h>
-# include "uresimp.h" // for debugging
-
-static void debug_tz_loc(const char *f, int32_t l)
-{
-  fprintf(stderr, "%s:%d: ", f, l);
-}
-
-static void debug_tz_msg(const char *pat, ...)
-{
-  va_list ap;
-  va_start(ap, pat);
-  vfprintf(stderr, pat, ap);
-  fflush(stderr);
-}
-static char gStrBuf[256];
-#define U_DEBUG_TZ_STR(x) u_austrncpy(gStrBuf,x,sizeof(gStrBuf)-1)
-// must use double parens, i.e.:  U_DEBUG_TZ_MSG(("four is: %d",4));
-#define U_DEBUG_TZ_MSG(x) {debug_tz_loc(__FILE__,__LINE__);debug_tz_msg x;}
-#else
-#define U_DEBUG_TZ_MSG(x)
-#endif
-
-#if !UCONFIG_NO_FORMATTING
-
-#include "unicode/simpletz.h"
-#include "unicode/calendar.h"
-#include "unicode/gregocal.h"
-#include "unicode/ures.h"
-#include "unicode/tzfmt.h"
-#include "unicode/numfmt.h"
-#include "gregoimp.h"
-#include "uresimp.h" // struct UResourceBundle
-#include "olsontz.h"
-#include "mutex.h"
-#include "unicode/udata.h"
-#include "ucln_in.h"
-#include "cstring.h"
-#include "cmemory.h"
-#include "unicode/strenum.h"
-#include "uassert.h"
-#include "zonemeta.h"
-
-#define kZONEINFO "zoneinfo64"
-#define kREGIONS  "Regions"
-#define kZONES    "Zones"
-#define kRULES    "Rules"
-#define kNAMES    "Names"
-#define kTZVERSION  "TZVersion"
-#define kLINKS    "links"
-#define kMAX_CUSTOM_HOUR    23
-#define kMAX_CUSTOM_MIN     59
-#define kMAX_CUSTOM_SEC     59
-#define MINUS 0x002D
-#define PLUS 0x002B
-#define ZERO_DIGIT 0x0030
-#define COLON 0x003A
-
-// Static data and constants
-
-static const UChar         WORLD[] = {0x30, 0x30, 0x31, 0x00}; /* "001" */
-
-static const UChar         GMT_ID[] = {0x47, 0x4D, 0x54, 0x00}; /* "GMT" */
-static const UChar         UNKNOWN_ZONE_ID[] = {0x45, 0x74, 0x63, 0x2F, 0x55, 0x6E, 0x6B, 0x6E, 0x6F, 0x77, 0x6E, 0x00}; /* "Etc/Unknown" */
-static const int32_t       GMT_ID_LENGTH = 3;
-static const int32_t       UNKNOWN_ZONE_ID_LENGTH = 11;
-
-static icu::TimeZone* DEFAULT_ZONE = NULL;
-static icu::UInitOnce gDefaultZoneInitOnce = U_INITONCE_INITIALIZER;
-
-static icu::TimeZone* _GMT = NULL;
-static icu::TimeZone* _UNKNOWN_ZONE = NULL;
-static icu::UInitOnce gStaticZonesInitOnce = U_INITONCE_INITIALIZER;
-
-static char TZDATA_VERSION[16];
-static icu::UInitOnce gTZDataVersionInitOnce = U_INITONCE_INITIALIZER;
-
-static int32_t* MAP_SYSTEM_ZONES = NULL;
-static int32_t* MAP_CANONICAL_SYSTEM_ZONES = NULL;
-static int32_t* MAP_CANONICAL_SYSTEM_LOCATION_ZONES = NULL;
-
-static int32_t LEN_SYSTEM_ZONES = 0;
-static int32_t LEN_CANONICAL_SYSTEM_ZONES = 0;
-static int32_t LEN_CANONICAL_SYSTEM_LOCATION_ZONES = 0;
-
-static icu::UInitOnce gSystemZonesInitOnce = U_INITONCE_INITIALIZER;
-static icu::UInitOnce gCanonicalZonesInitOnce = U_INITONCE_INITIALIZER;
-static icu::UInitOnce gCanonicalLocationZonesInitOnce = U_INITONCE_INITIALIZER;
-
-U_CDECL_BEGIN
-static UBool U_CALLCONV timeZone_cleanup(void)
-{
-    U_NAMESPACE_USE
-    delete DEFAULT_ZONE;
-    DEFAULT_ZONE = NULL;
-    gDefaultZoneInitOnce.reset();
-
-    delete _GMT;
-    _GMT = NULL;
-    delete _UNKNOWN_ZONE;
-    _UNKNOWN_ZONE = NULL;
-    gStaticZonesInitOnce.reset();
-
-    uprv_memset(TZDATA_VERSION, 0, sizeof(TZDATA_VERSION));
-    gTZDataVersionInitOnce.reset();
-
-    LEN_SYSTEM_ZONES = 0;
-    uprv_free(MAP_SYSTEM_ZONES);
-    MAP_SYSTEM_ZONES = 0;
-    gSystemZonesInitOnce.reset();
-
-    LEN_CANONICAL_SYSTEM_ZONES = 0;
-    uprv_free(MAP_CANONICAL_SYSTEM_ZONES);
-    MAP_CANONICAL_SYSTEM_ZONES = 0;
-    gCanonicalZonesInitOnce.reset();
-
-    LEN_CANONICAL_SYSTEM_LOCATION_ZONES = 0;
-    uprv_free(MAP_CANONICAL_SYSTEM_LOCATION_ZONES);
-    MAP_CANONICAL_SYSTEM_LOCATION_ZONES = 0;
-    gCanonicalLocationZonesInitOnce.reset();
-
-    return TRUE;
-}
-U_CDECL_END
-
-U_NAMESPACE_BEGIN
-
-static int32_t findInStringArray(UResourceBundle* array, const UnicodeString& id, UErrorCode &status)
-{
-    UnicodeString copy;
-    const UChar *u;
-    int32_t len;
-
-    int32_t start = 0;
-    int32_t limit = ures_getSize(array);
-    int32_t mid;
-    int32_t lastMid = INT32_MAX;
-    if(U_FAILURE(status) || (limit < 1)) {
-        return -1;
-    }
-    U_DEBUG_TZ_MSG(("fisa: Looking for %s, between %d and %d\n", U_DEBUG_TZ_STR(UnicodeString(id).getTerminatedBuffer()), start, limit));
-
-    for (;;) {
-        mid = (int32_t)((start + limit) / 2);
-        if (lastMid == mid) {   /* Have we moved? */
-            break;  /* We haven't moved, and it wasn't found. */
-        }
-        lastMid = mid;
-        u = ures_getStringByIndex(array, mid, &len, &status);
-        if (U_FAILURE(status)) {
-            break;
-        }
-        U_DEBUG_TZ_MSG(("tz: compare to %s, %d .. [%d] .. %d\n", U_DEBUG_TZ_STR(u), start, mid, limit));
-        copy.setTo(TRUE, u, len);
-        int r = id.compare(copy);
-        if(r==0) {
-            U_DEBUG_TZ_MSG(("fisa: found at %d\n", mid));
-            return mid;
-        } else if(r<0) {
-            limit = mid;
-        } else {
-            start = mid;
-        }
-    }
-    U_DEBUG_TZ_MSG(("fisa: not found\n"));
-    return -1;
-}
-
-/**
- * Fetch a specific zone by name.  Replaces the getByKey call.
- * @param top Top timezone resource
- * @param id Time zone ID
- * @param oldbundle Bundle for reuse (or NULL).   see 'ures_open()'
- * @return the zone's bundle if found, or undefined if error.  Reuses oldbundle.
- */
-static UResourceBundle* getZoneByName(const UResourceBundle* top, const UnicodeString& id, UResourceBundle *oldbundle, UErrorCode& status) {
-    // load the Rules object
-    UResourceBundle *tmp = ures_getByKey(top, kNAMES, NULL, &status);
-
-    // search for the string
-    int32_t idx = findInStringArray(tmp, id, status);
-
-    if((idx == -1) && U_SUCCESS(status)) {
-        // not found
-        status = U_MISSING_RESOURCE_ERROR;
-        //ures_close(oldbundle);
-        //oldbundle = NULL;
-    } else {
-        U_DEBUG_TZ_MSG(("gzbn: oldbundle= size %d, type %d, %s\n", ures_getSize(tmp), ures_getType(tmp), u_errorName(status)));
-        tmp = ures_getByKey(top, kZONES, tmp, &status); // get Zones object from top
-        U_DEBUG_TZ_MSG(("gzbn: loaded ZONES, size %d, type %d, path %s %s\n", ures_getSize(tmp), ures_getType(tmp), ures_getPath(tmp), u_errorName(status)));
-        oldbundle = ures_getByIndex(tmp, idx, oldbundle, &status); // get nth Zone object
-        U_DEBUG_TZ_MSG(("gzbn: loaded z#%d, size %d, type %d, path %s, %s\n", idx, ures_getSize(oldbundle), ures_getType(oldbundle), ures_getPath(oldbundle),  u_errorName(status)));
-    }
-    ures_close(tmp);
-    if(U_FAILURE(status)) {
-        //ures_close(oldbundle);
-        return NULL;
-    } else {
-        return oldbundle;
-    }
-}
-
-
-UResourceBundle* TimeZone::loadRule(const UResourceBundle* top, const UnicodeString& ruleid, UResourceBundle* oldbundle, UErrorCode& status) {
-    char key[64];
-    ruleid.extract(0, sizeof(key)-1, key, (int32_t)sizeof(key)-1, US_INV);
-    U_DEBUG_TZ_MSG(("loadRule(%s)\n", key));
-    UResourceBundle *r = ures_getByKey(top, kRULES, oldbundle, &status);
-    U_DEBUG_TZ_MSG(("loadRule(%s) -> kRULES [%s]\n", key, u_errorName(status)));
-    r = ures_getByKey(r, key, r, &status);
-    U_DEBUG_TZ_MSG(("loadRule(%s) -> item [%s]\n", key, u_errorName(status)));
-    return r;
-}
-
-/**
- * Given an ID, open the appropriate resource for the given time zone.
- * Dereference aliases if necessary.
- * @param id zone id
- * @param res resource, which must be ready for use (initialized but not open)
- * @param ec input-output error code
- * @return top-level resource bundle
- */
-static UResourceBundle* openOlsonResource(const UnicodeString& id,
-                                          UResourceBundle& res,
-                                          UErrorCode& ec)
-{
-#if U_DEBUG_TZ
-    char buf[128];
-    id.extract(0, sizeof(buf)-1, buf, sizeof(buf), "");
-#endif
-    UResourceBundle *top = ures_openDirect(0, kZONEINFO, &ec);
-    U_DEBUG_TZ_MSG(("pre: res sz=%d\n", ures_getSize(&res)));
-    /* &res = */ getZoneByName(top, id, &res, ec);
-    // Dereference if this is an alias.  Docs say result should be 1
-    // but it is 0 in 2.8 (?).
-    U_DEBUG_TZ_MSG(("Loading zone '%s' (%s, size %d) - %s\n", buf, ures_getKey((UResourceBundle*)&res), ures_getSize(&res), u_errorName(ec)));
-    if (ures_getType(&res) == URES_INT) {
-        int32_t deref = ures_getInt(&res, &ec) + 0;
-        U_DEBUG_TZ_MSG(("getInt: %s - type is %d\n", u_errorName(ec), ures_getType(&res)));
-        UResourceBundle *ares = ures_getByKey(top, kZONES, NULL, &ec); // dereference Zones section
-        ures_getByIndex(ares, deref, &res, &ec);
-        ures_close(ares);
-        U_DEBUG_TZ_MSG(("alias to #%d (%s) - %s\n", deref, "??", u_errorName(ec)));
-    } else {
-        U_DEBUG_TZ_MSG(("not an alias - size %d\n", ures_getSize(&res)));
-    }
-    U_DEBUG_TZ_MSG(("%s - final status is %s\n", buf, u_errorName(ec)));
-    return top;
-}
-
-// -------------------------------------
-
-namespace {
-
-void U_CALLCONV initStaticTimeZones() {
-    // Initialize _GMT independently of other static data; it should
-    // be valid even if we can't load the time zone UDataMemory.
-    ucln_i18n_registerCleanup(UCLN_I18N_TIMEZONE, timeZone_cleanup);
-    _UNKNOWN_ZONE = new SimpleTimeZone(0, UnicodeString(TRUE, UNKNOWN_ZONE_ID, UNKNOWN_ZONE_ID_LENGTH));
-    _GMT = new SimpleTimeZone(0, UnicodeString(TRUE, GMT_ID, GMT_ID_LENGTH));
-}
-
-}  // anonymous namespace
-
-const TimeZone& U_EXPORT2
-TimeZone::getUnknown()
-{
-    umtx_initOnce(gStaticZonesInitOnce, &initStaticTimeZones);
-    return *_UNKNOWN_ZONE;
-}
-
-const TimeZone* U_EXPORT2
-TimeZone::getGMT(void)
-{
-    umtx_initOnce(gStaticZonesInitOnce, &initStaticTimeZones);
-    return _GMT;
-}
-
-// *****************************************************************************
-// class TimeZone
-// *****************************************************************************
-
-UOBJECT_DEFINE_ABSTRACT_RTTI_IMPLEMENTATION(TimeZone)
-
-TimeZone::TimeZone()
-    :   UObject(), fID()
-{
-}
-
-// -------------------------------------
-
-TimeZone::TimeZone(const UnicodeString &id)
-    :   UObject(), fID(id)
-{
-}
-
-// -------------------------------------
-
-TimeZone::~TimeZone()
-{
-}
-
-// -------------------------------------
-
-TimeZone::TimeZone(const TimeZone &source)
-    :   UObject(source), fID(source.fID)
-{
-}
-
-// -------------------------------------
-
-TimeZone &
-TimeZone::operator=(const TimeZone &right)
-{
-    if (this != &right) fID = right.fID;
-    return *this;
-}
-
-// -------------------------------------
-
-UBool
-TimeZone::operator==(const TimeZone& that) const
-{
-    return typeid(*this) == typeid(that) &&
-        fID == that.fID;
-}
-
-// -------------------------------------
-
-namespace {
-TimeZone*
-createSystemTimeZone(const UnicodeString& id, UErrorCode& ec) {
-    if (U_FAILURE(ec)) {
-        return NULL;
-    }
-    TimeZone* z = 0;
-    UResourceBundle res;
-    ures_initStackObject(&res);
-    U_DEBUG_TZ_MSG(("pre-err=%s\n", u_errorName(ec)));
-    UResourceBundle *top = openOlsonResource(id, res, ec);
-    U_DEBUG_TZ_MSG(("post-err=%s\n", u_errorName(ec)));
-    if (U_SUCCESS(ec)) {
-        z = new OlsonTimeZone(top, &res, id, ec);
-        if (z == NULL) {
-          U_DEBUG_TZ_MSG(("cstz: olson time zone failed to initialize - err %s\n", u_errorName(ec)));
-        }
-    }
-    ures_close(&res);
-    ures_close(top);
-    if (U_FAILURE(ec)) {
-        U_DEBUG_TZ_MSG(("cstz: failed to create, err %s\n", u_errorName(ec)));
-        delete z;
-        z = 0;
-    }
-    return z;
-}
-
-/**
- * Lookup the given name in our system zone table.  If found,
- * instantiate a new zone of that name and return it.  If not
- * found, return 0.
- */
-TimeZone*
-createSystemTimeZone(const UnicodeString& id) {
-    UErrorCode ec = U_ZERO_ERROR;
-    return createSystemTimeZone(id, ec);
-}
-
-}
-
-TimeZone* U_EXPORT2
-TimeZone::createTimeZone(const UnicodeString& ID)
-{
-    /* We first try to lookup the zone ID in our system list.  If this
-     * fails, we try to parse it as a custom string GMT[+-]hh:mm.  If
-     * all else fails, we return GMT, which is probably not what the
-     * user wants, but at least is a functioning TimeZone object.
-     *
-     * We cannot return NULL, because that would break compatibility
-     * with the JDK.
-     */
-    TimeZone* result = createSystemTimeZone(ID);
-
-    if (result == NULL) {
-        U_DEBUG_TZ_MSG(("failed to load system time zone with id - falling to custom"));
-        result = createCustomTimeZone(ID);
-    }
-    if (result == NULL) {
-        U_DEBUG_TZ_MSG(("failed to load time zone with id - falling to Etc/Unknown(GMT)"));
-        const TimeZone& unknown = getUnknown();
-        if (_UNKNOWN_ZONE == NULL) {                   // Cannot test (&unknown == NULL) because the
-          U_DEBUG_TZ_MSG(("failed to getUnknown()"));  // behavior of NULL references is undefined.
-        } else {
-          result = unknown.clone();
-        }
-    }
-    return result;
-}
-
-// -------------------------------------
-
-TimeZone* U_EXPORT2
-TimeZone::detectHostTimeZone()
-{
-    // We access system timezone data through TPlatformUtilities,
-    // including tzset(), timezone, and tzname[].
-    int32_t rawOffset = 0;
-    const char *hostID;
-
-    // First, try to create a system timezone, based
-    // on the string ID in tzname[0].
-
-    uprv_tzset(); // Initialize tz... system data
-
-    uprv_tzname_clear_cache();
-
-    // Get the timezone ID from the host.  This function should do
-    // any required host-specific remapping; e.g., on Windows this
-    // function maps the Date and Time control panel setting to an
-    // ICU timezone ID.
-    hostID = uprv_tzname(0);
-
-    // Invert sign because UNIX semantics are backwards
-    rawOffset = uprv_timezone() * -U_MILLIS_PER_SECOND;
-
-    TimeZone* hostZone = NULL;
-
-    /* Make sure that the string is NULL terminated to prevent BoundsChecker/Purify warnings. */
-    UnicodeString hostStrID(hostID, -1, US_INV);
-    hostStrID.append((UChar)0);
-    hostStrID.truncate(hostStrID.length()-1);
-    hostZone = createSystemTimeZone(hostStrID);
-
-#if U_PLATFORM_USES_ONLY_WIN32_API
-    // hostID points to a heap-allocated location on Windows.
-    uprv_free(const_cast<char *>(hostID));
-#endif
-
-    int32_t hostIDLen = hostStrID.length();
-    if (hostZone != NULL && rawOffset != hostZone->getRawOffset()
-        && (3 <= hostIDLen && hostIDLen <= 4))
-    {
-        // Uh oh. This probably wasn't a good id.
-        // It was probably an ambiguous abbreviation
-        delete hostZone;
-        hostZone = NULL;
-    }
-
-    // Construct a fixed standard zone with the host's ID
-    // and raw offset.
-    if (hostZone == NULL) {
-        hostZone = new SimpleTimeZone(rawOffset, hostStrID);
-    }
-
-    // If we _still_ don't have a time zone, use GMT.
-    //
-    // Note: This is extremely unlikely situation. If
-    // new SimpleTimeZone(...) above fails, the following
-    // code may also fail.
-    if (hostZone == NULL) {
-        const TimeZone* temptz = TimeZone::getGMT();
-        // If we can't use GMT, get out.
-        if (temptz == NULL) {
-            return NULL;
-        }
-        hostZone = temptz->clone();
-    }
-
-    return hostZone;
-}
-
-// -------------------------------------
-
-/**
- * Initialize DEFAULT_ZONE from the system default time zone.  
- * Upon return, DEFAULT_ZONE will not be NULL, unless operator new()
- * returns NULL.
- */
-static void U_CALLCONV initDefault()
-{
-    ucln_i18n_registerCleanup(UCLN_I18N_TIMEZONE, timeZone_cleanup);
-
-    // If setDefault() has already been called we can skip getting the
-    // default zone information from the system.
-    if (DEFAULT_ZONE != NULL) {
-        return;
-    }
-    
-    // NOTE:  this code is safely single threaded, being only
-    // run via umtx_initOnce().
-    //
-    // Some of the locale/timezone OS functions may not be thread safe,
-    //
-    // The operating system might actually use ICU to implement timezones.
-    // So we may have ICU calling ICU here, like on AIX.
-    // There shouldn't be a problem with this; initOnce does not hold a mutex
-    // while the init function is being run.
-
-    // The code detecting the host time zone was separated from this
-    // and implemented as TimeZone::detectHostTimeZone()
-
-    TimeZone *default_zone = TimeZone::detectHostTimeZone();
-
-    // The only way for DEFAULT_ZONE to be non-null at this point is if the user
-    // made a thread-unsafe call to setDefault() or adoptDefault() in another
-    // thread while this thread was doing something that required getting the default.
-    U_ASSERT(DEFAULT_ZONE == NULL);
-
-    DEFAULT_ZONE = default_zone;
-}
-
-// -------------------------------------
-
-TimeZone* U_EXPORT2
-TimeZone::createDefault()
-{
-    umtx_initOnce(gDefaultZoneInitOnce, initDefault);
-    return (DEFAULT_ZONE != NULL) ? DEFAULT_ZONE->clone() : NULL;
-}
-
-// -------------------------------------
-
-void U_EXPORT2
-TimeZone::adoptDefault(TimeZone* zone)
-{
-    if (zone != NULL)
-    {
-        TimeZone *old = DEFAULT_ZONE;
-        DEFAULT_ZONE = zone;
-        delete old;
-        ucln_i18n_registerCleanup(UCLN_I18N_TIMEZONE, timeZone_cleanup);
-    }
-}
-// -------------------------------------
-
-void U_EXPORT2
-TimeZone::setDefault(const TimeZone& zone)
-{
-    adoptDefault(zone.clone());
-}
-
-//----------------------------------------------------------------------
-
-
-static void U_CALLCONV initMap(USystemTimeZoneType type, UErrorCode& ec) {
-    ucln_i18n_registerCleanup(UCLN_I18N_TIMEZONE, timeZone_cleanup);
-
-    UResourceBundle *res = ures_openDirect(0, kZONEINFO, &ec);
-    res = ures_getByKey(res, kNAMES, res, &ec); // dereference Zones section
-    if (U_SUCCESS(ec)) {
-        int32_t size = ures_getSize(res);
-        int32_t *m = (int32_t *)uprv_malloc(size * sizeof(int32_t));
-        if (m == NULL) {
-            ec = U_MEMORY_ALLOCATION_ERROR;
-        } else {
-            int32_t numEntries = 0;
-            for (int32_t i = 0; i < size; i++) {
-                UnicodeString id = ures_getUnicodeStringByIndex(res, i, &ec);
-                if (U_FAILURE(ec)) {
-                    break;
-                }
-                if (0 == id.compare(UNKNOWN_ZONE_ID, UNKNOWN_ZONE_ID_LENGTH)) {
-                    // exclude Etc/Unknown
-                    continue;
-                }
-                if (type == UCAL_ZONE_TYPE_CANONICAL || type == UCAL_ZONE_TYPE_CANONICAL_LOCATION) {
-                    UnicodeString canonicalID;
-                    ZoneMeta::getCanonicalCLDRID(id, canonicalID, ec);
-                    if (U_FAILURE(ec)) {
-                        break;
-                    }
-                    if (canonicalID != id) {
-                        // exclude aliases
-                        continue;
-                    }
-                }
-                if (type == UCAL_ZONE_TYPE_CANONICAL_LOCATION) {
-                    const UChar *region = TimeZone::getRegion(id, ec);
-                    if (U_FAILURE(ec)) {
-                        break;
-                    }
-                    if (u_strcmp(region, WORLD) == 0) {
-                       // exclude non-location ("001")
-                        continue;
-                    }
-                }
-                m[numEntries++] = i;
-            }
-            if (U_SUCCESS(ec)) {
-                int32_t *tmp = m;
-                m = (int32_t *)uprv_realloc(tmp, numEntries * sizeof(int32_t));
-                if (m == NULL) {
-                    // realloc failed.. use the original one even it has unused
-                    // area at the end
-                    m = tmp;
-                }
-
-                switch(type) {
-                case UCAL_ZONE_TYPE_ANY:
-                    U_ASSERT(MAP_SYSTEM_ZONES == NULL);
-                    MAP_SYSTEM_ZONES = m;
-                    LEN_SYSTEM_ZONES = numEntries;
-                    break;
-                case UCAL_ZONE_TYPE_CANONICAL:
-                    U_ASSERT(MAP_CANONICAL_SYSTEM_ZONES == NULL);
-                    MAP_CANONICAL_SYSTEM_ZONES = m;
-                    LEN_CANONICAL_SYSTEM_ZONES = numEntries;
-                    break;
-                case UCAL_ZONE_TYPE_CANONICAL_LOCATION:
-                    U_ASSERT(MAP_CANONICAL_SYSTEM_LOCATION_ZONES == NULL);
-                    MAP_CANONICAL_SYSTEM_LOCATION_ZONES = m;
-                    LEN_CANONICAL_SYSTEM_LOCATION_ZONES = numEntries;
-                    break;
-                }
-            }
-        }
-    }
-    ures_close(res);
-}
-
-
-/**
- * This is the default implementation for subclasses that do not
- * override this method.  This implementation calls through to the
- * 8-argument getOffset() method after suitable computations, and
- * correctly adjusts GMT millis to local millis when necessary.
- */
-void TimeZone::getOffset(UDate date, UBool local, int32_t& rawOffset,
-                         int32_t& dstOffset, UErrorCode& ec) const {
-    if (U_FAILURE(ec)) {
-        return;
-    }
-
-    rawOffset = getRawOffset();
-    if (!local) {
-        date += rawOffset; // now in local standard millis
-    }
-
-    // When local == TRUE, date might not be in local standard
-    // millis.  getOffset taking 7 parameters used here assume
-    // the given time in day is local standard time.
-    // At STD->DST transition, there is a range of time which
-    // does not exist.  When 'date' is in this time range
-    // (and local == TRUE), this method interprets the specified
-    // local time as DST.  At DST->STD transition, there is a
-    // range of time which occurs twice.  In this case, this
-    // method interprets the specified local time as STD.
-    // To support the behavior above, we need to call getOffset
-    // (with 7 args) twice when local == true and DST is
-    // detected in the initial call.
-    for (int32_t pass=0; ; ++pass) {
-        int32_t year, month, dom, dow;
-        double day = uprv_floor(date / U_MILLIS_PER_DAY);
-        int32_t millis = (int32_t) (date - day * U_MILLIS_PER_DAY);
-
-        Grego::dayToFields(day, year, month, dom, dow);
-
-        dstOffset = getOffset(GregorianCalendar::AD, year, month, dom,
-                              (uint8_t) dow, millis,
-                              Grego::monthLength(year, month),
-                              ec) - rawOffset;
-
-        // Recompute if local==TRUE, dstOffset!=0.
-        if (pass!=0 || !local || dstOffset == 0) {
-            break;
-        }
-        // adjust to local standard millis
-        date -= dstOffset;
-    }
-}
-
-// -------------------------------------
-
-// New available IDs API as of ICU 2.4.  Uses StringEnumeration API.
-
-class TZEnumeration : public StringEnumeration {
-private:
-
-    // Map into to zones.  Our results are zone[map[i]] for
-    // i=0..len-1, where zone[i] is the i-th Olson zone.  If map==NULL
-    // then our results are zone[i] for i=0..len-1.  Len will be zero
-    // if the zone data could not be loaded.
-    int32_t* map;
-    int32_t* localMap;
-    int32_t  len;
-    int32_t  pos;
-
-    TZEnumeration(int32_t* mapData, int32_t mapLen, UBool adoptMapData) : pos(0) {
-        map = mapData;
-        localMap = adoptMapData ? mapData : NULL;
-        len = mapLen;
-    }
-
-    UBool getID(int32_t i) {
-        UErrorCode ec = U_ZERO_ERROR;
-        int32_t idLen = 0;
-        const UChar* id = NULL;
-        UResourceBundle *top = ures_openDirect(0, kZONEINFO, &ec);
-        top = ures_getByKey(top, kNAMES, top, &ec); // dereference Zones section
-        id = ures_getStringByIndex(top, i, &idLen, &ec);
-        if(U_FAILURE(ec)) {
-            unistr.truncate(0);
-        }
-        else {
-            unistr.fastCopyFrom(UnicodeString(TRUE, id, idLen));
-        }
-        ures_close(top);
-        return U_SUCCESS(ec);
-    }
-
-    static int32_t* getMap(USystemTimeZoneType type, int32_t& len, UErrorCode& ec) {
-        len = 0;
-        if (U_FAILURE(ec)) {
-            return NULL;
-        }
-        int32_t* m = NULL;
-        switch (type) {
-        case UCAL_ZONE_TYPE_ANY:
-            umtx_initOnce(gSystemZonesInitOnce, &initMap, type, ec);
-            m = MAP_SYSTEM_ZONES;
-            len = LEN_SYSTEM_ZONES;
-            break;
-        case UCAL_ZONE_TYPE_CANONICAL:
-            umtx_initOnce(gCanonicalZonesInitOnce, &initMap, type, ec);
-            m = MAP_CANONICAL_SYSTEM_ZONES;
-            len = LEN_CANONICAL_SYSTEM_ZONES;
-            break;
-        case UCAL_ZONE_TYPE_CANONICAL_LOCATION:
-            umtx_initOnce(gCanonicalLocationZonesInitOnce, &initMap, type, ec);
-            m = MAP_CANONICAL_SYSTEM_LOCATION_ZONES;
-            len = LEN_CANONICAL_SYSTEM_LOCATION_ZONES;
-            break;
-        default:
-            ec = U_ILLEGAL_ARGUMENT_ERROR;
-            m = NULL;
-            len = 0;
-            break;
-        }
-        return m;
-    }
-
-public:
-
-#define DEFAULT_FILTERED_MAP_SIZE 8
-#define MAP_INCREMENT_SIZE 8
-
-    static TZEnumeration* create(USystemTimeZoneType type, const char* region, const int32_t* rawOffset, UErrorCode& ec) {
-        if (U_FAILURE(ec)) {
-            return NULL;
-        }
-
-        int32_t baseLen;
-        int32_t *baseMap = getMap(type, baseLen, ec);
-
-        if (U_FAILURE(ec)) {
-            return NULL;
-        }
-
-        // If any additional conditions are available,
-        // create instance local map filtered by the conditions.
-
-        int32_t *filteredMap = NULL;
-        int32_t numEntries = 0;
-
-        if (region != NULL || rawOffset != NULL) {
-            int32_t filteredMapSize = DEFAULT_FILTERED_MAP_SIZE;
-            filteredMap = (int32_t *)uprv_malloc(filteredMapSize * sizeof(int32_t));
-            if (filteredMap == NULL) {
-                ec = U_MEMORY_ALLOCATION_ERROR;
-                return NULL;
-            }
-
-            // Walk through the base map
-            UResourceBundle *res = ures_openDirect(0, kZONEINFO, &ec);
-            res = ures_getByKey(res, kNAMES, res, &ec); // dereference Zones section
-            for (int32_t i = 0; i < baseLen; i++) {
-                int32_t zidx = baseMap[i];
-                UnicodeString id = ures_getUnicodeStringByIndex(res, zidx, &ec);
-                if (U_FAILURE(ec)) {
-                    break;
-                }
-                if (region != NULL) {
-                    // Filter by region
-                    char tzregion[4]; // max 3 letters + null term
-                    TimeZone::getRegion(id, tzregion, sizeof(tzregion), ec);
-                    if (U_FAILURE(ec)) {
-                        break;
-                    }
-                    if (uprv_stricmp(tzregion, region) != 0) {
-                        // region does not match
-                        continue;
-                    }
-                }
-                if (rawOffset != NULL) {
-                    // Filter by raw offset
-                    // Note: This is VERY inefficient
-                    TimeZone *z = createSystemTimeZone(id, ec);
-                    if (U_FAILURE(ec)) {
-                        break;
-                    }
-                    int32_t tzoffset = z->getRawOffset();
-                    delete z;
-
-                    if (tzoffset != *rawOffset) {
-                        continue;
-                    }
-                }
-
-                if (filteredMapSize <= numEntries) {
-                    filteredMapSize += MAP_INCREMENT_SIZE;
-                    int32_t *tmp = (int32_t *)uprv_realloc(filteredMap, filteredMapSize * sizeof(int32_t));
-                    if (tmp == NULL) {
-                        ec = U_MEMORY_ALLOCATION_ERROR;
-                        break;
-                    } else {
-                        filteredMap = tmp;
-                    }
-                }
-
-                filteredMap[numEntries++] = zidx;
-            }
-
-            if (U_FAILURE(ec)) {
-                uprv_free(filteredMap);
-                filteredMap = NULL;
-            }
-
-            ures_close(res);
-        }
-
-        TZEnumeration *result = NULL;
-        if (U_SUCCESS(ec)) {
-            // Finally, create a new enumeration instance
-            if (filteredMap == NULL) {
-                result = new TZEnumeration(baseMap, baseLen, FALSE);
-            } else {
-                result = new TZEnumeration(filteredMap, numEntries, TRUE);
-                filteredMap = NULL;
-            }
-            if (result == NULL) {
-                ec = U_MEMORY_ALLOCATION_ERROR;
-            }
-        }
-
-        if (filteredMap != NULL) {
-            uprv_free(filteredMap);
-        }
-
-        return result;
-    }
-
-    TZEnumeration(const TZEnumeration &other) : StringEnumeration(), map(NULL), localMap(NULL), len(0), pos(0) {
-        if (other.localMap != NULL) {
-            localMap = (int32_t *)uprv_malloc(other.len * sizeof(int32_t));
-            if (localMap != NULL) {
-                len = other.len;
-                uprv_memcpy(localMap, other.localMap, len * sizeof(int32_t));
-                pos = other.pos;
-                map = localMap;
-            } else {
-                len = 0;
-                pos = 0;
-                map = NULL;
-            }
-        } else {
-            map = other.map;
-            localMap = NULL;
-            len = other.len;
-            pos = other.pos;
-        }
-    }
-
-    virtual ~TZEnumeration();
-
-    virtual StringEnumeration *clone() const {
-        return new TZEnumeration(*this);
-    }
-
-    virtual int32_t count(UErrorCode& status) const {
-        return U_FAILURE(status) ? 0 : len;
-    }
-
-    virtual const UnicodeString* snext(UErrorCode& status) {
-        if (U_SUCCESS(status) && map != NULL && pos < len) {
-            getID(map[pos]);
-            ++pos;
-            return &unistr;
-        }
-        return 0;
-    }
-
-    virtual void reset(UErrorCode& /*status*/) {
-        pos = 0;
-    }
-
-public:
-    static UClassID U_EXPORT2 getStaticClassID(void);
-    virtual UClassID getDynamicClassID(void) const;
-};
-
-TZEnumeration::~TZEnumeration() {
-    if (localMap != NULL) {
-        uprv_free(localMap);
-    }
-}
-
-UOBJECT_DEFINE_RTTI_IMPLEMENTATION(TZEnumeration)
-
-StringEnumeration* U_EXPORT2
-TimeZone::createTimeZoneIDEnumeration(
-            USystemTimeZoneType zoneType,
-            const char* region,
-            const int32_t* rawOffset,
-            UErrorCode& ec) {
-    return TZEnumeration::create(zoneType, region, rawOffset, ec);
-}
-
-StringEnumeration* U_EXPORT2
-TimeZone::createEnumeration() {
-    UErrorCode ec = U_ZERO_ERROR;
-    return TZEnumeration::create(UCAL_ZONE_TYPE_ANY, NULL, NULL, ec);
-}
-
-StringEnumeration* U_EXPORT2
-TimeZone::createEnumeration(int32_t rawOffset) {
-    UErrorCode ec = U_ZERO_ERROR;
-    return TZEnumeration::create(UCAL_ZONE_TYPE_ANY, NULL, &rawOffset, ec);
-}
-
-StringEnumeration* U_EXPORT2
-TimeZone::createEnumeration(const char* country) {
-    UErrorCode ec = U_ZERO_ERROR;
-    return TZEnumeration::create(UCAL_ZONE_TYPE_ANY, country, NULL, ec);
-}
-
-// ---------------------------------------
-
-int32_t U_EXPORT2
-TimeZone::countEquivalentIDs(const UnicodeString& id) {
-    int32_t result = 0;
-    UErrorCode ec = U_ZERO_ERROR;
-    UResourceBundle res;
-    ures_initStackObject(&res);
-    U_DEBUG_TZ_MSG(("countEquivalentIDs..\n"));
-    UResourceBundle *top = openOlsonResource(id, res, ec);
-    if (U_SUCCESS(ec)) {
-        UResourceBundle r;
-        ures_initStackObject(&r);
-        ures_getByKey(&res, kLINKS, &r, &ec);
-        ures_getIntVector(&r, &result, &ec);
-        ures_close(&r);
-    }
-    ures_close(&res);
-    ures_close(top);
-    return result;
-}
-
-// ---------------------------------------
-
-const UnicodeString U_EXPORT2
-TimeZone::getEquivalentID(const UnicodeString& id, int32_t index) {
-    U_DEBUG_TZ_MSG(("gEI(%d)\n", index));
-    UnicodeString result;
-    UErrorCode ec = U_ZERO_ERROR;
-    UResourceBundle res;
-    ures_initStackObject(&res);
-    UResourceBundle *top = openOlsonResource(id, res, ec);
-    int32_t zone = -1;
-    if (U_SUCCESS(ec)) {
-        UResourceBundle r;
-        ures_initStackObject(&r);
-        int32_t size;
-        ures_getByKey(&res, kLINKS, &r, &ec);
-        const int32_t* v = ures_getIntVector(&r, &size, &ec);
-        if (U_SUCCESS(ec)) {
-            if (index >= 0 && index < size) {
-                zone = v[index];
-            }
-        }
-        ures_close(&r);
-    }
-    ures_close(&res);
-    if (zone >= 0) {
-        UResourceBundle *ares = ures_getByKey(top, kNAMES, NULL, &ec); // dereference Zones section
-        if (U_SUCCESS(ec)) {
-            int32_t idLen = 0;
-            const UChar* id = ures_getStringByIndex(ares, zone, &idLen, &ec);
-            result.fastCopyFrom(UnicodeString(TRUE, id, idLen));
-            U_DEBUG_TZ_MSG(("gei(%d) -> %d, len%d, %s\n", index, zone, result.length(), u_errorName(ec)));
-        }
-        ures_close(ares);
-    }
-    ures_close(top);
-#if defined(U_DEBUG_TZ)
-    if(result.length() ==0) {
-      U_DEBUG_TZ_MSG(("equiv [__, #%d] -> 0 (%s)\n", index, u_errorName(ec)));
-    }
-#endif
-    return result;
-}
-
-// ---------------------------------------
-
-// These methods are used by ZoneMeta class only.
-
-const UChar*
-TimeZone::findID(const UnicodeString& id) {
-    const UChar *result = NULL;
-    UErrorCode ec = U_ZERO_ERROR;
-    UResourceBundle *rb = ures_openDirect(NULL, kZONEINFO, &ec);
-
-    // resolve zone index by name
-    UResourceBundle *names = ures_getByKey(rb, kNAMES, NULL, &ec);
-    int32_t idx = findInStringArray(names, id, ec);
-    result = ures_getStringByIndex(names, idx, NULL, &ec);
-    if (U_FAILURE(ec)) {
-        result = NULL;
-    }
-    ures_close(names);
-    ures_close(rb);
-    return result;
-}
-
-
-const UChar*
-TimeZone::dereferOlsonLink(const UnicodeString& id) {
-    const UChar *result = NULL;
-    UErrorCode ec = U_ZERO_ERROR;
-    UResourceBundle *rb = ures_openDirect(NULL, kZONEINFO, &ec);
-
-    // resolve zone index by name
-    UResourceBundle *names = ures_getByKey(rb, kNAMES, NULL, &ec);
-    int32_t idx = findInStringArray(names, id, ec);
-    result = ures_getStringByIndex(names, idx, NULL, &ec);
-
-    // open the zone bundle by index
-    ures_getByKey(rb, kZONES, rb, &ec);
-    ures_getByIndex(rb, idx, rb, &ec); 
-
-    if (U_SUCCESS(ec)) {
-        if (ures_getType(rb) == URES_INT) {
-            // this is a link - dereference the link
-            int32_t deref = ures_getInt(rb, &ec);
-            const UChar* tmp = ures_getStringByIndex(names, deref, NULL, &ec);
-            if (U_SUCCESS(ec)) {
-                result = tmp;
-            }
-        }
-    }
-
-    ures_close(names);
-    ures_close(rb);
-
-    return result;
-}
-
-const UChar*
-TimeZone::getRegion(const UnicodeString& id) {
-    UErrorCode status = U_ZERO_ERROR;
-    return getRegion(id, status);
-}
-
-const UChar*
-TimeZone::getRegion(const UnicodeString& id, UErrorCode& status) {
-    if (U_FAILURE(status)) {
-        return NULL;
-    }
-    const UChar *result = NULL;
-    UResourceBundle *rb = ures_openDirect(NULL, kZONEINFO, &status);
-
-    // resolve zone index by name
-    UResourceBundle *res = ures_getByKey(rb, kNAMES, NULL, &status);
-    int32_t idx = findInStringArray(res, id, status);
-
-    // get region mapping
-    ures_getByKey(rb, kREGIONS, res, &status);
-    const UChar *tmp = ures_getStringByIndex(res, idx, NULL, &status);
-    if (U_SUCCESS(status)) {
-        result = tmp;
-    }
-
-    ures_close(res);
-    ures_close(rb);
-
-    return result;
-}
-
-
-// ---------------------------------------
-int32_t
-TimeZone::getRegion(const UnicodeString& id, char *region, int32_t capacity, UErrorCode& status)
-{
-    int32_t resultLen = 0;
-    *region = 0;
-    if (U_FAILURE(status)) {
-        return 0;
-    }
-
-    const UChar *uregion = NULL;
-    // "Etc/Unknown" is not a system zone ID,
-    // but in the zone data
-    if (id.compare(UNKNOWN_ZONE_ID, UNKNOWN_ZONE_ID_LENGTH) != 0) {
-        uregion = getRegion(id);
-    }
-    if (uregion == NULL) {
-        status = U_ILLEGAL_ARGUMENT_ERROR;
-        return 0;
-    }
-    resultLen = u_strlen(uregion);
-    // A region code is represented by invariant characters
-    u_UCharsToChars(uregion, region, uprv_min(resultLen, capacity));
-
-    if (capacity < resultLen) {
-        status = U_BUFFER_OVERFLOW_ERROR;
-        return resultLen;
-    }
-
-    return u_terminateChars(region, capacity, resultLen, &status);
-}
-
-// ---------------------------------------
-
-
-UnicodeString&
-TimeZone::getDisplayName(UnicodeString& result) const
-{
-    return getDisplayName(FALSE,LONG,Locale::getDefault(), result);
-}
-
-UnicodeString&
-TimeZone::getDisplayName(const Locale& locale, UnicodeString& result) const
-{
-    return getDisplayName(FALSE, LONG, locale, result);
-}
-
-UnicodeString&
-TimeZone::getDisplayName(UBool daylight, EDisplayType style, UnicodeString& result)  const
-{
-    return getDisplayName(daylight,style, Locale::getDefault(), result);
-}
-//--------------------------------------
-int32_t
-TimeZone::getDSTSavings()const {
-    if (useDaylightTime()) {
-        return 3600000;
-    }
-    return 0;
-}
-//---------------------------------------
-UnicodeString&
-TimeZone::getDisplayName(UBool daylight, EDisplayType style, const Locale& locale, UnicodeString& result) const
-{
-    UErrorCode status = U_ZERO_ERROR;
-    UDate date = Calendar::getNow();
-    UTimeZoneFormatTimeType timeType;
-    int32_t offset;
-
-    if (style == GENERIC_LOCATION || style == LONG_GENERIC || style == SHORT_GENERIC) {
-        LocalPointer<TimeZoneFormat> tzfmt(TimeZoneFormat::createInstance(locale, status));
-        if (U_FAILURE(status)) {
-            result.remove();
-            return result;
-        }
-        // Generic format
-        switch (style) {
-        case GENERIC_LOCATION:
-            tzfmt->format(UTZFMT_STYLE_GENERIC_LOCATION, *this, date, result, &timeType);
-            break;
-        case LONG_GENERIC:
-            tzfmt->format(UTZFMT_STYLE_GENERIC_LONG, *this, date, result, &timeType);
-            break;
-        case SHORT_GENERIC:
-            tzfmt->format(UTZFMT_STYLE_GENERIC_SHORT, *this, date, result, &timeType);
-            break;
-        default:
-            U_ASSERT(FALSE);
-        }
-        // Generic format many use Localized GMT as the final fallback.
-        // When Localized GMT format is used, the result might not be
-        // appropriate for the requested daylight value.
-        if ((daylight && timeType == UTZFMT_TIME_TYPE_STANDARD) || (!daylight && timeType == UTZFMT_TIME_TYPE_DAYLIGHT)) {
-            offset = daylight ? getRawOffset() + getDSTSavings() : getRawOffset();
-            if (style == SHORT_GENERIC) {
-                tzfmt->formatOffsetShortLocalizedGMT(offset, result, status);
-            } else {
-                tzfmt->formatOffsetLocalizedGMT(offset, result, status);
-            }
-        }
-    } else if (style == LONG_GMT || style == SHORT_GMT) {
-        LocalPointer<TimeZoneFormat> tzfmt(TimeZoneFormat::createInstance(locale, status));
-        if (U_FAILURE(status)) {
-            result.remove();
-            return result;
-        }
-        offset = daylight && useDaylightTime() ? getRawOffset() + getDSTSavings() : getRawOffset();
-        switch (style) {
-        case LONG_GMT:
-            tzfmt->formatOffsetLocalizedGMT(offset, result, status);
-            break;
-        case SHORT_GMT:
-            tzfmt->formatOffsetISO8601Basic(offset, FALSE, FALSE, FALSE, result, status);
-            break;
-        default:
-            U_ASSERT(FALSE);
-        }
-
-    } else {
-        U_ASSERT(style == LONG || style == SHORT || style == SHORT_COMMONLY_USED);
-        UTimeZoneNameType nameType = UTZNM_UNKNOWN;
-        switch (style) {
-        case LONG:
-            nameType = daylight ? UTZNM_LONG_DAYLIGHT : UTZNM_LONG_STANDARD;
-            break;
-        case SHORT:
-        case SHORT_COMMONLY_USED:
-            nameType = daylight ? UTZNM_SHORT_DAYLIGHT : UTZNM_SHORT_STANDARD;
-            break;
-        default:
-            U_ASSERT(FALSE);
-        }
-        LocalPointer<TimeZoneNames> tznames(TimeZoneNames::createInstance(locale, status));
-        if (U_FAILURE(status)) {
-            result.remove();
-            return result;
-        }
-        UnicodeString canonicalID(ZoneMeta::getCanonicalCLDRID(*this));
-        tznames->getDisplayName(canonicalID, nameType, date, result);
-        if (result.isEmpty()) {
-            // Fallback to localized GMT
-            LocalPointer<TimeZoneFormat> tzfmt(TimeZoneFormat::createInstance(locale, status));
-            offset = daylight && useDaylightTime() ? getRawOffset() + getDSTSavings() : getRawOffset();
-            if (style == LONG) {
-                tzfmt->formatOffsetLocalizedGMT(offset, result, status);
-            } else {
-                tzfmt->formatOffsetShortLocalizedGMT(offset, result, status);
-            }
-        }
-    }
-    if (U_FAILURE(status)) {
-        result.remove();
-    }
-    return  result;
-}
-
-/**
- * Parse a custom time zone identifier and return a corresponding zone.
- * @param id a string of the form GMT[+-]hh:mm, GMT[+-]hhmm, or
- * GMT[+-]hh.
- * @return a newly created SimpleTimeZone with the given offset and
- * no Daylight Savings Time, or null if the id cannot be parsed.
-*/
-TimeZone*
-TimeZone::createCustomTimeZone(const UnicodeString& id)
-{
-    int32_t sign, hour, min, sec;
-    if (parseCustomID(id, sign, hour, min, sec)) {
-        UnicodeString customID;
-        formatCustomID(hour, min, sec, (sign < 0), customID);
-        int32_t offset = sign * ((hour * 60 + min) * 60 + sec) * 1000;
-        return new SimpleTimeZone(offset, customID);
-    }
-    return NULL;
-}
-
-UnicodeString&
-TimeZone::getCustomID(const UnicodeString& id, UnicodeString& normalized, UErrorCode& status) {
-    normalized.remove();
-    if (U_FAILURE(status)) {
-        return normalized;
-    }
-    int32_t sign, hour, min, sec;
-    if (parseCustomID(id, sign, hour, min, sec)) {
-        formatCustomID(hour, min, sec, (sign < 0), normalized);
-    } else {
-        status = U_ILLEGAL_ARGUMENT_ERROR;
-    }
-    return normalized;
-}
-
-UBool
-TimeZone::parseCustomID(const UnicodeString& id, int32_t& sign,
-                        int32_t& hour, int32_t& min, int32_t& sec) {
-    static const int32_t         kParseFailed = -99999;
-
-    NumberFormat* numberFormat = 0;
-    UnicodeString idUppercase = id;
-    idUppercase.toUpper("");
-
-    if (id.length() > GMT_ID_LENGTH &&
-        idUppercase.startsWith(GMT_ID, GMT_ID_LENGTH))
-    {
-        ParsePosition pos(GMT_ID_LENGTH);
-        sign = 1;
-        hour = 0;
-        min = 0;
-        sec = 0;
-
-        if (id[pos.getIndex()] == MINUS /*'-'*/) {
-            sign = -1;
-        } else if (id[pos.getIndex()] != PLUS /*'+'*/) {
-            return FALSE;
-        }
-        pos.setIndex(pos.getIndex() + 1);
-
-        UErrorCode success = U_ZERO_ERROR;
-        numberFormat = NumberFormat::createInstance(success);
-        if(U_FAILURE(success)){
-            return FALSE;
-        }
-        numberFormat->setParseIntegerOnly(TRUE);
-        //numberFormat->setLenient(TRUE); // TODO: May need to set this, depends on latest timezone parsing
-
-        // Look for either hh:mm, hhmm, or hh
-        int32_t start = pos.getIndex();
-        Formattable n(kParseFailed);
-        numberFormat->parse(id, n, pos);
-        if (pos.getIndex() == start) {
-            delete numberFormat;
-            return FALSE;
-        }
-        hour = n.getLong();
-
-        if (pos.getIndex() < id.length()) {
-            if (pos.getIndex() - start > 2
-                || id[pos.getIndex()] != COLON) {
-                delete numberFormat;
-                return FALSE;
-            }
-            // hh:mm
-            pos.setIndex(pos.getIndex() + 1);
-            int32_t oldPos = pos.getIndex();
-            n.setLong(kParseFailed);
-            numberFormat->parse(id, n, pos);
-            if ((pos.getIndex() - oldPos) != 2) {
-                // must be 2 digits
-                delete numberFormat;
-                return FALSE;
-            }
-            min = n.getLong();
-            if (pos.getIndex() < id.length()) {
-                if (id[pos.getIndex()] != COLON) {
-                    delete numberFormat;
-                    return FALSE;
-                }
-                // [:ss]
-                pos.setIndex(pos.getIndex() + 1);
-                oldPos = pos.getIndex();
-                n.setLong(kParseFailed);
-                numberFormat->parse(id, n, pos);
-                if (pos.getIndex() != id.length()
-                        || (pos.getIndex() - oldPos) != 2) {
-                    delete numberFormat;
-                    return FALSE;
-                }
-                sec = n.getLong();
-            }
-        } else {
-            // Supported formats are below -
-            //
-            // HHmmss
-            // Hmmss
-            // HHmm
-            // Hmm
-            // HH
-            // H
-
-            int32_t length = pos.getIndex() - start;
-            if (length <= 0 || 6 < length) {
-                // invalid length
-                delete numberFormat;
-                return FALSE;
-            }
-            switch (length) {
-                case 1:
-                case 2:
-                    // already set to hour
-                    break;
-                case 3:
-                case 4:
-                    min = hour % 100;
-                    hour /= 100;
-                    break;
-                case 5:
-                case 6:
-                    sec = hour % 100;
-                    min = (hour/100) % 100;
-                    hour /= 10000;
-                    break;
-            }
-        }
-
-        delete numberFormat;
-
-        if (hour > kMAX_CUSTOM_HOUR || min > kMAX_CUSTOM_MIN || sec > kMAX_CUSTOM_SEC) {
-            return FALSE;
-        }
-        return TRUE;
-    }
-    return FALSE;
-}
-
-UnicodeString&
-TimeZone::formatCustomID(int32_t hour, int32_t min, int32_t sec,
-                         UBool negative, UnicodeString& id) {
-    // Create time zone ID - GMT[+|-]hhmm[ss]
-    id.setTo(GMT_ID, GMT_ID_LENGTH);
-    if (hour | min | sec) {
-        if (negative) {
-            id += (UChar)MINUS;
-        } else {
-            id += (UChar)PLUS;
-        }
-
-        if (hour < 10) {
-            id += (UChar)ZERO_DIGIT;
-        } else {
-            id += (UChar)(ZERO_DIGIT + hour/10);
-        }
-        id += (UChar)(ZERO_DIGIT + hour%10);
-        id += (UChar)COLON;
-        if (min < 10) {
-            id += (UChar)ZERO_DIGIT;
-        } else {
-            id += (UChar)(ZERO_DIGIT + min/10);
-        }
-        id += (UChar)(ZERO_DIGIT + min%10);
-
-        if (sec) {
-            id += (UChar)COLON;
-            if (sec < 10) {
-                id += (UChar)ZERO_DIGIT;
-            } else {
-                id += (UChar)(ZERO_DIGIT + sec/10);
-            }
-            id += (UChar)(ZERO_DIGIT + sec%10);
-        }
-    }
-    return id;
-}
-
-
-UBool
-TimeZone::hasSameRules(const TimeZone& other) const
-{
-    return (getRawOffset() == other.getRawOffset() &&
-            useDaylightTime() == other.useDaylightTime());
-}
-
-static void U_CALLCONV initTZDataVersion(UErrorCode &status) {
-    ucln_i18n_registerCleanup(UCLN_I18N_TIMEZONE, timeZone_cleanup);
-    int32_t len = 0;
-    UResourceBundle *bundle = ures_openDirect(NULL, kZONEINFO, &status);
-    const UChar *tzver = ures_getStringByKey(bundle, kTZVERSION, &len, &status);
-
-    if (U_SUCCESS(status)) {
-        if (len >= (int32_t)sizeof(TZDATA_VERSION)) {
-            // Ensure that there is always space for a trailing nul in TZDATA_VERSION
-            len = sizeof(TZDATA_VERSION) - 1;
-        }
-        u_UCharsToChars(tzver, TZDATA_VERSION, len);
-    }
-    ures_close(bundle);
-
-}
-
-const char*
-TimeZone::getTZDataVersion(UErrorCode& status)
-{
-    umtx_initOnce(gTZDataVersionInitOnce, &initTZDataVersion, status);
-    return (const char*)TZDATA_VERSION;
-}
-
-UnicodeString&
-TimeZone::getCanonicalID(const UnicodeString& id, UnicodeString& canonicalID, UErrorCode& status)
-{
-    UBool isSystemID = FALSE;
-    return getCanonicalID(id, canonicalID, isSystemID, status);
-}
-
-UnicodeString&
-TimeZone::getCanonicalID(const UnicodeString& id, UnicodeString& canonicalID, UBool& isSystemID,
-                         UErrorCode& status)
-{
-    canonicalID.remove();
-    isSystemID = FALSE;
-    if (U_FAILURE(status)) {
-        return canonicalID;
-    }
-    if (id.compare(UNKNOWN_ZONE_ID, UNKNOWN_ZONE_ID_LENGTH) == 0) {
-        // special case - Etc/Unknown is a canonical ID, but not system ID
-        canonicalID.fastCopyFrom(id);
-        isSystemID = FALSE;
-    } else {
-        ZoneMeta::getCanonicalCLDRID(id, canonicalID, status);
-        if (U_SUCCESS(status)) {
-            isSystemID = TRUE;
-        } else {
-            // Not a system ID
-            status = U_ZERO_ERROR;
-            getCustomID(id, canonicalID, status);
-        }
-    }
-    return canonicalID;
-}
-
-UnicodeString&
-TimeZone::getWindowsID(const UnicodeString& id, UnicodeString& winid, UErrorCode& status) {
-    winid.remove();
-    if (U_FAILURE(status)) {
-        return winid;
-    }
-
-    // canonicalize the input ID
-    UnicodeString canonicalID;
-    UBool isSystemID = FALSE;
-
-    getCanonicalID(id, canonicalID, isSystemID, status);
-    if (U_FAILURE(status) || !isSystemID) {
-        // mapping data is only applicable to tz database IDs
-        if (status == U_ILLEGAL_ARGUMENT_ERROR) {
-            // getWindowsID() sets an empty string where
-            // getCanonicalID() sets a U_ILLEGAL_ARGUMENT_ERROR.
-            status = U_ZERO_ERROR;
-        }
-        return winid;
-    }
-
-    UResourceBundle *mapTimezones = ures_openDirect(NULL, "windowsZones", &status);
-    ures_getByKey(mapTimezones, "mapTimezones", mapTimezones, &status);
-
-    if (U_FAILURE(status)) {
-        return winid;
-    }
-
-    UResourceBundle *winzone = NULL;
-    UBool found = FALSE;
-    while (ures_hasNext(mapTimezones) && !found) {
-        winzone = ures_getNextResource(mapTimezones, winzone, &status);
-        if (U_FAILURE(status)) {
-            break;
-        }
-        if (ures_getType(winzone) != URES_TABLE) {
-            continue;
-        }
-        UResourceBundle *regionalData = NULL;
-        while (ures_hasNext(winzone) && !found) {
-            regionalData = ures_getNextResource(winzone, regionalData, &status);
-            if (U_FAILURE(status)) {
-                break;
-            }
-            if (ures_getType(regionalData) != URES_STRING) {
-                continue;
-            }
-            int32_t len;
-            const UChar *tzids = ures_getString(regionalData, &len, &status);
-            if (U_FAILURE(status)) {
-                break;
-            }
-
-            const UChar *start = tzids;
-            UBool hasNext = TRUE;
-            while (hasNext) {
-                const UChar *end = u_strchr(start, (UChar)0x20);
-                if (end == NULL) {
-                    end = tzids + len;
-                    hasNext = FALSE;
-                }
-                if (canonicalID.compare(start, end - start) == 0) {
-                    winid = UnicodeString(ures_getKey(winzone), -1 , US_INV);
-                    found = TRUE;
-                    break;
-                }
-                start = end + 1;
-            }
-        }
-        ures_close(regionalData);
-    }
-    ures_close(winzone);
-    ures_close(mapTimezones);
-
-    return winid;
-}
-
-#define MAX_WINDOWS_ID_SIZE 128
-
-UnicodeString&
-TimeZone::getIDForWindowsID(const UnicodeString& winid, const char* region, UnicodeString& id, UErrorCode& status) {
-    id.remove();
-    if (U_FAILURE(status)) {
-        return id;
-    }
-
-    UResourceBundle *zones = ures_openDirect(NULL, "windowsZones", &status);
-    ures_getByKey(zones, "mapTimezones", zones, &status);
-    if (U_FAILURE(status)) {
-        ures_close(zones);
-        return id;
-    }
-
-    UErrorCode tmperr = U_ZERO_ERROR;
-    char winidKey[MAX_WINDOWS_ID_SIZE];
-    int32_t winKeyLen = winid.extract(0, winid.length(), winidKey, sizeof(winidKey) - 1, US_INV);
-
-    if (winKeyLen == 0 || winKeyLen >= (int32_t)sizeof(winidKey)) {
-        ures_close(zones);
-        return id;
-    }
-    winidKey[winKeyLen] = 0;
-
-    ures_getByKey(zones, winidKey, zones, &tmperr); // use tmperr, because windows mapping might not
-                                                    // be avaiable by design
-    if (U_FAILURE(tmperr)) {
-        ures_close(zones);
-        return id;
-    }
-
-    const UChar *tzid = NULL;
-    int32_t len = 0;
-    UBool gotID = FALSE;
-    if (region) {
-        const UChar *tzids = ures_getStringByKey(zones, region, &len, &tmperr); // use tmperr, because
-                                                                                // regional mapping is optional
-        if (U_SUCCESS(tmperr)) {
-            // first ID delimited by space is the defasult one
-            const UChar *end = u_strchr(tzids, (UChar)0x20);
-            if (end == NULL) {
-                id.setTo(tzids, -1);
-            } else {
-                id.setTo(tzids, end - tzids);
-            }
-            gotID = TRUE;
-        }
-    }
-
-    if (!gotID) {
-        tzid = ures_getStringByKey(zones, "001", &len, &status);    // using status, because "001" must be
-                                                                // available at this point
-        if (U_SUCCESS(status)) {
-            id.setTo(tzid, len);
-        }
-    }
-
-    ures_close(zones);
-    return id;
-}
-
-
-U_NAMESPACE_END
-
-#endif /* #if !UCONFIG_NO_FORMATTING */
-
-//eof
diff --git a/intl/icu/source/i18n/unicode/timezone.h.orig b/intl/icu/source/i18n/unicode/timezone.h.orig
deleted file mode 100644
index 0a1441b..0000000
--- a/intl/icu/source/i18n/unicode/timezone.h.orig
+++ /dev/null
@@ -1,963 +0,0 @@
-/*************************************************************************
-* Copyright (c) 1997-2016, International Business Machines Corporation
-* and others. All Rights Reserved.
-**************************************************************************
-*
-* File TIMEZONE.H
-*
-* Modification History:
-*
-*   Date        Name        Description
-*   04/21/97    aliu        Overhauled header.
-*   07/09/97    helena      Changed createInstance to createDefault.
-*   08/06/97    aliu        Removed dependency on internal header for Hashtable.
-*   08/10/98    stephen        Changed getDisplayName() API conventions to match
-*   08/19/98    stephen        Changed createTimeZone() to never return 0
-*   09/02/98    stephen        Sync to JDK 1.2 8/31
-*                            - Added getOffset(... monthlen ...)
-*                            - Added hasSameRules()
-*   09/15/98    stephen        Added getStaticClassID
-*   12/03/99    aliu        Moved data out of static table into icudata.dll.
-*                           Hashtable replaced by new static data structures.
-*   12/14/99    aliu        Made GMT public.
-*   08/15/01    grhoten     Made GMT private and added the getGMT() function
-**************************************************************************
-*/
-
-#ifndef TIMEZONE_H
-#define TIMEZONE_H
-
-#include "unicode/utypes.h"
-
-/**
- * \file 
- * \brief C++ API: TimeZone object
- */
-
-#if !UCONFIG_NO_FORMATTING
-
-#include "unicode/uobject.h"
-#include "unicode/unistr.h"
-#include "unicode/ures.h"
-#include "unicode/ucal.h"
-
-U_NAMESPACE_BEGIN
-
-class StringEnumeration;
-
-/**
- *
- * <code>TimeZone</code> represents a time zone offset, and also figures out daylight
- * savings.
- *
- * <p>
- * Typically, you get a <code>TimeZone</code> using <code>createDefault</code>
- * which creates a <code>TimeZone</code> based on the time zone where the program
- * is running. For example, for a program running in Japan, <code>createDefault</code>
- * creates a <code>TimeZone</code> object based on Japanese Standard Time.
- *
- * <p>
- * You can also get a <code>TimeZone</code> using <code>createTimeZone</code> along
- * with a time zone ID. For instance, the time zone ID for the US Pacific
- * Time zone is "America/Los_Angeles". So, you can get a Pacific Time <code>TimeZone</code> object
- * with:
- * \htmlonly<blockquote>\endhtmlonly
- * <pre>
- * TimeZone *tz = TimeZone::createTimeZone("America/Los_Angeles");
- * </pre>
- * \htmlonly</blockquote>\endhtmlonly
- * You can use the <code>createEnumeration</code> method to iterate through
- * all the supported time zone IDs, or the <code>getCanonicalID</code> method to check
- * if a time zone ID is supported or not.  You can then choose a
- * supported ID to get a <code>TimeZone</code>.
- * If the time zone you want is not represented by one of the
- * supported IDs, then you can create a custom time zone ID with
- * the following syntax:
- *
- * \htmlonly<blockquote>\endhtmlonly
- * <pre>
- * GMT[+|-]hh[[:]mm]
- * </pre>
- * \htmlonly</blockquote>\endhtmlonly
- *
- * For example, you might specify GMT+14:00 as a custom
- * time zone ID.  The <code>TimeZone</code> that is returned
- * when you specify a custom time zone ID uses the specified
- * offset from GMT(=UTC) and does not observe daylight saving
- * time. For example, you might specify GMT+14:00 as a custom
- * time zone ID to create a TimeZone representing 14 hours ahead
- * of GMT (with no daylight saving time). In addition,
- * <code>getCanonicalID</code> can also be used to
- * normalize a custom time zone ID.
- *
- * TimeZone is an abstract class representing a time zone.  A TimeZone is needed for
- * Calendar to produce local time for a particular time zone.  A TimeZone comprises
- * three basic pieces of information:
- * <ul>
- *    <li>A time zone offset; that, is the number of milliseconds to add or subtract
- *      from a time expressed in terms of GMT to convert it to the same time in that
- *      time zone (without taking daylight savings time into account).</li>
- *    <li>Logic necessary to take daylight savings time into account if daylight savings
- *      time is observed in that time zone (e.g., the days and hours on which daylight
- *      savings time begins and ends).</li>
- *    <li>An ID.  This is a text string that uniquely identifies the time zone.</li>
- * </ul>
- *
- * (Only the ID is actually implemented in TimeZone; subclasses of TimeZone may handle
- * daylight savings time and GMT offset in different ways.  Currently we have the following
- * TimeZone subclasses: RuleBasedTimeZone, SimpleTimeZone, and VTimeZone.)
- * <P>
- * The TimeZone class contains a static list containing a TimeZone object for every
- * combination of GMT offset and daylight-savings time rules currently in use in the
- * world, each with a unique ID.  Each ID consists of a region (usually a continent or
- * ocean) and a city in that region, separated by a slash, (for example, US Pacific
- * Time is "America/Los_Angeles.")  Because older versions of this class used
- * three- or four-letter abbreviations instead, there is also a table that maps the older
- * abbreviations to the newer ones (for example, "PST" maps to "America/Los_Angeles").
- * Anywhere the API requires an ID, you can use either form.
- * <P>
- * To create a new TimeZone, you call the factory function TimeZone::createTimeZone()
- * and pass it a time zone ID.  You can use the createEnumeration() function to
- * obtain a list of all the time zone IDs recognized by createTimeZone().
- * <P>
- * You can also use TimeZone::createDefault() to create a TimeZone.  This function uses
- * platform-specific APIs to produce a TimeZone for the time zone corresponding to
- * the client's computer's physical location.  For example, if you're in Japan (assuming
- * your machine is set up correctly), TimeZone::createDefault() will return a TimeZone
- * for Japanese Standard Time ("Asia/Tokyo").
- */
-class U_I18N_API TimeZone : public UObject {
-public:
-    /**
-     * @stable ICU 2.0
-     */
-    virtual ~TimeZone();
-
-    /**
-     * Returns the "unknown" time zone.
-     * It behaves like the GMT/UTC time zone but has the
-     * <code>UCAL_UNKNOWN_ZONE_ID</code> = "Etc/Unknown".
-     * createTimeZone() returns a mutable clone of this time zone if the input ID is not recognized.
-     *
-     * @return the "unknown" time zone.
-     * @see UCAL_UNKNOWN_ZONE_ID
-     * @see createTimeZone
-     * @see getGMT
-     * @stable ICU 49
-     */
-    static const TimeZone& U_EXPORT2 getUnknown();
-
-    /**
-     * The GMT (=UTC) time zone has a raw offset of zero and does not use daylight
-     * savings time. This is a commonly used time zone.
-     *
-     * <p>Note: For backward compatibility reason, the ID used by the time
-     * zone returned by this method is "GMT", although the ICU's canonical
-     * ID for the GMT time zone is "Etc/GMT".
-     *
-     * @return the GMT/UTC time zone.
-     * @see getUnknown
-     * @stable ICU 2.0
-     */
-    static const TimeZone* U_EXPORT2 getGMT(void);
-
-    /**
-     * Creates a <code>TimeZone</code> for the given ID.
-     * @param ID the ID for a <code>TimeZone</code>, such as "America/Los_Angeles",
-     * or a custom ID such as "GMT-8:00".
-     * @return the specified <code>TimeZone</code>, or a mutable clone of getUnknown()
-     * if the given ID cannot be understood or if the given ID is "Etc/Unknown".
-     * The return result is guaranteed to be non-NULL.
-     * If you require that the specific zone asked for be returned,
-     * compare the result with getUnknown() or check the ID of the return result.
-     * @stable ICU 2.0
-     */
-    static TimeZone* U_EXPORT2 createTimeZone(const UnicodeString& ID);
-
-    /**
-     * Returns an enumeration over system time zone IDs with the given
-     * filter conditions.
-     * @param zoneType      The system time zone type.
-     * @param region        The ISO 3166 two-letter country code or UN M.49
-     *                      three-digit area code. When NULL, no filtering
-     *                      done by region. 
-     * @param rawOffset     An offset from GMT in milliseconds, ignoring
-     *                      the effect of daylight savings time, if any.
-     *                      When NULL, no filtering done by zone offset. 
-     * @param ec            Output param to filled in with a success or
-     *                      an error.
-     * @return an enumeration object, owned by the caller.
-     * @stable ICU 4.8
-     */
-    static StringEnumeration* U_EXPORT2 createTimeZoneIDEnumeration(
-        USystemTimeZoneType zoneType,
-        const char* region,
-        const int32_t* rawOffset,
-        UErrorCode& ec);
-
-    /**
-     * Returns an enumeration over all recognized time zone IDs. (i.e.,
-     * all strings that createTimeZone() accepts)
-     *
-     * @return an enumeration object, owned by the caller.
-     * @stable ICU 2.4
-     */
-    static StringEnumeration* U_EXPORT2 createEnumeration();
-
-    /**
-     * Returns an enumeration over time zone IDs with a given raw
-     * offset from GMT.  There may be several times zones with the
-     * same GMT offset that differ in the way they handle daylight
-     * savings time.  For example, the state of Arizona doesn't
-     * observe daylight savings time.  If you ask for the time zone
-     * IDs corresponding to GMT-7:00, you'll get back an enumeration
-     * over two time zone IDs: "America/Denver," which corresponds to
-     * Mountain Standard Time in the winter and Mountain Daylight Time
-     * in the summer, and "America/Phoenix", which corresponds to
-     * Mountain Standard Time year-round, even in the summer.
-     *
-     * @param rawOffset an offset from GMT in milliseconds, ignoring
-     * the effect of daylight savings time, if any
-     * @return an enumeration object, owned by the caller
-     * @stable ICU 2.4
-     */
-    static StringEnumeration* U_EXPORT2 createEnumeration(int32_t rawOffset);
-
-    /**
-     * Returns an enumeration over time zone IDs associated with the
-     * given country.  Some zones are affiliated with no country
-     * (e.g., "UTC"); these may also be retrieved, as a group.
-     *
-     * @param country The ISO 3166 two-letter country code, or NULL to
-     * retrieve zones not affiliated with any country.
-     * @return an enumeration object, owned by the caller
-     * @stable ICU 2.4
-     */
-    static StringEnumeration* U_EXPORT2 createEnumeration(const char* country);
-
-    /**
-     * Returns the number of IDs in the equivalency group that
-     * includes the given ID.  An equivalency group contains zones
-     * that have the same GMT offset and rules.
-     *
-     * <p>The returned count includes the given ID; it is always >= 1.
-     * The given ID must be a system time zone.  If it is not, returns
-     * zero.
-     * @param id a system time zone ID
-     * @return the number of zones in the equivalency group containing
-     * 'id', or zero if 'id' is not a valid system ID
-     * @see #getEquivalentID
-     * @stable ICU 2.0
-     */
-    static int32_t U_EXPORT2 countEquivalentIDs(const UnicodeString& id);
-
-    /**
-     * Returns an ID in the equivalency group that
-     * includes the given ID.  An equivalency group contains zones
-     * that have the same GMT offset and rules.
-     *
-     * <p>The given index must be in the range 0..n-1, where n is the
-     * value returned by <code>countEquivalentIDs(id)</code>.  For
-     * some value of 'index', the returned value will be equal to the
-     * given id.  If the given id is not a valid system time zone, or
-     * if 'index' is out of range, then returns an empty string.
-     * @param id a system time zone ID
-     * @param index a value from 0 to n-1, where n is the value
-     * returned by <code>countEquivalentIDs(id)</code>
-     * @return the ID of the index-th zone in the equivalency group
-     * containing 'id', or an empty string if 'id' is not a valid
-     * system ID or 'index' is out of range
-     * @see #countEquivalentIDs
-     * @stable ICU 2.0
-     */
-    static const UnicodeString U_EXPORT2 getEquivalentID(const UnicodeString& id,
-                                               int32_t index);
-
-    /**
-     * Creates an instance of TimeZone detected from the current host
-     * system configuration. Note that ICU4C does not change the default
-     * time zone unless TimeZone::adoptDefault(TimeZone*) or
-     * TimeZone::setDefault(const TimeZone&) is explicitly called by a
-     * user. This method does not update the current ICU's default,
-     * and may return a different TimeZone from the one returned by
-     * TimeZone::createDefault().
-     *
-     * @return  A new instance of TimeZone detected from the current host system
-     *          configuration.
-     * @stable ICU 55
-     */
-    static TimeZone* U_EXPORT2 detectHostTimeZone();
-
-    /**
-     * Creates a new copy of the default TimeZone for this host. Unless the default time
-     * zone has already been set using adoptDefault() or setDefault(), the default is
-     * determined by querying the system using methods in TPlatformUtilities. If the
-     * system routines fail, or if they specify a TimeZone or TimeZone offset which is not
-     * recognized, the TimeZone indicated by the ID kLastResortID is instantiated
-     * and made the default.
-     *
-     * @return   A default TimeZone. Clients are responsible for deleting the time zone
-     *           object returned.
-     * @stable ICU 2.0
-     */
-    static TimeZone* U_EXPORT2 createDefault(void);
-
-    /**
-     * Sets the default time zone (i.e., what's returned by createDefault()) to be the
-     * specified time zone.  If NULL is specified for the time zone, the default time
-     * zone is set to the default host time zone.  This call adopts the TimeZone object
-     * passed in; the client is no longer responsible for deleting it.
-     *
-     * <p>This function is not thread safe. It is an error for multiple threads
-     * to concurrently attempt to set the default time zone, or for any thread
-     * to attempt to reference the default zone while another thread is setting it.
-     *
-     * @param zone  A pointer to the new TimeZone object to use as the default.
-     * @stable ICU 2.0
-     */
-    static void U_EXPORT2 adoptDefault(TimeZone* zone);
-
-#ifndef U_HIDE_SYSTEM_API
-    /**
-     * Same as adoptDefault(), except that the TimeZone object passed in is NOT adopted;
-     * the caller remains responsible for deleting it.
-     *
-     * <p>See the thread safety note under adoptDefault().
-     *
-     * @param zone  The given timezone.
-     * @system
-     * @stable ICU 2.0
-     */
-    static void U_EXPORT2 setDefault(const TimeZone& zone);
-#endif  /* U_HIDE_SYSTEM_API */
-
-    /**
-     * Returns the timezone data version currently used by ICU.
-     * @param status Output param to filled in with a success or an error.
-     * @return the version string, such as "2007f"
-     * @stable ICU 3.8
-     */
-    static const char* U_EXPORT2 getTZDataVersion(UErrorCode& status);
-
-    /**
-     * Returns the canonical system timezone ID or the normalized
-     * custom time zone ID for the given time zone ID.
-     * @param id            The input time zone ID to be canonicalized.
-     * @param canonicalID   Receives the canonical system time zone ID
-     *                      or the custom time zone ID in normalized format.
-     * @param status        Receives the status.  When the given time zone ID
-     *                      is neither a known system time zone ID nor a
-     *                      valid custom time zone ID, U_ILLEGAL_ARGUMENT_ERROR
-     *                      is set.
-     * @return A reference to the result.
-     * @stable ICU 4.0
-     */
-    static UnicodeString& U_EXPORT2 getCanonicalID(const UnicodeString& id,
-        UnicodeString& canonicalID, UErrorCode& status);
-
-    /**
-     * Returns the canonical system time zone ID or the normalized
-     * custom time zone ID for the given time zone ID.
-     * @param id            The input time zone ID to be canonicalized.
-     * @param canonicalID   Receives the canonical system time zone ID
-     *                      or the custom time zone ID in normalized format.
-     * @param isSystemID    Receives if the given ID is a known system
-     *                      time zone ID.
-     * @param status        Receives the status.  When the given time zone ID
-     *                      is neither a known system time zone ID nor a
-     *                      valid custom time zone ID, U_ILLEGAL_ARGUMENT_ERROR
-     *                      is set.
-     * @return A reference to the result.
-     * @stable ICU 4.0
-     */
-    static UnicodeString& U_EXPORT2 getCanonicalID(const UnicodeString& id,
-        UnicodeString& canonicalID, UBool& isSystemID, UErrorCode& status);
-
-    /**
-    * Converts a system time zone ID to an equivalent Windows time zone ID. For example,
-    * Windows time zone ID "Pacific Standard Time" is returned for input "America/Los_Angeles".
-    *
-    * <p>There are system time zones that cannot be mapped to Windows zones. When the input
-    * system time zone ID is unknown or unmappable to a Windows time zone, then the result will be
-    * empty, but the operation itself remains successful (no error status set on return).
-    *
-    * <p>This implementation utilizes <a href="http://unicode.org/cldr/charts/supplemental/zone_tzid.html">
-    * Zone-Tzid mapping data</a>. The mapping data is updated time to time. To get the latest changes,
-    * please read the ICU user guide section <a href="http://userguide.icu-project.org/datetime/timezone#TOC-Updating-the-Time-Zone-Data">
-    * Updating the Time Zone Data</a>.
-    *
-    * @param id        A system time zone ID.
-    * @param winid     Receives a Windows time zone ID. When the input system time zone ID is unknown
-    *                  or unmappable to a Windows time zone ID, then an empty string is set on return.
-    * @param status    Receives the status.
-    * @return          A reference to the result (<code>winid</code>).
-    * @see getIDForWindowsID
-    *
-    * @stable ICU 52
-    */
-    static UnicodeString& U_EXPORT2 getWindowsID(const UnicodeString& id,
-        UnicodeString& winid, UErrorCode& status);
-
-    /**
-    * Converts a Windows time zone ID to an equivalent system time zone ID
-    * for a region. For example, system time zone ID "America/Los_Angeles" is returned
-    * for input Windows ID "Pacific Standard Time" and region "US" (or <code>null</code>),
-    * "America/Vancouver" is returned for the same Windows ID "Pacific Standard Time" and
-    * region "CA".
-    *
-    * <p>Not all Windows time zones can be mapped to system time zones. When the input
-    * Windows time zone ID is unknown or unmappable to a system time zone, then the result
-    * will be empty, but the operation itself remains successful (no error status set on return).
-    *
-    * <p>This implementation utilizes <a href="http://unicode.org/cldr/charts/supplemental/zone_tzid.html">
-    * Zone-Tzid mapping data</a>. The mapping data is updated time to time. To get the latest changes,
-    * please read the ICU user guide section <a href="http://userguide.icu-project.org/datetime/timezone#TOC-Updating-the-Time-Zone-Data">
-    * Updating the Time Zone Data</a>.
-    *
-    * @param winid     A Windows time zone ID.
-    * @param region    A null-terminated region code, or <code>NULL</code> if no regional preference.
-    * @param id        Receives a system time zone ID. When the input Windows time zone ID is unknown
-    *                  or unmappable to a system time zone ID, then an empty string is set on return.
-    * @param status    Receives the status.
-    * @return          A reference to the result (<code>id</code>).
-    * @see getWindowsID
-    *
-    * @stable ICU 52
-    */
-    static UnicodeString& U_EXPORT2 getIDForWindowsID(const UnicodeString& winid, const char* region,
-        UnicodeString& id, UErrorCode& status);
-
-    /**
-     * Returns true if the two TimeZones are equal.  (The TimeZone version only compares
-     * IDs, but subclasses are expected to also compare the fields they add.)
-     *
-     * @param that  The TimeZone object to be compared with.
-     * @return      True if the given TimeZone is equal to this TimeZone; false
-     *              otherwise.
-     * @stable ICU 2.0
-     */
-    virtual UBool operator==(const TimeZone& that) const;
-
-    /**
-     * Returns true if the two TimeZones are NOT equal; that is, if operator==() returns
-     * false.
-     *
-     * @param that  The TimeZone object to be compared with.
-     * @return      True if the given TimeZone is not equal to this TimeZone; false
-     *              otherwise.
-     * @stable ICU 2.0
-     */
-    UBool operator!=(const TimeZone& that) const {return !operator==(that);}
-
-    /**
-     * Returns the TimeZone's adjusted GMT offset (i.e., the number of milliseconds to add
-     * to GMT to get local time in this time zone, taking daylight savings time into
-     * account) as of a particular reference date.  The reference date is used to determine
-     * whether daylight savings time is in effect and needs to be figured into the offset
-     * that is returned (in other words, what is the adjusted GMT offset in this time zone
-     * at this particular date and time?).  For the time zones produced by createTimeZone(),
-     * the reference data is specified according to the Gregorian calendar, and the date
-     * and time fields are local standard time.
-     *
-     * <p>Note: Don't call this method. Instead, call the getOffset(UDate...) overload,
-     * which returns both the raw and the DST offset for a given time. This method
-     * is retained only for backward compatibility.
-     *
-     * @param era        The reference date's era
-     * @param year       The reference date's year
-     * @param month      The reference date's month (0-based; 0 is January)
-     * @param day        The reference date's day-in-month (1-based)
-     * @param dayOfWeek  The reference date's day-of-week (1-based; 1 is Sunday)
-     * @param millis     The reference date's milliseconds in day, local standard time
-     * @param status     Output param to filled in with a success or an error.
-     * @return           The offset in milliseconds to add to GMT to get local time.
-     * @stable ICU 2.0
-     */
-    virtual int32_t getOffset(uint8_t era, int32_t year, int32_t month, int32_t day,
-                              uint8_t dayOfWeek, int32_t millis, UErrorCode& status) const = 0;
-
-    /**
-     * Gets the time zone offset, for current date, modified in case of
-     * daylight savings. This is the offset to add *to* UTC to get local time.
-     *
-     * <p>Note: Don't call this method. Instead, call the getOffset(UDate...) overload,
-     * which returns both the raw and the DST offset for a given time. This method
-     * is retained only for backward compatibility.
-     *
-     * @param era the era of the given date.
-     * @param year the year in the given date.
-     * @param month the month in the given date.
-     * Month is 0-based. e.g., 0 for January.
-     * @param day the day-in-month of the given date.
-     * @param dayOfWeek the day-of-week of the given date.
-     * @param milliseconds the millis in day in <em>standard</em> local time.
-     * @param monthLength the length of the given month in days.
-     * @param status     Output param to filled in with a success or an error.
-     * @return the offset to add *to* GMT to get local time.
-     * @stable ICU 2.0
-     */
-    virtual int32_t getOffset(uint8_t era, int32_t year, int32_t month, int32_t day,
-                           uint8_t dayOfWeek, int32_t milliseconds,
-                           int32_t monthLength, UErrorCode& status) const = 0;
-
-    /**
-     * Returns the time zone raw and GMT offset for the given moment
-     * in time.  Upon return, local-millis = GMT-millis + rawOffset +
-     * dstOffset.  All computations are performed in the proleptic
-     * Gregorian calendar.  The default implementation in the TimeZone
-     * class delegates to the 8-argument getOffset().
-     *
-     * @param date moment in time for which to return offsets, in
-     * units of milliseconds from January 1, 1970 0:00 GMT, either GMT
-     * time or local wall time, depending on `local'.
-     * @param local if true, `date' is local wall time; otherwise it
-     * is in GMT time.
-     * @param rawOffset output parameter to receive the raw offset, that
-     * is, the offset not including DST adjustments
-     * @param dstOffset output parameter to receive the DST offset,
-     * that is, the offset to be added to `rawOffset' to obtain the
-     * total offset between local and GMT time. If DST is not in
-     * effect, this value is zero; otherwise it is a positive value,
-     * typically one hour.
-     * @param ec input-output error code
-     *
-     * @stable ICU 2.8
-     */
-    virtual void getOffset(UDate date, UBool local, int32_t& rawOffset,
-                           int32_t& dstOffset, UErrorCode& ec) const;
-
-    /**
-     * Sets the TimeZone's raw GMT offset (i.e., the number of milliseconds to add
-     * to GMT to get local time, before taking daylight savings time into account).
-     *
-     * @param offsetMillis  The new raw GMT offset for this time zone.
-     * @stable ICU 2.0
-     */
-    virtual void setRawOffset(int32_t offsetMillis) = 0;
-
-    /**
-     * Returns the TimeZone's raw GMT offset (i.e., the number of milliseconds to add
-     * to GMT to get local time, before taking daylight savings time into account).
-     *
-     * @return   The TimeZone's raw GMT offset.
-     * @stable ICU 2.0
-     */
-    virtual int32_t getRawOffset(void) const = 0;
-
-    /**
-     * Fills in "ID" with the TimeZone's ID.
-     *
-     * @param ID  Receives this TimeZone's ID.
-     * @return    A reference to 'ID'
-     * @stable ICU 2.0
-     */
-    UnicodeString& getID(UnicodeString& ID) const;
-
-    /**
-     * Sets the TimeZone's ID to the specified value.  This doesn't affect any other
-     * fields (for example, if you say<
-     * blockquote><pre>
-     * .     TimeZone* foo = TimeZone::createTimeZone("America/New_York");
-     * .     foo.setID("America/Los_Angeles");
-     * </pre>\htmlonly</blockquote>\endhtmlonly
-     * the time zone's GMT offset and daylight-savings rules don't change to those for
-     * Los Angeles.  They're still those for New York.  Only the ID has changed.)
-     *
-     * @param ID  The new time zone ID.
-     * @stable ICU 2.0
-     */
-    void setID(const UnicodeString& ID);
-
-    /**
-     * Enum for use with getDisplayName
-     * @stable ICU 2.4
-     */
-    enum EDisplayType {
-        /**
-         * Selector for short display name
-         * @stable ICU 2.4
-         */
-        SHORT = 1,
-        /**
-         * Selector for long display name
-         * @stable ICU 2.4
-         */
-        LONG,
-        /**
-         * Selector for short generic display name
-         * @stable ICU 4.4
-         */
-        SHORT_GENERIC,
-        /**
-         * Selector for long generic display name
-         * @stable ICU 4.4
-         */
-        LONG_GENERIC,
-        /**
-         * Selector for short display name derived
-         * from time zone offset
-         * @stable ICU 4.4
-         */
-        SHORT_GMT,
-        /**
-         * Selector for long display name derived
-         * from time zone offset
-         * @stable ICU 4.4
-         */
-        LONG_GMT,
-        /**
-         * Selector for short display name derived
-         * from the time zone's fallback name
-         * @stable ICU 4.4
-         */
-        SHORT_COMMONLY_USED,
-        /**
-         * Selector for long display name derived
-         * from the time zone's fallback name
-         * @stable ICU 4.4
-         */
-        GENERIC_LOCATION
-    };
-
-    /**
-     * Returns a name of this time zone suitable for presentation to the user
-     * in the default locale.
-     * This method returns the long name, not including daylight savings.
-     * If the display name is not available for the locale,
-     * then this method returns a string in the localized GMT offset format
-     * such as <code>GMT[+-]HH:mm</code>.
-     * @param result the human-readable name of this time zone in the default locale.
-     * @return       A reference to 'result'.
-     * @stable ICU 2.0
-     */
-    UnicodeString& getDisplayName(UnicodeString& result) const;
-
-    /**
-     * Returns a name of this time zone suitable for presentation to the user
-     * in the specified locale.
-     * This method returns the long name, not including daylight savings.
-     * If the display name is not available for the locale,
-     * then this method returns a string in the localized GMT offset format
-     * such as <code>GMT[+-]HH:mm</code>.
-     * @param locale the locale in which to supply the display name.
-     * @param result the human-readable name of this time zone in the given locale
-     *               or in the default locale if the given locale is not recognized.
-     * @return       A reference to 'result'.
-     * @stable ICU 2.0
-     */
-    UnicodeString& getDisplayName(const Locale& locale, UnicodeString& result) const;
-
-    /**
-     * Returns a name of this time zone suitable for presentation to the user
-     * in the default locale.
-     * If the display name is not available for the locale,
-     * then this method returns a string in the localized GMT offset format
-     * such as <code>GMT[+-]HH:mm</code>.
-     * @param daylight if true, return the daylight savings name.
-     * @param style
-     * @param result the human-readable name of this time zone in the default locale.
-     * @return       A reference to 'result'.
-     * @stable ICU 2.0
-     */
-    UnicodeString& getDisplayName(UBool daylight, EDisplayType style, UnicodeString& result) const;
-
-    /**
-     * Returns a name of this time zone suitable for presentation to the user
-     * in the specified locale.
-     * If the display name is not available for the locale,
-     * then this method returns a string in the localized GMT offset format
-     * such as <code>GMT[+-]HH:mm</code>.
-     * @param daylight if true, return the daylight savings name.
-     * @param style
-     * @param locale the locale in which to supply the display name.
-     * @param result the human-readable name of this time zone in the given locale
-     *               or in the default locale if the given locale is not recognized.
-     * @return       A refence to 'result'.
-     * @stable ICU 2.0
-     */
-    UnicodeString& getDisplayName(UBool daylight, EDisplayType style, const Locale& locale, UnicodeString& result) const;
-    
-    /**
-     * Queries if this time zone uses daylight savings time.
-     * @return true if this time zone uses daylight savings time,
-     * false, otherwise.
-     * <p><strong>Note:</strong>The default implementation of
-     * ICU TimeZone uses the tz database, which supports historic
-     * rule changes, for system time zones. With the implementation,
-     * there are time zones that used daylight savings time in the
-     * past, but no longer used currently. For example, Asia/Tokyo has
-     * never used daylight savings time since 1951. Most clients would
-     * expect that this method to return <code>FALSE</code> for such case.
-     * The default implementation of this method returns <code>TRUE</code>
-     * when the time zone uses daylight savings time in the current
-     * (Gregorian) calendar year.
-     * <p>In Java 7, <code>observesDaylightTime()</code> was added in
-     * addition to <code>useDaylightTime()</code>. In Java, <code>useDaylightTime()</code>
-     * only checks if daylight saving time is observed by the last known
-     * rule. This specification might not be what most users would expect
-     * if daylight saving time is currently observed, but not scheduled
-     * in future. In this case, Java's <code>userDaylightTime()</code> returns
-     * <code>false</code>. To resolve the issue, Java 7 added <code>observesDaylightTime()</code>,
-     * which takes the current rule into account. The method <code>observesDaylightTime()</code>
-     * was added in ICU4J for supporting API signature compatibility with JDK.
-     * In general, ICU4C also provides JDK compatible methods, but the current
-     * implementation <code>userDaylightTime()</code> serves the purpose
-     * (takes the current rule into account), <code>observesDaylightTime()</code>
-     * is not added in ICU4C. In addition to <code>useDaylightTime()</code>, ICU4C
-     * <code>BasicTimeZone</code> class (Note that <code>TimeZone::createTimeZone(const UnicodeString &ID)</code>
-     * always returns a <code>BasicTimeZone</code>) provides a series of methods allowing
-     * historic and future time zone rule iteration, so you can check if daylight saving
-     * time is observed or not within a given period.
-     * 
-     * @stable ICU 2.0
-     */
-    virtual UBool useDaylightTime(void) const = 0;
-
-    /**
-     * Queries if the given date is in daylight savings time in
-     * this time zone.
-     * This method is wasteful since it creates a new GregorianCalendar and
-     * deletes it each time it is called. This is a deprecated method
-     * and provided only for Java compatibility.
-     *
-     * @param date the given UDate.
-     * @param status Output param filled in with success/error code.
-     * @return true if the given date is in daylight savings time,
-     * false, otherwise.
-     * @deprecated ICU 2.4. Use Calendar::inDaylightTime() instead.
-     */
-    virtual UBool inDaylightTime(UDate date, UErrorCode& status) const = 0;
-
-    /**
-     * Returns true if this zone has the same rule and offset as another zone.
-     * That is, if this zone differs only in ID, if at all.
-     * @param other the <code>TimeZone</code> object to be compared with
-     * @return true if the given zone is the same as this one,
-     * with the possible exception of the ID
-     * @stable ICU 2.0
-     */
-    virtual UBool hasSameRules(const TimeZone& other) const;
-
-    /**
-     * Clones TimeZone objects polymorphically. Clients are responsible for deleting
-     * the TimeZone object cloned.
-     *
-     * @return   A new copy of this TimeZone object.
-     * @stable ICU 2.0
-     */
-    virtual TimeZone* clone(void) const = 0;
-
-    /**
-     * Return the class ID for this class.  This is useful only for
-     * comparing to a return value from getDynamicClassID().
-     * @return The class ID for all objects of this class.
-     * @stable ICU 2.0
-     */
-    static UClassID U_EXPORT2 getStaticClassID(void);
-
-    /**
-     * Returns a unique class ID POLYMORPHICALLY. This method is to
-     * implement a simple version of RTTI, since not all C++ compilers support genuine
-     * RTTI. Polymorphic operator==() and clone() methods call this method.
-     * <P>
-     * Concrete subclasses of TimeZone must use the UOBJECT_DEFINE_RTTI_IMPLEMENTATION
-     *  macro from uobject.h in their implementation to provide correct RTTI information.
-     * @return   The class ID for this object. All objects of a given class have the
-     *           same class ID. Objects of other classes have different class IDs.
-     * @stable ICU 2.0
-     */
-    virtual UClassID getDynamicClassID(void) const = 0;
-    
-    /**
-     * Returns the amount of time to be added to local standard time
-     * to get local wall clock time.
-     * <p>
-     * The default implementation always returns 3600000 milliseconds
-     * (i.e., one hour) if this time zone observes Daylight Saving
-     * Time. Otherwise, 0 (zero) is returned.
-     * <p>
-     * If an underlying TimeZone implementation subclass supports
-     * historical Daylight Saving Time changes, this method returns
-     * the known latest daylight saving value.
-     *
-     * @return the amount of saving time in milliseconds
-     * @stable ICU 3.6
-     */
-    virtual int32_t getDSTSavings() const;
-
-    /**
-     * Gets the region code associated with the given
-     * system time zone ID. The region code is either ISO 3166
-     * 2-letter country code or UN M.49 3-digit area code.
-     * When the time zone is not associated with a specific location,
-     * for example - "Etc/UTC", "EST5EDT", then this method returns
-     * "001" (UN M.49 area code for World).
-     * 
-     * @param id            The system time zone ID.
-     * @param region        Output buffer for receiving the region code.
-     * @param capacity      The size of the output buffer.
-     * @param status        Receives the status.  When the given time zone ID
-     *                      is not a known system time zone ID,
-     *                      U_ILLEGAL_ARGUMENT_ERROR is set.
-     * @return The length of the output region code.
-     * @stable ICU 4.8 
-     */ 
-    static int32_t U_EXPORT2 getRegion(const UnicodeString& id, 
-        char *region, int32_t capacity, UErrorCode& status); 
-
-protected:
-
-    /**
-     * Default constructor.  ID is initialized to the empty string.
-     * @stable ICU 2.0
-     */
-    TimeZone();
-
-    /**
-     * Construct a TimeZone with a given ID.
-     * @param id a system time zone ID
-     * @stable ICU 2.0
-     */
-    TimeZone(const UnicodeString &id);
-
-    /**
-     * Copy constructor.
-     * @param source the object to be copied.
-     * @stable ICU 2.0
-     */
-    TimeZone(const TimeZone& source);
-
-    /**
-     * Default assignment operator.
-     * @param right the object to be copied.
-     * @stable ICU 2.0
-     */
-    TimeZone& operator=(const TimeZone& right);
-
-#ifndef U_HIDE_INTERNAL_API
-    /**
-     * Utility function. For internally loading rule data.
-     * @param top Top resource bundle for tz data
-     * @param ruleid ID of rule to load
-     * @param oldbundle Old bundle to reuse or NULL
-     * @param status Status parameter
-     * @return either a new bundle or *oldbundle
-     * @internal
-     */
-    static UResourceBundle* loadRule(const UResourceBundle* top, const UnicodeString& ruleid, UResourceBundle* oldbundle, UErrorCode&status);
-#endif  /* U_HIDE_INTERNAL_API */
-
-private:
-    friend class ZoneMeta;
-
-
-    static TimeZone*        createCustomTimeZone(const UnicodeString&); // Creates a time zone based on the string.
-
-    /**
-     * Finds the given ID in the Olson tzdata. If the given ID is found in the tzdata,
-     * returns the pointer to the ID resource. This method is exposed through ZoneMeta class
-     * for ICU internal implementation and useful for building hashtable using a time zone
-     * ID as a key.
-     * @param id zone id string
-     * @return the pointer of the ID resource, or NULL.
-     */
-    static const UChar* findID(const UnicodeString& id);
-
-    /**
-     * Resolve a link in Olson tzdata.  When the given id is known and it's not a link,
-     * the id itself is returned.  When the given id is known and it is a link, then
-     * dereferenced zone id is returned.  When the given id is unknown, then it returns
-     * NULL.
-     * @param id zone id string
-     * @return the dereferenced zone or NULL
-     */
-    static const UChar* dereferOlsonLink(const UnicodeString& id);
-
-    /**
-     * Returns the region code associated with the given zone,
-     * or NULL if the zone is not known.
-     * @param id zone id string
-     * @return the region associated with the given zone
-     */
-    static const UChar* getRegion(const UnicodeString& id);
-
-  public:
-#ifndef U_HIDE_INTERNAL_API
-    /**
-     * Returns the region code associated with the given zone,
-     * or NULL if the zone is not known.
-     * @param id zone id string
-     * @param status Status parameter
-     * @return the region associated with the given zone
-     * @internal
-     */
-    static const UChar* getRegion(const UnicodeString& id, UErrorCode& status);
-#endif  /* U_HIDE_INTERNAL_API */
-
-  private:
-    /**
-     * Parses the given custom time zone identifier
-     * @param id id A string of the form GMT[+-]hh:mm, GMT[+-]hhmm, or
-     * GMT[+-]hh.
-     * @param sign Receves parsed sign, 1 for positive, -1 for negative.
-     * @param hour Receives parsed hour field
-     * @param minute Receives parsed minute field
-     * @param second Receives parsed second field
-     * @return Returns TRUE when the given custom id is valid.
-     */
-    static UBool parseCustomID(const UnicodeString& id, int32_t& sign, int32_t& hour,
-        int32_t& minute, int32_t& second);
-
-    /**
-     * Parse a custom time zone identifier and return the normalized
-     * custom time zone identifier for the given custom id string.
-     * @param id a string of the form GMT[+-]hh:mm, GMT[+-]hhmm, or
-     * GMT[+-]hh.
-     * @param normalized Receives the normalized custom ID
-     * @param status Receives the status.  When the input ID string is invalid,
-     * U_ILLEGAL_ARGUMENT_ERROR is set.
-     * @return The normalized custom id string.
-    */
-    static UnicodeString& getCustomID(const UnicodeString& id, UnicodeString& normalized,
-        UErrorCode& status);
-
-    /**
-     * Returns the normalized custome time zone ID for the given offset fields.
-     * @param hour offset hours
-     * @param min offset minutes
-     * @param sec offset seconds
-     * @param negative sign of the offset, TRUE for negative offset.
-     * @param id Receves the format result (normalized custom ID)
-     * @return The reference to id
-     */
-    static UnicodeString& formatCustomID(int32_t hour, int32_t min, int32_t sec,
-        UBool negative, UnicodeString& id);
-
-    UnicodeString           fID;    // this time zone's ID
-
-    friend class TZEnumeration;
-};
-
-
-// -------------------------------------
-
-inline UnicodeString&
-TimeZone::getID(UnicodeString& ID) const
-{
-    ID = fID;
-    return ID;
-}
-
-// -------------------------------------
-
-inline void
-TimeZone::setID(const UnicodeString& ID)
-{
-    fID = ID;
-}
-U_NAMESPACE_END
-
-#endif /* #if !UCONFIG_NO_FORMATTING */
-
-#endif //_TIMEZONE
-//eof
diff --git a/ipc/app/module.ver.orig b/ipc/app/module.ver.orig
deleted file mode 100644
index bab8a13..0000000
--- a/ipc/app/module.ver.orig
+++ /dev/null
@@ -1,6 +0,0 @@
-WIN32_MODULE_COMPANYNAME=Mozilla Corporation
-WIN32_MODULE_PRODUCTVERSION=@MOZ_APP_WINVERSION@
-WIN32_MODULE_PRODUCTVERSION_STRING=@MOZ_APP_VERSION@
-WIN32_MODULE_DESCRIPTION=Plugin Container for @MOZ_APP_DISPLAYNAME@
-WIN32_MODULE_PRODUCTNAME=@MOZ_APP_DISPLAYNAME@
-WIN32_MODULE_NAME=@MOZ_APP_DISPLAYNAME@
diff --git a/ipc/app/module.ver.rej b/ipc/app/module.ver.rej
deleted file mode 100644
index 9e20d81..0000000
--- a/ipc/app/module.ver.rej
+++ /dev/null
@@ -1,8 +0,0 @@
---- ipc/app/module.ver	2016-04-12 11:54:00 +0100
-+++ ipc/app/module.ver	2016-04-19 15:51:50 +0100
-@@ -1,4 +1,4 @@
--WIN32_MODULE_COMPANYNAME=Mozilla Corporation
-+WIN32_MODULE_COMPANYNAME=WaterfoxProject
- WIN32_MODULE_PRODUCTVERSION=@MOZ_APP_WINVERSION@
- WIN32_MODULE_PRODUCTVERSION_STRING=@MOZ_APP_VERSION@
- WIN32_MODULE_DESCRIPTION=Plugin Container for @MOZ_APP_DISPLAYNAME@
diff --git a/mobile/android/chrome/content/browser.js.orig b/mobile/android/chrome/content/browser.js.orig
deleted file mode 100644
index efb6452..0000000
--- a/mobile/android/chrome/content/browser.js.orig
+++ /dev/null
@@ -1,7635 +0,0 @@
-// -*- Mode: js2; tab-width: 2; indent-tabs-mode: nil; js2-basic-offset: 2; js2-skip-preprocessor-directives: t; -*-
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-"use strict";
-
-var Cc = Components.classes;
-var Ci = Components.interfaces;
-var Cu = Components.utils;
-var Cr = Components.results;
-
-Cu.import("resource://gre/modules/AppConstants.jsm");
-Cu.import("resource://gre/modules/XPCOMUtils.jsm");
-Cu.import("resource://gre/modules/Services.jsm");
-Cu.import("resource://gre/modules/AddonManager.jsm");
-Cu.import("resource://gre/modules/DelayedInit.jsm");
-
-if (AppConstants.ACCESSIBILITY) {
-  XPCOMUtils.defineLazyModuleGetter(this, "AccessFu",
-                                    "resource://gre/modules/accessibility/AccessFu.jsm");
-}
-
-XPCOMUtils.defineLazyModuleGetter(this, "SpatialNavigation",
-                                  "resource://gre/modules/SpatialNavigation.jsm");
-
-XPCOMUtils.defineLazyModuleGetter(this, "DownloadNotifications",
-                                  "resource://gre/modules/DownloadNotifications.jsm");
-
-XPCOMUtils.defineLazyModuleGetter(this, "FileUtils",
-                                  "resource://gre/modules/FileUtils.jsm");
-
-XPCOMUtils.defineLazyModuleGetter(this, "JNI",
-                                  "resource://gre/modules/JNI.jsm");
-
-XPCOMUtils.defineLazyModuleGetter(this, "UITelemetry",
-                                  "resource://gre/modules/UITelemetry.jsm");
-
-XPCOMUtils.defineLazyModuleGetter(this, "PluralForm",
-                                  "resource://gre/modules/PluralForm.jsm");
-
-XPCOMUtils.defineLazyModuleGetter(this, "Downloads",
-                                  "resource://gre/modules/Downloads.jsm");
-
-XPCOMUtils.defineLazyModuleGetter(this, "Messaging",
-                                  "resource://gre/modules/Messaging.jsm");
-
-XPCOMUtils.defineLazyModuleGetter(this, "UserAgentOverrides",
-                                  "resource://gre/modules/UserAgentOverrides.jsm");
-
-XPCOMUtils.defineLazyModuleGetter(this, "LoginManagerContent",
-                                  "resource://gre/modules/LoginManagerContent.jsm");
-
-XPCOMUtils.defineLazyModuleGetter(this, "LoginManagerParent",
-                                  "resource://gre/modules/LoginManagerParent.jsm");
-
-XPCOMUtils.defineLazyModuleGetter(this, "Task", "resource://gre/modules/Task.jsm");
-XPCOMUtils.defineLazyModuleGetter(this, "OS", "resource://gre/modules/osfile.jsm");
-
-if (AppConstants.MOZ_SAFE_BROWSING) {
-  XPCOMUtils.defineLazyModuleGetter(this, "SafeBrowsing",
-                                    "resource://gre/modules/SafeBrowsing.jsm");
-}
-
-XPCOMUtils.defineLazyModuleGetter(this, "BrowserUtils",
-                                  "resource://gre/modules/BrowserUtils.jsm");
-
-XPCOMUtils.defineLazyModuleGetter(this, "PrivateBrowsingUtils",
-                                  "resource://gre/modules/PrivateBrowsingUtils.jsm");
-
-XPCOMUtils.defineLazyModuleGetter(this, "Sanitizer",
-                                  "resource://gre/modules/Sanitizer.jsm");
-
-XPCOMUtils.defineLazyModuleGetter(this, "Prompt",
-                                  "resource://gre/modules/Prompt.jsm");
-
-XPCOMUtils.defineLazyModuleGetter(this, "HelperApps",
-                                  "resource://gre/modules/HelperApps.jsm");
-
-XPCOMUtils.defineLazyModuleGetter(this, "SSLExceptions",
-                                  "resource://gre/modules/SSLExceptions.jsm");
-
-XPCOMUtils.defineLazyModuleGetter(this, "FormHistory",
-                                  "resource://gre/modules/FormHistory.jsm");
-
-XPCOMUtils.defineLazyServiceGetter(this, "uuidgen",
-                                   "@mozilla.org/uuid-generator;1",
-                                   "nsIUUIDGenerator");
-
-XPCOMUtils.defineLazyServiceGetter(this, "Profiler",
-                                   "@mozilla.org/tools/profiler;1",
-                                   "nsIProfiler");
-
-XPCOMUtils.defineLazyModuleGetter(this, "SimpleServiceDiscovery",
-                                  "resource://gre/modules/SimpleServiceDiscovery.jsm");
-
-XPCOMUtils.defineLazyModuleGetter(this, "WebappManager",
-                                  "resource://gre/modules/WebappManager.jsm");
-
-XPCOMUtils.defineLazyModuleGetter(this, "CharsetMenu",
-                                  "resource://gre/modules/CharsetMenu.jsm");
-
-XPCOMUtils.defineLazyModuleGetter(this, "NetErrorHelper",
-                                  "resource://gre/modules/NetErrorHelper.jsm");
-
-XPCOMUtils.defineLazyModuleGetter(this, "PermissionsUtils",
-                                  "resource://gre/modules/PermissionsUtils.jsm");
-
-XPCOMUtils.defineLazyModuleGetter(this, "SharedPreferences",
-                                  "resource://gre/modules/SharedPreferences.jsm");
-
-XPCOMUtils.defineLazyModuleGetter(this, "Notifications",
-                                  "resource://gre/modules/Notifications.jsm");
-
-XPCOMUtils.defineLazyModuleGetter(this, "ReaderMode", "resource://gre/modules/ReaderMode.jsm");
-
-XPCOMUtils.defineLazyModuleGetter(this, "Snackbars", "resource://gre/modules/Snackbars.jsm");
-
-XPCOMUtils.defineLazyModuleGetter(this, "RuntimePermissions", "resource://gre/modules/RuntimePermissions.jsm");
-
-XPCOMUtils.defineLazyServiceGetter(this, "FontEnumerator",
-  "@mozilla.org/gfx/fontenumerator;1",
-  "nsIFontEnumerator");
-
-var lazilyLoadedBrowserScripts = [
-  ["SelectHelper", "chrome://browser/content/SelectHelper.js"],
-  ["InputWidgetHelper", "chrome://browser/content/InputWidgetHelper.js"],
-  ["MasterPassword", "chrome://browser/content/MasterPassword.js"],
-  ["PluginHelper", "chrome://browser/content/PluginHelper.js"],
-  ["OfflineApps", "chrome://browser/content/OfflineApps.js"],
-  ["Linkifier", "chrome://browser/content/Linkify.js"],
-  ["ZoomHelper", "chrome://browser/content/ZoomHelper.js"],
-  ["CastingApps", "chrome://browser/content/CastingApps.js"],
-  ["RemoteDebugger", "chrome://browser/content/RemoteDebugger.js"],
-];
-if (AppConstants.NIGHTLY_BUILD) {
-  lazilyLoadedBrowserScripts.push(
-    ["WebcompatReporter", "chrome://browser/content/WebcompatReporter.js"]);
-}
-
-lazilyLoadedBrowserScripts.forEach(function (aScript) {
-  let [name, script] = aScript;
-  XPCOMUtils.defineLazyGetter(window, name, function() {
-    let sandbox = {};
-    Services.scriptloader.loadSubScript(script, sandbox);
-    return sandbox[name];
-  });
-});
-
-var lazilyLoadedObserverScripts = [
-  ["MemoryObserver", ["memory-pressure", "Memory:Dump"], "chrome://browser/content/MemoryObserver.js"],
-  ["ConsoleAPI", ["console-api-log-event"], "chrome://browser/content/ConsoleAPI.js"],
-  ["FindHelper", ["FindInPage:Opened", "FindInPage:Closed", "Tab:Selected"], "chrome://browser/content/FindHelper.js"],
-  ["PermissionsHelper", ["Permissions:Check", "Permissions:Get", "Permissions:Clear"], "chrome://browser/content/PermissionsHelper.js"],
-  ["FeedHandler", ["Feeds:Subscribe"], "chrome://browser/content/FeedHandler.js"],
-  ["Feedback", ["Feedback:Show"], "chrome://browser/content/Feedback.js"],
-  ["SelectionHandler", ["TextSelection:Get"], "chrome://browser/content/SelectionHandler.js"],
-  ["EmbedRT", ["GeckoView:ImportScript"], "chrome://browser/content/EmbedRT.js"],
-  ["Reader", ["Reader:FetchContent", "Reader:Added", "Reader:Removed"], "chrome://browser/content/Reader.js"],
-  ["PrintHelper", ["Print:PDF"], "chrome://browser/content/PrintHelper.js"],
-];
-if (AppConstants.NIGHTLY_BUILD) {
-  lazilyLoadedObserverScripts.push(
-    ["ActionBarHandler", ["TextSelection:Get", "TextSelection:Action", "TextSelection:End"],
-      "chrome://browser/content/ActionBarHandler.js"]
-  );
-}
-if (AppConstants.MOZ_WEBRTC) {
-  lazilyLoadedObserverScripts.push(
-    ["WebrtcUI", ["getUserMedia:request",
-                  "PeerConnection:request",
-                  "recording-device-events"], "chrome://browser/content/WebrtcUI.js"])
-}
-
-lazilyLoadedObserverScripts.forEach(function (aScript) {
-  let [name, notifications, script] = aScript;
-  XPCOMUtils.defineLazyGetter(window, name, function() {
-    let sandbox = {};
-    Services.scriptloader.loadSubScript(script, sandbox);
-    return sandbox[name];
-  });
-  let observer = (s, t, d) => {
-    Services.obs.removeObserver(observer, t);
-    Services.obs.addObserver(window[name], t, false);
-    window[name].observe(s, t, d); // Explicitly notify new observer
-  };
-  notifications.forEach((notification) => {
-    Services.obs.addObserver(observer, notification, false);
-  });
-});
-
-// Lazily-loaded browser scripts that use message listeners.
-[
-  ["Reader", [
-    ["Reader:AddToList", false],
-    ["Reader:ArticleGet", false],
-    ["Reader:DropdownClosed", true], // 'true' allows us to survive mid-air cycle-collection.
-    ["Reader:DropdownOpened", false],
-    ["Reader:FaviconRequest", false],
-    ["Reader:ListStatusRequest", false],
-    ["Reader:RemoveFromList", false],
-    ["Reader:Share", false],
-    ["Reader:ToolbarHidden", false],
-    ["Reader:SystemUIVisibility", false],
-    ["Reader:UpdateReaderButton", false],
-    ["Reader:SetIntPref", false],
-    ["Reader:SetCharPref", false],
-  ], "chrome://browser/content/Reader.js"],
-].forEach(aScript => {
-  let [name, messages, script] = aScript;
-  XPCOMUtils.defineLazyGetter(window, name, function() {
-    let sandbox = {};
-    Services.scriptloader.loadSubScript(script, sandbox);
-    return sandbox[name];
-  });
-
-  let mm = window.getGroupMessageManager("browsers");
-  let listener = (message) => {
-    mm.removeMessageListener(message.name, listener);
-    let listenAfterClose = false;
-    for (let [name, laClose] of messages) {
-      if (message.name === name) {
-        listenAfterClose = laClose;
-        break;
-      }
-    }
-
-    mm.addMessageListener(message.name, window[name], listenAfterClose);
-    window[name].receiveMessage(message);
-  };
-
-  messages.forEach((message) => {
-    let [name, listenAfterClose] = message;
-    mm.addMessageListener(name, listener, listenAfterClose);
-  });
-});
-
-// Lazily-loaded JS modules that use observer notifications
-[
-  ["Home", ["HomeBanner:Get", "HomePanels:Get", "HomePanels:Authenticate", "HomePanels:RefreshView",
-            "HomePanels:Installed", "HomePanels:Uninstalled"], "resource://gre/modules/Home.jsm"],
-].forEach(module => {
-  let [name, notifications, resource] = module;
-  XPCOMUtils.defineLazyModuleGetter(this, name, resource);
-  let observer = (s, t, d) => {
-    Services.obs.removeObserver(observer, t);
-    Services.obs.addObserver(this[name], t, false);
-    this[name].observe(s, t, d); // Explicitly notify new observer
-  };
-  notifications.forEach(notification => {
-    Services.obs.addObserver(observer, notification, false);
-  });
-});
-
-XPCOMUtils.defineLazyServiceGetter(this, "Haptic",
-  "@mozilla.org/widget/hapticfeedback;1", "nsIHapticFeedback");
-
-XPCOMUtils.defineLazyServiceGetter(this, "ParentalControls",
-  "@mozilla.org/parental-controls-service;1", "nsIParentalControlsService");
-
-XPCOMUtils.defineLazyServiceGetter(this, "DOMUtils",
-  "@mozilla.org/inspector/dom-utils;1", "inIDOMUtils");
-
-XPCOMUtils.defineLazyServiceGetter(window, "URIFixup",
-  "@mozilla.org/docshell/urifixup;1", "nsIURIFixup");
-
-if (AppConstants.MOZ_WEBRTC) {
-  XPCOMUtils.defineLazyServiceGetter(this, "MediaManagerService",
-    "@mozilla.org/mediaManagerService;1", "nsIMediaManagerService");
-}
-
-XPCOMUtils.defineLazyModuleGetter(
-  this,
-  "DOMApplicationRegistry",
-  "resource://gre/modules/Webapps.jsm",
-  null,
-  function() {
-    XPCOMUtils.defineLazyServiceGetter(this, "ppmm",
-                                   "@mozilla.org/parentprocessmessagemanager;1",
-                                   "nsIMessageBroadcaster");
-
-    // Keep the messages in sync with the initialization in Webapps.jsm (bug 1171013).
-    this.messages = ["Webapps:Install",
-                     "Webapps:Uninstall",
-                     "Webapps:GetSelf",
-                     "Webapps:CheckInstalled",
-                     "Webapps:GetInstalled",
-                     "Webapps:GetNotInstalled",
-                     "Webapps:Launch",
-                     "Webapps:LocationChange",
-                     "Webapps:InstallPackage",
-                     "Webapps:GetList",
-                     "Webapps:RegisterForMessages",
-                     "Webapps:UnregisterForMessages",
-                     "Webapps:CancelDownload",
-                     "Webapps:CheckForUpdate",
-                     "Webapps:Download",
-                     "Webapps:ApplyDownload",
-                     "Webapps:Install:Return:Ack",
-                     "Webapps:AddReceipt",
-                     "Webapps:RemoveReceipt",
-                     "Webapps:ReplaceReceipt",
-                     "Webapps:RegisterBEP",
-                     "Webapps:Export",
-                     "Webapps:Import",
-                     "Webapps:GetIcon",
-                     "Webapps:ExtractManifest",
-                     "Webapps:SetEnabled",
-                     "child-process-shutdown"];
-
-    this.messages.forEach(msgName => {
-      this.ppmm.addMessageListener(msgName, this);
-    });
-  },
-  function() {
-    this.messages.forEach(msgName => {
-      this.ppmm.removeMessageListener(msgName, this);
-    });
-  },
-  {
-    receiveMessage: function() {
-      // This is called only once when we receive a message for the first time.
-      // With this, we trigger the import of Webapps.jsm and forward the message
-      // to the real registry.
-      return DOMApplicationRegistry.receiveMessage.apply(
-          DOMApplicationRegistry, arguments);
-    }
-  }
-);
-
-XPCOMUtils.defineLazyModuleGetter(this, "Log",
-  "resource://gre/modules/AndroidLog.jsm", "AndroidLog");
-
-// Define the "dump" function as a binding of the Log.d function so it specifies
-// the "debug" priority and a log tag.
-function dump(msg) {
-  Log.d("Browser", msg);
-}
-
-const kStateActive = 0x00000001; // :active pseudoclass for elements
-
-const kXLinkNamespace = "http://www.w3.org/1999/xlink";
-
-function fuzzyEquals(a, b) {
-  return (Math.abs(a - b) < 1e-6);
-}
-
-XPCOMUtils.defineLazyGetter(this, "ContentAreaUtils", function() {
-  let ContentAreaUtils = {};
-  Services.scriptloader.loadSubScript("chrome://global/content/contentAreaUtils.js", ContentAreaUtils);
-  return ContentAreaUtils;
-});
-
-XPCOMUtils.defineLazyModuleGetter(this, "Rect", "resource://gre/modules/Geometry.jsm");
-XPCOMUtils.defineLazyModuleGetter(this, "Point", "resource://gre/modules/Geometry.jsm");
-
-function resolveGeckoURI(aURI) {
-  if (!aURI)
-    throw "Can't resolve an empty uri";
-
-  if (aURI.startsWith("chrome://")) {
-    let registry = Cc['@mozilla.org/chrome/chrome-registry;1'].getService(Ci["nsIChromeRegistry"]);
-    return registry.convertChromeURL(Services.io.newURI(aURI, null, null)).spec;
-  } else if (aURI.startsWith("resource://")) {
-    let handler = Services.io.getProtocolHandler("resource").QueryInterface(Ci.nsIResProtocolHandler);
-    return handler.resolveURI(Services.io.newURI(aURI, null, null));
-  }
-  return aURI;
-}
-
-/**
- * Cache of commonly used string bundles.
- */
-var Strings = {
-  init: function () {
-    XPCOMUtils.defineLazyGetter(Strings, "brand", () => Services.strings.createBundle("chrome://branding/locale/brand.properties"));
-    XPCOMUtils.defineLazyGetter(Strings, "browser", () => Services.strings.createBundle("chrome://browser/locale/browser.properties"));
-    XPCOMUtils.defineLazyGetter(Strings, "reader", () => Services.strings.createBundle("chrome://global/locale/aboutReader.properties"));
-  },
-
-  flush: function () {
-    Services.strings.flushBundles();
-    this.init();
-  },
-};
-
-Strings.init();
-
-const kFormHelperModeDisabled = 0;
-const kFormHelperModeEnabled = 1;
-const kFormHelperModeDynamic = 2;   // disabled on tablets
-const kMaxHistoryListSize = 50;
-
-function InitLater(fn, object, name) {
-  return DelayedInit.schedule(fn, object, name, 15000 /* 15s max wait */);
-}
-
-var BrowserApp = {
-  _tabs: [],
-  _selectedTab: null,
-  _prefObservers: [],
-
-  get isTablet() {
-    let sysInfo = Cc["@mozilla.org/system-info;1"].getService(Ci.nsIPropertyBag2);
-    delete this.isTablet;
-    return this.isTablet = sysInfo.get("tablet");
-  },
-
-  get isOnLowMemoryPlatform() {
-    let memory = Cc["@mozilla.org/xpcom/memory-service;1"].getService(Ci.nsIMemory);
-    delete this.isOnLowMemoryPlatform;
-    return this.isOnLowMemoryPlatform = memory.isLowMemoryPlatform();
-  },
-
-  deck: null,
-
-  startup: function startup() {
-    window.QueryInterface(Ci.nsIDOMChromeWindow).browserDOMWindow = new nsBrowserAccess();
-    dump("zerdatime " + Date.now() + " - browser chrome startup finished.");
-
-    this.deck = document.getElementById("browsers");
-
-    BrowserEventHandler.init();
-
-    ViewportHandler.init();
-
-    Services.androidBridge.browserApp = this;
-
-    Services.obs.addObserver(this, "Locale:OS", false);
-    Services.obs.addObserver(this, "Locale:Changed", false);
-    Services.obs.addObserver(this, "Tab:Load", false);
-    Services.obs.addObserver(this, "Tab:Selected", false);
-    Services.obs.addObserver(this, "Tab:Closed", false);
-    Services.obs.addObserver(this, "Session:Back", false);
-    Services.obs.addObserver(this, "Session:Forward", false);
-    Services.obs.addObserver(this, "Session:Navigate", false);
-    Services.obs.addObserver(this, "Session:Reload", false);
-    Services.obs.addObserver(this, "Session:Stop", false);
-    Services.obs.addObserver(this, "SaveAs:PDF", false);
-    Services.obs.addObserver(this, "Browser:Quit", false);
-    Services.obs.addObserver(this, "Preferences:Set", false);
-    Services.obs.addObserver(this, "ScrollTo:FocusedInput", false);
-    Services.obs.addObserver(this, "Sanitize:ClearData", false);
-    Services.obs.addObserver(this, "FullScreen:Exit", false);
-    Services.obs.addObserver(this, "Viewport:Change", false);
-    Services.obs.addObserver(this, "Viewport:Flush", false);
-    Services.obs.addObserver(this, "Passwords:Init", false);
-    Services.obs.addObserver(this, "FormHistory:Init", false);
-    Services.obs.addObserver(this, "gather-telemetry", false);
-    Services.obs.addObserver(this, "keyword-search", false);
-    Services.obs.addObserver(this, "webapps-runtime-install", false);
-    Services.obs.addObserver(this, "webapps-runtime-install-package", false);
-    Services.obs.addObserver(this, "webapps-ask-install", false);
-    Services.obs.addObserver(this, "webapps-ask-uninstall", false);
-    Services.obs.addObserver(this, "webapps-launch", false);
-    Services.obs.addObserver(this, "webapps-runtime-uninstall", false);
-    Services.obs.addObserver(this, "Webapps:AutoInstall", false);
-    Services.obs.addObserver(this, "Webapps:Load", false);
-    Services.obs.addObserver(this, "Webapps:AutoUninstall", false);
-    Services.obs.addObserver(this, "sessionstore-state-purge-complete", false);
-    Services.obs.addObserver(this, "Fonts:Reload", false);
-
-    Messaging.addListener(this.getHistory.bind(this), "Session:GetHistory");
-
-    function showFullScreenWarning() {
-      Snackbars.show(Strings.browser.GetStringFromName("alertFullScreenToast"), Snackbars.LENGTH_LONG);
-    }
-
-    window.addEventListener("fullscreen", function() {
-      Messaging.sendRequest({
-        type: window.fullScreen ? "ToggleChrome:Hide" : "ToggleChrome:Show"
-      });
-    }, false);
-
-    window.addEventListener("mozfullscreenchange", function(e) {
-      // This event gets fired on the document and its entire ancestor chain
-      // of documents. When enabling fullscreen, it is fired on the top-level
-      // document first and goes down; when disabling the order is reversed
-      // (per spec). This means the last event on enabling will be for the innermost
-      // document, which will have mozFullScreenElement set correctly.
-      let doc = e.target;
-      Messaging.sendRequest({
-        type: doc.mozFullScreen ? "DOMFullScreen:Start" : "DOMFullScreen:Stop",
-        rootElement: (doc.mozFullScreen && doc.mozFullScreenElement == doc.documentElement)
-      });
-
-      if (doc.mozFullScreen)
-        showFullScreenWarning();
-    }, false);
-
-    // When a restricted key is pressed in DOM full-screen mode, we should display
-    // the "Press ESC to exit" warning message.
-    window.addEventListener("MozShowFullScreenWarning", showFullScreenWarning, true);
-
-    NativeWindow.init();
-    FormAssistant.init();
-    IndexedDB.init();
-    XPInstallObserver.init();
-    CharacterEncoding.init();
-    ActivityObserver.init();
-    RemoteDebugger.init();
-    UserAgentOverrides.init();
-    DesktopUserAgent.init();
-    Distribution.init();
-    Tabs.init();
-    SearchEngines.init();
-    Experiments.init();
-
-    if ("arguments" in window) {
-      if (window.arguments[0])
-        gScreenWidth = window.arguments[0];
-      if (window.arguments[1])
-        gScreenHeight = window.arguments[1];
-    }
-
-    // XXX maybe we don't do this if the launch was kicked off from external
-    Services.io.offline = false;
-
-    // Broadcast a UIReady message so add-ons know we are finished with startup
-    let event = document.createEvent("Events");
-    event.initEvent("UIReady", true, false);
-    window.dispatchEvent(event);
-
-    if (this._startupStatus) {
-      this.onAppUpdated();
-    }
-
-    if (!ParentalControls.isAllowed(ParentalControls.INSTALL_EXTENSION)) {
-      // Disable extension installs
-      Services.prefs.setIntPref("extensions.enabledScopes", 1);
-      Services.prefs.setIntPref("extensions.autoDisableScopes", 1);
-      Services.prefs.setBoolPref("xpinstall.enabled", false);
-    } else if (ParentalControls.parentalControlsEnabled) {
-      Services.prefs.clearUserPref("extensions.enabledScopes");
-      Services.prefs.clearUserPref("extensions.autoDisableScopes");
-      Services.prefs.setBoolPref("xpinstall.enabled", true);
-    }
-
-    if (ParentalControls.parentalControlsEnabled) {
-        let isBlockListEnabled = ParentalControls.isAllowed(ParentalControls.BLOCK_LIST);
-        Services.prefs.setBoolPref("browser.safebrowsing.forbiddenURIs.enabled", isBlockListEnabled);
-        Services.prefs.setBoolPref("browser.safebrowsing.allowOverride", !isBlockListEnabled);
-
-        let isTelemetryEnabled = ParentalControls.isAllowed(ParentalControls.TELEMETRY);
-        Services.prefs.setBoolPref("toolkit.telemetry.enabled", isTelemetryEnabled);
-
-        let isHealthReportEnabled = ParentalControls.isAllowed(ParentalControls.HEALTH_REPORT);
-        SharedPreferences.forApp().setBoolPref("android.not_a_preference.healthreport.uploadEnabled", isHealthReportEnabled);
-    }
-
-    let sysInfo = Cc["@mozilla.org/system-info;1"].getService(Ci.nsIPropertyBag2);
-    if (sysInfo.get("version") < 16) {
-      let defaults = Services.prefs.getDefaultBranch(null);
-      defaults.setBoolPref("media.autoplay.enabled", false);
-    }
-
-    InitLater(() => {
-      // The order that context menu items are added is important
-      // Make sure the "Open in App" context menu item appears at the bottom of the list
-      this.initContextMenu();
-      ExternalApps.init();
-    }, NativeWindow, "contextmenus");
-
-    if (AppConstants.ACCESSIBILITY) {
-      InitLater(() => AccessFu.attach(window), window, "AccessFu");
-    }
-
-    // Don't delay loading content.js because when we restore reader mode tabs,
-    // we require the reader mode scripts in content.js right away.
-    let mm = window.getGroupMessageManager("browsers");
-    mm.loadFrameScript("chrome://browser/content/content.js", true);
-
-    // We can't delay registering WebChannel listeners: if the first page is
-    // about:accounts, which can happen when starting the Firefox Account flow
-    // from the first run experience, or via the Firefox Account Status
-    // Activity, we can and do miss messages from the fxa-content-server.
-    // However, we never allow suitably restricted profiles from listening to
-    // fxa-content-server messages.
-    if (ParentalControls.isAllowed(ParentalControls.MODIFY_ACCOUNTS)) {
-      console.log("browser.js: loading Firefox Accounts WebChannel");
-      Cu.import("resource://gre/modules/FxAccountsWebChannel.jsm");
-      EnsureFxAccountsWebChannel();
-    } else {
-      console.log("browser.js: not loading Firefox Accounts WebChannel; this profile cannot connect to Firefox Accounts.");
-    }
-
-    // Notify Java that Gecko has loaded.
-    Messaging.sendRequest({ type: "Gecko:Ready" });
-
-    this.deck.addEventListener("DOMContentLoaded", function BrowserApp_delayedStartup() {
-      BrowserApp.deck.removeEventListener("DOMContentLoaded", BrowserApp_delayedStartup, false);
-
-      InitLater(() => Cu.import("resource://gre/modules/NotificationDB.jsm"));
-      InitLater(() => Cu.import("resource://gre/modules/Payment.jsm"));
-
-      InitLater(() => Services.obs.notifyObservers(window, "browser-delayed-startup-finished", ""));
-      InitLater(() => Messaging.sendRequest({ type: "Gecko:DelayedStartup" }));
-
-      if (AppConstants.NIGHTLY_BUILD) {
-        InitLater(() => WebcompatReporter.init());
-      }
-
-      // Collect telemetry data.
-      // We do this at startup because we want to move away from "gather-telemetry" (bug 1127907)
-      InitLater(() => {
-        Telemetry.addData("FENNEC_TRACKING_PROTECTION_STATE", parseInt(BrowserApp.getTrackingProtectionState()));
-        Telemetry.addData("ZOOMED_VIEW_ENABLED", Services.prefs.getBoolPref("ui.zoomedview.enabled"));
-      });
-
-      InitLater(() => LightWeightThemeWebInstaller.init());
-      InitLater(() => SpatialNavigation.init(BrowserApp.deck, null), window, "SpatialNavigation");
-      InitLater(() => CastingApps.init(), window, "CastingApps");
-      InitLater(() => Services.search.init(), Services, "search");
-      InitLater(() => DownloadNotifications.init(), window, "DownloadNotifications");
-
-      if (AppConstants.MOZ_SAFE_BROWSING) {
-        // Bug 778855 - Perf regression if we do this here. To be addressed in bug 779008.
-        InitLater(() => SafeBrowsing.init(), window, "SafeBrowsing");
-      }
-
-      InitLater(() => Cc["@mozilla.org/login-manager;1"].getService(Ci.nsILoginManager));
-      InitLater(() => LoginManagerParent.init(), window, "LoginManagerParent");
-
-    }, false);
-
-    // Pass caret StateChanged events to ActionBarHandler.
-    if (AppConstants.NIGHTLY_BUILD) {
-      window.addEventListener("mozcaretstatechanged", e => {
-        ActionBarHandler.caretStateChangedHandler(e);
-      }, /* useCapture = */ true, /* wantsUntrusted = */ false);
-    }
-  },
-
-  get _startupStatus() {
-    delete this._startupStatus;
-
-    let savedMilestone = null;
-    try {
-      savedMilestone = Services.prefs.getCharPref("browser.startup.homepage_override.mstone");
-    } catch (e) {
-    }
-    let ourMilestone = AppConstants.MOZ_APP_VERSION;
-    this._startupStatus = "";
-    if (ourMilestone != savedMilestone) {
-      Services.prefs.setCharPref("browser.startup.homepage_override.mstone", ourMilestone);
-      this._startupStatus = savedMilestone ? "upgrade" : "new";
-    }
-
-    return this._startupStatus;
-  },
-
-  /**
-   * Pass this a locale string, such as "fr" or "es_ES".
-   */
-  setLocale: function (locale) {
-    console.log("browser.js: requesting locale set: " + locale);
-    Messaging.sendRequest({ type: "Locale:Set", locale: locale });
-  },
-
-  _initRuntime: function(status, url, callback) {
-    let sandbox = {};
-    Services.scriptloader.loadSubScript("chrome://browser/content/WebappRT.js", sandbox);
-    window.WebappRT = sandbox.WebappRT;
-    WebappRT.init(status, url, callback);
-  },
-
-  initContextMenu: function () {
-    // We pass a thunk in place of a raw label string. This allows the
-    // context menu to automatically accommodate locale changes without
-    // having to be rebuilt.
-    let stringGetter = name => () => Strings.browser.GetStringFromName(name);
-
-    // TODO: These should eventually move into more appropriate classes
-    NativeWindow.contextmenus.add(stringGetter("contextmenu.openInNewTab"),
-      NativeWindow.contextmenus.linkOpenableNonPrivateContext,
-      function(aTarget) {
-        UITelemetry.addEvent("action.1", "contextmenu", null, "web_open_new_tab");
-        UITelemetry.addEvent("loadurl.1", "contextmenu", null);
-
-        let url = NativeWindow.contextmenus._getLinkURL(aTarget);
-        ContentAreaUtils.urlSecurityCheck(url, aTarget.ownerDocument.nodePrincipal);
-        let tab = BrowserApp.addTab(url, { selected: false, parentId: BrowserApp.selectedTab.id });
-
-        let newtabStrings = Strings.browser.GetStringFromName("newtabpopup.opened");
-        let label = PluralForm.get(1, newtabStrings).replace("#1", 1);
-        let buttonLabel = Strings.browser.GetStringFromName("newtabpopup.switch");
-
-        Snackbars.show(label, Snackbars.LENGTH_LONG, {
-          action: {
-            label: buttonLabel,
-            callback: () => { BrowserApp.selectTab(tab); },
-          }
-        });
-      });
-
-    let showOpenInPrivateTab = true;
-    if ("@mozilla.org/parental-controls-service;1" in Cc) {
-      let pc = Cc["@mozilla.org/parental-controls-service;1"].createInstance(Ci.nsIParentalControlsService);
-      showOpenInPrivateTab = pc.isAllowed(Ci.nsIParentalControlsService.PRIVATE_BROWSING);
-    }
-
-    if (showOpenInPrivateTab) {
-      NativeWindow.contextmenus.add(stringGetter("contextmenu.openInPrivateTab"),
-        NativeWindow.contextmenus.linkOpenableContext,
-        function (aTarget) {
-          UITelemetry.addEvent("action.1", "contextmenu", null, "web_open_new_tab");
-          UITelemetry.addEvent("loadurl.1", "contextmenu", null);
-
-          let url = NativeWindow.contextmenus._getLinkURL(aTarget);
-          ContentAreaUtils.urlSecurityCheck(url, aTarget.ownerDocument.nodePrincipal);
-          let tab = BrowserApp.addTab(url, {selected: false, parentId: BrowserApp.selectedTab.id, isPrivate: true});
-
-          let newtabStrings = Strings.browser.GetStringFromName("newprivatetabpopup.opened");
-          let label = PluralForm.get(1, newtabStrings).replace("#1", 1);
-          let buttonLabel = Strings.browser.GetStringFromName("newtabpopup.switch");
-          Snackbars.show(label, Snackbars.LENGTH_LONG, {
-            action: {
-              label: buttonLabel,
-              callback: () => { BrowserApp.selectTab(tab); },
-            }
-          });
-        });
-    }
-
-    NativeWindow.contextmenus.add(stringGetter("contextmenu.addToReadingList"),
-      NativeWindow.contextmenus.linkOpenableContext,
-      function(aTarget) {
-        UITelemetry.addEvent("action.1", "contextmenu", null, "web_reading_list");
-        UITelemetry.addEvent("save.1", "contextmenu", null, "reading_list");
-
-        let url = NativeWindow.contextmenus._getLinkURL(aTarget);
-        Messaging.sendRequestForResult({
-            type: "Reader:AddToList",
-            title: truncate(url, MAX_TITLE_LENGTH),
-            url: truncate(url, MAX_URI_LENGTH),
-        }).catch(Cu.reportError);
-      });
-
-    NativeWindow.contextmenus.add(stringGetter("contextmenu.copyLink"),
-      NativeWindow.contextmenus.linkCopyableContext,
-      function(aTarget) {
-        UITelemetry.addEvent("action.1", "contextmenu", null, "web_copy_link");
-
-        let url = NativeWindow.contextmenus._getLinkURL(aTarget);
-        NativeWindow.contextmenus._copyStringToDefaultClipboard(url);
-      });
-
-    NativeWindow.contextmenus.add(stringGetter("contextmenu.copyEmailAddress"),
-      NativeWindow.contextmenus.emailLinkContext,
-      function(aTarget) {
-        UITelemetry.addEvent("action.1", "contextmenu", null, "web_copy_email");
-
-        let url = NativeWindow.contextmenus._getLinkURL(aTarget);
-        let emailAddr = NativeWindow.contextmenus._stripScheme(url);
-        NativeWindow.contextmenus._copyStringToDefaultClipboard(emailAddr);
-      });
-
-    NativeWindow.contextmenus.add(stringGetter("contextmenu.copyPhoneNumber"),
-      NativeWindow.contextmenus.phoneNumberLinkContext,
-      function(aTarget) {
-        UITelemetry.addEvent("action.1", "contextmenu", null, "web_copy_phone");
-
-        let url = NativeWindow.contextmenus._getLinkURL(aTarget);
-        let phoneNumber = NativeWindow.contextmenus._stripScheme(url);
-        NativeWindow.contextmenus._copyStringToDefaultClipboard(phoneNumber);
-      });
-
-    NativeWindow.contextmenus.add({
-      label: stringGetter("contextmenu.shareLink"),
-      order: NativeWindow.contextmenus.DEFAULT_HTML5_ORDER - 1, // Show above HTML5 menu items
-      selector: NativeWindow.contextmenus._disableRestricted("SHARE", NativeWindow.contextmenus.linkShareableContext),
-      showAsActions: function(aElement) {
-        return {
-          title: aElement.textContent.trim() || aElement.title.trim(),
-          uri: NativeWindow.contextmenus._getLinkURL(aElement),
-        };
-      },
-      icon: "drawable://ic_menu_share",
-      callback: function(aTarget) {
-        // share.1 telemetry is handled in Java via PromptList
-        UITelemetry.addEvent("action.1", "contextmenu", null, "web_share_link");
-      }
-    });
-
-    NativeWindow.contextmenus.add({
-      label: stringGetter("contextmenu.shareEmailAddress"),
-      order: NativeWindow.contextmenus.DEFAULT_HTML5_ORDER - 1,
-      selector: NativeWindow.contextmenus._disableRestricted("SHARE", NativeWindow.contextmenus.emailLinkContext),
-      showAsActions: function(aElement) {
-        let url = NativeWindow.contextmenus._getLinkURL(aElement);
-        let emailAddr = NativeWindow.contextmenus._stripScheme(url);
-        let title = aElement.textContent || aElement.title;
-        return {
-          title: title,
-          uri: emailAddr,
-        };
-      },
-      icon: "drawable://ic_menu_share",
-      callback: function(aTarget) {
-        // share.1 telemetry is handled in Java via PromptList
-        UITelemetry.addEvent("action.1", "contextmenu", null, "web_share_email");
-      }
-    });
-
-    NativeWindow.contextmenus.add({
-      label: stringGetter("contextmenu.sharePhoneNumber"),
-      order: NativeWindow.contextmenus.DEFAULT_HTML5_ORDER - 1,
-      selector: NativeWindow.contextmenus._disableRestricted("SHARE", NativeWindow.contextmenus.phoneNumberLinkContext),
-      showAsActions: function(aElement) {
-        let url = NativeWindow.contextmenus._getLinkURL(aElement);
-        let phoneNumber = NativeWindow.contextmenus._stripScheme(url);
-        let title = aElement.textContent || aElement.title;
-        return {
-          title: title,
-          uri: phoneNumber,
-        };
-      },
-      icon: "drawable://ic_menu_share",
-      callback: function(aTarget) {
-        // share.1 telemetry is handled in Java via PromptList
-        UITelemetry.addEvent("action.1", "contextmenu", null, "web_share_phone");
-      }
-    });
-
-    NativeWindow.contextmenus.add(stringGetter("contextmenu.addToContacts"),
-      NativeWindow.contextmenus._disableRestricted("ADD_CONTACT", NativeWindow.contextmenus.emailLinkContext),
-      function(aTarget) {
-        UITelemetry.addEvent("action.1", "contextmenu", null, "web_contact_email");
-
-        let url = NativeWindow.contextmenus._getLinkURL(aTarget);
-        Messaging.sendRequest({
-          type: "Contact:Add",
-          email: url
-        });
-      });
-
-    NativeWindow.contextmenus.add(stringGetter("contextmenu.addToContacts"),
-      NativeWindow.contextmenus._disableRestricted("ADD_CONTACT", NativeWindow.contextmenus.phoneNumberLinkContext),
-      function(aTarget) {
-        UITelemetry.addEvent("action.1", "contextmenu", null, "web_contact_phone");
-
-        let url = NativeWindow.contextmenus._getLinkURL(aTarget);
-        Messaging.sendRequest({
-          type: "Contact:Add",
-          phone: url
-        });
-      });
-
-    NativeWindow.contextmenus.add(stringGetter("contextmenu.bookmarkLink"),
-      NativeWindow.contextmenus._disableRestricted("BOOKMARK", NativeWindow.contextmenus.linkBookmarkableContext),
-      function(aTarget) {
-        UITelemetry.addEvent("action.1", "contextmenu", null, "web_bookmark");
-        UITelemetry.addEvent("save.1", "contextmenu", null, "bookmark");
-
-        let url = NativeWindow.contextmenus._getLinkURL(aTarget);
-        let title = aTarget.textContent || aTarget.title || url;
-        Messaging.sendRequest({
-          type: "Bookmark:Insert",
-          url: url,
-          title: title
-        });
-      });
-
-    NativeWindow.contextmenus.add(stringGetter("contextmenu.playMedia"),
-      NativeWindow.contextmenus.mediaContext("media-paused"),
-      function(aTarget) {
-        UITelemetry.addEvent("action.1", "contextmenu", null, "web_play");
-        aTarget.play();
-      });
-
-    NativeWindow.contextmenus.add(stringGetter("contextmenu.pauseMedia"),
-      NativeWindow.contextmenus.mediaContext("media-playing"),
-      function(aTarget) {
-        UITelemetry.addEvent("action.1", "contextmenu", null, "web_pause");
-        aTarget.pause();
-      });
-
-    NativeWindow.contextmenus.add(stringGetter("contextmenu.showControls2"),
-      NativeWindow.contextmenus.mediaContext("media-hidingcontrols"),
-      function(aTarget) {
-        UITelemetry.addEvent("action.1", "contextmenu", null, "web_controls_media");
-        aTarget.setAttribute("controls", true);
-      });
-
-    NativeWindow.contextmenus.add({
-      label: stringGetter("contextmenu.shareMedia"),
-      order: NativeWindow.contextmenus.DEFAULT_HTML5_ORDER - 1,
-      selector: NativeWindow.contextmenus._disableRestricted("SHARE", NativeWindow.contextmenus.SelectorContext("video")),
-      showAsActions: function(aElement) {
-        let url = (aElement.currentSrc || aElement.src);
-        let title = aElement.textContent || aElement.title;
-        return {
-          title: title,
-          uri: url,
-          type: "video/*",
-        };
-      },
-      icon: "drawable://ic_menu_share",
-      callback: function(aTarget) {
-        // share.1 telemetry is handled in Java via PromptList
-        UITelemetry.addEvent("action.1", "contextmenu", null, "web_share_media");
-      }
-    });
-
-    NativeWindow.contextmenus.add(stringGetter("contextmenu.fullScreen"),
-      NativeWindow.contextmenus.SelectorContext("video:not(:-moz-full-screen)"),
-      function(aTarget) {
-        UITelemetry.addEvent("action.1", "contextmenu", null, "web_fullscreen");
-        aTarget.mozRequestFullScreen();
-      });
-
-    NativeWindow.contextmenus.add(stringGetter("contextmenu.mute"),
-      NativeWindow.contextmenus.mediaContext("media-unmuted"),
-      function(aTarget) {
-        UITelemetry.addEvent("action.1", "contextmenu", null, "web_mute");
-        aTarget.muted = true;
-      });
-
-    NativeWindow.contextmenus.add(stringGetter("contextmenu.unmute"),
-      NativeWindow.contextmenus.mediaContext("media-muted"),
-      function(aTarget) {
-        UITelemetry.addEvent("action.1", "contextmenu", null, "web_unmute");
-        aTarget.muted = false;
-      });
-
-    NativeWindow.contextmenus.add(stringGetter("contextmenu.copyImageLocation"),
-      NativeWindow.contextmenus.imageLocationCopyableContext,
-      function(aTarget) {
-        UITelemetry.addEvent("action.1", "contextmenu", null, "web_copy_image");
-
-        let url = aTarget.src;
-        NativeWindow.contextmenus._copyStringToDefaultClipboard(url);
-      });
-
-    NativeWindow.contextmenus.add({
-      label: stringGetter("contextmenu.shareImage"),
-      selector: NativeWindow.contextmenus._disableRestricted("SHARE", NativeWindow.contextmenus.imageSaveableContext),
-      order: NativeWindow.contextmenus.DEFAULT_HTML5_ORDER - 1, // Show above HTML5 menu items
-      showAsActions: function(aTarget) {
-        let doc = aTarget.ownerDocument;
-        let imageCache = Cc["@mozilla.org/image/tools;1"].getService(Ci.imgITools)
-                                                         .getImgCacheForDocument(doc);
-        let props = imageCache.findEntryProperties(aTarget.currentURI, doc);
-        let src = aTarget.src;
-        return {
-          title: src,
-          uri: src,
-          type: "image/*",
-        };
-      },
-      icon: "drawable://ic_menu_share",
-      menu: true,
-      callback: function(aTarget) {
-        UITelemetry.addEvent("action.1", "contextmenu", null, "web_share_image");
-      }
-    });
-
-    NativeWindow.contextmenus.add(stringGetter("contextmenu.saveImage"),
-      NativeWindow.contextmenus.imageSaveableContext,
-      function(aTarget) {
-        UITelemetry.addEvent("action.1", "contextmenu", null, "web_save_image");
-        UITelemetry.addEvent("save.1", "contextmenu", null, "image");
-
-        RuntimePermissions.waitForPermissions(RuntimePermissions.WRITE_EXTERNAL_STORAGE).then(function(permissionGranted) {
-            if (!permissionGranted) {
-                return;
-            }
-
-            ContentAreaUtils.saveImageURL(aTarget.currentURI.spec, null, "SaveImageTitle",
-                                          false, true, aTarget.ownerDocument.documentURIObject,
-                                          aTarget.ownerDocument);
-        });
-      });
-
-    NativeWindow.contextmenus.add(stringGetter("contextmenu.setImageAs"),
-      NativeWindow.contextmenus._disableRestricted("SET_IMAGE", NativeWindow.contextmenus.imageSaveableContext),
-      function(aTarget) {
-        UITelemetry.addEvent("action.1", "contextmenu", null, "web_background_image");
-
-        let src = aTarget.src;
-        Messaging.sendRequest({
-          type: "Image:SetAs",
-          url: src
-        });
-      });
-
-    NativeWindow.contextmenus.add(
-      function(aTarget) {
-        if (aTarget instanceof HTMLVideoElement) {
-          // If a video element is zero width or height, its essentially
-          // an HTMLAudioElement.
-          if (aTarget.videoWidth == 0 || aTarget.videoHeight == 0 )
-            return Strings.browser.GetStringFromName("contextmenu.saveAudio");
-          return Strings.browser.GetStringFromName("contextmenu.saveVideo");
-        } else if (aTarget instanceof HTMLAudioElement) {
-          return Strings.browser.GetStringFromName("contextmenu.saveAudio");
-        }
-        return Strings.browser.GetStringFromName("contextmenu.saveVideo");
-      }, NativeWindow.contextmenus.mediaSaveableContext,
-      function(aTarget) {
-        UITelemetry.addEvent("action.1", "contextmenu", null, "web_save_media");
-        UITelemetry.addEvent("save.1", "contextmenu", null, "media");
-
-        let url = aTarget.currentSrc || aTarget.src;
-        let filePickerTitleKey = (aTarget instanceof HTMLVideoElement &&
-                                  (aTarget.videoWidth != 0 && aTarget.videoHeight != 0))
-                                  ? "SaveVideoTitle" : "SaveAudioTitle";
-        // Skipped trying to pull MIME type out of cache for now
-        ContentAreaUtils.internalSave(url, null, null, null, null, false,
-                                      filePickerTitleKey, null, aTarget.ownerDocument.documentURIObject,
-                                      aTarget.ownerDocument, true, null);
-      });
-
-    NativeWindow.contextmenus.add(stringGetter("contextmenu.showImage"),
-      NativeWindow.contextmenus.imageBlockingPolicyContext,
-      function(aTarget) {
-        UITelemetry.addEvent("action.1", "contextmenu", null, "web_show_image");
-        aTarget.setAttribute("data-ctv-show", "true");
-        aTarget.setAttribute("src", aTarget.getAttribute("data-ctv-src"));
-
-        // Shows a snackbar to unblock all images if browser.image_blocking.enabled is enabled.
-        let blockedImgs = aTarget.ownerDocument.querySelectorAll("[data-ctv-src]");
-        if (blockedImgs.length == 0) {
-          return;
-        }
-        let message = Strings.browser.GetStringFromName("imageblocking.downloadedImage");
-        Snackbars.show(message, Snackbars.LENGTH_LONG, {
-          action: {
-            label: Strings.browser.GetStringFromName("imageblocking.showAllImages"),
-            callback: () => {
-              UITelemetry.addEvent("action.1", "toast", null, "web_show_all_image");
-              for (let i = 0; i < blockedImgs.length; ++i) {
-                blockedImgs[i].setAttribute("data-ctv-show", "true");
-                blockedImgs[i].setAttribute("src", blockedImgs[i].getAttribute("data-ctv-src"));
-              }
-            },
-          }
-        });
-    });
-  },
-
-  onAppUpdated: function() {
-    // initialize the form history and passwords databases on upgrades
-    Services.obs.notifyObservers(null, "FormHistory:Init", "");
-    Services.obs.notifyObservers(null, "Passwords:Init", "");
-
-    if (this._startupStatus === "upgrade") {
-      this._migrateUI();
-    }
-  },
-
-  _migrateUI: function() {
-    const UI_VERSION = 2;
-    let currentUIVersion = 0;
-    try {
-      currentUIVersion = Services.prefs.getIntPref("browser.migration.version");
-    } catch(ex) {}
-    if (currentUIVersion >= UI_VERSION) {
-      return;
-    }
-
-    if (currentUIVersion < 1) {
-      // Migrate user-set "plugins.click_to_play" pref. See bug 884694.
-      // Because the default value is true, a user-set pref means that the pref was set to false.
-      if (Services.prefs.prefHasUserValue("plugins.click_to_play")) {
-        Services.prefs.setIntPref("plugin.default.state", Ci.nsIPluginTag.STATE_ENABLED);
-        Services.prefs.clearUserPref("plugins.click_to_play");
-      }
-
-      // Migrate the "privacy.donottrackheader.value" pref. See bug 1042135.
-      if (Services.prefs.prefHasUserValue("privacy.donottrackheader.value")) {
-        // Make sure the doNotTrack value conforms to the conversion from
-        // three-state to two-state. (This reverts a setting of "please track me"
-        // to the default "don't say anything").
-        if (Services.prefs.getBoolPref("privacy.donottrackheader.enabled") &&
-            (Services.prefs.getIntPref("privacy.donottrackheader.value") != 1)) {
-          Services.prefs.clearUserPref("privacy.donottrackheader.enabled");
-        }
-
-        // This pref has been removed, so always clear it.
-        Services.prefs.clearUserPref("privacy.donottrackheader.value");
-      }
-
-      // Set the search activity default pref on app upgrade if it has not been set already.
-      if (!Services.prefs.prefHasUserValue("searchActivity.default.migrated")) {
-        Services.prefs.setBoolPref("searchActivity.default.migrated", true);
-        SearchEngines.migrateSearchActivityDefaultPref();
-      }
-
-      Reader.migrateCache().catch(e => Cu.reportError("Error migrating Reader cache: " + e));
-
-      // We removed this pref from user visible settings, so we should reset it.
-      // Power users can go into about:config to re-enable this if they choose.
-      if (Services.prefs.prefHasUserValue("nglayout.debug.paint_flashing")) {
-        Services.prefs.clearUserPref("nglayout.debug.paint_flashing");
-      }
-    }
-
-    if (currentUIVersion < 2) {
-      let name;
-      if (Services.prefs.prefHasUserValue("browser.search.defaultenginename")) {
-        name = Services.prefs.getCharPref("browser.search.defaultenginename");
-      }
-      if (!name && Services.prefs.prefHasUserValue("browser.search.defaultenginename.US")) {
-        name = Services.prefs.getCharPref("browser.search.defaultenginename.US");
-      }
-      if (name) {
-        Services.search.init(() => {
-          let engine = Services.search.getEngineByName(name);
-          if (engine) {
-            Services.search.defaultEngine = engine;
-            Services.obs.notifyObservers(null, "default-search-engine-migrated", "");
-          }
-        });
-      }
-    }
-
-    // Update the migration version.
-    Services.prefs.setIntPref("browser.migration.version", UI_VERSION);
-  },
-
-  // This function returns false during periods where the browser displayed document is
-  // different from the browser content document, so user actions and some kinds of viewport
-  // updates should be ignored. This period starts when we start loading a new page or
-  // switch tabs, and ends when the new browser content document has been drawn and handed
-  // off to the compositor.
-  isBrowserContentDocumentDisplayed: function() {
-    try {
-      if (!Services.androidBridge.isContentDocumentDisplayed())
-        return false;
-    } catch (e) {
-      return false;
-    }
-
-    let tab = this.selectedTab;
-    if (!tab)
-      return false;
-    return tab.contentDocumentIsDisplayed;
-  },
-
-  contentDocumentChanged: function() {
-    dump("GeckoBug1151102: Setting first-paint flag on DWU");
-    window.top.QueryInterface(Ci.nsIInterfaceRequestor).getInterface(Ci.nsIDOMWindowUtils).isFirstPaint = true;
-    Services.androidBridge.contentDocumentChanged();
-  },
-
-  get tabs() {
-    return this._tabs;
-  },
-
-  set selectedTab(aTab) {
-    if (this._selectedTab == aTab)
-      return;
-
-    if (this._selectedTab) {
-      this._selectedTab.setActive(false);
-    }
-
-    this._selectedTab = aTab;
-    if (!aTab)
-      return;
-
-    aTab.setActive(true);
-    this.contentDocumentChanged();
-    this.deck.selectedPanel = aTab.browser;
-    // Focus the browser so that things like selection will be styled correctly.
-    aTab.browser.focus();
-  },
-
-  get selectedBrowser() {
-    if (this._selectedTab)
-      return this._selectedTab.browser;
-    return null;
-  },
-
-  getTabForId: function getTabForId(aId) {
-    let tabs = this._tabs;
-    for (let i=0; i < tabs.length; i++) {
-       if (tabs[i].id == aId)
-         return tabs[i];
-    }
-    return null;
-  },
-
-  getTabForBrowser: function getTabForBrowser(aBrowser) {
-    let tabs = this._tabs;
-    for (let i = 0; i < tabs.length; i++) {
-      if (tabs[i].browser == aBrowser)
-        return tabs[i];
-    }
-    return null;
-  },
-
-  getTabForWindow: function getTabForWindow(aWindow) {
-    let tabs = this._tabs;
-    for (let i = 0; i < tabs.length; i++) {
-      if (tabs[i].browser.contentWindow == aWindow)
-        return tabs[i];
-    }
-    return null;
-  },
-
-  getBrowserForWindow: function getBrowserForWindow(aWindow) {
-    let tabs = this._tabs;
-    for (let i = 0; i < tabs.length; i++) {
-      if (tabs[i].browser.contentWindow == aWindow)
-        return tabs[i].browser;
-    }
-    return null;
-  },
-
-  getBrowserForDocument: function getBrowserForDocument(aDocument) {
-    let tabs = this._tabs;
-    for (let i = 0; i < tabs.length; i++) {
-      if (tabs[i].browser.contentDocument == aDocument)
-        return tabs[i].browser;
-    }
-    return null;
-  },
-
-  loadURI: function loadURI(aURI, aBrowser, aParams) {
-    aBrowser = aBrowser || this.selectedBrowser;
-    if (!aBrowser)
-      return;
-
-    aParams = aParams || {};
-
-    let flags = "flags" in aParams ? aParams.flags : Ci.nsIWebNavigation.LOAD_FLAGS_NONE;
-    let postData = ("postData" in aParams && aParams.postData) ? aParams.postData : null;
-    let referrerURI = "referrerURI" in aParams ? aParams.referrerURI : null;
-    let charset = "charset" in aParams ? aParams.charset : null;
-
-    let tab = this.getTabForBrowser(aBrowser);
-    if (tab) {
-      if ("userRequested" in aParams) tab.userRequested = aParams.userRequested;
-      tab.isSearch = ("isSearch" in aParams) ? aParams.isSearch : false;
-    }
-
-    try {
-      aBrowser.loadURIWithFlags(aURI, flags, referrerURI, charset, postData);
-    } catch(e) {
-      if (tab) {
-        let message = {
-          type: "Content:LoadError",
-          tabID: tab.id
-        };
-        Messaging.sendRequest(message);
-        dump("Handled load error: " + e)
-      }
-    }
-  },
-
-  addTab: function addTab(aURI, aParams) {
-    aParams = aParams || {};
-
-    let newTab = new Tab(aURI, aParams);
-
-    if (typeof aParams.tabIndex == "number") {
-      this._tabs.splice(aParams.tabIndex, 0, newTab);
-    } else {
-      this._tabs.push(newTab);
-    }
-
-    let selected = "selected" in aParams ? aParams.selected : true;
-    if (selected)
-      this.selectedTab = newTab;
-
-    let pinned = "pinned" in aParams ? aParams.pinned : false;
-    if (pinned) {
-      let ss = Cc["@mozilla.org/browser/sessionstore;1"].getService(Ci.nsISessionStore);
-      ss.setTabValue(newTab, "appOrigin", aURI);
-    }
-
-    let evt = document.createEvent("UIEvents");
-    evt.initUIEvent("TabOpen", true, false, window, null);
-    newTab.browser.dispatchEvent(evt);
-
-    return newTab;
-  },
-
-  // Use this method to close a tab from JS. This method sends a message
-  // to Java to close the tab in the Java UI (we'll get a Tab:Closed message
-  // back from Java when that happens).
-  closeTab: function closeTab(aTab) {
-    if (!aTab) {
-      Cu.reportError("Error trying to close tab (tab doesn't exist)");
-      return;
-    }
-
-    let message = {
-      type: "Tab:Close",
-      tabID: aTab.id
-    };
-    Messaging.sendRequest(message);
-  },
-
-  _loadWebapp: function(aMessage) {
-    // Entry point for WebApps. This is the point in which we know
-    // the code is being used as a WebApp runtime.
-    this._initRuntime(this._startupStatus, aMessage.url, aUrl => {
-      this.manifestUrl = aMessage.url;
-      this.addTab(aUrl, { title: aMessage.name });
-    });
-  },
-
-  // Calling this will update the state in BrowserApp after a tab has been
-  // closed in the Java UI.
-  _handleTabClosed: function _handleTabClosed(aTab, aShowUndoSnackbar) {
-    if (aTab == this.selectedTab)
-      this.selectedTab = null;
-
-    let tabIndex = this._tabs.indexOf(aTab);
-
-    let evt = document.createEvent("UIEvents");
-    evt.initUIEvent("TabClose", true, false, window, tabIndex);
-    aTab.browser.dispatchEvent(evt);
-
-    if (aShowUndoSnackbar) {
-      // Get a title for the undo close snackbar. Fall back to the URL if there is no title.
-      let ss = Cc["@mozilla.org/browser/sessionstore;1"].getService(Ci.nsISessionStore);
-      let closedTabData = ss.getClosedTabs(window)[0];
-
-      let message;
-      let title = closedTabData.entries[closedTabData.index - 1].title;
-
-      if (title) {
-        message = Strings.browser.formatStringFromName("undoCloseToast.message", [title], 1);
-      } else {
-        message = Strings.browser.GetStringFromName("undoCloseToast.messageDefault");
-      }
-
-      Snackbars.show(message, Snackbars.LENGTH_LONG, {
-        action: {
-          label: Strings.browser.GetStringFromName("undoCloseToast.action2"),
-          callback: function() {
-            UITelemetry.addEvent("undo.1", "toast", null, "closetab");
-            ss.undoCloseTab(window, closedTabData);
-          }
-        }
-      });
-    }
-
-    aTab.destroy();
-    this._tabs.splice(tabIndex, 1);
-  },
-
-  // Use this method to select a tab from JS. This method sends a message
-  // to Java to select the tab in the Java UI (we'll get a Tab:Selected message
-  // back from Java when that happens).
-  selectTab: function selectTab(aTab) {
-    if (!aTab) {
-      Cu.reportError("Error trying to select tab (tab doesn't exist)");
-      return;
-    }
-
-    // There's nothing to do if the tab is already selected
-    if (aTab == this.selectedTab)
-      return;
-
-    this.selectedBrowser.contentDocument.mozCancelFullScreen();
-
-    let message = {
-      type: "Tab:Select",
-      tabID: aTab.id
-    };
-    Messaging.sendRequest(message);
-  },
-
-  /**
-   * Gets an open tab with the given URL.
-   *
-   * @param  aURL URL to look for
-   * @param  aOptions Options for the search. Currently supports:
-   **  @option startsWith a Boolean indicating whether to search for a tab who's url starts with the
-   *           requested url. Useful if you want to ignore hash codes on the end of a url. For instance
-   *           to have about:downloads match about:downloads#123.
-   * @return the tab with the given URL, or null if no such tab exists
-   */
-  getTabWithURL: function getTabWithURL(aURL, aOptions) {
-    aOptions = aOptions || {};
-    let uri = Services.io.newURI(aURL, null, null);
-    for (let i = 0; i < this._tabs.length; ++i) {
-      let tab = this._tabs[i];
-      if (aOptions.startsWith) {
-        if (tab.browser.currentURI.spec.startsWith(aURL)) {
-          return tab;
-        }
-      } else {
-        if (tab.browser.currentURI.equals(uri)) {
-          return tab;
-        }
-      }
-    }
-    return null;
-  },
-
-  /**
-   * If a tab with the given URL already exists, that tab is selected.
-   * Otherwise, a new tab is opened with the given URL.
-   *
-   * @param aURL URL to open
-   * @param aParam Options used if a tab is created
-   * @param aFlags Options for the search. Currently supports:
-   **  @option startsWith a Boolean indicating whether to search for a tab who's url starts with the
-   *           requested url. Useful if you want to ignore hash codes on the end of a url. For instance
-   *           to have about:downloads match about:downloads#123.
-   */
-  selectOrAddTab: function selectOrAddTab(aURL, aParams, aFlags) {
-    let tab = this.getTabWithURL(aURL, aFlags);
-    if (tab == null) {
-      tab = this.addTab(aURL, aParams);
-    } else {
-      this.selectTab(tab);
-    }
-
-    return tab;
-  },
-
-  // This method updates the state in BrowserApp after a tab has been selected
-  // in the Java UI.
-  _handleTabSelected: function _handleTabSelected(aTab) {
-    this.selectedTab = aTab;
-
-    let evt = document.createEvent("UIEvents");
-    evt.initUIEvent("TabSelect", true, false, window, null);
-    aTab.browser.dispatchEvent(evt);
-  },
-
-  quit: function quit(aClear = { sanitize: {}, dontSaveSession: false }) {
-    // Notify all windows that an application quit has been requested.
-    let cancelQuit = Cc["@mozilla.org/supports-PRBool;1"].createInstance(Ci.nsISupportsPRBool);
-    Services.obs.notifyObservers(cancelQuit, "quit-application-requested", "restart");
-
-    // Quit aborted.
-    if (cancelQuit.data) {
-      return;
-    }
-
-    // Tell session store to forget about this window
-    if (aClear.dontSaveSession) {
-      let ss = Cc["@mozilla.org/browser/sessionstore;1"].getService(Ci.nsISessionStore);
-      ss.removeWindow(window);
-    }
-
-    BrowserApp.sanitize(aClear.sanitize, function() {
-      let appStartup = Cc["@mozilla.org/toolkit/app-startup;1"].getService(Ci.nsIAppStartup);
-      appStartup.quit(Ci.nsIAppStartup.eForceQuit);
-    });
-  },
-
-  saveAsPDF: function saveAsPDF(aBrowser) {
-    RuntimePermissions.waitForPermissions(RuntimePermissions.WRITE_EXTERNAL_STORAGE).then(function(permissionGranted) {
-      if (!permissionGranted) {
-        return;
-      }
-
-      Task.spawn(function* () {
-        let fileName = ContentAreaUtils.getDefaultFileName(aBrowser.contentTitle, aBrowser.currentURI, null, null);
-        fileName = fileName.trim() + ".pdf";
-
-        let downloadsDir = yield Downloads.getPreferredDownloadsDirectory();
-        let file = OS.Path.join(downloadsDir, fileName);
-
-        // Force this to have a unique name.
-        let openedFile = yield OS.File.openUnique(file, { humanReadable: true });
-        file = openedFile.path;
-        yield openedFile.file.close();
-
-        let download = yield Downloads.createDownload({
-          source: aBrowser.contentWindow,
-          target: file,
-          saver: "pdf",
-          startTime: Date.now(),
-        });
-
-        let list = yield Downloads.getList(download.source.isPrivate ? Downloads.PRIVATE : Downloads.PUBLIC)
-        yield list.add(download);
-        yield download.start();
-      });
-    });
-  },
-
-  notifyPrefObservers: function(aPref) {
-    this._prefObservers[aPref].forEach(function(aRequestId) {
-      this.getPreferences(aRequestId, [aPref], 1);
-    }, this);
-  },
-
-  // These values come from pref_tracking_protection_entries in arrays.xml.
-  PREF_TRACKING_PROTECTION_ENABLED: "2",
-  PREF_TRACKING_PROTECTION_ENABLED_PB: "1",
-  PREF_TRACKING_PROTECTION_DISABLED: "0",
-
-  /**
-   * Returns the current state of the tracking protection pref.
-   * (0 = Disabled, 1 = Enabled in PB, 2 = Enabled)
-   */
-  getTrackingProtectionState: function() {
-    if (Services.prefs.getBoolPref("privacy.trackingprotection.enabled")) {
-      return this.PREF_TRACKING_PROTECTION_ENABLED;
-    }
-    if (Services.prefs.getBoolPref("privacy.trackingprotection.pbmode.enabled")) {
-      return this.PREF_TRACKING_PROTECTION_ENABLED_PB;
-    }
-    return this.PREF_TRACKING_PROTECTION_DISABLED;
-  },
-
-  handlePreferencesRequest: function handlePreferencesRequest(aRequestId,
-                                                              aPrefNames,
-                                                              aListen) {
-
-    let prefs = [];
-
-    for (let prefName of aPrefNames) {
-      let pref = {
-        name: prefName,
-        type: "",
-        value: null
-      };
-
-      if (aListen) {
-        if (this._prefObservers[prefName])
-          this._prefObservers[prefName].push(aRequestId);
-        else
-          this._prefObservers[prefName] = [ aRequestId ];
-        Services.prefs.addObserver(prefName, this, false);
-      }
-
-      // These pref names are not "real" pref names.
-      // They are used in the setting menu,
-      // and these are passed when initializing the setting menu.
-      switch (prefName) {
-        // The plugin pref is actually two separate prefs, so
-        // we need to handle it differently
-        case "plugin.enable":
-          pref.type = "string";// Use a string type for java's ListPreference
-          pref.value = PluginHelper.getPluginPreference();
-          prefs.push(pref);
-          continue;
-        // Handle master password
-        case "privacy.masterpassword.enabled":
-          pref.type = "bool";
-          pref.value = MasterPassword.enabled;
-          prefs.push(pref);
-          continue;
-        case "privacy.trackingprotection.state": {
-          pref.type = "string";
-          pref.value = this.getTrackingProtectionState();
-          prefs.push(pref);
-          continue;
-        }
-        // Crash reporter submit pref must be fetched from nsICrashReporter service.
-        case "datareporting.crashreporter.submitEnabled":
-          let crashReporterBuilt = "nsICrashReporter" in Ci && Services.appinfo instanceof Ci.nsICrashReporter;
-          if (crashReporterBuilt) {
-            pref.type = "bool";
-            pref.value = Services.appinfo.submitReports;
-            prefs.push(pref);
-          }
-          continue;
-      }
-
-      try {
-        switch (Services.prefs.getPrefType(prefName)) {
-          case Ci.nsIPrefBranch.PREF_BOOL:
-            pref.type = "bool";
-            pref.value = Services.prefs.getBoolPref(prefName);
-            break;
-          case Ci.nsIPrefBranch.PREF_INT:
-            pref.type = "int";
-            pref.value = Services.prefs.getIntPref(prefName);
-            break;
-          case Ci.nsIPrefBranch.PREF_STRING:
-          default:
-            pref.type = "string";
-            try {
-              // Try in case it's a localized string (will throw an exception if not)
-              pref.value = Services.prefs.getComplexValue(prefName, Ci.nsIPrefLocalizedString).data;
-            } catch (e) {
-              pref.value = Services.prefs.getCharPref(prefName);
-            }
-            break;
-        }
-      } catch (e) {
-        dump("Error reading pref [" + prefName + "]: " + e);
-        // preference does not exist; do not send it
-        continue;
-      }
-
-      // Some Gecko preferences use integers or strings to reference
-      // state instead of directly representing the value.
-      // Since the Java UI uses the type to determine which ui elements
-      // to show and how to handle them, we need to normalize these
-      // preferences to the correct type.
-      switch (prefName) {
-        // (string) index for determining which multiple choice value to display.
-        case "browser.chrome.titlebarMode":
-        case "network.cookie.cookieBehavior":
-        case "font.size.inflation.minTwips":
-        case "home.sync.updateMode":
-        case "browser.image_blocking":
-          pref.type = "string";
-          pref.value = pref.value.toString();
-          break;
-      }
-
-      prefs.push(pref);
-    }
-
-    Messaging.sendRequest({
-      type: "Preferences:Data",
-      requestId: aRequestId,    // opaque request identifier, can be any string/int/whatever
-      preferences: prefs
-    });
-  },
-
-  setPreferences: function (aPref) {
-    let json = JSON.parse(aPref);
-
-    switch (json.name) {
-      // The plugin pref is actually two separate prefs, so
-      // we need to handle it differently
-      case "plugin.enable":
-        PluginHelper.setPluginPreference(json.value);
-        return;
-
-      // MasterPassword pref is not real, we just need take action and leave
-      case "privacy.masterpassword.enabled":
-        if (MasterPassword.enabled)
-          MasterPassword.removePassword(json.value);
-        else
-          MasterPassword.setPassword(json.value);
-        return;
-
-      // "privacy.trackingprotection.state" is not a "real" pref name, but it's used in the setting menu.
-      // By default "privacy.trackingprotection.pbmode.enabled" is true,
-      // and "privacy.trackingprotection.enabled" is false.
-      case "privacy.trackingprotection.state": {
-        switch (json.value) {
-          // Tracking protection disabled.
-          case this.PREF_TRACKING_PROTECTION_DISABLED:
-            Services.prefs.setBoolPref("privacy.trackingprotection.pbmode.enabled", false);
-            Services.prefs.setBoolPref("privacy.trackingprotection.enabled", false);
-            break;
-          // Tracking protection only in private browsing,
-          case this.PREF_TRACKING_PROTECTION_ENABLED_PB:
-            Services.prefs.setBoolPref("privacy.trackingprotection.pbmode.enabled", true);
-            Services.prefs.setBoolPref("privacy.trackingprotection.enabled", false);
-            break;
-          // Tracking protection everywhere.
-          case this.PREF_TRACKING_PROTECTION_ENABLED:
-            Services.prefs.setBoolPref("privacy.trackingprotection.pbmode.enabled", true);
-            Services.prefs.setBoolPref("privacy.trackingprotection.enabled", true);
-            break;
-        }
-        return;
-      }
-      // Enabling or disabling suggestions will prevent future prompts
-      case SearchEngines.PREF_SUGGEST_ENABLED:
-        Services.prefs.setBoolPref(SearchEngines.PREF_SUGGEST_PROMPTED, true);
-        break;
-
-      // Crash reporter preference is in a service; set and return.
-      case "datareporting.crashreporter.submitEnabled":
-        let crashReporterBuilt = "nsICrashReporter" in Ci && Services.appinfo instanceof Ci.nsICrashReporter;
-        if (crashReporterBuilt) {
-          Services.appinfo.submitReports = json.value;
-        }
-        return;
-
-      // When sending to Java, we normalized special preferences that use
-      // integers and strings to represent booleans. Here, we convert them back
-      // to their actual types so we can store them.
-      case "browser.chrome.titlebarMode":
-      case "network.cookie.cookieBehavior":
-      case "font.size.inflation.minTwips":
-      case "home.sync.updateMode":
-      case "browser.image_blocking":
-        json.type = "int";
-        json.value = parseInt(json.value);
-        break;
-    }
-
-    switch (json.type) {
-      case "bool":
-        Services.prefs.setBoolPref(json.name, json.value);
-        break;
-      case "int":
-        Services.prefs.setIntPref(json.name, json.value);
-        break;
-      default: {
-        let pref = Cc["@mozilla.org/pref-localizedstring;1"].createInstance(Ci.nsIPrefLocalizedString);
-        pref.data = json.value;
-        Services.prefs.setComplexValue(json.name, Ci.nsISupportsString, pref);
-        break;
-      }
-    }
-
-    // Finally, if we were asked to flush, flush prefs to disk right now.
-    // This allows us to be confident that prefs set in Settings are persisted,
-    // even if we crash very soon after.
-    if (json.flush) {
-      Services.prefs.savePrefFile(null);
-    }
-  },
-
-  sanitize: function (aItems, callback) {
-    let success = true;
-    var promises = [];
-
-    for (let key in aItems) {
-      if (!aItems[key])
-        continue;
-
-      key = key.replace("private.data.", "");
-
-      switch (key) {
-        case "cookies_sessions":
-          promises.push(Sanitizer.clearItem("cookies"));
-          promises.push(Sanitizer.clearItem("sessions"));
-          break;
-        default:
-          promises.push(Sanitizer.clearItem(key));
-      }
-    }
-
-    Promise.all(promises).then(function() {
-      Messaging.sendRequest({
-        type: "Sanitize:Finished",
-        success: true
-      });
-
-      if (callback) {
-        callback();
-      }
-    }).catch(function(err) {
-      Messaging.sendRequest({
-        type: "Sanitize:Finished",
-        error: err,
-        success: false
-      });
-
-      if (callback) {
-        callback();
-      }
-    })
-  },
-
-  getFocusedInput: function(aBrowser, aOnlyInputElements = false) {
-    if (!aBrowser)
-      return null;
-
-    let doc = aBrowser.contentDocument;
-    if (!doc)
-      return null;
-
-    let focused = doc.activeElement;
-    while (focused instanceof HTMLFrameElement || focused instanceof HTMLIFrameElement) {
-      doc = focused.contentDocument;
-      focused = doc.activeElement;
-    }
-
-    if (focused instanceof HTMLInputElement && focused.mozIsTextField(false))
-      return focused;
-
-    if (aOnlyInputElements)
-      return null;
-
-    if (focused && (focused instanceof HTMLTextAreaElement || focused.isContentEditable)) {
-
-      if (focused instanceof HTMLBodyElement) {
-        // we are putting focus into a contentEditable frame. scroll the frame into
-        // view instead of the contentEditable document contained within, because that
-        // results in a better user experience
-        focused = focused.ownerDocument.defaultView.frameElement;
-      }
-      return focused;
-    }
-    return null;
-  },
-
-  scrollToFocusedInput: function(aBrowser, aAllowZoom = true) {
-    let formHelperMode = Services.prefs.getIntPref("formhelper.mode");
-    if (formHelperMode == kFormHelperModeDisabled)
-      return;
-
-    if (!AppConstants.MOZ_ANDROID_APZ) {
-      let focused = this.getFocusedInput(aBrowser);
-      if (focused) {
-        let shouldZoom = Services.prefs.getBoolPref("formhelper.autozoom");
-        if (formHelperMode == kFormHelperModeDynamic && this.isTablet)
-          shouldZoom = false;
-        // ZoomHelper.zoomToElement will handle not sending any message if this input is already mostly filling the screen
-        ZoomHelper.zoomToElement(focused, -1, false,
-            aAllowZoom && shouldZoom && !ViewportHandler.isViewportSpecified(aBrowser.contentWindow));
-      }
-    } else {
-      // Using a timeout to let the viewport propagate to the compositor thread before requesting a pan and zoom animation
-      // so the element will end up in the middle of the correctly sized viewport. See Bug 1231517.
-      setTimeout(function(e) {
-        aBrowser.contentWindow.QueryInterface(Ci.nsIInterfaceRequestor).getInterface(Ci.nsIDOMWindowUtils).zoomToFocusedInput();
-      }, 500);
-    }
-  },
-
-  getUALocalePref: function () {
-    try {
-      return Services.prefs.getComplexValue("general.useragent.locale", Ci.nsIPrefLocalizedString).data;
-    } catch (e) {
-      try {
-        return Services.prefs.getCharPref("general.useragent.locale");
-      } catch (ee) {
-        return undefined;
-      }
-    }
-  },
-
-  getOSLocalePref: function () {
-    try {
-      return Services.prefs.getCharPref("intl.locale.os");
-    } catch (e) {
-      return undefined;
-    }
-  },
-
-  setLocalizedPref: function (pref, value) {
-    let pls = Cc["@mozilla.org/pref-localizedstring;1"]
-                .createInstance(Ci.nsIPrefLocalizedString);
-    pls.data = value;
-    Services.prefs.setComplexValue(pref, Ci.nsIPrefLocalizedString, pls);
-  },
-
-  observe: function(aSubject, aTopic, aData) {
-    let browser = this.selectedBrowser;
-
-    switch (aTopic) {
-
-      case "Session:Back":
-        browser.goBack();
-        break;
-
-      case "Session:Forward":
-        browser.goForward();
-        break;
-
-      case "Session:Navigate":
-          let index = JSON.parse(aData);
-          let webNav = BrowserApp.selectedTab.window.QueryInterface(Ci.nsIInterfaceRequestor).getInterface(Ci.nsIWebNavigation);
-          let historySize = webNav.sessionHistory.count;
-
-          if (index < 0) {
-            index = 0;
-            Log.e("Browser", "Negative index truncated to zero");
-          } else if (index >= historySize) {
-            Log.e("Browser", "Incorrect index " + index + " truncated to " + historySize - 1);
-            index = historySize - 1;
-          }
-
-          browser.gotoIndex(index);
-          break;
-
-      case "Session:Reload": {
-        let flags = Ci.nsIWebNavigation.LOAD_FLAGS_NONE;
-
-        // Check to see if this is a message to enable/disable mixed content blocking.
-        if (aData) {
-          let data = JSON.parse(aData);
-
-          if (data.bypassCache) {
-            flags |= Ci.nsIWebNavigation.LOAD_FLAGS_BYPASS_CACHE |
-                     Ci.nsIWebNavigation.LOAD_FLAGS_BYPASS_PROXY;
-          }
-
-          if (data.contentType === "tracking") {
-            // Convert document URI into the format used by
-            // nsChannelClassifier::ShouldEnableTrackingProtection
-            // (any scheme turned into https is correct)
-            let normalizedUrl = Services.io.newURI("https://" + browser.currentURI.hostPort, null, null);
-            if (data.allowContent) {
-              // Add the current host in the 'trackingprotection' consumer of
-              // the permission manager using a normalized URI. This effectively
-              // places this host on the tracking protection white list.
-              if (PrivateBrowsingUtils.isBrowserPrivate(browser)) {
-                PrivateBrowsingUtils.addToTrackingAllowlist(normalizedUrl);
-              } else {
-                Services.perms.add(normalizedUrl, "trackingprotection", Services.perms.ALLOW_ACTION);
-                Telemetry.addData("TRACKING_PROTECTION_EVENTS", 1);
-              }
-            } else {
-              // Remove the current host from the 'trackingprotection' consumer
-              // of the permission manager. This effectively removes this host
-              // from the tracking protection white list (any list actually).
-              if (PrivateBrowsingUtils.isBrowserPrivate(browser)) {
-                PrivateBrowsingUtils.removeFromTrackingAllowlist(normalizedUrl);
-              } else {
-                Services.perms.remove(normalizedUrl, "trackingprotection");
-                Telemetry.addData("TRACKING_PROTECTION_EVENTS", 2);
-              }
-            }
-          }
-        }
-
-        // Try to use the session history to reload so that framesets are
-        // handled properly. If the window has no session history, fall back
-        // to using the web navigation's reload method.
-        let webNav = browser.webNavigation;
-        try {
-          let sh = webNav.sessionHistory;
-          if (sh)
-            webNav = sh.QueryInterface(Ci.nsIWebNavigation);
-        } catch (e) {}
-        webNav.reload(flags);
-        break;
-      }
-
-      case "Session:Stop":
-        browser.stop();
-        break;
-
-      case "Tab:Load": {
-        let data = JSON.parse(aData);
-        let url = data.url;
-        let flags = Ci.nsIWebNavigation.LOAD_FLAGS_ALLOW_THIRD_PARTY_FIXUP
-                  | Ci.nsIWebNavigation.LOAD_FLAGS_FIXUP_SCHEME_TYPOS;
-
-        // Pass LOAD_FLAGS_DISALLOW_INHERIT_OWNER to prevent any loads from
-        // inheriting the currently loaded document's principal.
-        if (data.userEntered) {
-          flags |= Ci.nsIWebNavigation.LOAD_FLAGS_DISALLOW_INHERIT_OWNER;
-        }
-
-        let delayLoad = ("delayLoad" in data) ? data.delayLoad : false;
-        let params = {
-          selected: ("selected" in data) ? data.selected : !delayLoad,
-          parentId: ("parentId" in data) ? data.parentId : -1,
-          flags: flags,
-          tabID: data.tabID,
-          isPrivate: (data.isPrivate === true),
-          pinned: (data.pinned === true),
-          delayLoad: (delayLoad === true),
-          desktopMode: (data.desktopMode === true)
-        };
-
-        params.userRequested = url;
-
-        if (data.engine) {
-          let engine = Services.search.getEngineByName(data.engine);
-          if (engine) {
-            let submission = engine.getSubmission(url);
-            url = submission.uri.spec;
-            params.postData = submission.postData;
-            params.isSearch = true;
-          }
-        }
-
-        if (data.newTab) {
-          this.addTab(url, params);
-        } else {
-          if (data.tabId) {
-            // Use a specific browser instead of the selected browser, if it exists
-            let specificBrowser = this.getTabForId(data.tabId).browser;
-            if (specificBrowser)
-              browser = specificBrowser;
-          }
-          this.loadURI(url, browser, params);
-        }
-        break;
-      }
-
-      case "Tab:Selected":
-        this._handleTabSelected(this.getTabForId(parseInt(aData)));
-        break;
-
-      case "Tab:Closed": {
-        let data = JSON.parse(aData);
-        this._handleTabClosed(this.getTabForId(data.tabId), data.showUndoToast);
-        break;
-      }
-
-      case "keyword-search":
-        // This event refers to a search via the URL bar, not a bookmarks
-        // keyword search. Note that this code assumes that the user can only
-        // perform a keyword search on the selected tab.
-        this.selectedTab.isSearch = true;
-
-        // Don't store queries in private browsing mode.
-        let isPrivate = PrivateBrowsingUtils.isBrowserPrivate(this.selectedTab.browser);
-        let query = isPrivate ? "" : aData;
-
-        let engine = aSubject.QueryInterface(Ci.nsISearchEngine);
-        Messaging.sendRequest({
-          type: "Search:Keyword",
-          identifier: engine.identifier,
-          name: engine.name,
-          query: query
-        });
-        break;
-
-      case "Browser:Quit":
-        // Add-ons like QuitNow and CleanQuit provide aData as an empty-string ("").
-        // Pass undefined to invoke the methods default parms.
-        this.quit(aData ? JSON.parse(aData) : undefined);
-        break;
-
-      case "SaveAs:PDF":
-        this.saveAsPDF(browser);
-        break;
-
-      case "Preferences:Set":
-        this.setPreferences(aData);
-        break;
-
-      case "ScrollTo:FocusedInput":
-        // these messages come from a change in the viewable area and not user interaction
-        // we allow scrolling to the selected input, but not zooming the page
-        this.scrollToFocusedInput(browser, false);
-        break;
-
-      case "Sanitize:ClearData":
-        this.sanitize(JSON.parse(aData));
-        break;
-
-      case "FullScreen:Exit":
-        browser.contentDocument.mozCancelFullScreen();
-        break;
-
-      case "Viewport:Change":
-        if (this.isBrowserContentDocumentDisplayed())
-          this.selectedTab.setViewport(JSON.parse(aData));
-        break;
-
-      case "Viewport:Flush":
-        this.contentDocumentChanged();
-        break;
-
-      case "Passwords:Init": {
-        let storage = Cc["@mozilla.org/login-manager/storage/mozStorage;1"].
-                      getService(Ci.nsILoginManagerStorage);
-        storage.initialize();
-        Services.obs.removeObserver(this, "Passwords:Init");
-        break;
-      }
-
-      case "FormHistory:Init": {
-        // Force creation/upgrade of formhistory.sqlite
-        FormHistory.count({});
-        Services.obs.removeObserver(this, "FormHistory:Init");
-        break;
-      }
-
-      case "sessionstore-state-purge-complete":
-        Messaging.sendRequest({ type: "Session:StatePurged" });
-        break;
-
-      case "gather-telemetry":
-        Messaging.sendRequest({ type: "Telemetry:Gather" });
-        break;
-
-      case "nsPref:changed":
-        this.notifyPrefObservers(aData);
-        break;
-
-      case "webapps-runtime-install":
-        WebappManager.install(JSON.parse(aData), aSubject);
-        break;
-
-      case "webapps-runtime-install-package":
-        WebappManager.installPackage(JSON.parse(aData), aSubject);
-        break;
-
-      case "webapps-ask-install":
-        WebappManager.askInstall(JSON.parse(aData));
-        break;
-
-      case "webapps-ask-uninstall":
-        WebappManager.askUninstall(JSON.parse(aData));
-        break;
-
-      case "webapps-launch": {
-        WebappManager.launch(JSON.parse(aData));
-        break;
-      }
-
-      case "webapps-runtime-uninstall": {
-        WebappManager.uninstall(JSON.parse(aData), aSubject);
-        break;
-      }
-
-      case "Webapps:AutoInstall":
-        WebappManager.autoInstall(JSON.parse(aData));
-        break;
-
-      case "Webapps:Load":
-        this._loadWebapp(JSON.parse(aData));
-        break;
-
-      case "Webapps:AutoUninstall":
-        WebappManager.autoUninstall(JSON.parse(aData));
-        break;
-
-      case "Locale:OS":
-        // We know the system locale. We use this for generating Accept-Language headers.
-        console.log("Locale:OS: " + aData);
-        let currentOSLocale = this.getOSLocalePref();
-        if (currentOSLocale == aData) {
-          break;
-        }
-
-        console.log("New OS locale.");
-
-        // Ensure that this choice is immediately persisted, because
-        // Gecko won't be told again if it forgets.
-        Services.prefs.setCharPref("intl.locale.os", aData);
-        Services.prefs.savePrefFile(null);
-
-        let appLocale = this.getUALocalePref();
-
-        this.computeAcceptLanguages(aData, appLocale);
-        break;
-
-      case "Locale:Changed":
-        if (aData) {
-          // The value provided to Locale:Changed should be a BCP47 language tag
-          // understood by Gecko -- for example, "es-ES" or "de".
-          console.log("Locale:Changed: " + aData);
-
-          // We always write a localized pref, even though sometimes the value is a char pref.
-          // (E.g., on desktop single-locale builds.)
-          this.setLocalizedPref("general.useragent.locale", aData);
-        } else {
-          // Resetting.
-          console.log("Switching to system locale.");
-          Services.prefs.clearUserPref("general.useragent.locale");
-        }
-
-        Services.prefs.setBoolPref("intl.locale.matchOS", !aData);
-
-        // Ensure that this choice is immediately persisted, because
-        // Gecko won't be told again if it forgets.
-        Services.prefs.savePrefFile(null);
-
-        // Blow away the string cache so that future lookups get the
-        // correct locale.
-        Strings.flush();
-
-        // Make sure we use the right Accept-Language header.
-        let osLocale;
-        try {
-          // This should never not be set at this point, but better safe than sorry.
-          osLocale = Services.prefs.getCharPref("intl.locale.os");
-        } catch (e) {
-        }
-
-        this.computeAcceptLanguages(osLocale, aData);
-        break;
-
-      case "Fonts:Reload":
-        FontEnumerator.updateFontList();
-        break;
-
-      default:
-        dump('BrowserApp.observe: unexpected topic "' + aTopic + '"\n');
-        break;
-
-    }
-  },
-
-  /**
-   * Set intl.accept_languages accordingly.
-   *
-   * After Bug 881510 this will also accept a real Accept-Language choice as
-   * input; all Accept-Language logic lives here.
-   *
-   * osLocale should never be null, but this method is safe regardless.
-   * appLocale may explicitly be null.
-   */
-  computeAcceptLanguages(osLocale, appLocale) {
-    let defaultBranch = Services.prefs.getDefaultBranch(null);
-    let defaultAccept = defaultBranch.getComplexValue("intl.accept_languages", Ci.nsIPrefLocalizedString).data;
-    console.log("Default intl.accept_languages = " + defaultAccept);
-
-    // A guard for potential breakage. Bug 438031.
-    // This should not be necessary, because we're reading from the default branch,
-    // but better safe than sorry.
-    if (defaultAccept && defaultAccept.startsWith("chrome://")) {
-      defaultAccept = null;
-    } else {
-      // Ensure lowercase everywhere so we can compare.
-      defaultAccept = defaultAccept.toLowerCase();
-    }
-
-    if (appLocale) {
-      appLocale = appLocale.toLowerCase();
-    }
-
-    if (osLocale) {
-      osLocale = osLocale.toLowerCase();
-    }
-
-    // Eliminate values if they're present in the default.
-    let chosen;
-    if (defaultAccept) {
-      // intl.accept_languages is a comma-separated list, with no q-value params. Those
-      // are added when the header is generated.
-      chosen = defaultAccept.split(",")
-                            .map(String.trim)
-                            .filter((x) => (x != appLocale && x != osLocale));
-    } else {
-      chosen = [];
-    }
-
-    if (osLocale) {
-      chosen.unshift(osLocale);
-    }
-
-    if (appLocale && appLocale != osLocale) {
-      chosen.unshift(appLocale);
-    }
-
-    let result = chosen.join(",");
-    console.log("Setting intl.accept_languages to " + result);
-    this.setLocalizedPref("intl.accept_languages", result);
-  },
-
-  // nsIAndroidBrowserApp
-  get selectedTab() {
-    return this._selectedTab;
-  },
-
-  // nsIAndroidBrowserApp
-  getBrowserTab: function(tabId) {
-    return this.getTabForId(tabId);
-  },
-
-  getUITelemetryObserver: function() {
-    return UITelemetry;
-  },
-
-  getPreferences: function getPreferences(requestId, prefNames, count) {
-    this.handlePreferencesRequest(requestId, prefNames, false);
-  },
-
-  observePreferences: function observePreferences(requestId, prefNames, count) {
-    this.handlePreferencesRequest(requestId, prefNames, true);
-  },
-
-  removePreferenceObservers: function removePreferenceObservers(aRequestId) {
-    let newPrefObservers = [];
-    for (let prefName in this._prefObservers) {
-      let requestIds = this._prefObservers[prefName];
-      // Remove the requestID from the preference handlers
-      let i = requestIds.indexOf(aRequestId);
-      if (i >= 0) {
-        requestIds.splice(i, 1);
-      }
-
-      // If there are no more request IDs, remove the observer
-      if (requestIds.length == 0) {
-        Services.prefs.removeObserver(prefName, this);
-      } else {
-        newPrefObservers[prefName] = requestIds;
-      }
-    }
-    this._prefObservers = newPrefObservers;
-  },
-
-  // This method will return a list of history items and toIndex based on the action provided from the fromIndex to toIndex,
-  // optionally selecting selIndex (if fromIndex <= selIndex <= toIndex)
-  getHistory: function(data) {
-    let action = data.action;
-    let webNav = BrowserApp.getTabForId(data.tabId).window.QueryInterface(Ci.nsIInterfaceRequestor).getInterface(Ci.nsIWebNavigation);
-    let historyIndex = webNav.sessionHistory.index;
-    let historySize = webNav.sessionHistory.count;
-    let canGoBack = webNav.canGoBack;
-    let canGoForward = webNav.canGoForward;
-    let listitems = [];
-    let fromIndex = 0;
-    let toIndex = historySize - 1;
-    let selIndex = historyIndex;
-
-    if (action == "BACK" && canGoBack) {
-      fromIndex = Math.max(historyIndex - kMaxHistoryListSize, 0);
-      toIndex = historyIndex;
-      selIndex = historyIndex;
-    } else if (action == "FORWARD" && canGoForward) {
-      fromIndex = historyIndex;
-      toIndex = Math.min(historySize - 1, historyIndex + kMaxHistoryListSize);
-      selIndex = historyIndex;
-    } else if (action == "ALL" && (canGoBack || canGoForward)){
-      fromIndex = historyIndex - kMaxHistoryListSize / 2;
-      toIndex = historyIndex + kMaxHistoryListSize / 2;
-      if (fromIndex < 0) {
-        toIndex -= fromIndex;
-      }
-
-      if (toIndex > historySize - 1) {
-        fromIndex -= toIndex - (historySize - 1);
-        toIndex = historySize - 1;
-      }
-
-      fromIndex = Math.max(fromIndex, 0);
-      selIndex = historyIndex;
-    } else {
-      // return empty list immediately.
-      return {
-        "historyItems": listitems,
-        "toIndex": toIndex
-      };
-    }
-
-    let browser = this.selectedBrowser;
-    let hist = browser.sessionHistory;
-    for (let i = toIndex; i >= fromIndex; i--) {
-      let entry = hist.getEntryAtIndex(i, false);
-      let item = {
-        title: entry.title || entry.URI.spec,
-        url: entry.URI.spec,
-        selected: (i == selIndex)
-      };
-      listitems.push(item);
-    }
-
-    return {
-      "historyItems": listitems,
-      "toIndex": toIndex
-    };
-  },
-};
-
-var NativeWindow = {
-  init: function() {
-    Services.obs.addObserver(this, "Menu:Clicked", false);
-    Services.obs.addObserver(this, "Doorhanger:Reply", false);
-    this.contextmenus.init();
-  },
-
-  loadDex: function(zipFile, implClass) {
-    Messaging.sendRequest({
-      type: "Dex:Load",
-      zipfile: zipFile,
-      impl: implClass || "Main"
-    });
-  },
-
-  unloadDex: function(zipFile) {
-    Messaging.sendRequest({
-      type: "Dex:Unload",
-      zipfile: zipFile
-    });
-  },
-
-  menu: {
-    _callbacks: [],
-    _menuId: 1,
-    toolsMenuID: -1,
-    add: function() {
-      let options;
-      if (arguments.length == 1) {
-        options = arguments[0];
-      } else if (arguments.length == 3) {
-          Log.w("Browser", "This menu addon API has been deprecated. Instead, use the options object API.");
-          options = {
-            name: arguments[0],
-            callback: arguments[2]
-          };
-      } else {
-         throw "Incorrect number of parameters";
-      }
-
-      options.type = "Menu:Add";
-      options.id = this._menuId;
-
-      Messaging.sendRequest(options);
-      this._callbacks[this._menuId] = options.callback;
-      this._menuId++;
-      return this._menuId - 1;
-    },
-
-    remove: function(aId) {
-      Messaging.sendRequest({ type: "Menu:Remove", id: aId });
-    },
-
-    update: function(aId, aOptions) {
-      if (!aOptions)
-        return;
-
-      Messaging.sendRequest({
-        type: "Menu:Update",
-        id: aId,
-        options: aOptions
-      });
-    }
-  },
-
-  doorhanger: {
-    _callbacks: {},
-    _callbacksId: 0,
-    _promptId: 0,
-
-  /**
-   * @param aOptions
-   *        An options JavaScript object holding additional properties for the
-   *        notification. The following properties are currently supported:
-   *        persistence: An integer. The notification will not automatically
-   *                     dismiss for this many page loads. If persistence is set
-   *                     to -1, the doorhanger will never automatically dismiss.
-   *        persistWhileVisible:
-   *                     A boolean. If true, a visible notification will always
-   *                     persist across location changes.
-   *        timeout:     A time in milliseconds. The notification will not
-   *                     automatically dismiss before this time.
-   *
-   *        checkbox:    A string to appear next to a checkbox under the notification
-   *                     message. The button callback functions will be called with
-   *                     the checked state as an argument.
-   *
-   *        actionText:  An object that specifies a clickable string, a type of action,
-   *                     and a bundle blob for the consumer to create a click action.
-   *                     { text: <text>,
-   *                       type: <type>,
-   *                       bundle: <blob-object> }
-   *
-   * @param aCategory
-   *        Doorhanger type to display (e.g., LOGIN)
-   */
-    show: function(aMessage, aValue, aButtons, aTabID, aOptions, aCategory) {
-      if (aButtons == null) {
-        aButtons = [];
-      }
-
-      aButtons.forEach((function(aButton) {
-        this._callbacks[this._callbacksId] = { cb: aButton.callback, prompt: this._promptId };
-        aButton.callback = this._callbacksId;
-        this._callbacksId++;
-      }).bind(this));
-
-      this._promptId++;
-      let json = {
-        type: "Doorhanger:Add",
-        message: aMessage,
-        value: aValue,
-        buttons: aButtons,
-        // use the current tab if none is provided
-        tabID: aTabID || BrowserApp.selectedTab.id,
-        options: aOptions || {},
-        category: aCategory
-      };
-      Messaging.sendRequest(json);
-    },
-
-    hide: function(aValue, aTabID) {
-      Messaging.sendRequest({
-        type: "Doorhanger:Remove",
-        value: aValue,
-        tabID: aTabID
-      });
-    }
-  },
-
-  observe: function(aSubject, aTopic, aData) {
-    if (aTopic == "Menu:Clicked") {
-      if (this.menu._callbacks[aData])
-        this.menu._callbacks[aData]();
-    } else if (aTopic == "Doorhanger:Reply") {
-      let data = JSON.parse(aData);
-      let reply_id = data["callback"];
-
-      if (this.doorhanger._callbacks[reply_id]) {
-        // Pass the value of the optional checkbox to the callback
-        let checked = data["checked"];
-        this.doorhanger._callbacks[reply_id].cb(checked, data.inputs);
-
-        let prompt = this.doorhanger._callbacks[reply_id].prompt;
-        for (let id in this.doorhanger._callbacks) {
-          if (this.doorhanger._callbacks[id].prompt == prompt) {
-            delete this.doorhanger._callbacks[id];
-          }
-        }
-      }
-    }
-  },
-
-  contextmenus: {
-    items: {}, //  a list of context menu items that we may show
-    DEFAULT_HTML5_ORDER: -1, // Sort order for HTML5 context menu items
-
-    init: function() {
-      // Accessing "NativeWindow.contextmenus" initializes context menus if needed.
-      BrowserApp.deck.addEventListener(
-          "contextmenu", (e) => NativeWindow.contextmenus.show(e), false);
-    },
-
-    add: function() {
-      let args;
-      if (arguments.length == 1) {
-        args = arguments[0];
-      } else if (arguments.length == 3) {
-        args = {
-          label : arguments[0],
-          selector: arguments[1],
-          callback: arguments[2]
-        };
-      } else {
-        throw "Incorrect number of parameters";
-      }
-
-      if (!args.label)
-        throw "Menu items must have a name";
-
-      let cmItem = new ContextMenuItem(args);
-      this.items[cmItem.id] = cmItem;
-      return cmItem.id;
-    },
-
-    remove: function(aId) {
-      delete this.items[aId];
-    },
-
-    SelectorContext: function(aSelector) {
-      return {
-        matches: function(aElt) {
-          if (aElt.matches)
-            return aElt.matches(aSelector);
-          return false;
-        }
-      };
-    },
-
-    linkOpenableNonPrivateContext: {
-      matches: function linkOpenableNonPrivateContextMatches(aElement) {
-        let doc = aElement.ownerDocument;
-        if (!doc || PrivateBrowsingUtils.isContentWindowPrivate(doc.defaultView)) {
-          return false;
-        }
-
-        return NativeWindow.contextmenus.linkOpenableContext.matches(aElement);
-      }
-    },
-
-    linkOpenableContext: {
-      matches: function linkOpenableContextMatches(aElement) {
-        let uri = NativeWindow.contextmenus._getLink(aElement);
-        if (uri) {
-          let scheme = uri.scheme;
-          let dontOpen = /^(javascript|mailto|news|snews|tel)$/;
-          return (scheme && !dontOpen.test(scheme));
-        }
-        return false;
-      }
-    },
-
-    linkCopyableContext: {
-      matches: function linkCopyableContextMatches(aElement) {
-        let uri = NativeWindow.contextmenus._getLink(aElement);
-        if (uri) {
-          let scheme = uri.scheme;
-          let dontCopy = /^(mailto|tel)$/;
-          return (scheme && !dontCopy.test(scheme));
-        }
-        return false;
-      }
-    },
-
-    linkShareableContext: {
-      matches: function linkShareableContextMatches(aElement) {
-        let uri = NativeWindow.contextmenus._getLink(aElement);
-        if (uri) {
-          let scheme = uri.scheme;
-          let dontShare = /^(about|chrome|file|javascript|mailto|resource|tel)$/;
-          return (scheme && !dontShare.test(scheme));
-        }
-        return false;
-      }
-    },
-
-    linkBookmarkableContext: {
-      matches: function linkBookmarkableContextMatches(aElement) {
-        let uri = NativeWindow.contextmenus._getLink(aElement);
-        if (uri) {
-          let scheme = uri.scheme;
-          let dontBookmark = /^(mailto|tel)$/;
-          return (scheme && !dontBookmark.test(scheme));
-        }
-        return false;
-      }
-    },
-
-    emailLinkContext: {
-      matches: function emailLinkContextMatches(aElement) {
-        let uri = NativeWindow.contextmenus._getLink(aElement);
-        if (uri)
-          return uri.schemeIs("mailto");
-        return false;
-      }
-    },
-
-    phoneNumberLinkContext: {
-      matches: function phoneNumberLinkContextMatches(aElement) {
-        let uri = NativeWindow.contextmenus._getLink(aElement);
-        if (uri)
-          return uri.schemeIs("tel");
-        return false;
-      }
-    },
-
-    imageLocationCopyableContext: {
-      matches: function imageLinkCopyableContextMatches(aElement) {
-        if (aElement instanceof Ci.nsIDOMHTMLImageElement) {
-          // The image is blocked by Tap-to-load Images
-          if (aElement.hasAttribute("data-ctv-src") && !aElement.hasAttribute("data-ctv-show")) {
-            return false;
-          }
-        }
-        return (aElement instanceof Ci.nsIImageLoadingContent && aElement.currentURI);
-      }
-    },
-
-    imageSaveableContext: {
-      matches: function imageSaveableContextMatches(aElement) {
-        if (aElement instanceof Ci.nsIDOMHTMLImageElement) {
-          // The image is blocked by Tap-to-load Images
-          if (aElement.hasAttribute("data-ctv-src") && !aElement.hasAttribute("data-ctv-show")) {
-            return false;
-          }
-        }
-        if (aElement instanceof Ci.nsIImageLoadingContent && aElement.currentURI) {
-          // The image must be loaded to allow saving
-          let request = aElement.getRequest(Ci.nsIImageLoadingContent.CURRENT_REQUEST);
-          return (request && (request.imageStatus & request.STATUS_SIZE_AVAILABLE));
-        }
-        return false;
-      }
-    },
-
-    mediaSaveableContext: {
-      matches: function mediaSaveableContextMatches(aElement) {
-        return (aElement instanceof HTMLVideoElement ||
-               aElement instanceof HTMLAudioElement);
-      }
-    },
-
-    imageBlockingPolicyContext: {
-      matches: function imageBlockingPolicyContextMatches(aElement) {
-        if (aElement instanceof Ci.nsIDOMHTMLImageElement && aElement.getAttribute("data-ctv-src")) {
-          // Only show the menuitem if we are blocking the image
-          if (aElement.getAttribute("data-ctv-show") == "true") {
-            return false;
-          }
-          return true;
-        }
-        return false;
-      }
-    },
-
-    mediaContext: function(aMode) {
-      return {
-        matches: function(aElt) {
-          if (aElt instanceof Ci.nsIDOMHTMLMediaElement) {
-            let hasError = aElt.error != null || aElt.networkState == aElt.NETWORK_NO_SOURCE;
-            if (hasError)
-              return false;
-
-            let paused = aElt.paused || aElt.ended;
-            if (paused && aMode == "media-paused")
-              return true;
-            if (!paused && aMode == "media-playing")
-              return true;
-            let controls = aElt.controls;
-            if (!controls && aMode == "media-hidingcontrols")
-              return true;
-
-            let muted = aElt.muted;
-            if (muted && aMode == "media-muted")
-              return true;
-            else if (!muted && aMode == "media-unmuted")
-              return true;
-          }
-          return false;
-        }
-      };
-    },
-
-    /* Holds a WeakRef to the original target element this context menu was shown for.
-     * Most API's will have to walk up the tree from this node to find the correct element
-     * to act on
-     */
-    get _target() {
-      if (this._targetRef)
-        return this._targetRef.get();
-      return null;
-    },
-
-    set _target(aTarget) {
-      if (aTarget)
-        this._targetRef = Cu.getWeakReference(aTarget);
-      else this._targetRef = null;
-    },
-
-    get defaultContext() {
-      delete this.defaultContext;
-      return this.defaultContext = Strings.browser.GetStringFromName("browser.menu.context.default");
-    },
-
-    /* Gets menuitems for an arbitrary node
-     * Parameters:
-     *   element - The element to look at. If this element has a contextmenu attribute, the
-     *             corresponding contextmenu will be used.
-     */
-    _getHTMLContextMenuItemsForElement: function(element) {
-      let htmlMenu = element.contextMenu;
-      if (!htmlMenu) {
-        return [];
-      }
-
-      htmlMenu.QueryInterface(Components.interfaces.nsIHTMLMenu);
-      htmlMenu.sendShowEvent();
-
-      return this._getHTMLContextMenuItemsForMenu(htmlMenu, element);
-    },
-
-    /* Add a menuitem for an HTML <menu> node
-     * Parameters:
-     *   menu - The <menu> element to iterate through for menuitems
-     *   target - The target element these context menu items are attached to
-     */
-    _getHTMLContextMenuItemsForMenu: function(menu, target) {
-      let items = [];
-      for (let i = 0; i < menu.childNodes.length; i++) {
-        let elt = menu.childNodes[i];
-        if (!elt.label)
-          continue;
-
-        items.push(new HTMLContextMenuItem(elt, target));
-      }
-
-      return items;
-    },
-
-    // Searches the current list of menuitems to show for any that match this id
-    _findMenuItem: function(aId) {
-      if (!this.menus) {
-        return null;
-      }
-
-      for (let context in this.menus) {
-        let menu = this.menus[context];
-        for (let i = 0; i < menu.length; i++) {
-          if (menu[i].id === aId) {
-            return menu[i];
-          }
-        }
-      }
-      return null;
-    },
-
-    // Returns true if there are any context menu items to show
-    _shouldShow: function() {
-      for (let context in this.menus) {
-        let menu = this.menus[context];
-        if (menu.length > 0) {
-          return true;
-        }
-      }
-      return false;
-    },
-
-    /* Returns a label to be shown in a tabbed ui if there are multiple "contexts". For instance, if this
-     * is an image inside an <a> tag, we may have a "link" context and an "image" one.
-     */
-    _getContextType: function(element) {
-      // For anchor nodes, we try to use the scheme to pick a string
-      if (element instanceof Ci.nsIDOMHTMLAnchorElement) {
-        let uri = this.makeURI(this._getLinkURL(element));
-        try {
-          return Strings.browser.GetStringFromName("browser.menu.context." + uri.scheme);
-        } catch(ex) { }
-      }
-
-      // Otherwise we try the nodeName
-      try {
-        return Strings.browser.GetStringFromName("browser.menu.context." + element.nodeName.toLowerCase());
-      } catch(ex) { }
-
-      // Fallback to the default
-      return this.defaultContext;
-    },
-
-    // Adds context menu items added through the add-on api
-    _getNativeContextMenuItems: function(element, x, y) {
-      let res = [];
-      for (let itemId of Object.keys(this.items)) {
-        let item = this.items[itemId];
-
-        if (!this._findMenuItem(item.id) && item.matches(element, x, y)) {
-          res.push(item);
-        }
-      }
-
-      return res;
-    },
-
-    /* Checks if there are context menu items to show, and if it finds them
-     * sends a contextmenu event to content. We also send showing events to
-     * any html5 context menus we are about to show, and fire some local notifications
-     * for chrome consumers to do lazy menuitem construction
-     */
-    show: function(event) {
-      // Android Long-press / contextmenu event provides clientX/Y data. This is not provided
-      // by mochitest: test_browserElement_inproc_ContextmenuEvents.html.
-      if (!event.clientX || !event.clientY) {
-        return;
-      }
-
-      // Use the highlighted element for the context menu target. When accessibility is
-      // enabled, elements may not be highlighted so use the event target instead.
-      this._target = BrowserEventHandler._highlightElement || event.target;
-      if (!this._target) {
-        return;
-      }
-
-      // Try to build a list of contextmenu items. If successful, actually show the
-      // native context menu by passing the list to Java.
-      this._buildMenu(event.clientX, event.clientY);
-      if (this._shouldShow()) {
-        BrowserEventHandler._cancelTapHighlight();
-
-        // Consume / preventDefault the event, and show the contextmenu.
-        event.preventDefault();
-        this._innerShow(this._target, event.clientX, event.clientY);
-        this._target = null;
-
-        return;
-      }
-
-      // If no context-menu for long-press event, it may be meant to trigger text-selection.
-      this.menus = null;
-      Services.obs.notifyObservers(
-        {target: this._target, x: event.clientX, y: event.clientY}, "context-menu-not-shown", "");
-
-      if (SelectionHandler.canSelect(this._target)) {
-        // If textSelection WORD is successful,
-        // consume / preventDefault the context menu event.
-        let selectionResult = SelectionHandler.startSelection(this._target,
-          { mode: SelectionHandler.SELECT_AT_POINT,
-            x: event.clientX,
-            y: event.clientY
-          }
-        );
-        if (selectionResult === SelectionHandler.ERROR_NONE) {
-          event.preventDefault();
-          return;
-        }
-
-        // If textSelection caret-attachment is successful,
-        // consume / preventDefault the context menu event.
-        if (SelectionHandler.attachCaret(this._target) === SelectionHandler.ERROR_NONE) {
-          event.preventDefault();
-          return;
-        }
-      }
-    },
-
-    // Returns a title for a context menu. If no title attribute exists, will fall back to looking for a url
-    _getTitle: function(node) {
-      if (node.hasAttribute && node.hasAttribute("title")) {
-        return node.getAttribute("title");
-      }
-      return this._getUrl(node);
-    },
-
-    // Returns a url associated with a node
-    _getUrl: function(node) {
-      if ((node instanceof Ci.nsIDOMHTMLAnchorElement && node.href) ||
-          (node instanceof Ci.nsIDOMHTMLAreaElement && node.href)) {
-        return this._getLinkURL(node);
-      } else if (node instanceof Ci.nsIImageLoadingContent && node.currentURI) {
-        // The image is blocked by Tap-to-load Images
-        let originalURL = node.getAttribute("data-ctv-src");
-        if (originalURL) {
-          return originalURL;
-        }
-        return node.currentURI.spec;
-      } else if (node instanceof Ci.nsIDOMHTMLMediaElement) {
-        return (node.currentSrc || node.src);
-      }
-
-      return "";
-    },
-
-    // Adds an array of menuitems to the current list of items to show, in the correct context
-    _addMenuItems: function(items, context) {
-        if (!this.menus[context]) {
-          this.menus[context] = [];
-        }
-        this.menus[context] = this.menus[context].concat(items);
-    },
-
-    /* Does the basic work of building a context menu to show. Will combine HTML and Native
-     * context menus items, as well as sorting menuitems into different menus based on context.
-     */
-    _buildMenu: function(x, y) {
-      // now walk up the tree and for each node look for any context menu items that apply
-      let element = this._target;
-
-      // this.menus holds a hashmap of "contexts" to menuitems associated with that context
-      // For instance, if the user taps an image inside a link, we'll have something like:
-      // {
-      //   link:  [ ContextMenuItem, ContextMenuItem ]
-      //   image: [ ContextMenuItem, ContextMenuItem ]
-      // }
-      this.menus = {};
-
-      while (element) {
-        let context = this._getContextType(element);
-
-        // First check for any html5 context menus that might exist...
-        var items = this._getHTMLContextMenuItemsForElement(element);
-        if (items.length > 0) {
-          this._addMenuItems(items, context);
-        }
-
-        // then check for any context menu items registered in the ui.
-        items = this._getNativeContextMenuItems(element, x, y);
-        if (items.length > 0) {
-          this._addMenuItems(items, context);
-        }
-
-        // walk up the tree and find more items to show
-        element = element.parentNode;
-      }
-    },
-
-    // Walks the DOM tree to find a title from a node
-    _findTitle: function(node) {
-      let title = "";
-      while(node && !title) {
-        title = this._getTitle(node);
-        node = node.parentNode;
-      }
-      return title;
-    },
-
-    /* Reformats the list of menus to show into an object that can be sent to Prompt.jsm
-     * If there is one menu, will return a flat array of menuitems. If there are multiple
-     * menus, will return an array with appropriate tabs/items inside it. i.e. :
-     * [
-     *    { label: "link", items: [...] },
-     *    { label: "image", items: [...] }
-     * ]
-     */
-    _reformatList: function(target) {
-      let contexts = Object.keys(this.menus);
-
-      if (contexts.length === 1) {
-        // If there's only one context, we'll only show a single flat single select list
-        return this._reformatMenuItems(target, this.menus[contexts[0]]);
-      }
-
-      // If there are multiple contexts, we'll only show a tabbed ui with multiple lists
-      return this._reformatListAsTabs(target, this.menus);
-    },
-
-    /* Reformats the list of menus to show into an object that can be sent to Prompt.jsm's
-     * addTabs method. i.e. :
-     * { link: [...], image: [...] } becomes
-     * [ { label: "link", items: [...] } ]
-     *
-     * Also reformats items and resolves any parmaeters that aren't known until display time
-     * (for instance Helper app menu items adjust their title to reflect what Helper App can be used for this link).
-     */
-    _reformatListAsTabs: function(target, menus) {
-      let itemArray = [];
-
-      // Sort the keys so that "link" is always first
-      let contexts = Object.keys(this.menus);
-      contexts.sort((context1, context2) => {
-        if (context1 === this.defaultContext) {
-          return -1;
-        } else if (context2 === this.defaultContext) {
-          return 1;
-        }
-        return 0;
-      });
-
-      contexts.forEach(context => {
-        itemArray.push({
-          label: context,
-          items: this._reformatMenuItems(target, menus[context])
-        });
-      });
-
-      return itemArray;
-    },
-
-    /* Reformats an array of ContextMenuItems into an array that can be handled by Prompt.jsm. Also reformats items
-     * and resolves any parmaeters that aren't known until display time
-     * (for instance Helper app menu items adjust their title to reflect what Helper App can be used for this link).
-     */
-    _reformatMenuItems: function(target, menuitems) {
-      let itemArray = [];
-
-      for (let i = 0; i < menuitems.length; i++) {
-        let t = target;
-        while(t) {
-          if (menuitems[i].matches(t)) {
-            let val = menuitems[i].getValue(t);
-
-            // hidden menu items will return null from getValue
-            if (val) {
-              itemArray.push(val);
-              break;
-            }
-          }
-
-          t = t.parentNode;
-        }
-      }
-
-      return itemArray;
-    },
-
-    // Called where we're finally ready to actually show the contextmenu. Sorts the items and shows a prompt.
-    _innerShow: function(target, x, y) {
-      Haptic.performSimpleAction(Haptic.LongPress);
-
-      // spin through the tree looking for a title for this context menu
-      let title = this._findTitle(target);
-
-      for (let context in this.menus) {
-        let menu = this.menus[context];
-        menu.sort((a,b) => {
-          if (a.order === b.order) {
-            return 0;
-          }
-          return (a.order > b.order) ? 1 : -1;
-        });
-      }
-
-      let useTabs = Object.keys(this.menus).length > 1;
-      let prompt = new Prompt({
-        window: target.ownerDocument.defaultView,
-        title: useTabs ? undefined : title
-      });
-
-      let items = this._reformatList(target);
-      if (useTabs) {
-        prompt.addTabs({
-          id: "tabs",
-          items: items
-        });
-      } else {
-        prompt.setSingleChoiceItems(items);
-      }
-
-      prompt.show(this._promptDone.bind(this, target, x, y, items));
-    },
-
-    // Called when the contextmenu prompt is closed
-    _promptDone: function(target, x, y, items, data) {
-      if (data.button == -1) {
-        // Prompt was cancelled, or an ActionView was used.
-        return;
-      }
-
-      let selectedItemId;
-      if (data.tabs) {
-        let menu = items[data.tabs.tab];
-        selectedItemId = menu.items[data.tabs.item].id;
-      } else {
-        selectedItemId = items[data.list[0]].id
-      }
-
-      let selectedItem = this._findMenuItem(selectedItemId);
-      this.menus = null;
-
-      if (!selectedItem || !selectedItem.matches || !selectedItem.callback) {
-        return;
-      }
-
-      // for menuitems added using the native UI, pass the dom element that matched that item to the callback
-      while (target) {
-        if (selectedItem.matches(target, x, y)) {
-          selectedItem.callback(target, x, y);
-          break;
-        }
-        target = target.parentNode;
-      }
-    },
-
-    // XXX - These are stolen from Util.js, we should remove them if we bring it back
-    makeURLAbsolute: function makeURLAbsolute(base, url) {
-      // Note:  makeURI() will throw if url is not a valid URI
-      return this.makeURI(url, null, this.makeURI(base)).spec;
-    },
-
-    makeURI: function makeURI(aURL, aOriginCharset, aBaseURI) {
-      return Services.io.newURI(aURL, aOriginCharset, aBaseURI);
-    },
-
-    _getLink: function(aElement) {
-      if (aElement.nodeType == Ci.nsIDOMNode.ELEMENT_NODE &&
-          ((aElement instanceof Ci.nsIDOMHTMLAnchorElement && aElement.href) ||
-          (aElement instanceof Ci.nsIDOMHTMLAreaElement && aElement.href) ||
-          aElement instanceof Ci.nsIDOMHTMLLinkElement ||
-          aElement.getAttributeNS(kXLinkNamespace, "type") == "simple")) {
-        try {
-          let url = this._getLinkURL(aElement);
-          return Services.io.newURI(url, null, null);
-        } catch (e) {}
-      }
-      return null;
-    },
-
-    _disableRestricted: function _disableRestricted(restriction, selector) {
-      return {
-        matches: function _disableRestrictedMatches(aElement, aX, aY) {
-          if (!ParentalControls.isAllowed(ParentalControls[restriction])) {
-            return false;
-          }
-
-          return selector.matches(aElement, aX, aY);
-        }
-      };
-    },
-
-    _getLinkURL: function ch_getLinkURL(aLink) {
-      let href = aLink.href;
-      if (href)
-        return href;
-
-      href = aLink.getAttributeNS(kXLinkNamespace, "href");
-      if (!href || !href.match(/\S/)) {
-        // Without this we try to save as the current doc,
-        // for example, HTML case also throws if empty
-        throw "Empty href";
-      }
-
-      return this.makeURLAbsolute(aLink.baseURI, href);
-    },
-
-    _copyStringToDefaultClipboard: function(aString) {
-      let clipboard = Cc["@mozilla.org/widget/clipboardhelper;1"].getService(Ci.nsIClipboardHelper);
-      clipboard.copyString(aString);
-      Snackbars.show(Strings.browser.GetStringFromName("selectionHelper.textCopied"), Snackbars.LENGTH_LONG);
-    },
-
-    _stripScheme: function(aString) {
-      let index = aString.indexOf(":");
-      return aString.slice(index + 1);
-    }
-  }
-};
-
-XPCOMUtils.defineLazyModuleGetter(this, "PageActions",
-                                  "resource://gre/modules/PageActions.jsm");
-
-// These alias to the old, deprecated NativeWindow interfaces
-[
-  ["pageactions", "resource://gre/modules/PageActions.jsm", "PageActions"],
-  ["toast", "resource://gre/modules/Snackbars.jsm", "Snackbars"]
-].forEach(item => {
-  let [name, script, exprt] = item;
-
-  XPCOMUtils.defineLazyGetter(NativeWindow, name, () => {
-    var err = Strings.browser.formatStringFromName("nativeWindow.deprecated", ["NativeWindow." + name, script], 2);
-    Cu.reportError(err);
-
-    let sandbox = {};
-    Cu.import(script, sandbox);
-    return sandbox[exprt];
-  });
-});
-
-var LightWeightThemeWebInstaller = {
-  init: function sh_init() {
-    let temp = {};
-    Cu.import("resource://gre/modules/LightweightThemeConsumer.jsm", temp);
-    let theme = new temp.LightweightThemeConsumer(document);
-    BrowserApp.deck.addEventListener("InstallBrowserTheme", this, false, true);
-    BrowserApp.deck.addEventListener("PreviewBrowserTheme", this, false, true);
-    BrowserApp.deck.addEventListener("ResetBrowserThemePreview", this, false, true);
-
-    if (ParentalControls.parentalControlsEnabled &&
-        !this._manager.currentTheme &&
-        ParentalControls.isAllowed(ParentalControls.DEFAULT_THEME)) {
-      // We are using the DEFAULT_THEME restriction to differentiate between restricted profiles & guest mode - Bug 1199596
-      this._installParentalControlsTheme();
-    }
-  },
-
-  handleEvent: function (event) {
-    switch (event.type) {
-      case "InstallBrowserTheme":
-      case "PreviewBrowserTheme":
-      case "ResetBrowserThemePreview":
-        // ignore requests from background tabs
-        if (event.target.ownerDocument.defaultView.top != content)
-          return;
-    }
-
-    switch (event.type) {
-      case "InstallBrowserTheme":
-        this._installRequest(event);
-        break;
-      case "PreviewBrowserTheme":
-        this._preview(event);
-        break;
-      case "ResetBrowserThemePreview":
-        this._resetPreview(event);
-        break;
-      case "pagehide":
-      case "TabSelect":
-        this._resetPreview();
-        break;
-    }
-  },
-
-  get _manager () {
-    let temp = {};
-    Cu.import("resource://gre/modules/LightweightThemeManager.jsm", temp);
-    delete this._manager;
-    return this._manager = temp.LightweightThemeManager;
-  },
-
-  _installParentalControlsTheme: function() {
-    let mgr = this._manager;
-    let parentalControlsTheme = {
-      "headerURL": "resource://android/assets/parental_controls_theme.png",
-      "name": "Parental Controls Theme",
-      "id": "parental-controls-theme@mozilla.org"
-    };
-
-    mgr.addBuiltInTheme(parentalControlsTheme);
-    mgr.themeChanged(parentalControlsTheme);
-  },
-
-  _installRequest: function (event) {
-    let node = event.target;
-    let data = this._getThemeFromNode(node);
-    if (!data)
-      return;
-
-    if (this._isAllowed(node)) {
-      this._install(data);
-      return;
-    }
-
-    let allowButtonText = Strings.browser.GetStringFromName("lwthemeInstallRequest.allowButton");
-    let message = Strings.browser.formatStringFromName("lwthemeInstallRequest.message", [node.ownerDocument.location.hostname], 1);
-    let buttons = [{
-      label: allowButtonText,
-      callback: function () {
-        LightWeightThemeWebInstaller._install(data);
-      },
-      positive: true
-    }];
-
-    NativeWindow.doorhanger.show(message, "Personas", buttons, BrowserApp.selectedTab.id);
-  },
-
-  _install: function (newLWTheme) {
-    this._manager.currentTheme = newLWTheme;
-  },
-
-  _previewWindow: null,
-  _preview: function (event) {
-    if (!this._isAllowed(event.target))
-      return;
-    let data = this._getThemeFromNode(event.target);
-    if (!data)
-      return;
-    this._resetPreview();
-
-    this._previewWindow = event.target.ownerDocument.defaultView;
-    this._previewWindow.addEventListener("pagehide", this, true);
-    BrowserApp.deck.addEventListener("TabSelect", this, false);
-    this._manager.previewTheme(data);
-  },
-
-  _resetPreview: function (event) {
-    if (!this._previewWindow ||
-        event && !this._isAllowed(event.target))
-      return;
-
-    this._previewWindow.removeEventListener("pagehide", this, true);
-    this._previewWindow = null;
-    BrowserApp.deck.removeEventListener("TabSelect", this, false);
-
-    this._manager.resetPreview();
-  },
-
-  _isAllowed: function (node) {
-    // Make sure the whitelist has been imported to permissions
-    PermissionsUtils.importFromPrefs("xpinstall.", "install");
-
-    let pm = Services.perms;
-
-    let uri = node.ownerDocument.documentURIObject;
-    if (!uri.schemeIs("https")) {
-      return false;
-    }
-
-    return pm.testPermission(uri, "install") == pm.ALLOW_ACTION;
-  },
-
-  _getThemeFromNode: function (node) {
-    return this._manager.parseTheme(node.getAttribute("data-browsertheme"), node.baseURI);
-  }
-};
-
-var DesktopUserAgent = {
-  DESKTOP_UA: null,
-  TCO_DOMAIN: "t.co",
-  TCO_REPLACE: / Gecko.*/,
-
-  init: function ua_init() {
-    Services.obs.addObserver(this, "DesktopMode:Change", false);
-    UserAgentOverrides.addComplexOverride(this.onRequest.bind(this));
-
-    // See https://developer.mozilla.org/en/Gecko_user_agent_string_reference
-    this.DESKTOP_UA = Cc["@mozilla.org/network/protocol;1?name=http"]
-                        .getService(Ci.nsIHttpProtocolHandler).userAgent
-                        .replace(/Android \d.+?; [a-zA-Z]+/, "X11; Linux x86_64")
-                        .replace(/Gecko\/[0-9\.]+/, "Gecko/20100101");
-  },
-
-  onRequest: function(channel, defaultUA) {
-    if (AppConstants.NIGHTLY_BUILD && this.TCO_DOMAIN == channel.URI.host) {
-      // Force the referrer
-      channel.referrer = channel.URI;
-
-      // Send a bot-like UA to t.co to get a real redirect. We strip off the
-      // "Gecko/x.y Firefox/x.y" part
-      return defaultUA.replace(this.TCO_REPLACE, "");
-    }
-
-    let channelWindow = this._getWindowForRequest(channel);
-    let tab = BrowserApp.getTabForWindow(channelWindow);
-    if (tab) {
-      return this.getUserAgentForTab(tab);
-    }
-
-    return null;
-  },
-
-  getUserAgentForWindow: function ua_getUserAgentForWindow(aWindow) {
-    let tab = BrowserApp.getTabForWindow(aWindow.top);
-    if (tab) {
-      return this.getUserAgentForTab(tab);
-    }
-
-    return null;
-  },
-
-  getUserAgentForTab: function ua_getUserAgentForTab(aTab) {
-    // Send desktop UA if "Request Desktop Site" is enabled.
-    if (aTab.desktopMode) {
-      return this.DESKTOP_UA;
-    }
-
-    return null;
-  },
-
-  _getRequestLoadContext: function ua_getRequestLoadContext(aRequest) {
-    if (aRequest && aRequest.notificationCallbacks) {
-      try {
-        return aRequest.notificationCallbacks.getInterface(Ci.nsILoadContext);
-      } catch (ex) { }
-    }
-
-    if (aRequest && aRequest.loadGroup && aRequest.loadGroup.notificationCallbacks) {
-      try {
-        return aRequest.loadGroup.notificationCallbacks.getInterface(Ci.nsILoadContext);
-      } catch (ex) { }
-    }
-
-    return null;
-  },
-
-  _getWindowForRequest: function ua_getWindowForRequest(aRequest) {
-    let loadContext = this._getRequestLoadContext(aRequest);
-    if (loadContext) {
-      try {
-        return loadContext.associatedWindow;
-      } catch (e) {
-        // loadContext.associatedWindow can throw when there's no window
-      }
-    }
-    return null;
-  },
-
-  observe: function ua_observe(aSubject, aTopic, aData) {
-    if (aTopic === "DesktopMode:Change") {
-      let args = JSON.parse(aData);
-      let tab = BrowserApp.getTabForId(args.tabId);
-      if (tab) {
-        tab.reloadWithMode(args.desktopMode);
-      }
-    }
-  }
-};
-
-
-function nsBrowserAccess() {
-}
-
-nsBrowserAccess.prototype = {
-  QueryInterface: XPCOMUtils.generateQI([Ci.nsIBrowserDOMWindow]),
-
-  _getBrowser: function _getBrowser(aURI, aOpener, aWhere, aContext) {
-    let isExternal = (aContext == Ci.nsIBrowserDOMWindow.OPEN_EXTERNAL);
-    if (isExternal && aURI && aURI.schemeIs("chrome"))
-      return null;
-
-    let loadflags = isExternal ?
-                      Ci.nsIWebNavigation.LOAD_FLAGS_FROM_EXTERNAL :
-                      Ci.nsIWebNavigation.LOAD_FLAGS_NONE;
-    if (aWhere == Ci.nsIBrowserDOMWindow.OPEN_DEFAULTWINDOW) {
-      switch (aContext) {
-        case Ci.nsIBrowserDOMWindow.OPEN_EXTERNAL:
-          aWhere = Services.prefs.getIntPref("browser.link.open_external");
-          break;
-        default: // OPEN_NEW or an illegal value
-          aWhere = Services.prefs.getIntPref("browser.link.open_newwindow");
-      }
-    }
-
-    Services.io.offline = false;
-
-    let referrer;
-    if (aOpener) {
-      try {
-        let location = aOpener.location;
-        referrer = Services.io.newURI(location, null, null);
-      } catch(e) { }
-    }
-
-    let ss = Cc["@mozilla.org/browser/sessionstore;1"].getService(Ci.nsISessionStore);
-    let pinned = false;
-
-    if (aURI && aWhere == Ci.nsIBrowserDOMWindow.OPEN_SWITCHTAB) {
-      pinned = true;
-      let spec = aURI.spec;
-      let tabs = BrowserApp.tabs;
-      for (let i = 0; i < tabs.length; i++) {
-        let appOrigin = ss.getTabValue(tabs[i], "appOrigin");
-        if (appOrigin == spec) {
-          let tab = tabs[i];
-          BrowserApp.selectTab(tab);
-          return tab.browser;
-        }
-      }
-    }
-
-    // If OPEN_SWITCHTAB was not handled above, we need to open a new tab,
-    // along with other OPEN_ values that create a new tab.
-    let newTab = (aWhere == Ci.nsIBrowserDOMWindow.OPEN_NEWWINDOW ||
-                  aWhere == Ci.nsIBrowserDOMWindow.OPEN_NEWTAB ||
-                  aWhere == Ci.nsIBrowserDOMWindow.OPEN_SWITCHTAB);
-    let isPrivate = false;
-
-    if (newTab) {
-      let parentId = -1;
-      if (!isExternal && aOpener) {
-        let parent = BrowserApp.getTabForWindow(aOpener.top);
-        if (parent) {
-          parentId = parent.id;
-          isPrivate = PrivateBrowsingUtils.isBrowserPrivate(parent.browser);
-        }
-      }
-
-      // BrowserApp.addTab calls loadURIWithFlags with the appropriate params
-      let tab = BrowserApp.addTab(aURI ? aURI.spec : "about:blank", { flags: loadflags,
-                                                                      referrerURI: referrer,
-                                                                      external: isExternal,
-                                                                      parentId: parentId,
-                                                                      selected: true,
-                                                                      isPrivate: isPrivate,
-                                                                      pinned: pinned });
-
-      return tab.browser;
-    }
-
-    // OPEN_CURRENTWINDOW and illegal values
-    let browser = BrowserApp.selectedBrowser;
-    if (aURI && browser) {
-      browser.loadURIWithFlags(aURI.spec, loadflags, referrer, null, null);
-    }
-
-    return browser;
-  },
-
-  openURI: function browser_openURI(aURI, aOpener, aWhere, aContext) {
-    let browser = this._getBrowser(aURI, aOpener, aWhere, aContext);
-    return browser ? browser.contentWindow : null;
-  },
-
-  openURIInFrame: function browser_openURIInFrame(aURI, aParams, aWhere, aContext) {
-    let browser = this._getBrowser(aURI, null, aWhere, aContext);
-    return browser ? browser.QueryInterface(Ci.nsIFrameLoaderOwner) : null;
-  },
-
-  isTabContentWindow: function(aWindow) {
-    return BrowserApp.getBrowserForWindow(aWindow) != null;
-  },
-
-  canClose() {
-    return BrowserUtils.canCloseWindow(window);
-  },
-};
-
-
-// track the last known screen size so that new tabs
-// get created with the right size rather than being 1x1
-var gScreenWidth = 1;
-var gScreenHeight = 1;
-
-function Tab(aURL, aParams) {
-  this.filter = null;
-  this.browser = null;
-  this.id = 0;
-  this.lastTouchedAt = Date.now();
-  this._zoom = 1.0;
-  this._drawZoom = 1.0;
-  this._restoreZoom = false;
-  this.userScrollPos = { x: 0, y: 0 };
-  this.contentDocumentIsDisplayed = true;
-  this.pluginDoorhangerTimeout = null;
-  this.shouldShowPluginDoorhanger = true;
-  this.clickToPlayPluginsActivated = false;
-  this.desktopMode = false;
-  this.originalURI = null;
-  this.hasTouchListener = false;
-
-  this.create(aURL, aParams);
-}
-
-/*
- * Sanity limit for URIs passed to UI code.
- *
- * 2000 is the typical industry limit, largely due to older IE versions.
- *
- * We use 25000, so we'll allow almost any value through.
- *
- * Still, this truncation doesn't affect history, so this is only a practical
- * concern in two ways: the truncated value is used when editing URIs, and as
- * the key for favicon fetches.
- */
-const MAX_URI_LENGTH = 25000;
-
-/*
- * Similar restriction for titles. This is only a display concern.
- */
-const MAX_TITLE_LENGTH = 255;
-
-/**
- * Ensure that a string is of a sane length.
- */
-function truncate(text, max) {
-  if (!text || !max) {
-    return text;
-  }
-
-  if (text.length <= max) {
-    return text;
-  }
-
-  return text.slice(0, max) + "";
-}
-
-Tab.prototype = {
-  create: function(aURL, aParams) {
-    if (this.browser)
-      return;
-
-    aParams = aParams || {};
-
-    this.browser = document.createElement("browser");
-    this.browser.setAttribute("type", "content-targetable");
-    this.browser.setAttribute("messagemanagergroup", "browsers");
-
-    // Make sure the previously selected panel remains selected. The selected panel of a deck is
-    // not stable when panels are added.
-    let selectedPanel = BrowserApp.deck.selectedPanel;
-    BrowserApp.deck.insertBefore(this.browser, aParams.sibling || null);
-    BrowserApp.deck.selectedPanel = selectedPanel;
-
-    if (BrowserApp.manifestUrl) {
-      let appsService = Cc["@mozilla.org/AppsService;1"].getService(Ci.nsIAppsService);
-      let manifest = appsService.getAppByManifestURL(BrowserApp.manifestUrl);
-      if (manifest) {
-        let app = manifest.QueryInterface(Ci.mozIApplication);
-        this.browser.docShell.setIsApp(app.localId);
-      }
-    }
-
-    // Must be called after appendChild so the docShell has been created.
-    this.setActive(false);
-
-    let isPrivate = ("isPrivate" in aParams) && aParams.isPrivate;
-    if (isPrivate) {
-      this.browser.docShell.QueryInterface(Ci.nsILoadContext).usePrivateBrowsing = true;
-    }
-
-    // Set the new docShell load flags based on network state.
-    if (Tabs.useCache) {
-      this.browser.docShell.defaultLoadFlags |= Ci.nsIRequest.LOAD_FROM_CACHE;
-    }
-
-    this.browser.stop();
-
-    // Only set tab uri if uri is valid
-    let uri = null;
-    let title = aParams.title || aURL;
-    try {
-      uri = Services.io.newURI(aURL, null, null).spec;
-    } catch (e) {}
-
-    // When the tab is stubbed from Java, there's a window between the stub
-    // creation and the tab creation in Gecko where the stub could be removed
-    // or the selected tab can change (which is easiest to hit during startup).
-    // To prevent these races, we need to differentiate between tab stubs from
-    // Java and new tabs from Gecko.
-    let stub = false;
-
-    if (!aParams.zombifying) {
-      if ("tabID" in aParams) {
-        this.id = aParams.tabID;
-        stub = true;
-      } else {
-        let jenv = JNI.GetForThread();
-        let jTabs = JNI.LoadClass(jenv, "org.mozilla.gecko.Tabs", {
-          static_methods: [
-            { name: "getNextTabId", sig: "()I" }
-          ],
-        });
-        this.id = jTabs.getNextTabId();
-        JNI.UnloadClasses(jenv);
-      }
-
-      this.desktopMode = ("desktopMode" in aParams) ? aParams.desktopMode : false;
-
-      let message = {
-        type: "Tab:Added",
-        tabID: this.id,
-        uri: truncate(uri, MAX_URI_LENGTH),
-        parentId: ("parentId" in aParams) ? aParams.parentId : -1,
-        tabIndex: ("tabIndex" in aParams) ? aParams.tabIndex : -1,
-        external: ("external" in aParams) ? aParams.external : false,
-        selected: ("selected" in aParams) ? aParams.selected : true,
-        title: truncate(title, MAX_TITLE_LENGTH),
-        delayLoad: aParams.delayLoad || false,
-        desktopMode: this.desktopMode,
-        isPrivate: isPrivate,
-        stub: stub
-      };
-      Messaging.sendRequest(message);
-
-      this.overscrollController = new OverscrollController(this);
-    }
-
-    this.browser.contentWindow.controllers.insertControllerAt(0, this.overscrollController);
-
-    let flags = Ci.nsIWebProgress.NOTIFY_STATE_ALL |
-                Ci.nsIWebProgress.NOTIFY_LOCATION |
-                Ci.nsIWebProgress.NOTIFY_SECURITY;
-    this.filter = Cc["@mozilla.org/appshell/component/browser-status-filter;1"].createInstance(Ci.nsIWebProgress);
-    this.filter.addProgressListener(this, flags)
-    this.browser.addProgressListener(this.filter, flags);
-    this.browser.sessionHistory.addSHistoryListener(this);
-
-    this.browser.addEventListener("DOMContentLoaded", this, true);
-    this.browser.addEventListener("DOMFormHasPassword", this, true);
-    this.browser.addEventListener("DOMLinkAdded", this, true);
-    this.browser.addEventListener("DOMLinkChanged", this, true);
-    this.browser.addEventListener("DOMMetaAdded", this, false);
-    this.browser.addEventListener("DOMTitleChanged", this, true);
-    this.browser.addEventListener("DOMAudioPlaybackStarted", this, true);
-    this.browser.addEventListener("DOMAudioPlaybackStopped", this, true);
-    this.browser.addEventListener("DOMWindowClose", this, true);
-    this.browser.addEventListener("DOMWillOpenModalDialog", this, true);
-    this.browser.addEventListener("DOMAutoComplete", this, true);
-    this.browser.addEventListener("blur", this, true);
-    this.browser.addEventListener("scroll", this, true);
-    this.browser.addEventListener("MozScrolledAreaChanged", this, true);
-    this.browser.addEventListener("pageshow", this, true);
-    this.browser.addEventListener("MozApplicationManifest", this, true);
-
-    // Note that the XBL binding is untrusted
-    this.browser.addEventListener("PluginBindingAttached", this, true, true);
-    this.browser.addEventListener("VideoBindingAttached", this, true, true);
-    this.browser.addEventListener("VideoBindingCast", this, true, true);
-
-    Services.obs.addObserver(this, "before-first-paint", false);
-
-    if (aParams.delayLoad) {
-      // If this is a zombie tab, attach restore data so the tab will be
-      // restored when selected
-      this.browser.__SS_data = {
-        entries: [{
-          url: aURL,
-          title: truncate(title, MAX_TITLE_LENGTH)
-        }],
-        index: 1
-      };
-      this.browser.__SS_restore = true;
-    } else {
-      let flags = "flags" in aParams ? aParams.flags : Ci.nsIWebNavigation.LOAD_FLAGS_NONE;
-      let postData = ("postData" in aParams && aParams.postData) ? aParams.postData.value : null;
-      let referrerURI = "referrerURI" in aParams ? aParams.referrerURI : null;
-      let charset = "charset" in aParams ? aParams.charset : null;
-
-      // The search term the user entered to load the current URL
-      this.userRequested = "userRequested" in aParams ? aParams.userRequested : "";
-      this.isSearch = "isSearch" in aParams ? aParams.isSearch : false;
-
-      try {
-        this.browser.loadURIWithFlags(aURL, flags, referrerURI, charset, postData);
-      } catch(e) {
-        let message = {
-          type: "Content:LoadError",
-          tabID: this.id
-        };
-        Messaging.sendRequest(message);
-        dump("Handled load error: " + e);
-      }
-    }
-  },
-
-  /**
-   * Reloads the tab with the desktop mode setting.
-   */
-  reloadWithMode: function (aDesktopMode) {
-    // notify desktopmode for PIDOMWindow
-    let win = this.browser.contentWindow;
-    let dwi = win.QueryInterface(Ci.nsIInterfaceRequestor).getInterface(Ci.nsIDOMWindowUtils);
-    dwi.setDesktopModeViewport(aDesktopMode);
-
-    // Set desktop mode for tab and send change to Java
-    if (this.desktopMode != aDesktopMode) {
-      this.desktopMode = aDesktopMode;
-      Messaging.sendRequest({
-        type: "DesktopMode:Changed",
-        desktopMode: aDesktopMode,
-        tabID: this.id
-      });
-    }
-
-    // Only reload the page for http/https schemes
-    let currentURI = this.browser.currentURI;
-    if (!currentURI.schemeIs("http") && !currentURI.schemeIs("https"))
-      return;
-
-    let url = currentURI.spec;
-    // We need LOAD_FLAGS_BYPASS_CACHE here since we're changing the User-Agent
-    // string, and servers typically don't use the Vary: User-Agent header, so
-    // not doing this means that we'd get some of the previously cached content.
-    let flags = Ci.nsIWebNavigation.LOAD_FLAGS_BYPASS_CACHE |
-                Ci.nsIWebNavigation.LOAD_FLAGS_REPLACE_HISTORY;
-    if (this.originalURI && !this.originalURI.equals(currentURI)) {
-      // We were redirected; reload the original URL
-      url = this.originalURI.spec;
-    }
-
-    this.browser.docShell.loadURI(url, flags, null, null, null);
-  },
-
-  destroy: function() {
-    if (!this.browser)
-      return;
-
-    this.browser.contentWindow.controllers.removeController(this.overscrollController);
-
-    this.browser.removeProgressListener(this.filter);
-    this.filter.removeProgressListener(this);
-    this.filter = null;
-    this.browser.sessionHistory.removeSHistoryListener(this);
-
-    this.browser.removeEventListener("DOMContentLoaded", this, true);
-    this.browser.removeEventListener("DOMFormHasPassword", this, true);
-    this.browser.removeEventListener("DOMLinkAdded", this, true);
-    this.browser.removeEventListener("DOMLinkChanged", this, true);
-    this.browser.removeEventListener("DOMMetaAdded", this, false);
-    this.browser.removeEventListener("DOMTitleChanged", this, true);
-    this.browser.removeEventListener("DOMAudioPlaybackStarted", this, true);
-    this.browser.removeEventListener("DOMAudioPlaybackStopped", this, true);
-    this.browser.removeEventListener("DOMWindowClose", this, true);
-    this.browser.removeEventListener("DOMWillOpenModalDialog", this, true);
-    this.browser.removeEventListener("DOMAutoComplete", this, true);
-    this.browser.removeEventListener("blur", this, true);
-    this.browser.removeEventListener("scroll", this, true);
-    this.browser.removeEventListener("MozScrolledAreaChanged", this, true);
-    this.browser.removeEventListener("pageshow", this, true);
-    this.browser.removeEventListener("MozApplicationManifest", this, true);
-
-    this.browser.removeEventListener("PluginBindingAttached", this, true, true);
-    this.browser.removeEventListener("VideoBindingAttached", this, true, true);
-    this.browser.removeEventListener("VideoBindingCast", this, true, true);
-
-    Services.obs.removeObserver(this, "before-first-paint");
-
-    // Make sure the previously selected panel remains selected. The selected panel of a deck is
-    // not stable when panels are removed.
-    let selectedPanel = BrowserApp.deck.selectedPanel;
-    BrowserApp.deck.removeChild(this.browser);
-    BrowserApp.deck.selectedPanel = selectedPanel;
-
-    this.browser = null;
-  },
-
-  // This should be called to update the browser when the tab gets selected/unselected
-  setActive: function setActive(aActive) {
-    if (!this.browser || !this.browser.docShell)
-      return;
-
-    this.lastTouchedAt = Date.now();
-
-    if (aActive) {
-      this.browser.setAttribute("type", "content-primary");
-      this.browser.focus();
-      this.browser.docShellIsActive = true;
-      Reader.updatePageAction(this);
-      ExternalApps.updatePageAction(this.browser.currentURI, this.browser.contentDocument);
-    } else {
-      this.browser.setAttribute("type", "content-targetable");
-      this.browser.docShellIsActive = false;
-    }
-  },
-
-  getActive: function getActive() {
-    return this.browser.docShellIsActive;
-  },
-
-  setDisplayPort: function(aDisplayPort) {
-    let zoom = this._zoom;
-    let resolution = this.restoredSessionZoom() || aDisplayPort.resolution;
-    if (zoom <= 0 || resolution <= 0)
-      return;
-
-    // "zoom" is the user-visible zoom of the "this" tab
-    // "resolution" is the zoom at which we wish gecko to render "this" tab at
-    // these two may be different if we are, for example, trying to render a
-    // large area of the page at low resolution because the user is panning real
-    // fast.
-    // The gecko scroll position is in CSS pixels. The display port rect
-    // values (aDisplayPort), however, are in CSS pixels multiplied by the desired
-    // rendering resolution. Therefore care must be taken when doing math with
-    // these sets of values, to ensure that they are normalized to the same coordinate
-    // space first.
-
-    let element = this.browser.contentDocument.documentElement;
-    if (!element)
-      return;
-
-    // we should never be drawing background tabs at resolutions other than the user-
-    // visible zoom. for foreground tabs, however, if we are drawing at some other
-    // resolution, we need to set the resolution as specified.
-    let cwu = this.browser.contentWindow.QueryInterface(Ci.nsIInterfaceRequestor).getInterface(Ci.nsIDOMWindowUtils);
-    if (BrowserApp.selectedTab == this) {
-      if (resolution != this._drawZoom) {
-        this._drawZoom = resolution;
-        cwu.setResolutionAndScaleTo(resolution / window.devicePixelRatio);
-      }
-    } else if (!fuzzyEquals(resolution, zoom)) {
-      dump("Warning: setDisplayPort resolution did not match zoom for background tab! (" + resolution + " != " + zoom + ")");
-    }
-
-    // Finally, we set the display port as a set of margins around the visible viewport.
-
-    let scrollx = this.browser.contentWindow.scrollX * zoom;
-    let scrolly = this.browser.contentWindow.scrollY * zoom;
-    let displayPortMargins = {
-      left: scrollx - aDisplayPort.left,
-      top: scrolly - aDisplayPort.top,
-      right: aDisplayPort.right - (scrollx + gScreenWidth),
-      bottom: aDisplayPort.bottom - (scrolly + gScreenHeight)
-    };
-
-    cwu.setDisplayPortMarginsForElement(displayPortMargins.left,
-                                        displayPortMargins.top,
-                                        displayPortMargins.right,
-                                        displayPortMargins.bottom,
-                                        element, 0);
-  },
-
-  setScrollClampingSize: function(zoom) {
-    let viewportWidth = gScreenWidth / zoom;
-    let viewportHeight = gScreenHeight / zoom;
-    let screenWidth = gScreenWidth;
-    let screenHeight = gScreenHeight;
-
-    // Make sure the aspect ratio of the screen is maintained when setting
-    // the clamping scroll-port size.
-    let factor = Math.min(viewportWidth / screenWidth,
-                          viewportHeight / screenHeight);
-    let scrollPortWidth = screenWidth * factor;
-    let scrollPortHeight = screenHeight * factor;
-
-    let win = this.browser.contentWindow;
-    win.QueryInterface(Ci.nsIInterfaceRequestor).getInterface(Ci.nsIDOMWindowUtils).
-        setScrollPositionClampingScrollPortSize(scrollPortWidth, scrollPortHeight);
-  },
-
-  setViewport: function(aViewport) {
-    if (AppConstants.MOZ_ANDROID_APZ) {
-      // This should already be getting short-circuited out in GeckoLayerClient,
-      // but this is an extra safety precaution
-      return;
-    }
-
-    // Transform coordinates based on zoom
-    let x = aViewport.x / aViewport.zoom;
-    let y = aViewport.y / aViewport.zoom;
-
-    this.setScrollClampingSize(aViewport.zoom);
-
-    let win = this.browser.contentWindow;
-    win.scrollTo(x, y);
-    this.saveSessionZoom(aViewport.zoom);
-
-    this.userScrollPos.x = win.scrollX;
-    this.userScrollPos.y = win.scrollY;
-    this.setResolution(aViewport.zoom, false);
-
-    if (aViewport.displayPort)
-      this.setDisplayPort(aViewport.displayPort);
-  },
-
-  setResolution: function(aZoom, aForce) {
-    if (AppConstants.MOZ_ANDROID_APZ) {
-      return;
-    }
-    // Set zoom level
-    if (aForce || !fuzzyEquals(aZoom, this._zoom)) {
-      this._zoom = aZoom;
-      if (BrowserApp.selectedTab == this) {
-        let cwu = this.browser.contentWindow.QueryInterface(Ci.nsIInterfaceRequestor).getInterface(Ci.nsIDOMWindowUtils);
-        this._drawZoom = aZoom;
-        cwu.setResolutionAndScaleTo(aZoom / window.devicePixelRatio);
-      }
-    }
-  },
-
-  getViewport: function() {
-    let zoom = this.restoredSessionZoom() || this._zoom;
-
-    let viewport = {
-      width: gScreenWidth,
-      height: gScreenHeight,
-      cssWidth: gScreenWidth / zoom,
-      cssHeight: gScreenHeight / zoom,
-      pageLeft: 0,
-      pageTop: 0,
-      pageRight: gScreenWidth,
-      pageBottom: gScreenHeight,
-      // We make up matching css page dimensions
-      cssPageLeft: 0,
-      cssPageTop: 0,
-      cssPageRight: gScreenWidth / zoom,
-      cssPageBottom: gScreenHeight / zoom,
-      zoom: zoom,
-    };
-
-    // Set the viewport offset to current scroll offset
-    viewport.cssX = this.browser.contentWindow.scrollX || 0;
-    viewport.cssY = this.browser.contentWindow.scrollY || 0;
-
-    // Transform coordinates based on zoom
-    viewport.x = Math.round(viewport.cssX * viewport.zoom);
-    viewport.y = Math.round(viewport.cssY * viewport.zoom);
-
-    let doc = this.browser.contentDocument;
-    if (doc != null) {
-      let cwu = this.browser.contentWindow.QueryInterface(Ci.nsIInterfaceRequestor).getInterface(Ci.nsIDOMWindowUtils);
-      let cssPageRect = cwu.getRootBounds();
-
-      /*
-       * Avoid sending page sizes of less than screen size before we hit DOMContentLoaded, because
-       * this causes the page size to jump around wildly during page load. After the page is loaded,
-       * send updates regardless of page size; we'll zoom to fit the content as needed.
-       *
-       * In the check below, we floor the viewport size because there might be slight rounding errors
-       * introduced in the CSS page size due to the conversion to and from app units in Gecko. The
-       * error should be no more than one app unit so doing the floor is overkill, but safe in the
-       * sense that the extra page size updates that get sent as a result will be mostly harmless.
-       */
-      let pageLargerThanScreen = (Math.ceil(cssPageRect.width) >= Math.floor(viewport.cssWidth))
-                              && (Math.ceil(cssPageRect.height) >= Math.floor(viewport.cssHeight));
-      if (doc.readyState === 'complete' || pageLargerThanScreen) {
-        viewport.cssPageLeft = cssPageRect.left;
-        viewport.cssPageTop = cssPageRect.top;
-        viewport.cssPageRight = cssPageRect.right;
-        viewport.cssPageBottom = cssPageRect.bottom;
-        /* Transform the page width and height based on the zoom factor. */
-        viewport.pageLeft = (viewport.cssPageLeft * viewport.zoom);
-        viewport.pageTop = (viewport.cssPageTop * viewport.zoom);
-        viewport.pageRight = (viewport.cssPageRight * viewport.zoom);
-        viewport.pageBottom = (viewport.cssPageBottom * viewport.zoom);
-      }
-    }
-
-    return viewport;
-  },
-
-  sendViewportUpdate: function(aPageSizeUpdate) {
-    if (AppConstants.MOZ_ANDROID_APZ) {
-      return;
-    }
-    let viewport = this.getViewport();
-    let displayPort = Services.androidBridge.getDisplayPort(aPageSizeUpdate, BrowserApp.isBrowserContentDocumentDisplayed(), this.id, viewport);
-    if (displayPort != null)
-      this.setDisplayPort(displayPort);
-  },
-
-  // These constants are used to prioritize high quality metadata over low quality data, so that
-  // we can collect data as we find meta tags, and replace low quality metadata with higher quality
-  // matches. For instance a msApplicationTile icon is a better tile image than an og:image tag.
-  METADATA_GOOD_MATCH: 10,
-  METADATA_NORMAL_MATCH: 1,
-
-  addMetadata: function(type, value, quality = 1) {
-    if (!this.metatags) {
-      this.metatags = {
-        url: this.browser.currentURI.spec
-      };
-    }
-
-    if (type == "touchIconList") {
-      if (!this.metatags['touchIconList']) {
-        this.metatags['touchIconList'] = {};
-      }
-      this.metatags.touchIconList[quality] = value;
-    } else if (!this.metatags[type] || this.metatags[type + "_quality"] < quality) {
-      this.metatags[type] = value;
-      this.metatags[type + "_quality"] = quality;
-    }
-  },
-
-  sanitizeRelString: function(linkRel) {
-    // Sanitize the rel string
-    let list = [];
-    if (linkRel) {
-      list = linkRel.toLowerCase().split(/\s+/);
-      let hash = {};
-      list.forEach(function(value) { hash[value] = true; });
-      list = [];
-      for (let rel in hash)
-      list.push("[" + rel + "]");
-    }
-    return list;
-  },
-
-  makeFaviconMessage: function(eventTarget) {
-    // We want to get the largest icon size possible for our UI.
-    let maxSize = 0;
-
-    // We use the sizes attribute if available
-    // see http://www.whatwg.org/specs/web-apps/current-work/multipage/links.html#rel-icon
-    if (eventTarget.hasAttribute("sizes")) {
-      let sizes = eventTarget.getAttribute("sizes").toLowerCase();
-
-      if (sizes == "any") {
-        // Since Java expects an integer, use -1 to represent icons with sizes="any"
-        maxSize = -1;
-      } else {
-        let tokens = sizes.split(" ");
-        tokens.forEach(function(token) {
-          // TODO: check for invalid tokens
-          let [w, h] = token.split("x");
-          maxSize = Math.max(maxSize, Math.max(w, h));
-        });
-      }
-    }
-    return {
-      type: "Link:Favicon",
-      tabID: this.id,
-      href: resolveGeckoURI(eventTarget.href),
-      size: maxSize,
-      mime: eventTarget.getAttribute("type") || ""
-    };
-  },
-
-  makeFeedMessage: function(eventTarget, targetType) {
-    try {
-      // urlSecurityCeck will throw if things are not OK
-      ContentAreaUtils.urlSecurityCheck(eventTarget.href,
-            eventTarget.ownerDocument.nodePrincipal,
-            Ci.nsIScriptSecurityManager.DISALLOW_INHERIT_PRINCIPAL);
-
-      if (!this.browser.feeds)
-        this.browser.feeds = [];
-
-      this.browser.feeds.push({
-        href: eventTarget.href,
-        title: eventTarget.title,
-        type: targetType
-      });
-
-      return {
-        type: "Link:Feed",
-        tabID: this.id
-      };
-    } catch (e) {
-        return null;
-    }
-  },
-
-  sendOpenSearchMessage: function(eventTarget) {
-    let type = eventTarget.type && eventTarget.type.toLowerCase();
-    // Replace all starting or trailing spaces or spaces before "*;" globally w/ "".
-    type = type.replace(/^\s+|\s*(?:;.*)?$/g, "");
-
-    // Check that type matches opensearch.
-    let isOpenSearch = (type == "application/opensearchdescription+xml");
-    if (isOpenSearch && eventTarget.title && /^(?:https?|ftp):/i.test(eventTarget.href)) {
-      Services.search.init(() => {
-        let visibleEngines = Services.search.getVisibleEngines();
-        // NOTE: Engines are currently identified by name, but this can be changed
-        // when Engines are identified by URL (see bug 335102).
-        if (visibleEngines.some(function(e) {
-          return e.name == eventTarget.title;
-        })) {
-          // This engine is already present, do nothing.
-          return null;
-        }
-
-        if (this.browser.engines) {
-          // This engine has already been handled, do nothing.
-          if (this.browser.engines.some(function(e) {
-            return e.url == eventTarget.href;
-          })) {
-            return null;
-          }
-        } else {
-            this.browser.engines = [];
-        }
-
-        // Get favicon.
-        let iconURL = eventTarget.ownerDocument.documentURIObject.prePath + "/favicon.ico";
-
-        let newEngine = {
-          title: eventTarget.title,
-          url: eventTarget.href,
-          iconURL: iconURL
-        };
-
-        this.browser.engines.push(newEngine);
-
-        // Don't send a message to display engines if we've already handled an engine.
-        if (this.browser.engines.length > 1)
-          return null;
-
-        // Broadcast message that this tab contains search engines that should be visible.
-        Messaging.sendRequest({
-          type: "Link:OpenSearch",
-          tabID: this.id,
-          visible: true
-        });
-      });
-    }
-  },
-
-  handleEvent: function(aEvent) {
-    switch (aEvent.type) {
-      case "DOMContentLoaded": {
-        let target = aEvent.originalTarget;
-
-        // ignore on frames and other documents
-        if (target != this.browser.contentDocument)
-          return;
-
-        // Sample the background color of the page and pass it along. (This is used to draw the
-        // checkerboard.) Right now we don't detect changes in the background color after this
-        // event fires; it's not clear that doing so is worth the effort.
-        var backgroundColor = null;
-        try {
-          let { contentDocument, contentWindow } = this.browser;
-          let computedStyle = contentWindow.getComputedStyle(contentDocument.body);
-          backgroundColor = computedStyle.backgroundColor;
-        } catch (e) {
-          // Ignore. Catching and ignoring exceptions here ensures that Talos succeeds.
-        }
-
-        let docURI = target.documentURI;
-        let errorType = "";
-        if (docURI.startsWith("about:certerror"))
-          errorType = "certerror";
-        else if (docURI.startsWith("about:blocked"))
-          errorType = "blocked"
-        else if (docURI.startsWith("about:neterror"))
-          errorType = "neterror";
-
-        // Attach a listener to watch for "click" events bubbling up from error
-        // pages and other similar page. This lets us fix bugs like 401575 which
-        // require error page UI to do privileged things, without letting error
-        // pages have any privilege themselves.
-        if (docURI.startsWith("about:neterror")) {
-          NetErrorHelper.attachToBrowser(this.browser);
-        }
-
-        Messaging.sendRequest({
-          type: "DOMContentLoaded",
-          tabID: this.id,
-          bgColor: backgroundColor,
-          errorType: errorType,
-          metadata: this.metatags,
-        });
-
-        // Reset isSearch so that the userRequested term will be erased on next page load
-        this.metatags = null;
-
-        if (docURI.startsWith("about:certerror") || docURI.startsWith("about:blocked")) {
-          this.browser.addEventListener("click", ErrorPageEventHandler, true);
-          let listener = function() {
-            this.browser.removeEventListener("click", ErrorPageEventHandler, true);
-            this.browser.removeEventListener("pagehide", listener, true);
-          }.bind(this);
-
-          this.browser.addEventListener("pagehide", listener, true);
-        }
-        break;
-      }
-
-      case "DOMFormHasPassword": {
-        LoginManagerContent.onDOMFormHasPassword(aEvent,
-                                                 this.browser.contentWindow);
-
-        // Send logins for this hostname to Java.
-        let hostname = aEvent.target.baseURIObject.prePath;
-        let foundLogins = Services.logins.findLogins({}, hostname, "", "");
-        if (foundLogins.length > 0) {
-          let displayHost = IdentityHandler.getEffectiveHost();
-          let title = { text: displayHost, resource: hostname };
-          let selectObj = { title: title, logins: foundLogins };
-          Messaging.sendRequest({ type: "Doorhanger:Logins", data: selectObj });
-        }
-        break;
-      }
-
-      case "DOMMetaAdded":
-        let target = aEvent.originalTarget;
-        let browser = BrowserApp.getBrowserForDocument(target.ownerDocument);
-
-        switch (target.name) {
-          case "msapplication-TileImage":
-            this.addMetadata("tileImage", browser.currentURI.resolve(target.content), this.METADATA_GOOD_MATCH);
-            break;
-          case "msapplication-TileColor":
-            this.addMetadata("tileColor", target.content, this.METADATA_GOOD_MATCH);
-            break;
-        }
-
-        break;
-
-      case "DOMLinkAdded":
-      case "DOMLinkChanged": {
-        let jsonMessage = null;
-        let target = aEvent.originalTarget;
-        if (!target.href || target.disabled)
-          return;
-
-        // Ignore on frames and other documents
-        if (target.ownerDocument != this.browser.contentDocument)
-          return;
-
-        // Sanitize rel link
-        let list = this.sanitizeRelString(target.rel);
-        if (list.indexOf("[icon]") != -1) {
-          jsonMessage = this.makeFaviconMessage(target);
-        } else if (list.indexOf("[apple-touch-icon]") != -1 ||
-            list.indexOf("[apple-touch-icon-precomposed]") != -1) {
-          let message = this.makeFaviconMessage(target);
-          this.addMetadata("touchIconList", message.href, message.size);
-        } else if (list.indexOf("[alternate]") != -1 && aEvent.type == "DOMLinkAdded") {
-          let type = target.type.toLowerCase().replace(/^\s+|\s*(?:;.*)?$/g, "");
-          let isFeed = (type == "application/rss+xml" || type == "application/atom+xml");
-
-          if (!isFeed)
-            return;
-
-          jsonMessage = this.makeFeedMessage(target, type);
-        } else if (list.indexOf("[search]" != -1) && aEvent.type == "DOMLinkAdded") {
-          this.sendOpenSearchMessage(target);
-        }
-        if (!jsonMessage)
-         return;
-
-        Messaging.sendRequest(jsonMessage);
-        break;
-      }
-
-      case "DOMTitleChanged": {
-        if (!aEvent.isTrusted)
-          return;
-
-        // ignore on frames and other documents
-        if (aEvent.originalTarget != this.browser.contentDocument)
-          return;
-
-        Messaging.sendRequest({
-          type: "DOMTitleChanged",
-          tabID: this.id,
-          title: truncate(aEvent.target.title, MAX_TITLE_LENGTH)
-        });
-        break;
-      }
-
-      case "DOMAudioPlaybackStarted":
-      case "DOMAudioPlaybackStopped": {
-        if (!Services.prefs.getBoolPref("browser.tabs.showAudioPlayingIcon") ||
-            !aEvent.isTrusted) {
-          return;
-        }
-
-        let browser = aEvent.originalTarget;
-        if (browser != this.browser) {
-          return;
-        }
-
-        Messaging.sendRequest({
-          type: "Tab:AudioPlayingChange",
-          tabID: this.id,
-          isAudioPlaying: aEvent.type === "DOMAudioPlaybackStarted"
-        });
-        return;
-      }
-
-      case "DOMWindowClose": {
-        if (!aEvent.isTrusted)
-          return;
-
-        // Find the relevant tab, and close it from Java
-        if (this.browser.contentWindow == aEvent.target) {
-          aEvent.preventDefault();
-
-          Messaging.sendRequest({
-            type: "Tab:Close",
-            tabID: this.id
-          });
-        }
-        break;
-      }
-
-      case "DOMWillOpenModalDialog": {
-        if (!aEvent.isTrusted)
-          return;
-
-        // We're about to open a modal dialog, make sure the opening
-        // tab is brought to the front.
-        let tab = BrowserApp.getTabForWindow(aEvent.target.top);
-        BrowserApp.selectTab(tab);
-        break;
-      }
-
-      case "DOMAutoComplete":
-      case "blur": {
-        LoginManagerContent.onUsernameInput(aEvent);
-        break;
-      }
-
-      case "scroll": {
-        let win = this.browser.contentWindow;
-        if (this.userScrollPos.x != win.scrollX || this.userScrollPos.y != win.scrollY) {
-          this.sendViewportUpdate();
-        }
-        break;
-      }
-
-      case "MozScrolledAreaChanged": {
-        // This event is only fired for root scroll frames, and only when the
-        // scrolled area has actually changed, so no need to check for that.
-        // Just make sure it's the event for the correct root scroll frame.
-        if (aEvent.originalTarget != this.browser.contentDocument)
-          return;
-
-        this.sendViewportUpdate(true);
-        break;
-      }
-
-      case "PluginBindingAttached": {
-        PluginHelper.handlePluginBindingAttached(this, aEvent);
-        break;
-      }
-
-      case "VideoBindingAttached": {
-        CastingApps.handleVideoBindingAttached(this, aEvent);
-        break;
-      }
-
-      case "VideoBindingCast": {
-        CastingApps.handleVideoBindingCast(this, aEvent);
-        break;
-      }
-
-      case "MozApplicationManifest": {
-        OfflineApps.offlineAppRequested(aEvent.originalTarget.defaultView);
-        break;
-      }
-
-      case "pageshow": {
-        LoginManagerContent.onPageShow(aEvent, this.browser.contentWindow);
-
-        // The rest of this only handles pageshow for the top-level document.
-        if (aEvent.originalTarget.defaultView != this.browser.contentWindow)
-          return;
-
-        let target = aEvent.originalTarget;
-        let docURI = target.documentURI;
-        if (!docURI.startsWith("about:neterror") && !this.isSearch) {
-          // If this wasn't an error page and the user isn't search, don't retain the typed entry
-          this.userRequested = "";
-        }
-
-        Messaging.sendRequest({
-          type: "Content:PageShow",
-          tabID: this.id,
-          userRequested: this.userRequested
-        });
-
-        this.isSearch = false;
-
-        if (!aEvent.persisted && Services.prefs.getBoolPref("browser.ui.linkify.phone")) {
-          if (!this._linkifier)
-            this._linkifier = new Linkifier();
-          this._linkifier.linkifyNumbers(this.browser.contentWindow.document);
-        }
-
-        // Update page actions for helper apps.
-        let uri = this.browser.currentURI;
-        if (BrowserApp.selectedTab == this) {
-          if (ExternalApps.shouldCheckUri(uri)) {
-            ExternalApps.updatePageAction(uri, this.browser.contentDocument);
-          } else {
-            ExternalApps.clearPageAction();
-          }
-        }
-      }
-    }
-  },
-
-  onStateChange: function(aWebProgress, aRequest, aStateFlags, aStatus) {
-    let contentWin = aWebProgress.DOMWindow;
-    if (contentWin != contentWin.top)
-        return;
-
-    // Filter optimization: Only really send NETWORK state changes to Java listener
-    if (aStateFlags & Ci.nsIWebProgressListener.STATE_IS_NETWORK) {
-      if (AppConstants.NIGHTLY_BUILD && (aStateFlags & Ci.nsIWebProgressListener.STATE_START)) {
-        Profiler.AddMarker("Load start: " + aRequest.QueryInterface(Ci.nsIChannel).originalURI.spec);
-      } else if (AppConstants.NIGHTLY_BUILD && (aStateFlags & Ci.nsIWebProgressListener.STATE_STOP) && !aWebProgress.isLoadingDocument) {
-        Profiler.AddMarker("Load stop: " + aRequest.QueryInterface(Ci.nsIChannel).originalURI.spec);
-      }
-
-      if ((aStateFlags & Ci.nsIWebProgressListener.STATE_STOP) && aWebProgress.isLoadingDocument) {
-        // We may receive a document stop event while a document is still loading
-        // (such as when doing URI fixup). Don't notify Java UI in these cases.
-        return;
-      }
-
-      // Clear page-specific opensearch engines and feeds for a new request.
-      if (aStateFlags & Ci.nsIWebProgressListener.STATE_START && aRequest && aWebProgress.isTopLevel) {
-        this.browser.engines = null;
-        this.browser.feeds = null;
-      }
-
-      // true if the page loaded successfully (i.e., no 404s or other errors)
-      let success = false;
-      let uri = "";
-      try {
-        // Remember original URI for UA changes on redirected pages
-        this.originalURI = aRequest.QueryInterface(Components.interfaces.nsIChannel).originalURI;
-
-        if (this.originalURI != null)
-          uri = this.originalURI.spec;
-      } catch (e) { }
-      try {
-        success = aRequest.QueryInterface(Components.interfaces.nsIHttpChannel).requestSucceeded;
-      } catch (e) {
-        // If the request does not handle the nsIHttpChannel interface, use nsIRequest's success
-        // status. Used for local files. See bug 948849.
-        success = aRequest.status == 0;
-      }
-
-      // Check to see if we restoring the content from a previous presentation (session)
-      // since there should be no real network activity
-      let restoring = (aStateFlags & Ci.nsIWebProgressListener.STATE_RESTORING) > 0;
-
-      let message = {
-        type: "Content:StateChange",
-        tabID: this.id,
-        uri: truncate(uri, MAX_URI_LENGTH),
-        state: aStateFlags,
-        restoring: restoring,
-        success: success
-      };
-      Messaging.sendRequest(message);
-    }
-  },
-
-  onLocationChange: function(aWebProgress, aRequest, aLocationURI, aFlags) {
-    let contentWin = aWebProgress.DOMWindow;
-
-    // Browser webapps may load content inside iframes that can not reach across the app/frame boundary
-    // i.e. even though the page is loaded in an iframe window.top != webapp
-    // Make cure this window is a top level tab before moving on.
-    if (BrowserApp.getBrowserForWindow(contentWin) == null)
-      return;
-
-    this._hostChanged = true;
-
-    let fixedURI = aLocationURI;
-    try {
-      fixedURI = URIFixup.createExposableURI(aLocationURI);
-    } catch (ex) { }
-
-    // In restricted profiles, we refuse to let you open various urls.
-    if (!ParentalControls.isAllowed(ParentalControls.BROWSE, fixedURI)) {
-      aRequest.cancel(Cr.NS_BINDING_ABORTED);
-
-      this.browser.docShell.displayLoadError(Cr.NS_ERROR_UNKNOWN_PROTOCOL, fixedURI, null);
-    }
-
-    let contentType = contentWin.document.contentType;
-
-    // If fixedURI matches browser.lastURI, we assume this isn't a real location
-    // change but rather a spurious addition like a wyciwyg URI prefix. See Bug 747883.
-    // Note that we have to ensure fixedURI is not the same as aLocationURI so we
-    // don't false-positive page reloads as spurious additions.
-    let sameDocument = (aFlags & Ci.nsIWebProgressListener.LOCATION_CHANGE_SAME_DOCUMENT) != 0 ||
-                       ((this.browser.lastURI != null) && fixedURI.equals(this.browser.lastURI) && !fixedURI.equals(aLocationURI));
-    this.browser.lastURI = fixedURI;
-
-    // Let the reader logic know about same document changes because we won't get a DOMContentLoaded
-    // or pageshow event, but we'll still want to update the reader view button to account for this change.
-    // This mirrors the desktop logic in TabsProgressListener.
-    if (aFlags & Ci.nsIWebProgressListener.LOCATION_CHANGE_SAME_DOCUMENT) {
-      this.browser.messageManager.sendAsyncMessage("Reader:PushState", {isArticle: this.browser.isArticle});
-    }
-
-    // Reset state of click-to-play plugin notifications.
-    clearTimeout(this.pluginDoorhangerTimeout);
-    this.pluginDoorhangerTimeout = null;
-    this.shouldShowPluginDoorhanger = true;
-    this.clickToPlayPluginsActivated = false;
-
-    let documentURI = contentWin.document.documentURIObject.spec;
-
-    // If reader mode, get the base domain for the original url.
-    let strippedURI = this._stripAboutReaderURL(documentURI);
-
-    // Borrowed from desktop Firefox: http://hg.mozilla.org/mozilla-central/annotate/72835344333f/browser/base/content/urlbarBindings.xml#l236
-    let matchedURL = strippedURI.match(/^((?:[a-z]+:\/\/)?(?:[^\/]+@)?)(.+?)(?::\d+)?(?:\/|$)/);
-    let baseDomain = "";
-    if (matchedURL) {
-      var domain = "";
-      [, , domain] = matchedURL;
-
-      try {
-        baseDomain = Services.eTLD.getBaseDomainFromHost(domain);
-        if (!domain.endsWith(baseDomain)) {
-          // getBaseDomainFromHost converts its resultant to ACE.
-          let IDNService = Cc["@mozilla.org/network/idn-service;1"].getService(Ci.nsIIDNService);
-          baseDomain = IDNService.convertACEtoUTF8(baseDomain);
-        }
-      } catch (e) {}
-    }
-
-    // If we are navigating to a new location with a different host,
-    // clear any URL origin that might have been pinned to this tab.
-    let ss = Cc["@mozilla.org/browser/sessionstore;1"].getService(Ci.nsISessionStore);
-    let appOrigin = ss.getTabValue(this, "appOrigin");
-    if (appOrigin) {
-      let originHost = "";
-      try {
-        originHost = Services.io.newURI(appOrigin, null, null).host;
-      } catch (e if (e.result == Cr.NS_ERROR_FAILURE)) {
-        // NS_ERROR_FAILURE can be thrown by nsIURI.host if the URI scheme does not possess a host - in this case
-        // we just act as if we have an empty host.
-      }
-      if (originHost != aLocationURI.host) {
-        // Note: going 'back' will not make this tab pinned again
-        ss.deleteTabValue(this, "appOrigin");
-      }
-    }
-
-    // Update the page actions URI for helper apps.
-    if (BrowserApp.selectedTab == this) {
-      ExternalApps.updatePageActionUri(fixedURI);
-    }
-
-    let webNav = contentWin.QueryInterface(Ci.nsIInterfaceRequestor).getInterface(Ci.nsIWebNavigation);
-
-    let message = {
-      type: "Content:LocationChange",
-      tabID: this.id,
-      uri: truncate(fixedURI.spec, MAX_URI_LENGTH),
-      userRequested: this.userRequested || "",
-      baseDomain: baseDomain,
-      contentType: (contentType ? contentType : ""),
-      sameDocument: sameDocument,
-
-      historyIndex: webNav.sessionHistory.index,
-      historySize: webNav.sessionHistory.count,
-      canGoBack: webNav.canGoBack,
-      canGoForward: webNav.canGoForward,
-    };
-
-    Messaging.sendRequest(message);
-
-    if (!sameDocument) {
-      // XXX This code assumes that this is the earliest hook we have at which
-      // browser.contentDocument is changed to the new document we're loading
-      this.contentDocumentIsDisplayed = false;
-      this.hasTouchListener = false;
-    } else {
-      setTimeout(function() {
-        this.sendViewportUpdate();
-      }.bind(this), 0);
-    }
-  },
-
-  _stripAboutReaderURL: function (url) {
-    return ReaderMode.getOriginalUrl(url) || url;
-  },
-
-  // Properties used to cache security state used to update the UI
-  _state: null,
-  _hostChanged: false, // onLocationChange will flip this bit
-
-  onSecurityChange: function(aWebProgress, aRequest, aState) {
-    // Don't need to do anything if the data we use to update the UI hasn't changed
-    if (this._state == aState && !this._hostChanged)
-      return;
-
-    this._state = aState;
-    this._hostChanged = false;
-
-    let identity = IdentityHandler.checkIdentity(aState, this.browser);
-
-    let message = {
-      type: "Content:SecurityChange",
-      tabID: this.id,
-      identity: identity
-    };
-
-    Messaging.sendRequest(message);
-  },
-
-  onProgressChange: function(aWebProgress, aRequest, aCurSelfProgress, aMaxSelfProgress, aCurTotalProgress, aMaxTotalProgress) {
-    // Note: aWebProgess and aRequest will be NULL since we are filtering webprogress
-    // notifications using nsBrowserStatusFilter.
-  },
-
-  onStatusChange: function(aBrowser, aWebProgress, aRequest, aStatus, aMessage) {
-    // Note: aWebProgess and aRequest will be NULL since we are filtering webprogress
-    // notifications using nsBrowserStatusFilter.
-  },
-
-  _getGeckoZoom: function() {
-    let res = {};
-    let cwu = this.browser.contentWindow.QueryInterface(Ci.nsIInterfaceRequestor).getInterface(Ci.nsIDOMWindowUtils);
-    cwu.getResolution(res);
-    let zoom = res.value * window.devicePixelRatio;
-    return zoom;
-  },
-
-  saveSessionZoom: function(aZoom) {
-    let cwu = this.browser.contentWindow.QueryInterface(Ci.nsIInterfaceRequestor).getInterface(Ci.nsIDOMWindowUtils);
-    cwu.setResolutionAndScaleTo(aZoom / window.devicePixelRatio);
-  },
-
-  restoredSessionZoom: function() {
-    let cwu = this.browser.contentWindow.QueryInterface(Ci.nsIInterfaceRequestor).getInterface(Ci.nsIDOMWindowUtils);
-
-    if (this._restoreZoom && cwu.isResolutionSet) {
-      return this._getGeckoZoom();
-    }
-    return null;
-  },
-
-  _updateZoomFromHistoryEvent: function(aHistoryEventName) {
-    // Restore zoom only when moving in session history, not for new page loads.
-    this._restoreZoom = aHistoryEventName !== "New";
-  },
-
-  OnHistoryNewEntry: function(aUri) {
-    this._updateZoomFromHistoryEvent("New");
-  },
-
-  OnHistoryGoBack: function(aUri) {
-    this._updateZoomFromHistoryEvent("Back");
-    return true;
-  },
-
-  OnHistoryGoForward: function(aUri) {
-    this._updateZoomFromHistoryEvent("Forward");
-    return true;
-  },
-
-  OnHistoryReload: function(aUri, aFlags) {
-    // we don't do anything with this, so don't propagate it
-    // for now anyway
-    return true;
-  },
-
-  OnHistoryGotoIndex: function(aIndex, aUri) {
-    this._updateZoomFromHistoryEvent("Goto");
-    return true;
-  },
-
-  OnHistoryPurge: function(aNumEntries) {
-    this._updateZoomFromHistoryEvent("Purge");
-    return true;
-  },
-
-  OnHistoryReplaceEntry: function(aIndex) {
-    // we don't do anything with this, so don't propogate it
-    // for now anyway.
-  },
-
-  viewportSizeUpdated: function viewportSizeUpdated() {
-    this.sendViewportUpdate(); // recompute displayport
-  },
-
-  observe: function(aSubject, aTopic, aData) {
-    switch (aTopic) {
-      case "before-first-paint":
-        // Is it on the top level?
-        let contentDocument = aSubject;
-        if (contentDocument == this.browser.contentDocument) {
-          if (BrowserApp.selectedTab == this) {
-            BrowserApp.contentDocumentChanged();
-          }
-          this.contentDocumentIsDisplayed = true;
-
-          if (contentDocument instanceof Ci.nsIImageDocument) {
-            contentDocument.shrinkToFit();
-          }
-
-          let zoom = this.restoredSessionZoom();
-          if (zoom) {
-            this.setResolution(zoom, true);
-          }
-        }
-        break;
-    }
-  },
-
-  // nsIBrowserTab
-  get window() {
-    if (!this.browser)
-      return null;
-    return this.browser.contentWindow;
-  },
-
-  get scale() {
-    return this._zoom;
-  },
-
-  QueryInterface: XPCOMUtils.generateQI([
-    Ci.nsIWebProgressListener,
-    Ci.nsISHistoryListener,
-    Ci.nsIObserver,
-    Ci.nsISupportsWeakReference,
-    Ci.nsIBrowserTab
-  ])
-};
-
-var BrowserEventHandler = {
-  init: function init() {
-    this._clickInZoomedView = false;
-    Services.obs.addObserver(this, "Gesture:SingleTap", false);
-    Services.obs.addObserver(this, "Gesture:ClickInZoomedView", false);
-
-    if (!AppConstants.MOZ_ANDROID_APZ) {
-      Services.obs.addObserver(this, "Gesture:CancelTouch", false);
-      Services.obs.addObserver(this, "Gesture:DoubleTap", false);
-      Services.obs.addObserver(this, "Gesture:Scroll", false);
-      Services.obs.addObserver(this, "dom-touch-listener-added", false);
-      BrowserApp.deck.addEventListener("touchstart", this, true);
-    } else {
-      BrowserApp.deck.addEventListener("touchend", this, true);
-    }
-
-    BrowserApp.deck.addEventListener("DOMUpdatePageReport", PopupBlockerObserver.onUpdatePageReport, false);
-    BrowserApp.deck.addEventListener("MozMouseHittest", this, true);
-
-    InitLater(() => BrowserApp.deck.addEventListener("click", InputWidgetHelper, true));
-    InitLater(() => BrowserApp.deck.addEventListener("click", SelectHelper, true));
-    if (AppConstants.NIGHTLY_BUILD) {
-      InitLater(() => BrowserApp.deck.addEventListener("InsecureLoginFormsStateChange", IdentityHandler.sendLoginInsecure, true));
-    }
-
-    // ReaderViews support backPress listeners.
-    Messaging.addListener(() => {
-      return Reader.onBackPress(BrowserApp.selectedTab.id);
-    }, "Browser:OnBackPressed");
-  },
-
-  handleEvent: function(aEvent) {
-    switch (aEvent.type) {
-      case 'touchstart':
-        this._handleTouchStart(aEvent);
-        break;
-      case 'touchend':
-        if (this._inCluster) {
-          aEvent.preventDefault();
-        }
-        break;
-      case 'MozMouseHittest':
-        this._handleRetargetedTouchStart(aEvent);
-        break;
-    }
-  },
-
-  _handleTouchStart: function(aEvent) {
-    if (!BrowserApp.isBrowserContentDocumentDisplayed() || aEvent.touches.length > 1 || aEvent.defaultPrevented)
-      return;
-
-    let target = aEvent.target;
-    if (!target) {
-      return;
-    }
-
-    // If we've pressed a scrollable element, let Java know that we may
-    // want to override the scroll behaviour (for document sub-frames)
-    this._scrollableElement = this._findScrollableElement(target, true);
-    this._firstScrollEvent = true;
-
-    if (this._scrollableElement != null) {
-      // Discard if it's the top-level scrollable, we let Java handle this
-      // The top-level scrollable is the body in quirks mode and the html element
-      // in standards mode
-      let doc = BrowserApp.selectedBrowser.contentDocument;
-      let rootScrollable = (doc.compatMode === "BackCompat" ? doc.body : doc.documentElement);
-      if (this._scrollableElement != rootScrollable) {
-        Messaging.sendRequest({ type: "Panning:Override" });
-      }
-    }
-  },
-
-  _handleRetargetedTouchStart: function(aEvent) {
-    // we should only get this called just after a new touchstart with a single
-    // touch point.
-    if (!BrowserApp.isBrowserContentDocumentDisplayed() || aEvent.defaultPrevented) {
-      return;
-    }
-
-    let target = aEvent.target;
-    if (!target) {
-      return;
-    }
-
-    this._inCluster = aEvent.hitCluster;
-    if (this._inCluster) {
-      return;  // No highlight for a cluster of links
-    }
-
-    let uri = this._getLinkURI(target);
-    if (uri) {
-      try {
-        Services.io.QueryInterface(Ci.nsISpeculativeConnect).speculativeConnect(uri, null);
-      } catch (e) {}
-    }
-    this._doTapHighlight(target);
-  },
-
-  _getLinkURI: function(aElement) {
-    if (aElement.nodeType == Ci.nsIDOMNode.ELEMENT_NODE &&
-        ((aElement instanceof Ci.nsIDOMHTMLAnchorElement && aElement.href) ||
-        (aElement instanceof Ci.nsIDOMHTMLAreaElement && aElement.href))) {
-      try {
-        return Services.io.newURI(aElement.href, null, null);
-      } catch (e) {}
-    }
-    return null;
-  },
-
-  observe: function(aSubject, aTopic, aData) {
-    if (aTopic == "dom-touch-listener-added") {
-      let tab = BrowserApp.getTabForWindow(aSubject.top);
-      if (!tab || tab.hasTouchListener)
-        return;
-
-      tab.hasTouchListener = true;
-      Messaging.sendRequest({
-        type: "Tab:HasTouchListener",
-        tabID: tab.id
-      });
-      return;
-    }
-
-    // the remaining events are all dependent on the browser content document being the
-    // same as the browser displayed document. if they are not the same, we should ignore
-    // the event.
-    if (BrowserApp.isBrowserContentDocumentDisplayed()) {
-      this.handleUserEvent(aTopic, aData);
-    }
-  },
-
-  handleUserEvent: function(aTopic, aData) {
-    switch (aTopic) {
-
-      case "Gesture:Scroll": {
-        // If we've lost our scrollable element, return. Don't cancel the
-        // override, as we probably don't want Java to handle panning until the
-        // user releases their finger.
-        if (this._scrollableElement == null)
-          return;
-
-        // If this is the first scroll event and we can't scroll in the direction
-        // the user wanted, and neither can any non-root sub-frame, cancel the
-        // override so that Java can handle panning the main document.
-        let data = JSON.parse(aData);
-
-        // round the scroll amounts because they come in as floats and might be
-        // subject to minor rounding errors because of zoom values. I've seen values
-        // like 0.99 come in here and get truncated to 0; this avoids that problem.
-        let zoom = BrowserApp.selectedTab._zoom;
-        let x = Math.round(data.x / zoom);
-        let y = Math.round(data.y / zoom);
-
-        if (this._firstScrollEvent) {
-          while (this._scrollableElement != null &&
-                 !this._elementCanScroll(this._scrollableElement, x, y))
-            this._scrollableElement = this._findScrollableElement(this._scrollableElement, false);
-
-          let doc = BrowserApp.selectedBrowser.contentDocument;
-          if (this._scrollableElement == null ||
-              this._scrollableElement == doc.documentElement) {
-            Messaging.sendRequest({ type: "Panning:CancelOverride" });
-            return;
-          }
-
-          this._firstScrollEvent = false;
-        }
-
-        // Scroll the scrollable element
-        if (this._elementCanScroll(this._scrollableElement, x, y)) {
-          this._scrollElementBy(this._scrollableElement, x, y);
-          Messaging.sendRequest({ type: "Gesture:ScrollAck", scrolled: true });
-          SelectionHandler.subdocumentScrolled(this._scrollableElement);
-        } else {
-          Messaging.sendRequest({ type: "Gesture:ScrollAck", scrolled: false });
-        }
-
-        break;
-      }
-
-      case "Gesture:CancelTouch":
-        this._cancelTapHighlight();
-        break;
-
-      case "Gesture:ClickInZoomedView":
-        this._clickInZoomedView = true;
-        break;
-
-      case "Gesture:SingleTap": {
-        let focusedElement = null;
-        try {
-          // If the element was previously focused, show the caret attached to it.
-          let element = this._highlightElement;
-          focusedElement = BrowserApp.getFocusedInput(BrowserApp.selectedBrowser);
-          if (element && element == focusedElement) {
-            let result = SelectionHandler.attachCaret(element);
-            if (result !== SelectionHandler.ERROR_NONE) {
-              dump("Unexpected failure during caret attach: " + result);
-            }
-          }
-        } catch(e) {
-          Cu.reportError(e);
-        }
-
-        let data = JSON.parse(aData);
-        let {x, y} = data;
-
-        if (this._inCluster && this._clickInZoomedView != true) {
-          // If there is a focused element, the display of the zoomed view won't remove the focus.
-          // In this case, the form assistant linked to the focused element will never be closed.
-          // To avoid this situation, the focus is moved and the form assistant is closed.
-          if (focusedElement) {
-            try {
-              Services.focus.moveFocus(BrowserApp.selectedBrowser.contentWindow, null, Services.focus.MOVEFOCUS_ROOT, 0);
-            } catch(e) {
-              Cu.reportError(e);
-            }
-            Messaging.sendRequest({ type: "FormAssist:Hide" });
-          }
-          this._clusterClicked(x, y);
-        } else {
-          if (this._clickInZoomedView != true) {
-            this._closeZoomedView();
-          }
-          if (!AppConstants.MOZ_ANDROID_APZ) {
-            // The _highlightElement was chosen after fluffing the touch events
-            // that led to this SingleTap, so by fluffing the mouse events, they
-            // should find the same target since we fluff them again below.
-            this._sendMouseEvent("mousemove", x, y);
-            this._sendMouseEvent("mousedown", x, y);
-            this._sendMouseEvent("mouseup",   x, y);
-          }
-        }
-        this._clickInZoomedView = false;
-        if (!AppConstants.MOZ_ANDROID_APZ) {
-          // scrollToFocusedInput does its own checks to find out if an element should be zoomed into
-          BrowserApp.scrollToFocusedInput(BrowserApp.selectedBrowser);
-        }
-
-        this._cancelTapHighlight();
-        break;
-      }
-
-      case"Gesture:DoubleTap":
-        this._cancelTapHighlight();
-        this.onDoubleTap(aData);
-        break;
-
-      default:
-        dump('BrowserEventHandler.handleUserEvent: unexpected topic "' + aTopic + '"');
-        break;
-    }
-  },
-
-  _closeZoomedView: function() {
-    Messaging.sendRequest({
-      type: "Gesture:CloseZoomedView"
-    });
-  },
-
-  _clusterClicked: function(aX, aY) {
-    Messaging.sendRequest({
-      type: "Gesture:clusteredLinksClicked",
-      clickPosition: {
-        x: aX,
-        y: aY
-      }
-    });
-  },
-
-  onDoubleTap: function(aData) {
-    let metadata = ViewportHandler.getMetadataForDocument(BrowserApp.selectedBrowser.contentDocument);
-    if (metadata && !metadata.allowDoubleTapZoom) {
-      return;
-    }
-
-    let data = JSON.parse(aData);
-    let element = ElementTouchHelper.anyElementFromPoint(data.x, data.y);
-
-    if (!element) {
-      ZoomHelper.zoomOut();
-      return;
-    }
-
-    while (element && !this._shouldZoomToElement(element))
-      element = element.parentNode;
-
-    if (!element) {
-      ZoomHelper.zoomOut();
-    } else {
-      ZoomHelper.zoomToElement(element, data.y);
-    }
-  },
-
-  _shouldZoomToElement: function(aElement) {
-    let win = aElement.ownerDocument.defaultView;
-    if (win.getComputedStyle(aElement, null).display == "inline")
-      return false;
-    if (aElement instanceof Ci.nsIDOMHTMLLIElement)
-      return false;
-    if (aElement instanceof Ci.nsIDOMHTMLQuoteElement)
-      return false;
-    return true;
-  },
-
-  _firstScrollEvent: false,
-
-  _scrollableElement: null,
-
-  _highlightElement: null,
-
-  _doTapHighlight: function _doTapHighlight(aElement) {
-    if (!AppConstants.MOZ_ANDROID_APZ) {
-      DOMUtils.setContentState(aElement, kStateActive);
-    }
-    this._highlightElement = aElement;
-  },
-
-  _cancelTapHighlight: function _cancelTapHighlight() {
-    if (!this._highlightElement)
-      return;
-
-    if (!AppConstants.MOZ_ANDROID_APZ) {
-      // If the active element is in a sub-frame, we need to make that frame's document
-      // active to remove the element's active state.
-      if (this._highlightElement.ownerDocument != BrowserApp.selectedBrowser.contentWindow.document)
-        DOMUtils.setContentState(this._highlightElement.ownerDocument.documentElement, kStateActive);
-
-      DOMUtils.setContentState(BrowserApp.selectedBrowser.contentWindow.document.documentElement, kStateActive);
-    }
-
-    this._highlightElement = null;
-  },
-
-  _updateLastPosition: function(x, y, dx, dy) {
-    this.lastX = x;
-    this.lastY = y;
-    this.lastTime = Date.now();
-
-    this.motionBuffer.push({ dx: dx, dy: dy, time: this.lastTime });
-  },
-
-  _sendMouseEvent: function _sendMouseEvent(aName, aX, aY) {
-    let win = BrowserApp.selectedBrowser.contentWindow;
-    try {
-      let cwu = win.top.QueryInterface(Ci.nsIInterfaceRequestor).getInterface(Ci.nsIDOMWindowUtils);
-      cwu.sendMouseEventToWindow(aName, aX, aY, 0, 1, 0, true, 0, Ci.nsIDOMMouseEvent.MOZ_SOURCE_TOUCH, false);
-    } catch(e) {
-      Cu.reportError(e);
-    }
-  },
-
-  _hasScrollableOverflow: function(elem) {
-    var win = elem.ownerDocument.defaultView;
-    if (!win)
-      return false;
-    var computedStyle = win.getComputedStyle(elem);
-    if (!computedStyle)
-      return false;
-    // We check for overflow:hidden only because all the other cases are scrollable
-    // under various conditions. See https://bugzilla.mozilla.org/show_bug.cgi?id=911574#c24
-    // for some more details.
-    return !(computedStyle.overflowX == 'hidden' && computedStyle.overflowY == 'hidden');
-  },
-
-  _findScrollableElement: function(elem, checkElem) {
-    // Walk the DOM tree until we find a scrollable element
-    let scrollable = false;
-    while (elem) {
-      /* Element is scrollable if its scroll-size exceeds its client size, and:
-       * - It has overflow other than 'hidden', or
-       * - It's a textarea node, or
-       * - It's a text input, or
-       * - It's a select element showing multiple rows
-       */
-      if (checkElem) {
-        if ((elem.scrollTopMin != elem.scrollTopMax ||
-             elem.scrollLeftMin != elem.scrollLeftMax) &&
-            (this._hasScrollableOverflow(elem) ||
-             elem.matches("textarea")) ||
-            (elem instanceof HTMLInputElement && elem.mozIsTextField(false)) ||
-            (elem instanceof HTMLSelectElement && (elem.size > 1 || elem.multiple))) {
-          scrollable = true;
-          break;
-        }
-      } else {
-        checkElem = true;
-      }
-
-      // Propagate up iFrames
-      if (!elem.parentNode && elem.documentElement && elem.documentElement.ownerDocument)
-        elem = elem.documentElement.ownerDocument.defaultView.frameElement;
-      else
-        elem = elem.parentNode;
-    }
-
-    if (!scrollable)
-      return null;
-
-    return elem;
-  },
-
-  _scrollElementBy: function(elem, x, y) {
-    elem.scrollTop = elem.scrollTop + y;
-    elem.scrollLeft = elem.scrollLeft + x;
-  },
-
-  _elementCanScroll: function(elem, x, y) {
-    let scrollX = (x < 0 && elem.scrollLeft > 0)
-               || (x > 0 && elem.scrollLeft < elem.scrollLeftMax);
-
-    let scrollY = (y < 0 && elem.scrollTop > 0)
-               || (y > 0 && elem.scrollTop < elem.scrollTopMax);
-
-    return scrollX || scrollY;
-  }
-};
-
-const ElementTouchHelper = {
-  /* Return the element at the given coordinates, starting from the given window and
-     drilling down through frames. If no window is provided, the top-level window of
-     the currently selected tab is used. The coordinates provided should be CSS pixels
-     relative to the window's scroll position. */
-  anyElementFromPoint: function(aX, aY, aWindow) {
-    let win = (aWindow ? aWindow : BrowserApp.selectedBrowser.contentWindow);
-    let cwu = win.QueryInterface(Ci.nsIInterfaceRequestor).getInterface(Ci.nsIDOMWindowUtils);
-    let elem = cwu.elementFromPoint(aX, aY, true, true);
-
-    while (elem && (elem instanceof HTMLIFrameElement || elem instanceof HTMLFrameElement)) {
-      let rect = elem.getBoundingClientRect();
-      aX -= rect.left;
-      aY -= rect.top;
-      cwu = elem.contentDocument.defaultView.QueryInterface(Ci.nsIInterfaceRequestor).getInterface(Ci.nsIDOMWindowUtils);
-      elem = cwu.elementFromPoint(aX, aY, true, true);
-    }
-
-    return elem;
-  },
-
-  /* Returns the touch radius with zoom factored in. */
-  getTouchRadius: function getTouchRadius() {
-    let zoom = BrowserApp.selectedTab._zoom;
-    return {
-      top: this.radius.top / zoom,
-      right: this.radius.right / zoom,
-      bottom: this.radius.bottom / zoom,
-      left: this.radius.left / zoom
-    };
-  },
-
-  /* Returns the touch radius in device pixels. */
-  get radius() {
-    let mmToIn = 1 / 25.4;
-    let mmToPx = mmToIn * ViewportHandler.displayDPI;
-    let prefs = Services.prefs;
-    delete this.radius;
-    return this.radius = { "top": prefs.getIntPref("ui.touch.radius.topmm") * mmToPx,
-                           "right": prefs.getIntPref("ui.touch.radius.rightmm") * mmToPx,
-                           "bottom": prefs.getIntPref("ui.touch.radius.bottommm") * mmToPx,
-                           "left": prefs.getIntPref("ui.touch.radius.leftmm") * mmToPx
-                         };
-  },
-
-  getBoundingContentRect: function(aElement) {
-    if (!aElement)
-      return {x: 0, y: 0, w: 0, h: 0};
-
-    let document = aElement.ownerDocument;
-    while (document.defaultView.frameElement)
-      document = document.defaultView.frameElement.ownerDocument;
-
-    let cwu = document.defaultView.QueryInterface(Ci.nsIInterfaceRequestor).getInterface(Ci.nsIDOMWindowUtils);
-    let scrollX = {}, scrollY = {};
-    cwu.getScrollXY(false, scrollX, scrollY);
-
-    let r = aElement.getBoundingClientRect();
-
-    // step out of iframes and frames, offsetting scroll values
-    for (let frame = aElement.ownerDocument.defaultView; frame.frameElement && frame != content; frame = frame.parent) {
-      // adjust client coordinates' origin to be top left of iframe viewport
-      let rect = frame.frameElement.getBoundingClientRect();
-      let left = frame.getComputedStyle(frame.frameElement, "").borderLeftWidth;
-      let top = frame.getComputedStyle(frame.frameElement, "").borderTopWidth;
-      scrollX.value += rect.left + parseInt(left);
-      scrollY.value += rect.top + parseInt(top);
-    }
-
-    return {x: r.left + scrollX.value,
-            y: r.top + scrollY.value,
-            w: r.width,
-            h: r.height };
-  }
-};
-
-var ErrorPageEventHandler = {
-  handleEvent: function(aEvent) {
-    switch (aEvent.type) {
-      case "click": {
-        // Don't trust synthetic events
-        if (!aEvent.isTrusted)
-          return;
-
-        let target = aEvent.originalTarget;
-        let errorDoc = target.ownerDocument;
-
-        // If the event came from an ssl error page, it is probably either the "Add
-        // Exception" or "Get me out of here!" button
-        if (errorDoc.documentURI.startsWith("about:certerror?e=nssBadCert")) {
-          let perm = errorDoc.getElementById("permanentExceptionButton");
-          let temp = errorDoc.getElementById("temporaryExceptionButton");
-          if (target == temp || target == perm) {
-            // Handle setting an cert exception and reloading the page
-            try {
-              // Add a new SSL exception for this URL
-              let uri = Services.io.newURI(errorDoc.location.href, null, null);
-              let sslExceptions = new SSLExceptions();
-
-              if (target == perm)
-                sslExceptions.addPermanentException(uri, errorDoc.defaultView);
-              else
-                sslExceptions.addTemporaryException(uri, errorDoc.defaultView);
-            } catch (e) {
-              dump("Failed to set cert exception: " + e + "\n");
-            }
-            errorDoc.location.reload();
-          } else if (target == errorDoc.getElementById("getMeOutOfHereButton")) {
-            errorDoc.location = "about:home";
-          }
-        } else if (errorDoc.documentURI.startsWith("about:blocked")) {
-          // The event came from a button on a malware/phishing block page
-          // First check whether it's malware, phishing or unwanted, so that we
-          // can use the right strings/links
-          let bucketName = "";
-          let sendTelemetry = false;
-          if (errorDoc.documentURI.contains("e=malwareBlocked")) {
-            sendTelemetry = true;
-            bucketName = "WARNING_MALWARE_PAGE_";
-          } else if (errorDoc.documentURI.contains("e=phishingBlocked")) {
-            sendTelemetry = true;
-            bucketName = "WARNING_PHISHING_PAGE_";
-          } else if (errorDoc.documentURI.contains("e=unwantedBlocked")) {
-            sendTelemetry = true;
-            bucketName = "WARNING_UNWANTED_PAGE_";
-          }
-          let nsISecTel = Ci.nsISecurityUITelemetry;
-          let isIframe = (errorDoc.defaultView.parent === errorDoc.defaultView);
-          bucketName += isIframe ? "TOP_" : "FRAME_";
-
-          let formatter = Cc["@mozilla.org/toolkit/URLFormatterService;1"].getService(Ci.nsIURLFormatter);
-
-          if (target == errorDoc.getElementById("getMeOutButton")) {
-            if (sendTelemetry) {
-              Telemetry.addData("SECURITY_UI", nsISecTel[bucketName + "GET_ME_OUT_OF_HERE"]);
-            }
-            errorDoc.location = "about:home";
-          } else if (target == errorDoc.getElementById("reportButton")) {
-            // We log even if malware/phishing info URL couldn't be found:
-            // the measurement is for how many users clicked the WHY BLOCKED button
-            if (sendTelemetry) {
-              Telemetry.addData("SECURITY_UI", nsISecTel[bucketName + "WHY_BLOCKED"]);
-            }
-
-            // This is the "Why is this site blocked" button. We redirect
-            // to the generic page describing phishing/malware protection.
-            let url = Services.urlFormatter.formatURLPref("app.support.baseURL");
-            BrowserApp.selectedBrowser.loadURI(url + "phishing-malware");
-          } else if (target == errorDoc.getElementById("ignoreWarningButton") &&
-                     Services.prefs.getBoolPref("browser.safebrowsing.allowOverride")) {
-            if (sendTelemetry) {
-              Telemetry.addData("SECURITY_UI", nsISecTel[bucketName + "IGNORE_WARNING"]);
-            }
-
-            // Allow users to override and continue through to the site,
-            let webNav = BrowserApp.selectedBrowser.docShell.QueryInterface(Ci.nsIWebNavigation);
-            let location = BrowserApp.selectedBrowser.contentWindow.location;
-            webNav.loadURI(location, Ci.nsIWebNavigation.LOAD_FLAGS_BYPASS_CLASSIFIER, null, null, null);
-
-            // ....but add a notify bar as a reminder, so that they don't lose
-            // track after, e.g., tab switching.
-            NativeWindow.doorhanger.show(Strings.browser.GetStringFromName("safeBrowsingDoorhanger"), "safebrowsing-warning", [], BrowserApp.selectedTab.id);
-          } else if (target == errorDoc.getElementById("whyForbiddenButton")) {
-            // This is the "Why is this site blocked" button for family friendly browsing.
-            BrowserApp.selectedBrowser.loadURI("https://support.mozilla.org/kb/controlledaccess");
-          }
-        }
-        break;
-      }
-    }
-  }
-};
-
-var FormAssistant = {
-  QueryInterface: XPCOMUtils.generateQI([Ci.nsIFormSubmitObserver]),
-
-  // Used to keep track of the element that corresponds to the current
-  // autocomplete suggestions
-  _currentInputElement: null,
-
-  // The value of the currently focused input
-  _currentInputValue: null,
-
-  // Whether we're in the middle of an autocomplete
-  _doingAutocomplete: false,
-
-  _isBlocklisted: false,
-
-  // Keep track of whether or not an invalid form has been submitted
-  _invalidSubmit: false,
-
-  init: function() {
-    Services.obs.addObserver(this, "FormAssist:AutoComplete", false);
-    Services.obs.addObserver(this, "FormAssist:Blocklisted", false);
-    Services.obs.addObserver(this, "FormAssist:Hidden", false);
-    Services.obs.addObserver(this, "FormAssist:Remove", false);
-    Services.obs.addObserver(this, "invalidformsubmit", false);
-    Services.obs.addObserver(this, "PanZoom:StateChange", false);
-
-    // We need to use a capturing listener for focus events
-    BrowserApp.deck.addEventListener("focus", this, true);
-    BrowserApp.deck.addEventListener("blur", this, true);
-    BrowserApp.deck.addEventListener("click", this, true);
-    BrowserApp.deck.addEventListener("input", this, false);
-    BrowserApp.deck.addEventListener("pageshow", this, false);
-  },
-
-  observe: function(aSubject, aTopic, aData) {
-    switch (aTopic) {
-      case "PanZoom:StateChange":
-        // If the user is just touching the screen and we haven't entered a pan or zoom state yet do nothing
-        if (aData == "TOUCHING" || aData == "WAITING_LISTENERS")
-          break;
-        if (aData == "NOTHING") {
-          // only look for input elements, not contentEditable or multiline text areas
-          let focused = BrowserApp.getFocusedInput(BrowserApp.selectedBrowser, true);
-          if (!focused)
-            break;
-
-          if (this._showValidationMessage(focused))
-            break;
-          let checkResultsClick = hasResults => {
-            if (!hasResults) {
-              this._hideFormAssistPopup();
-            }
-          };
-          this._showAutoCompleteSuggestions(focused, checkResultsClick);
-        } else {
-          // temporarily hide the form assist popup while we're panning or zooming the page
-          this._hideFormAssistPopup();
-        }
-        break;
-      case "FormAssist:AutoComplete":
-        if (!this._currentInputElement)
-          break;
-
-        let editableElement = this._currentInputElement.QueryInterface(Ci.nsIDOMNSEditableElement);
-
-        this._doingAutocomplete = true;
-
-        // If we have an active composition string, commit it before sending
-        // the autocomplete event with the text that will replace it.
-        try {
-          let imeEditor = editableElement.editor.QueryInterface(Ci.nsIEditorIMESupport);
-          if (imeEditor.composing)
-            imeEditor.forceCompositionEnd();
-        } catch (e) {}
-
-        editableElement.setUserInput(aData);
-        this._currentInputValue = aData;
-
-        let event = this._currentInputElement.ownerDocument.createEvent("Events");
-        event.initEvent("DOMAutoComplete", true, true);
-        this._currentInputElement.dispatchEvent(event);
-
-        this._doingAutocomplete = false;
-
-        break;
-
-      case "FormAssist:Blocklisted":
-        this._isBlocklisted = (aData == "true");
-        break;
-
-      case "FormAssist:Hidden":
-        this._currentInputElement = null;
-        break;
-
-      case "FormAssist:Remove":
-        if (!this._currentInputElement) {
-          break;
-        }
-
-        FormHistory.update({
-          op: "remove",
-          fieldname: this._currentInputElement.name,
-          value: aData
-        });
-        break;
-    }
-  },
-
-  notifyInvalidSubmit: function notifyInvalidSubmit(aFormElement, aInvalidElements) {
-    if (!aInvalidElements.length)
-      return;
-
-    // Ignore this notificaiton if the current tab doesn't contain the invalid form
-    if (BrowserApp.selectedBrowser.contentDocument !=
-        aFormElement.ownerDocument.defaultView.top.document)
-      return;
-
-    this._invalidSubmit = true;
-
-    // Our focus listener will show the element's validation message
-    let currentElement = aInvalidElements.queryElementAt(0, Ci.nsISupports);
-    currentElement.focus();
-  },
-
-  handleEvent: function(aEvent) {
-    switch (aEvent.type) {
-      case "focus": {
-        let currentElement = aEvent.target;
-
-        // Only show a validation message on focus.
-        this._showValidationMessage(currentElement);
-        break;
-      }
-
-      case "blur": {
-        this._currentInputValue = null;
-        break;
-      }
-
-      case "click": {
-        let currentElement = aEvent.target;
-
-        // Prioritize a form validation message over autocomplete suggestions
-        // when the element is first focused (a form validation message will
-        // only be available if an invalid form was submitted)
-        if (this._showValidationMessage(currentElement))
-          break;
-
-        let checkResultsClick = hasResults => {
-          if (!hasResults) {
-            this._hideFormAssistPopup();
-          }
-        };
-
-        this._showAutoCompleteSuggestions(currentElement, checkResultsClick);
-        break;
-      }
-
-      case "input": {
-        let currentElement = aEvent.target;
-
-        // If this element isn't focused, we're already in middle of an
-        // autocomplete, or its value hasn't changed, don't show the
-        // autocomplete popup.
-        if (currentElement !== BrowserApp.getFocusedInput(BrowserApp.selectedBrowser) ||
-            this._doingAutocomplete ||
-            currentElement.value === this._currentInputValue) {
-          break;
-        }
-
-        this._currentInputValue = currentElement.value;
-
-        // Since we can only show one popup at a time, prioritze autocomplete
-        // suggestions over a form validation message
-        let checkResultsInput = hasResults => {
-          if (hasResults)
-            return;
-
-          if (this._showValidationMessage(currentElement))
-            return;
-
-          // If we're not showing autocomplete suggestions, hide the form assist popup
-          this._hideFormAssistPopup();
-        };
-
-        this._showAutoCompleteSuggestions(currentElement, checkResultsInput);
-        break;
-      }
-
-      // Reset invalid submit state on each pageshow
-      case "pageshow": {
-        if (!this._invalidSubmit)
-          return;
-
-        let selectedBrowser = BrowserApp.selectedBrowser;
-        if (selectedBrowser) {
-          let selectedDocument = selectedBrowser.contentDocument;
-          let target = aEvent.originalTarget;
-          if (target == selectedDocument || target.ownerDocument == selectedDocument)
-            this._invalidSubmit = false;
-        }
-        break;
-      }
-    }
-  },
-
-  // We only want to show autocomplete suggestions for certain elements
-  _isAutoComplete: function _isAutoComplete(aElement) {
-    if (!(aElement instanceof HTMLInputElement) || aElement.readOnly || aElement.disabled ||
-        (aElement.getAttribute("type") == "password") ||
-        (aElement.hasAttribute("autocomplete") &&
-         aElement.getAttribute("autocomplete").toLowerCase() == "off"))
-      return false;
-
-    return true;
-  },
-
-  // Retrieves autocomplete suggestions for an element from the form autocomplete service.
-  // aCallback(array_of_suggestions) is called when results are available.
-  _getAutoCompleteSuggestions: function _getAutoCompleteSuggestions(aSearchString, aElement, aCallback) {
-    // Cache the form autocomplete service for future use
-    if (!this._formAutoCompleteService) {
-      this._formAutoCompleteService = Cc["@mozilla.org/satchel/form-autocomplete;1"]
-          .getService(Ci.nsIFormAutoComplete);
-    }
-
-    let resultsAvailable = function (results) {
-      let suggestions = [];
-      for (let i = 0; i < results.matchCount; i++) {
-        let value = results.getValueAt(i);
-
-        // Do not show the value if it is the current one in the input field
-        if (value == aSearchString)
-          continue;
-
-        // Supply a label and value, since they can differ for datalist suggestions
-        suggestions.push({ label: value, value: value });
-      }
-      aCallback(suggestions);
-    };
-
-    this._formAutoCompleteService.autoCompleteSearchAsync(aElement.name || aElement.id,
-                                                          aSearchString, aElement, null,
-                                                          null, resultsAvailable);
-  },
-
-  /**
-   * (Copied from mobile/xul/chrome/content/forms.js)
-   * This function is similar to getListSuggestions from
-   * components/satchel/src/nsInputListAutoComplete.js but sadly this one is
-   * used by the autocomplete.xml binding which is not in used in fennec
-   */
-  _getListSuggestions: function _getListSuggestions(aElement) {
-    if (!(aElement instanceof HTMLInputElement) || !aElement.list)
-      return [];
-
-    let suggestions = [];
-    let filter = !aElement.hasAttribute("mozNoFilter");
-    let lowerFieldValue = aElement.value.toLowerCase();
-
-    let options = aElement.list.options;
-    let length = options.length;
-    for (let i = 0; i < length; i++) {
-      let item = options.item(i);
-
-      let label = item.value;
-      if (item.label)
-        label = item.label;
-      else if (item.text)
-        label = item.text;
-
-      if (filter && !(label.toLowerCase().includes(lowerFieldValue)) )
-        continue;
-      suggestions.push({ label: label, value: item.value });
-    }
-
-    return suggestions;
-  },
-
-  // Retrieves autocomplete suggestions for an element from the form autocomplete service
-  // and sends the suggestions to the Java UI, along with element position data. As
-  // autocomplete queries are asynchronous, calls aCallback when done with a true
-  // argument if results were found and false if no results were found.
-  _showAutoCompleteSuggestions: function _showAutoCompleteSuggestions(aElement, aCallback) {
-    if (!this._isAutoComplete(aElement)) {
-      aCallback(false);
-      return;
-    }
-    if (this._isDisabledElement(aElement)) {
-      aCallback(false);
-      return;
-    }
-
-    // Don't display the form auto-complete popup after the user starts typing
-    // to avoid confusing somes IME. See bug 758820 and bug 632744.
-    if (this._isBlocklisted && aElement.value.length > 0) {
-      aCallback(false);
-      return;
-    }
-
-    let resultsAvailable = autoCompleteSuggestions => {
-      // On desktop, we show datalist suggestions below autocomplete suggestions,
-      // without duplicates removed.
-      let listSuggestions = this._getListSuggestions(aElement);
-      let suggestions = autoCompleteSuggestions.concat(listSuggestions);
-
-      // Return false if there are no suggestions to show
-      if (!suggestions.length) {
-        aCallback(false);
-        return;
-      }
-
-      Messaging.sendRequest({
-        type:  "FormAssist:AutoComplete",
-        suggestions: suggestions,
-        rect: ElementTouchHelper.getBoundingContentRect(aElement)
-      });
-
-      // Keep track of input element so we can fill it in if the user
-      // selects an autocomplete suggestion
-      this._currentInputElement = aElement;
-      aCallback(true);
-    };
-
-    this._getAutoCompleteSuggestions(aElement.value, aElement, resultsAvailable);
-  },
-
-  // Only show a validation message if the user submitted an invalid form,
-  // there's a non-empty message string, and the element is the correct type
-  _isValidateable: function _isValidateable(aElement) {
-    if (!this._invalidSubmit ||
-        !aElement.validationMessage ||
-        !(aElement instanceof HTMLInputElement ||
-          aElement instanceof HTMLTextAreaElement ||
-          aElement instanceof HTMLSelectElement ||
-          aElement instanceof HTMLButtonElement))
-      return false;
-
-    return true;
-  },
-
-  // Sends a validation message and position data for an element to the Java UI.
-  // Returns true if there's a validation message to show, false otherwise.
-  _showValidationMessage: function _sendValidationMessage(aElement) {
-    if (!this._isValidateable(aElement))
-      return false;
-
-    Messaging.sendRequest({
-      type: "FormAssist:ValidationMessage",
-      validationMessage: aElement.validationMessage,
-      rect: ElementTouchHelper.getBoundingContentRect(aElement)
-    });
-
-    return true;
-  },
-
-  _hideFormAssistPopup: function _hideFormAssistPopup() {
-    Messaging.sendRequest({ type: "FormAssist:Hide" });
-  },
-
-  _isDisabledElement : function(aElement) {
-    let currentElement = aElement;
-    while (currentElement) {
-      if(currentElement.disabled)
-	return true;
-
-      currentElement = currentElement.parentElement;
-    }
-    return false;
-  }
-};
-
-var XPInstallObserver = {
-  init: function() {
-    Services.obs.addObserver(this, "addon-install-origin-blocked", false);
-    Services.obs.addObserver(this, "addon-install-disabled", false);
-    Services.obs.addObserver(this, "addon-install-blocked", false);
-    Services.obs.addObserver(this, "addon-install-started", false);
-    Services.obs.addObserver(this, "xpi-signature-changed", false);
-    Services.obs.addObserver(this, "browser-delayed-startup-finished", false);
-
-    AddonManager.addInstallListener(this);
-  },
-
-  observe: function(aSubject, aTopic, aData) {
-    let installInfo, tab, host;
-    if (aSubject && aSubject instanceof Ci.amIWebInstallInfo) {
-      installInfo = aSubject;
-      tab = BrowserApp.getTabForBrowser(installInfo.browser);
-      if (installInfo.originatingURI) {
-        host = installInfo.originatingURI.host;
-      }
-    }
-
-    let strings = Strings.browser;
-    let brandShortName = Strings.brand.GetStringFromName("brandShortName");
-
-    switch (aTopic) {
-      case "addon-install-started":
-        Snackbars.show(strings.GetStringFromName("alertAddonsDownloading"), Snackbars.LENGTH_LONG);
-        break;
-      case "addon-install-disabled": {
-        if (!tab)
-          return;
-
-        let enabled = true;
-        try {
-          enabled = Services.prefs.getBoolPref("xpinstall.enabled");
-        } catch (e) {}
-
-        let buttons, message, callback;
-        if (!enabled) {
-          message = strings.GetStringFromName("xpinstallDisabledMessageLocked");
-          buttons = [strings.GetStringFromName("unsignedAddonsDisabled.dismiss")];
-          callback: (data) => {};
-        } else {
-          message = strings.formatStringFromName("xpinstallDisabledMessage2", [brandShortName, host], 2);
-          buttons = [
-              strings.GetStringFromName("xpinstallDisabledButton"),
-              strings.GetStringFromName("unsignedAddonsDisabled.dismiss")
-          ];
-          callback: (data) => {
-            if (data.button === 1) {
-              Services.prefs.setBoolPref("xpinstall.enabled", true)
-            }
-          };
-        }
-
-        new Prompt({
-          title: Strings.browser.GetStringFromName("addonError.titleError"),
-          message: message,
-          buttons: buttons
-        }).show(callback);
-        break;
-      }
-      case "addon-install-blocked": {
-        if (!tab)
-          return;
-
-        let message;
-        if (host) {
-          // We have a host which asked for the install.
-          message = strings.formatStringFromName("xpinstallPromptWarning2", [brandShortName, host], 2);
-        } else {
-          // Without a host we address the add-on as the initiator of the install.
-          let addon = null;
-          if (installInfo.installs.length > 0) {
-            addon = installInfo.installs[0].name;
-          }
-          if (addon) {
-            // We have an addon name, show the regular message.
-            message = strings.formatStringFromName("xpinstallPromptWarningLocal", [brandShortName, addon], 2);
-          } else {
-            // We don't have an addon name, show an alternative message.
-            message = strings.formatStringFromName("xpinstallPromptWarningDirect", [brandShortName], 1);
-          }
-        }
-
-        let buttons = [
-            strings.GetStringFromName("xpinstallPromptAllowButton"),
-            strings.GetStringFromName("unsignedAddonsDisabled.dismiss")
-        ];
-        new Prompt({
-          title: Strings.browser.GetStringFromName("addonError.titleBlocked"),
-          message: message,
-          buttons: buttons
-        }).show((data) => {
-          if (data.button === 0) {
-            // Kick off the install
-            installInfo.install();
-          }
-        });
-        break;
-      }
-      case "addon-install-origin-blocked": {
-        if (!tab)
-          return;
-
-        new Prompt({
-          title: Strings.browser.GetStringFromName("addonError.titleBlocked"),
-          message: strings.formatStringFromName("xpinstallPromptWarningDirect", [brandShortName], 1),
-          buttons: [strings.GetStringFromName("unsignedAddonsDisabled.dismiss")]
-        }).show((data) => {});
-        break;
-      }
-      case "xpi-signature-changed": {
-        if (JSON.parse(aData).disabled.length) {
-          this._notifyUnsignedAddonsDisabled();
-        }
-        break;
-      }
-      case "browser-delayed-startup-finished": {
-        let disabledAddons = AddonManager.getStartupChanges(AddonManager.STARTUP_CHANGE_DISABLED);
-        for (let id of disabledAddons) {
-          if (AddonManager.getAddonByID(id).signedState <= AddonManager.SIGNEDSTATE_MISSING) {
-            this._notifyUnsignedAddonsDisabled();
-            break;
-          }
-        }
-        break;
-      }
-    }
-  },
-
-  _notifyUnsignedAddonsDisabled: function() {
-    new Prompt({
-      window: window,
-      title: Strings.browser.GetStringFromName("unsignedAddonsDisabled.title"),
-      message: Strings.browser.GetStringFromName("unsignedAddonsDisabled.message"),
-      buttons: [
-        Strings.browser.GetStringFromName("unsignedAddonsDisabled.viewAddons"),
-        Strings.browser.GetStringFromName("unsignedAddonsDisabled.dismiss")
-      ]
-    }).show((data) => {
-      if (data.button === 0) {
-        // TODO: Open about:addons to show only unsigned add-ons?
-        BrowserApp.selectOrAddTab("about:addons", { parentId: BrowserApp.selectedTab.id });
-      }
-    });
-  },
-
-  onInstallEnded: function(aInstall, aAddon) {
-    // Don't create a notification for distribution add-ons.
-    if (Distribution.pendingAddonInstalls.has(aInstall)) {
-      Distribution.pendingAddonInstalls.delete(aInstall);
-      return;
-    }
-
-    let needsRestart = false;
-    if (aInstall.existingAddon && (aInstall.existingAddon.pendingOperations & AddonManager.PENDING_UPGRADE))
-      needsRestart = true;
-    else if (aAddon.pendingOperations & AddonManager.PENDING_INSTALL)
-      needsRestart = true;
-
-    if (needsRestart) {
-      this.showRestartPrompt();
-    } else {
-      // Display completion message for new installs or updates not done Automatically
-      if (!aInstall.existingAddon || !AddonManager.shouldAutoUpdate(aInstall.existingAddon)) {
-        let message = Strings.browser.GetStringFromName("alertAddonsInstalledNoRestart.message");
-        Snackbars.show(message, Snackbars.LENGTH_LONG, {
-          action: {
-            label: Strings.browser.GetStringFromName("alertAddonsInstalledNoRestart.action2"),
-            callback: () => {
-              UITelemetry.addEvent("show.1", "toast", null, "addons");
-              BrowserApp.selectOrAddTab("about:addons", { parentId: BrowserApp.selectedTab.id });
-            },
-          }
-        });
-      }
-    }
-  },
-
-  onInstallFailed: function(aInstall) {
-    this._showErrorMessage(aInstall);
-  },
-
-  onDownloadProgress: function(aInstall) {},
-
-  onDownloadFailed: function(aInstall) {
-    this._showErrorMessage(aInstall);
-  },
-
-  onDownloadCancelled: function(aInstall) {},
-
-  _showErrorMessage: function(aInstall) {
-    // Don't create a notification for distribution add-ons.
-    if (Distribution.pendingAddonInstalls.has(aInstall)) {
-      Cu.reportError("Error installing distribution add-on: " + aInstall.addon.id);
-      Distribution.pendingAddonInstalls.delete(aInstall);
-      return;
-    }
-
-    let host = (aInstall.originatingURI instanceof Ci.nsIStandardURL) && aInstall.originatingURI.host;
-    if (!host) {
-      host = (aInstall.sourceURI instanceof Ci.nsIStandardURL) && aInstall.sourceURI.host;
-    }
-
-    let error = (host || aInstall.error == 0) ? "addonError" : "addonLocalError";
-    if (aInstall.error < 0) {
-      error += aInstall.error;
-    } else if (aInstall.addon && aInstall.addon.blocklistState == Ci.nsIBlocklistService.STATE_BLOCKED) {
-      error += "Blocklisted";
-    } else {
-      error += "Incompatible";
-    }
-
-    let msg = Strings.browser.GetStringFromName(error);
-    // TODO: formatStringFromName
-    msg = msg.replace("#1", aInstall.name);
-    if (host) {
-      msg = msg.replace("#2", host);
-    }
-    msg = msg.replace("#3", Strings.brand.GetStringFromName("brandShortName"));
-    msg = msg.replace("#4", Services.appinfo.version);
-
-    if (aInstall.error == AddonManager.ERROR_SIGNEDSTATE_REQUIRED) {
-      new Prompt({
-        window: window,
-        title: Strings.browser.GetStringFromName("addonError.titleBlocked"),
-        message: msg,
-        buttons: [Strings.browser.GetStringFromName("addonError.learnMore")]
-      }).show((data) => {
-        if (data.button === 0) {
-          let url = Services.urlFormatter.formatURLPref("app.support.baseURL") + "unsigned-addons";
-          BrowserApp.addTab(url, { parentId: BrowserApp.selectedTab.id });
-        }
-      });
-    } else {
-      Services.prompt.alert(null, Strings.browser.GetStringFromName("addonError.titleError"), msg);
-    }
-  },
-
-  showRestartPrompt: function() {
-    let buttons = [{
-      label: Strings.browser.GetStringFromName("notificationRestart.button"),
-      callback: function() {
-        // Notify all windows that an application quit has been requested
-        let cancelQuit = Cc["@mozilla.org/supports-PRBool;1"].createInstance(Ci.nsISupportsPRBool);
-        Services.obs.notifyObservers(cancelQuit, "quit-application-requested", "restart");
-
-        // If nothing aborted, quit the app
-        if (cancelQuit.data == false) {
-          let appStartup = Cc["@mozilla.org/toolkit/app-startup;1"].getService(Ci.nsIAppStartup);
-          appStartup.quit(Ci.nsIAppStartup.eRestart | Ci.nsIAppStartup.eAttemptQuit);
-        }
-      },
-      positive: true
-    }];
-
-    let message = Strings.browser.GetStringFromName("notificationRestart.normal");
-    NativeWindow.doorhanger.show(message, "addon-app-restart", buttons, BrowserApp.selectedTab.id, { persistence: -1 });
-  },
-
-  hideRestartPrompt: function() {
-    NativeWindow.doorhanger.hide("addon-app-restart", BrowserApp.selectedTab.id);
-  }
-};
-
-// Blindly copied from Safari documentation for now.
-const kViewportMinScale  = 0;
-const kViewportMaxScale  = 10;
-const kViewportMinWidth  = 200;
-const kViewportMaxWidth  = 10000;
-const kViewportMinHeight = 223;
-const kViewportMaxHeight = 10000;
-
-var ViewportHandler = {
-  // The cached viewport metadata for each document. We tie viewport metadata to each document
-  // instead of to each tab so that we don't have to update it when the document changes. Using an
-  // ES6 weak map lets us avoid leaks.
-  _metadata: new WeakMap(),
-
-  init: function init() {
-    Services.obs.addObserver(this, "Window:Resize", false);
-    Services.obs.addObserver(this, "zoom-constraints-updated", false);
-  },
-
-  observe: function(aSubject, aTopic, aData) {
-    switch (aTopic) {
-      case "zoom-constraints-updated":
-        // aSubject should be a document, so let's find the tab corresponding
-        // to that if there is one
-        let constraints = JSON.parse(aData);
-        let doc = aSubject;
-        constraints.isRTL = doc.documentElement.dir == "rtl";
-        ViewportHandler.setMetadataForDocument(doc, constraints);
-        let tab = BrowserApp.getTabForWindow(doc.defaultView);
-        if (tab) {
-          constraints.type = "Tab:ViewportMetadata";
-          constraints.tabID = tab.id;
-          Messaging.sendRequest(constraints);
-        }
-        return;
-      case "Window:Resize":
-        if (window.outerWidth == gScreenWidth && window.outerHeight == gScreenHeight)
-          break;
-        if (window.outerWidth == 0 || window.outerHeight == 0)
-          break;
-
-        gScreenWidth = window.outerWidth * window.devicePixelRatio;
-        gScreenHeight = window.outerHeight * window.devicePixelRatio;
-        let tabs = BrowserApp.tabs;
-        for (let i = 0; i < tabs.length; i++) {
-          tabs[i].viewportSizeUpdated();
-        }
-        break;
-      default:
-        return;
-    }
-
-    if (aData) {
-      let scrollChange = JSON.parse(aData);
-      let windowUtils = window.QueryInterface(Ci.nsIInterfaceRequestor).getInterface(Ci.nsIDOMWindowUtils);
-      windowUtils.setNextPaintSyncId(scrollChange.id);
-      let win = BrowserApp.selectedTab.browser.contentWindow;
-      win.scrollBy(scrollChange.x, scrollChange.y);
-    }
-  },
-
-  /**
-   * Returns true if a viewport tag was specified
-   */
-  isViewportSpecified: function isViewportSpecified(aWindow) {
-    let tab = BrowserApp.getTabForWindow(aWindow);
-    let readerMode = false;
-    try {
-      readerMode = tab.browser.contentDocument.documentURI.startsWith("about:reader");
-    } catch (e) {
-    }
-    if (tab.desktopMode && !readerMode) {
-      return false;
-    }
-
-    let windowUtils = aWindow.QueryInterface(Ci.nsIInterfaceRequestor).getInterface(Ci.nsIDOMWindowUtils);
-    return !isNaN(parseFloat(windowUtils.getDocumentMetadata("viewport-initial-scale")))
-        || !isNaN(parseFloat(windowUtils.getDocumentMetadata("viewport-minimum-scale")))
-        || !isNaN(parseFloat(windowUtils.getDocumentMetadata("viewport-maximum-scale")))
-        || ("" != windowUtils.getDocumentMetadata("viewport-user-scalable"))
-        || ("" != windowUtils.getDocumentMetadata("viewport-width"))
-        || ("" != windowUtils.getDocumentMetadata("viewport-height"));
-  },
-
-  get displayDPI() {
-    let utils = window.QueryInterface(Ci.nsIInterfaceRequestor).getInterface(Ci.nsIDOMWindowUtils);
-    delete this.displayDPI;
-    return this.displayDPI = utils.displayDPI;
-  },
-
-  /**
-   * Returns the viewport metadata for the given document, or undefined if there
-   * isn't one.
-   */
-  getMetadataForDocument: function getMetadataForDocument(aDocument) {
-    return this._metadata.get(aDocument);
-  },
-
-  /** Updates the saved viewport metadata for the given content document. */
-  setMetadataForDocument: function setMetadataForDocument(aDocument, aMetadata) {
-    if (!aMetadata)
-      this._metadata.delete(aDocument);
-    else
-      this._metadata.set(aDocument, aMetadata);
-  }
-};
-
-/**
- * Handler for blocked popups, triggered by DOMUpdatePageReport events in browser.xml
- */
-var PopupBlockerObserver = {
-  onUpdatePageReport: function onUpdatePageReport(aEvent) {
-    let browser = BrowserApp.selectedBrowser;
-    if (aEvent.originalTarget != browser)
-      return;
-
-    if (!browser.pageReport)
-      return;
-
-    let result = Services.perms.testExactPermission(BrowserApp.selectedBrowser.currentURI, "popup");
-    if (result == Ci.nsIPermissionManager.DENY_ACTION)
-      return;
-
-    // Only show the notification again if we've not already shown it. Since
-    // notifications are per-browser, we don't need to worry about re-adding
-    // it.
-    if (!browser.pageReport.reported) {
-      if (Services.prefs.getBoolPref("privacy.popups.showBrowserMessage")) {
-        let brandShortName = Strings.brand.GetStringFromName("brandShortName");
-        let popupCount = browser.pageReport.length;
-
-        let strings = Strings.browser;
-        let message = PluralForm.get(popupCount, strings.GetStringFromName("popup.message"))
-                                .replace("#1", brandShortName)
-                                .replace("#2", popupCount);
-
-        let buttons = [
-          {
-            label: strings.GetStringFromName("popup.dontShow"),
-            callback: function(aChecked) {
-              if (aChecked)
-                PopupBlockerObserver.allowPopupsForSite(false);
-            }
-          },
-          {
-            label: strings.GetStringFromName("popup.show"),
-            callback: function(aChecked) {
-              // Set permission before opening popup windows
-              if (aChecked)
-                PopupBlockerObserver.allowPopupsForSite(true);
-
-              PopupBlockerObserver.showPopupsForSite();
-            },
-            positive: true
-          }
-        ];
-
-        let options = { checkbox: Strings.browser.GetStringFromName("popup.dontAskAgain") };
-        NativeWindow.doorhanger.show(message, "popup-blocked", buttons, null, options);
-      }
-      // Record the fact that we've reported this blocked popup, so we don't
-      // show it again.
-      browser.pageReport.reported = true;
-    }
-  },
-
-  allowPopupsForSite: function allowPopupsForSite(aAllow) {
-    let currentURI = BrowserApp.selectedBrowser.currentURI;
-    Services.perms.add(currentURI, "popup", aAllow
-                       ?  Ci.nsIPermissionManager.ALLOW_ACTION
-                       :  Ci.nsIPermissionManager.DENY_ACTION);
-    dump("Allowing popups for: " + currentURI);
-  },
-
-  showPopupsForSite: function showPopupsForSite() {
-    let uri = BrowserApp.selectedBrowser.currentURI;
-    let pageReport = BrowserApp.selectedBrowser.pageReport;
-    if (pageReport) {
-      for (let i = 0; i < pageReport.length; ++i) {
-        let popupURIspec = pageReport[i].popupWindowURI.spec;
-
-        // Sometimes the popup URI that we get back from the pageReport
-        // isn't useful (for instance, netscape.com's popup URI ends up
-        // being "http://www.netscape.com", which isn't really the URI of
-        // the popup they're trying to show).  This isn't going to be
-        // useful to the user, so we won't create a menu item for it.
-        if (popupURIspec == "" || popupURIspec == "about:blank" || popupURIspec == uri.spec)
-          continue;
-
-        let popupFeatures = pageReport[i].popupWindowFeatures;
-        let popupName = pageReport[i].popupWindowName;
-
-        let parent = BrowserApp.selectedTab;
-        let isPrivate = PrivateBrowsingUtils.isBrowserPrivate(parent.browser);
-        BrowserApp.addTab(popupURIspec, { parentId: parent.id, isPrivate: isPrivate });
-      }
-    }
-  }
-};
-
-
-var IndexedDB = {
-  _permissionsPrompt: "indexedDB-permissions-prompt",
-  _permissionsResponse: "indexedDB-permissions-response",
-
-  init: function IndexedDB_init() {
-    Services.obs.addObserver(this, this._permissionsPrompt, false);
-  },
-
-  observe: function IndexedDB_observe(subject, topic, data) {
-    if (topic != this._permissionsPrompt) {
-      throw new Error("Unexpected topic!");
-    }
-
-    let requestor = subject.QueryInterface(Ci.nsIInterfaceRequestor);
-
-    let browser = requestor.getInterface(Ci.nsIDOMNode);
-    let tab = BrowserApp.getTabForBrowser(browser);
-    if (!tab)
-      return;
-
-    let host = browser.currentURI.asciiHost;
-
-    let strings = Strings.browser;
-
-    let message, responseTopic;
-    if (topic == this._permissionsPrompt) {
-      message = strings.formatStringFromName("offlineApps.ask", [host], 1);
-      responseTopic = this._permissionsResponse;
-    }
-
-    const firstTimeoutDuration = 300000; // 5 minutes
-
-    let timeoutId;
-
-    let notificationID = responseTopic + host;
-    let observer = requestor.getInterface(Ci.nsIObserver);
-
-    // This will be set to the result of PopupNotifications.show() below, or to
-    // the result of PopupNotifications.getNotification() if this is a
-    // quotaCancel notification.
-    let notification;
-
-    function timeoutNotification() {
-      // Remove the notification.
-      NativeWindow.doorhanger.hide(notificationID, tab.id);
-
-      // Clear all of our timeout stuff. We may be called directly, not just
-      // when the timeout actually elapses.
-      clearTimeout(timeoutId);
-
-      // And tell the page that the popup timed out.
-      observer.observe(null, responseTopic, Ci.nsIPermissionManager.UNKNOWN_ACTION);
-    }
-
-    let buttons = [
-    {
-      label: strings.GetStringFromName("offlineApps.dontAllow2"),
-      callback: function(aChecked) {
-        clearTimeout(timeoutId);
-        let action = aChecked ? Ci.nsIPermissionManager.DENY_ACTION : Ci.nsIPermissionManager.UNKNOWN_ACTION;
-        observer.observe(null, responseTopic, action);
-      }
-    },
-    {
-      label: strings.GetStringFromName("offlineApps.allow"),
-      callback: function() {
-        clearTimeout(timeoutId);
-        observer.observe(null, responseTopic, Ci.nsIPermissionManager.ALLOW_ACTION);
-      },
-      positive: true
-    }];
-
-    let options = { checkbox: Strings.browser.GetStringFromName("offlineApps.dontAskAgain") };
-    NativeWindow.doorhanger.show(message, notificationID, buttons, tab.id, options);
-
-    // Set the timeoutId after the popup has been created, and use the long
-    // timeout value. If the user doesn't notice the popup after this amount of
-    // time then it is most likely not visible and we want to alert the page.
-    timeoutId = setTimeout(timeoutNotification, firstTimeoutDuration);
-  }
-};
-
-var CharacterEncoding = {
-  _charsets: [],
-
-  init: function init() {
-    Services.obs.addObserver(this, "CharEncoding:Get", false);
-    Services.obs.addObserver(this, "CharEncoding:Set", false);
-    InitLater(() => this.sendState());
-  },
-
-  observe: function observe(aSubject, aTopic, aData) {
-    switch (aTopic) {
-      case "CharEncoding:Get":
-        this.getEncoding();
-        break;
-      case "CharEncoding:Set":
-        this.setEncoding(aData);
-        break;
-    }
-  },
-
-  sendState: function sendState() {
-    let showCharEncoding = "false";
-    try {
-      showCharEncoding = Services.prefs.getComplexValue("browser.menu.showCharacterEncoding", Ci.nsIPrefLocalizedString).data;
-    } catch (e) { /* Optional */ }
-
-    Messaging.sendRequest({
-      type: "CharEncoding:State",
-      visible: showCharEncoding
-    });
-  },
-
-  getEncoding: function getEncoding() {
-    function infoToCharset(info) {
-      return { code: info.value, title: info.label };
-    }
-
-    if (!this._charsets.length) {
-      let data = CharsetMenu.getData();
-
-      // In the desktop UI, the pinned charsets are shown above the rest.
-      let pinnedCharsets = data.pinnedCharsets.map(infoToCharset);
-      let otherCharsets = data.otherCharsets.map(infoToCharset)
-
-      this._charsets = pinnedCharsets.concat(otherCharsets);
-    }
-
-    // Look for the index of the selected charset. Default to -1 if the
-    // doc charset isn't found in the list of available charsets.
-    let docCharset = BrowserApp.selectedBrowser.contentDocument.characterSet;
-    let selected = -1;
-    let charsetCount = this._charsets.length;
-
-    for (let i = 0; i < charsetCount; i++) {
-      if (this._charsets[i].code === docCharset) {
-        selected = i;
-        break;
-      }
-    }
-
-    Messaging.sendRequest({
-      type: "CharEncoding:Data",
-      charsets: this._charsets,
-      selected: selected
-    });
-  },
-
-  setEncoding: function setEncoding(aEncoding) {
-    let browser = BrowserApp.selectedBrowser;
-    browser.docShell.gatherCharsetMenuTelemetry();
-    browser.docShell.charset = aEncoding;
-    browser.reload(Ci.nsIWebNavigation.LOAD_FLAGS_CHARSET_CHANGE);
-  }
-};
-
-var IdentityHandler = {
-  // No trusted identity information. No site identity icon is shown.
-  IDENTITY_MODE_UNKNOWN: "unknown",
-
-  // Domain-Validation SSL CA-signed domain verification (DV).
-  IDENTITY_MODE_IDENTIFIED: "identified",
-
-  // Extended-Validation SSL CA-signed identity information (EV). A more rigorous validation process.
-  IDENTITY_MODE_VERIFIED: "verified",
-
-  // Part of the product's UI (built in about: pages)
-  IDENTITY_MODE_CHROMEUI: "chromeUI",
-
-  // The following mixed content modes are only used if "security.mixed_content.block_active_content"
-  // is enabled. Our Java frontend coalesces them into one indicator.
-
-  // No mixed content information. No mixed content icon is shown.
-  MIXED_MODE_UNKNOWN: "unknown",
-
-  // Blocked active mixed content.
-  MIXED_MODE_CONTENT_BLOCKED: "blocked",
-
-  // Loaded active mixed content.
-  MIXED_MODE_CONTENT_LOADED: "loaded",
-
-  // The following tracking content modes are only used if tracking protection
-  // is enabled. Our Java frontend coalesces them into one indicator.
-
-  // No tracking content information. No tracking content icon is shown.
-  TRACKING_MODE_UNKNOWN: "unknown",
-
-  // Blocked active tracking content. Shield icon is shown, with a popup option to load content.
-  TRACKING_MODE_CONTENT_BLOCKED: "tracking_content_blocked",
-
-  // Loaded active tracking content. Yellow triangle icon is shown.
-  TRACKING_MODE_CONTENT_LOADED: "tracking_content_loaded",
-
-  // Cache the most recent SSLStatus and Location seen in getIdentityStrings
-  _lastStatus : null,
-  _lastLocation : null,
-
-  /**
-   * Helper to parse out the important parts of _lastStatus (of the SSL cert in
-   * particular) for use in constructing identity UI strings
-  */
-  getIdentityData : function() {
-    let result = {};
-    let status = this._lastStatus.QueryInterface(Components.interfaces.nsISSLStatus);
-    let cert = status.serverCert;
-
-    // Human readable name of Subject
-    result.subjectOrg = cert.organization;
-
-    // SubjectName fields, broken up for individual access
-    if (cert.subjectName) {
-      result.subjectNameFields = {};
-      cert.subjectName.split(",").forEach(function(v) {
-        let field = v.split("=");
-        this[field[0]] = field[1];
-      }, result.subjectNameFields);
-
-      // Call out city, state, and country specifically
-      result.city = result.subjectNameFields.L;
-      result.state = result.subjectNameFields.ST;
-      result.country = result.subjectNameFields.C;
-    }
-
-    // Human readable name of Certificate Authority
-    result.caOrg =  cert.issuerOrganization || cert.issuerCommonName;
-    result.cert = cert;
-
-    return result;
-  },
-
-  /**
-   * Determines the identity mode corresponding to the icon we show in the urlbar.
-   */
-  getIdentityMode: function getIdentityMode(aState, uri) {
-    if (aState & Ci.nsIWebProgressListener.STATE_IDENTITY_EV_TOPLEVEL) {
-      return this.IDENTITY_MODE_VERIFIED;
-    }
-
-    if (aState & Ci.nsIWebProgressListener.STATE_IS_SECURE) {
-      return this.IDENTITY_MODE_IDENTIFIED;
-    }
-
-    // We also allow "about:" by allowing the selector to be empty (i.e. '(|.....|...|...)'
-    let whitelist = /^about:($|about|accounts|addons|buildconfig|cache|config|crashes|devices|downloads|fennec|firefox|feedback|healthreport|license|logins|logo|memory|mozilla|networking|plugins|privatebrowsing|rights|serviceworkers|support|telemetry|webrtc)($|\?)/i;
-    if (uri.schemeIs("about") && whitelist.test(uri.spec)) {
-        return this.IDENTITY_MODE_CHROMEUI;
-    }
-
-    return this.IDENTITY_MODE_UNKNOWN;
-  },
-
-  getMixedDisplayMode: function getMixedDisplayMode(aState) {
-    if (aState & Ci.nsIWebProgressListener.STATE_LOADED_MIXED_DISPLAY_CONTENT) {
-        return this.MIXED_MODE_CONTENT_LOADED;
-    }
-
-    if (aState & Ci.nsIWebProgressListener.STATE_BLOCKED_MIXED_DISPLAY_CONTENT) {
-        return this.MIXED_MODE_CONTENT_BLOCKED;
-    }
-
-    return this.MIXED_MODE_UNKNOWN;
-  },
-
-  getMixedActiveMode: function getActiveDisplayMode(aState) {
-    // Only show an indicator for loaded mixed content if the pref to block it is enabled
-    if ((aState & Ci.nsIWebProgressListener.STATE_LOADED_MIXED_ACTIVE_CONTENT) &&
-         !Services.prefs.getBoolPref("security.mixed_content.block_active_content")) {
-      return this.MIXED_MODE_CONTENT_LOADED;
-    }
-
-    if (aState & Ci.nsIWebProgressListener.STATE_BLOCKED_MIXED_ACTIVE_CONTENT) {
-      return this.MIXED_MODE_CONTENT_BLOCKED;
-    }
-
-    return this.MIXED_MODE_UNKNOWN;
-  },
-
-  getTrackingMode: function getTrackingMode(aState, aBrowser) {
-    if (aState & Ci.nsIWebProgressListener.STATE_BLOCKED_TRACKING_CONTENT) {
-      this.shieldHistogramAdd(aBrowser, 2);
-      return this.TRACKING_MODE_CONTENT_BLOCKED;
-    }
-
-    // Only show an indicator for loaded tracking content if the pref to block it is enabled
-    let tpEnabled = Services.prefs.getBoolPref("privacy.trackingprotection.enabled") ||
-                    (Services.prefs.getBoolPref("privacy.trackingprotection.pbmode.enabled") &&
-                     PrivateBrowsingUtils.isBrowserPrivate(aBrowser));
-
-    if ((aState & Ci.nsIWebProgressListener.STATE_LOADED_TRACKING_CONTENT) && tpEnabled) {
-      this.shieldHistogramAdd(aBrowser, 1);
-      return this.TRACKING_MODE_CONTENT_LOADED;
-    }
-
-    this.shieldHistogramAdd(aBrowser, 0);
-    return this.TRACKING_MODE_UNKNOWN;
-  },
-
-  sendLoginInsecure: function sendLoginInsecure() {
-    let loginInsecure = LoginManagerParent.hasInsecureLoginForms(BrowserApp.selectedBrowser);
-        if (loginInsecure) {
-          let message = {
-            type: "Content:LoginInsecure",
-            tabID: BrowserApp.selectedTab.id
-          };
-          Messaging.sendRequest(message);
-        }
-    },
-
-
-  shieldHistogramAdd: function(browser, value) {
-    if (PrivateBrowsingUtils.isBrowserPrivate(browser)) {
-      return;
-    }
-    Telemetry.addData("TRACKING_PROTECTION_SHIELD", value);
-  },
-
-  /**
-   * Determine the identity of the page being displayed by examining its SSL cert
-   * (if available). Return the data needed to update the UI.
-   */
-  checkIdentity: function checkIdentity(aState, aBrowser) {
-    this._lastStatus = aBrowser.securityUI
-                               .QueryInterface(Components.interfaces.nsISSLStatusProvider)
-                               .SSLStatus;
-
-    // Don't pass in the actual location object, since it can cause us to
-    // hold on to the window object too long.  Just pass in the fields we
-    // care about. (bug 424829)
-    let locationObj = {};
-    try {
-      let location = aBrowser.contentWindow.location;
-      locationObj.host = location.host;
-      locationObj.hostname = location.hostname;
-      locationObj.port = location.port;
-      locationObj.origin = location.origin;
-    } catch (ex) {
-      // Can sometimes throw if the URL being visited has no host/hostname,
-      // e.g. about:blank. The _state for these pages means we won't need these
-      // properties anyways, though.
-    }
-    this._lastLocation = locationObj;
-
-    let uri = aBrowser.currentURI;
-    try {
-      uri = Services.uriFixup.createExposableURI(uri);
-    } catch (e) {}
-
-    let identityMode = this.getIdentityMode(aState, uri);
-    let mixedDisplay = this.getMixedDisplayMode(aState);
-    let mixedActive = this.getMixedActiveMode(aState);
-    let trackingMode = this.getTrackingMode(aState, aBrowser);
-    let result = {
-      origin: locationObj.origin,
-      mode: {
-        identity: identityMode,
-        mixed_display: mixedDisplay,
-        mixed_active: mixedActive,
-        tracking: trackingMode
-      }
-    };
-
-    // Don't show identity data for pages with an unknown identity or if any
-    // mixed content is loaded (mixed display content is loaded by default).
-    // We also return for CHROMEUI pages since they don't have any certificate
-    // information to load either. result.secure specifically refers to connection
-    // security, which is irrelevant for about: pages, as they're loaded locally.
-    if (identityMode == this.IDENTITY_MODE_UNKNOWN ||
-        identityMode == this.IDENTITY_MODE_CHROMEUI ||
-        aState & Ci.nsIWebProgressListener.STATE_IS_BROKEN) {
-      result.secure = false;
-      return result;
-    }
-
-    result.secure = true;
-
-    result.host = this.getEffectiveHost();
-
-    let iData = this.getIdentityData();
-    result.verifier = Strings.browser.formatStringFromName("identity.identified.verifier", [iData.caOrg], 1);
-
-    // If the cert is identified, then we can populate the results with credentials
-    if (aState & Ci.nsIWebProgressListener.STATE_IDENTITY_EV_TOPLEVEL) {
-      result.owner = iData.subjectOrg;
-
-      // Build an appropriate supplemental block out of whatever location data we have
-      let supplemental = "";
-      if (iData.city)
-        supplemental += iData.city + "\n";
-      if (iData.state && iData.country)
-        supplemental += Strings.browser.formatStringFromName("identity.identified.state_and_country", [iData.state, iData.country], 2);
-      else if (iData.state) // State only
-        supplemental += iData.state;
-      else if (iData.country) // Country only
-        supplemental += iData.country;
-      result.supplemental = supplemental;
-
-      return result;
-    }
-
-    // Cache the override service the first time we need to check it
-    if (!this._overrideService)
-      this._overrideService = Cc["@mozilla.org/security/certoverride;1"].getService(Ci.nsICertOverrideService);
-
-    // Check whether this site is a security exception. XPConnect does the right
-    // thing here in terms of converting _lastLocation.port from string to int, but
-    // the overrideService doesn't like undefined ports, so make sure we have
-    // something in the default case (bug 432241).
-    // .hostname can return an empty string in some exceptional cases -
-    // hasMatchingOverride does not handle that, so avoid calling it.
-    // Updating the tooltip value in those cases isn't critical.
-    // FIXME: Fixing bug 646690 would probably makes this check unnecessary
-    if (this._lastLocation.hostname &&
-        this._overrideService.hasMatchingOverride(this._lastLocation.hostname,
-                                                  (this._lastLocation.port || 443),
-                                                  iData.cert, {}, {}))
-      result.verifier = Strings.browser.GetStringFromName("identity.identified.verified_by_you");
-
-    return result;
-  },
-
-  /**
-   * Attempt to provide proper IDN treatment for host names
-   */
-  getEffectiveHost: function getEffectiveHost() {
-    if (!this._IDNService)
-      this._IDNService = Cc["@mozilla.org/network/idn-service;1"]
-                         .getService(Ci.nsIIDNService);
-    try {
-      return this._IDNService.convertToDisplayIDN(this._uri.host, {});
-    } catch (e) {
-      // If something goes wrong (e.g. hostname is an IP address) just fail back
-      // to the full domain.
-      return this._lastLocation.hostname;
-    }
-  }
-};
-
-function OverscrollController(aTab) {
-  this.tab = aTab;
-}
-
-OverscrollController.prototype = {
-  supportsCommand : function supportsCommand(aCommand) {
-    if (aCommand != "cmd_linePrevious" && aCommand != "cmd_scrollPageUp")
-      return false;
-
-    return (this.tab.getViewport().y == 0);
-  },
-
-  isCommandEnabled : function isCommandEnabled(aCommand) {
-    return this.supportsCommand(aCommand);
-  },
-
-  doCommand : function doCommand(aCommand){
-    Messaging.sendRequest({ type: "ToggleChrome:Focus" });
-  },
-
-  onEvent : function onEvent(aEvent) { }
-};
-
-var SearchEngines = {
-  _contextMenuId: null,
-  PREF_SUGGEST_ENABLED: "browser.search.suggest.enabled",
-  PREF_SUGGEST_PROMPTED: "browser.search.suggest.prompted",
-
-  // Shared preference key used for search activity default engine.
-  PREF_SEARCH_ACTIVITY_ENGINE_KEY: "search.engines.defaultname",
-
-  init: function init() {
-    Services.obs.addObserver(this, "SearchEngines:Add", false);
-    Services.obs.addObserver(this, "SearchEngines:GetVisible", false);
-    Services.obs.addObserver(this, "SearchEngines:Remove", false);
-    Services.obs.addObserver(this, "SearchEngines:RestoreDefaults", false);
-    Services.obs.addObserver(this, "SearchEngines:SetDefault", false);
-    Services.obs.addObserver(this, "browser-search-engine-modified", false);
-  },
-
-  // Fetch list of search engines. all ? All engines : Visible engines only.
-  _handleSearchEnginesGetVisible: function _handleSearchEnginesGetVisible(rv, all) {
-    if (!Components.isSuccessCode(rv)) {
-      Cu.reportError("Could not initialize search service, bailing out.");
-      return;
-    }
-
-    let engineData = Services.search.getVisibleEngines({});
-
-    // Our Java UI assumes that the default engine is the first item in the array,
-    // so we need to make sure that's the case.
-    if (engineData[0] !== Services.search.defaultEngine) {
-      engineData = engineData.filter(engine => engine !== Services.search.defaultEngine);
-      engineData.unshift(Services.search.defaultEngine);
-    }
-
-    let searchEngines = engineData.map(function (engine) {
-      return {
-        name: engine.name,
-        identifier: engine.identifier,
-        iconURI: (engine.iconURI ? engine.iconURI.spec : null),
-        hidden: engine.hidden
-      };
-    });
-
-    let suggestTemplate = null;
-    let suggestEngine = null;
-
-    // Check to see if the default engine supports search suggestions. We only need to check
-    // the default engine because we only show suggestions for the default engine in the UI.
-    let engine = Services.search.defaultEngine;
-    if (engine.supportsResponseType("application/x-suggestions+json")) {
-      suggestEngine = engine.name;
-      suggestTemplate = engine.getSubmission("__searchTerms__", "application/x-suggestions+json").uri.spec;
-    }
-
-    // By convention, the currently configured default engine is at position zero in searchEngines.
-    Messaging.sendRequest({
-      type: "SearchEngines:Data",
-      searchEngines: searchEngines,
-      suggest: {
-        engine: suggestEngine,
-        template: suggestTemplate,
-        enabled: Services.prefs.getBoolPref(this.PREF_SUGGEST_ENABLED),
-        prompted: Services.prefs.getBoolPref(this.PREF_SUGGEST_PROMPTED)
-      }
-    });
-
-    // Send a speculative connection to the default engine.
-    Services.search.defaultEngine.speculativeConnect({window: window});
-  },
-
-  // Helper method to extract the engine name from a JSON. Simplifies the observe function.
-  _extractEngineFromJSON: function _extractEngineFromJSON(aData) {
-    let data = JSON.parse(aData);
-    return Services.search.getEngineByName(data.engine);
-  },
-
-  observe: function observe(aSubject, aTopic, aData) {
-    let engine;
-    switch(aTopic) {
-      case "SearchEngines:Add":
-        this.displaySearchEnginesList(aData);
-        break;
-      case "SearchEngines:GetVisible":
-        Services.search.init(this._handleSearchEnginesGetVisible.bind(this));
-        break;
-      case "SearchEngines:Remove":
-        // Make sure the engine isn't hidden before removing it, to make sure it's
-        // visible if the user later re-adds it (works around bug 341833)
-        engine = this._extractEngineFromJSON(aData);
-        engine.hidden = false;
-        Services.search.removeEngine(engine);
-        break;
-      case "SearchEngines:RestoreDefaults":
-        // Un-hides all default engines.
-        Services.search.restoreDefaultEngines();
-        break;
-      case "SearchEngines:SetDefault":
-        engine = this._extractEngineFromJSON(aData);
-        // Move the new default search engine to the top of the search engine list.
-        Services.search.moveEngine(engine, 0);
-        Services.search.defaultEngine = engine;
-        break;
-      case "browser-search-engine-modified":
-        if (aData == "engine-default") {
-          this._setSearchActivityDefaultPref(aSubject.QueryInterface(Ci.nsISearchEngine));
-        }
-        break;
-      default:
-        dump("Unexpected message type observed: " + aTopic);
-        break;
-    }
-  },
-
-  migrateSearchActivityDefaultPref: function migrateSearchActivityDefaultPref() {
-    Services.search.init(() => this._setSearchActivityDefaultPref(Services.search.defaultEngine));
-  },
-
-  // Updates the search activity pref when the default engine changes.
-  _setSearchActivityDefaultPref: function _setSearchActivityDefaultPref(engine) {
-    SharedPreferences.forApp().setCharPref(this.PREF_SEARCH_ACTIVITY_ENGINE_KEY, engine.name);
-  },
-
-  // Display context menu listing names of the search engines available to be added.
-  displaySearchEnginesList: function displaySearchEnginesList(aData) {
-    let data = JSON.parse(aData);
-    let tab = BrowserApp.getTabForId(data.tabId);
-
-    if (!tab)
-      return;
-
-    let browser = tab.browser;
-    let engines = browser.engines;
-
-    let p = new Prompt({
-      window: browser.contentWindow
-    }).setSingleChoiceItems(engines.map(function(e) {
-      return { label: e.title };
-    })).show((function(data) {
-      if (data.button == -1)
-        return;
-
-      this.addOpenSearchEngine(engines[data.button]);
-      engines.splice(data.button, 1);
-
-      if (engines.length < 1) {
-        // Broadcast message that there are no more add-able search engines.
-        let newEngineMessage = {
-          type: "Link:OpenSearch",
-          tabID: tab.id,
-          visible: false
-        };
-
-        Messaging.sendRequest(newEngineMessage);
-      }
-    }).bind(this));
-  },
-
-  addOpenSearchEngine: function addOpenSearchEngine(engine) {
-    Services.search.addEngine(engine.url, Ci.nsISearchEngine.DATA_XML, engine.iconURL, false, {
-      onSuccess: function() {
-        // Display a toast confirming addition of new search engine.
-        Snackbars.show(Strings.browser.formatStringFromName("alertSearchEngineAddedToast", [engine.title], 1), Snackbars.LENGTH_LONG);
-      },
-
-      onError: function(aCode) {
-        let errorMessage;
-        if (aCode == 2) {
-          // Engine is a duplicate.
-          errorMessage = "alertSearchEngineDuplicateToast";
-
-        } else {
-          // Unknown failure. Display general error message.
-          errorMessage = "alertSearchEngineErrorToast";
-        }
-
-        Snackbars.show(Strings.browser.formatStringFromName(errorMessage, [engine.title], 1), Snackbars.LENGTH_LONG);
-      }
-    });
-  },
-
-  addEngine: function addEngine(aElement) {
-    let form = aElement.form;
-    let charset = aElement.ownerDocument.characterSet;
-    let docURI = Services.io.newURI(aElement.ownerDocument.URL, charset, null);
-    let formURL = Services.io.newURI(form.getAttribute("action"), charset, docURI).spec;
-    let method = form.method.toUpperCase();
-    let formData = [];
-
-    for (let i = 0; i < form.elements.length; ++i) {
-      let el = form.elements[i];
-      if (!el.type)
-        continue;
-
-      // make this text field a generic search parameter
-      if (aElement == el) {
-        formData.push({ name: el.name, value: "{searchTerms}" });
-        continue;
-      }
-
-      let type = el.type.toLowerCase();
-      let escapedName = escape(el.name);
-      let escapedValue = escape(el.value);
-
-      // add other form elements as parameters
-      switch (el.type) {
-        case "checkbox":
-        case "radio":
-          if (!el.checked) break;
-        case "text":
-        case "hidden":
-        case "textarea":
-          formData.push({ name: escapedName, value: escapedValue });
-          break;
-        case "select-one":
-          for (let option of el.options) {
-            if (option.selected) {
-              formData.push({ name: escapedName, value: escapedValue });
-              break;
-            }
-          }
-      }
-    }
-
-    // prompt user for name of search engine
-    let promptTitle = Strings.browser.GetStringFromName("contextmenu.addSearchEngine2");
-    let title = { value: (aElement.ownerDocument.title || docURI.host) };
-    if (!Services.prompt.prompt(null, promptTitle, null, title, null, {}))
-      return;
-
-    // fetch the favicon for this page
-    let dbFile = FileUtils.getFile("ProfD", ["browser.db"]);
-    let mDBConn = Services.storage.openDatabase(dbFile);
-    let stmts = [];
-    stmts[0] = mDBConn.createStatement("SELECT favicon FROM history_with_favicons WHERE url = ?");
-    stmts[0].bindByIndex(0, docURI.spec);
-    let favicon = null;
-    Services.search.init(function addEngine_cb(rv) {
-      if (!Components.isSuccessCode(rv)) {
-        Cu.reportError("Could not initialize search service, bailing out.");
-        return;
-      }
-      mDBConn.executeAsync(stmts, stmts.length, {
-        handleResult: function (results) {
-          let bytes = results.getNextRow().getResultByName("favicon");
-          if (bytes && bytes.length) {
-            favicon = "data:image/x-icon;base64," + btoa(String.fromCharCode.apply(null, bytes));
-          }
-        },
-        handleCompletion: function (reason) {
-          // if there's already an engine with this name, add a number to
-          // make the name unique (e.g., "Google" becomes "Google 2")
-          let name = title.value;
-          for (let i = 2; Services.search.getEngineByName(name); i++)
-            name = title.value + " " + i;
-
-          Services.search.addEngineWithDetails(name, favicon, null, null, method, formURL);
-          Snackbars.show(Strings.browser.formatStringFromName("alertSearchEngineAddedToast", [name], 1), Snackbars.LENGTH_LONG);
-          let engine = Services.search.getEngineByName(name);
-          engine.wrappedJSObject._queryCharset = charset;
-          for (let i = 0; i < formData.length; ++i) {
-            let param = formData[i];
-            if (param.name && param.value)
-              engine.addParam(param.name, param.value, null);
-          }
-        }
-      });
-    });
-  }
-};
-
-var ActivityObserver = {
-  init: function ao_init() {
-    Services.obs.addObserver(this, "application-background", false);
-    Services.obs.addObserver(this, "application-foreground", false);
-  },
-
-  observe: function ao_observe(aSubject, aTopic, aData) {
-    let isForeground = false;
-    let tab = BrowserApp.selectedTab;
-
-    UITelemetry.addEvent("show.1", "system", null, aTopic);
-
-    switch (aTopic) {
-      case "application-background" :
-        let doc = (tab ? tab.browser.contentDocument : null);
-        if (doc && doc.mozFullScreen) {
-          doc.mozCancelFullScreen();
-        }
-        isForeground = false;
-        break;
-      case "application-foreground" :
-        isForeground = true;
-        break;
-    }
-
-    if (tab && tab.getActive() != isForeground) {
-      tab.setActive(isForeground);
-    }
-  }
-};
-
-var Telemetry = {
-  addData: function addData(aHistogramId, aValue) {
-    let histogram = Services.telemetry.getHistogramById(aHistogramId);
-    histogram.add(aValue);
-  },
-};
-
-var Experiments = {
-  // Enable malware download protection (bug 936041)
-  MALWARE_DOWNLOAD_PROTECTION: "malware-download-protection",
-
-  // Try to load pages from disk cache when network is offline (bug 935190)
-  OFFLINE_CACHE: "offline-cache",
-
-  init() {
-    Messaging.sendRequestForResult({
-      type: "Experiments:GetActive"
-    }).then(experiments => {
-      let names = JSON.parse(experiments);
-      for (let name of names) {
-        switch (name) {
-          case this.MALWARE_DOWNLOAD_PROTECTION: {
-            // Apply experiment preferences on the default branch. This allows
-            // us to avoid migrating user prefs when experiments are enabled/disabled,
-            // and it also allows users to override these prefs in about:config.
-            let defaults = Services.prefs.getDefaultBranch(null);
-            defaults.setBoolPref("browser.safebrowsing.downloads.enabled", true);
-            defaults.setBoolPref("browser.safebrowsing.downloads.remote.enabled", true);
-            continue;
-          }
-
-          case this.OFFLINE_CACHE: {
-            let defaults = Services.prefs.getDefaultBranch(null);
-            defaults.setBoolPref("browser.tabs.useCache", true);
-            continue;
-          }
-        }
-      }
-    });
-  }
-};
-
-var ExternalApps = {
-  _contextMenuId: null,
-
-  // extend _getLink to pickup html5 media links.
-  _getMediaLink: function(aElement) {
-    let uri = NativeWindow.contextmenus._getLink(aElement);
-    if (uri == null && aElement.nodeType == Ci.nsIDOMNode.ELEMENT_NODE && (aElement instanceof Ci.nsIDOMHTMLMediaElement)) {
-      try {
-        let mediaSrc = aElement.currentSrc || aElement.src;
-        uri = ContentAreaUtils.makeURI(mediaSrc, null, null);
-      } catch (e) {}
-    }
-    return uri;
-  },
-
-  init: function helper_init() {
-    this._contextMenuId = NativeWindow.contextmenus.add(function(aElement) {
-      let uri = null;
-      var node = aElement;
-      while (node && !uri) {
-        uri = ExternalApps._getMediaLink(node);
-        node = node.parentNode;
-      }
-      let apps = [];
-      if (uri)
-        apps = HelperApps.getAppsForUri(uri);
-
-      return apps.length == 1 ? Strings.browser.formatStringFromName("helperapps.openWithApp2", [apps[0].name], 1) :
-                                Strings.browser.GetStringFromName("helperapps.openWithList2");
-    }, this.filter, this.openExternal);
-  },
-
-  filter: {
-    matches: function(aElement) {
-      let uri = ExternalApps._getMediaLink(aElement);
-      let apps = [];
-      if (uri) {
-        apps = HelperApps.getAppsForUri(uri);
-      }
-      return apps.length > 0;
-    }
-  },
-
-  openExternal: function(aElement) {
-    if (aElement.pause) {
-      aElement.pause();
-    }
-    let uri = ExternalApps._getMediaLink(aElement);
-    HelperApps.launchUri(uri);
-  },
-
-  shouldCheckUri: function(uri) {
-    if (!(uri.schemeIs("http") || uri.schemeIs("https") || uri.schemeIs("file"))) {
-      return false;
-    }
-
-    return true;
-  },
-
-  updatePageAction: function updatePageAction(uri, contentDocument) {
-    HelperApps.getAppsForUri(uri, { filterHttp: true }, (apps) => {
-      this.clearPageAction();
-      if (apps.length > 0)
-        this._setUriForPageAction(uri, apps, contentDocument);
-    });
-  },
-
-  updatePageActionUri: function updatePageActionUri(uri) {
-    this._pageActionUri = uri;
-  },
-
-  _getMediaContentElement(contentDocument) {
-    if (!contentDocument.contentType.startsWith("video/") &&
-        !contentDocument.contentType.startsWith("audio/")) {
-      return null;
-    }
-
-    let element = contentDocument.activeElement;
-
-    if (element instanceof HTMLBodyElement) {
-      element = element.firstChild;
-    }
-
-    if (element instanceof HTMLMediaElement) {
-      return element;
-    }
-
-    return null;
-  },
-
-  _setUriForPageAction: function setUriForPageAction(uri, apps, contentDocument) {
-    this.updatePageActionUri(uri);
-
-    // If the pageaction is already added, simply update the URI to be launched when 'onclick' is triggered.
-    if (this._pageActionId != undefined)
-      return;
-
-    let mediaElement = this._getMediaContentElement(contentDocument);
-
-    this._pageActionId = PageActions.add({
-      title: Strings.browser.GetStringFromName("openInApp.pageAction"),
-      icon: "drawable://icon_openinapp",
-
-      clickCallback: () => {
-        UITelemetry.addEvent("launch.1", "pageaction", null, "helper");
-
-        let wasPlaying = mediaElement && !mediaElement.paused && !mediaElement.ended;
-        if (wasPlaying) {
-          mediaElement.pause();
-        }
-
-        if (apps.length > 1) {
-          // Use the HelperApps prompt here to filter out any Http handlers
-          HelperApps.prompt(apps, {
-            title: Strings.browser.GetStringFromName("openInApp.pageAction"),
-            buttons: [
-              Strings.browser.GetStringFromName("openInApp.ok"),
-              Strings.browser.GetStringFromName("openInApp.cancel")
-            ]
-          }, (result) => {
-            if (result.button != 0) {
-              if (wasPlaying) {
-                mediaElement.play();
-              }
-
-              return;
-            }
-            apps[result.icongrid0].launch(this._pageActionUri);
-          });
-        } else {
-          apps[0].launch(this._pageActionUri);
-        }
-      }
-    });
-  },
-
-  clearPageAction: function clearPageAction() {
-    if(!this._pageActionId)
-      return;
-
-    PageActions.remove(this._pageActionId);
-    delete this._pageActionId;
-  },
-};
-
-var Distribution = {
-  // File used to store campaign data
-  _file: null,
-
-  init: function dc_init() {
-    Services.obs.addObserver(this, "Distribution:Changed", false);
-    Services.obs.addObserver(this, "Distribution:Set", false);
-    Services.obs.addObserver(this, "prefservice:after-app-defaults", false);
-    Services.obs.addObserver(this, "Campaign:Set", false);
-
-    // Look for file outside the APK:
-    // /data/data/org.mozilla.xxx/distribution.json
-    this._file = Services.dirsvc.get("XCurProcD", Ci.nsIFile);
-    this._file.append("distribution.json");
-    this.readJSON(this._file, this.update);
-  },
-
-  observe: function dc_observe(aSubject, aTopic, aData) {
-    switch (aTopic) {
-      case "Distribution:Changed":
-        // Re-init the search service.
-        try {
-          Services.search._asyncReInit();
-        } catch (e) {
-          console.log("Unable to reinit search service.");
-        }
-        // Fall through.
-
-      case "Distribution:Set":
-        // Reload the default prefs so we can observe "prefservice:after-app-defaults"
-        Services.prefs.QueryInterface(Ci.nsIObserver).observe(null, "reload-default-prefs", null);
-        this.installDistroAddons();
-        break;
-
-      case "prefservice:after-app-defaults":
-        this.getPrefs();
-        break;
-
-      case "Campaign:Set": {
-        // Update the prefs for this session
-        try {
-          this.update(JSON.parse(aData));
-        } catch (ex) {
-          Cu.reportError("Distribution: Could not parse JSON: " + ex);
-          return;
-        }
-
-        // Asynchronously copy the data to the file.
-        let array = new TextEncoder().encode(aData);
-        OS.File.writeAtomic(this._file.path, array, { tmpPath: this._file.path + ".tmp" });
-        break;
-      }
-    }
-  },
-
-  update: function dc_update(aData) {
-    // Force the distribution preferences on the default branch
-    let defaults = Services.prefs.getDefaultBranch(null);
-    defaults.setCharPref("distribution.id", aData.id);
-    defaults.setCharPref("distribution.version", aData.version);
-  },
-
-  getPrefs: function dc_getPrefs() {
-    // Get the distribution directory, and bail if it doesn't exist.
-    let file = FileUtils.getDir("XREAppDist", [], false);
-    if (!file.exists())
-      return;
-
-    file.append("preferences.json");
-    this.readJSON(file, this.applyPrefs);
-  },
-
-  applyPrefs: function dc_applyPrefs(aData) {
-    // Check for required Global preferences
-    let global = aData["Global"];
-    if (!(global && global["id"] && global["version"] && global["about"])) {
-      Cu.reportError("Distribution: missing or incomplete Global preferences");
-      return;
-    }
-
-    // Force the distribution preferences on the default branch
-    let defaults = Services.prefs.getDefaultBranch(null);
-    defaults.setCharPref("distribution.id", global["id"]);
-    defaults.setCharPref("distribution.version", global["version"]);
-
-    let locale = BrowserApp.getUALocalePref();
-    let aboutString = Cc["@mozilla.org/supports-string;1"].createInstance(Ci.nsISupportsString);
-    aboutString.data = global["about." + locale] || global["about"];
-    defaults.setComplexValue("distribution.about", Ci.nsISupportsString, aboutString);
-
-    let prefs = aData["Preferences"];
-    for (let key in prefs) {
-      try {
-        let value = prefs[key];
-        switch (typeof value) {
-          case "boolean":
-            defaults.setBoolPref(key, value);
-            break;
-          case "number":
-            defaults.setIntPref(key, value);
-            break;
-          case "string":
-          case "undefined":
-            defaults.setCharPref(key, value);
-            break;
-        }
-      } catch (e) { /* ignore bad prefs and move on */ }
-    }
-
-    // Apply a lightweight theme if necessary
-    if (prefs && prefs["lightweightThemes.selectedThemeID"]) {
-      Services.obs.notifyObservers(null, "lightweight-theme-apply", "");
-    }
-
-    let localizedString = Cc["@mozilla.org/pref-localizedstring;1"].createInstance(Ci.nsIPrefLocalizedString);
-    let localizeablePrefs = aData["LocalizablePreferences"];
-    for (let key in localizeablePrefs) {
-      try {
-        let value = localizeablePrefs[key];
-        value = value.replace(/%LOCALE%/g, locale);
-        localizedString.data = "data:text/plain," + key + "=" + value;
-        defaults.setComplexValue(key, Ci.nsIPrefLocalizedString, localizedString);
-      } catch (e) { /* ignore bad prefs and move on */ }
-    }
-
-    let localizeablePrefsOverrides = aData["LocalizablePreferences." + locale];
-    for (let key in localizeablePrefsOverrides) {
-      try {
-        let value = localizeablePrefsOverrides[key];
-        localizedString.data = "data:text/plain," + key + "=" + value;
-        defaults.setComplexValue(key, Ci.nsIPrefLocalizedString, localizedString);
-      } catch (e) { /* ignore bad prefs and move on */ }
-    }
-
-    Messaging.sendRequest({ type: "Distribution:Set:OK" });
-  },
-
-  // aFile is an nsIFile
-  // aCallback takes the parsed JSON object as a parameter
-  readJSON: function dc_readJSON(aFile, aCallback) {
-    Task.spawn(function() {
-      let bytes = yield OS.File.read(aFile.path);
-      let raw = new TextDecoder().decode(bytes) || "";
-
-      try {
-        aCallback(JSON.parse(raw));
-      } catch (e) {
-        Cu.reportError("Distribution: Could not parse JSON: " + e);
-      }
-    }).then(null, function onError(reason) {
-      if (!(reason instanceof OS.File.Error && reason.becauseNoSuchFile)) {
-        Cu.reportError("Distribution: Could not read from " + aFile.leafName + " file");
-      }
-    });
-  },
-
-  // Track pending installs so we can avoid showing notifications for them.
-  pendingAddonInstalls: new Set(),
-
-  installDistroAddons: Task.async(function* () {
-    const PREF_ADDONS_INSTALLED = "distribution.addonsInstalled";
-    try {
-      let installed = Services.prefs.getBoolPref(PREF_ADDONS_INSTALLED);
-      if (installed) {
-        return;
-      }
-    } catch (e) {
-      Services.prefs.setBoolPref(PREF_ADDONS_INSTALLED, true);
-    }
-
-    let distroPath;
-    try {
-      distroPath = FileUtils.getDir("XREAppDist", ["extensions"]).path;
-
-      let info = yield OS.File.stat(distroPath);
-      if (!info.isDir) {
-        return;
-      }
-    } catch (e) {
-      return;
-    }
-
-    let it = new OS.File.DirectoryIterator(distroPath);
-    try {
-      yield it.forEach(entry => {
-        // Only support extensions that are zipped in .xpi files.
-        if (entry.isDir || !entry.name.endsWith(".xpi")) {
-          dump("Ignoring distribution add-on that isn't an XPI: " + entry.path);
-          return;
-        }
-
-        new Promise((resolve, reject) => {
-          AddonManager.getInstallForFile(new FileUtils.File(entry.path), resolve);
-        }).then(install => {
-          let id = entry.name.substring(0, entry.name.length - 4);
-          if (install.addon.id !== id) {
-            Cu.reportError("File entry " + entry.path + " contains an add-on with an incorrect ID");
-            return;
-          }
-          this.pendingAddonInstalls.add(install);
-          install.install();
-        }).catch(e => {
-          Cu.reportError("Error installing distribution add-on: " + entry.path + ": " + e);
-        });
-      });
-    } finally {
-      it.close();
-    }
-  })
-};
-
-var Tabs = {
-  _enableTabExpiration: false,
-  _useCache: false,
-  _domains: new Set(),
-
-  init: function() {
-    // On low-memory platforms, always allow tab expiration. On high-mem
-    // platforms, allow it to be turned on once we hit a low-mem situation.
-    if (BrowserApp.isOnLowMemoryPlatform) {
-      this._enableTabExpiration = true;
-    } else {
-      Services.obs.addObserver(this, "memory-pressure", false);
-    }
-
-    // Watch for opportunities to pre-connect to high probability targets.
-    Services.obs.addObserver(this, "Session:Prefetch", false);
-
-    // Track the network connection so we can efficiently use the cache
-    // for possible offline rendering.
-    Services.obs.addObserver(this, "network:link-status-changed", false);
-    let network = Cc["@mozilla.org/network/network-link-service;1"].getService(Ci.nsINetworkLinkService);
-    this.useCache = !network.isLinkUp;
-
-    BrowserApp.deck.addEventListener("pageshow", this, false);
-    BrowserApp.deck.addEventListener("TabOpen", this, false);
-  },
-
-  observe: function(aSubject, aTopic, aData) {
-    switch (aTopic) {
-      case "memory-pressure":
-        if (aData != "heap-minimize") {
-          // We received a low-memory related notification. This will enable
-          // expirations.
-          this._enableTabExpiration = true;
-          Services.obs.removeObserver(this, "memory-pressure");
-        } else {
-          // Use "heap-minimize" as a trigger to expire the most stale tab.
-          this.expireLruTab();
-        }
-        break;
-      case "Session:Prefetch":
-        if (aData) {
-          try {
-            let uri = Services.io.newURI(aData, null, null);
-            if (uri && !this._domains.has(uri.host)) {
-              Services.io.QueryInterface(Ci.nsISpeculativeConnect).speculativeConnect(uri, null);
-              this._domains.add(uri.host);
-            }
-          } catch (e) {}
-        }
-        break;
-      case "network:link-status-changed":
-        if (["down", "unknown", "up"].indexOf(aData) == -1) {
-          return;
-        }
-        this.useCache = (aData != "up");
-        break;
-    }
-  },
-
-  handleEvent: function(aEvent) {
-    switch (aEvent.type) {
-      case "pageshow":
-        // Clear the domain cache whenever a page is loaded into any browser.
-        this._domains.clear();
-
-        // Notify if we are loading a page from cache.
-        if (this._useCache) {
-          let targetDoc = aEvent.originalTarget;
-          let isTopLevel = (targetDoc.defaultView.parent === targetDoc.defaultView);
-
-          // Ignore any about: pages, especially about:neterror since it means we failed to find the page in cache.
-          let targetURI = targetDoc.documentURI;
-          if (isTopLevel && !targetURI.startsWith("about:")) {
-            UITelemetry.addEvent("neterror.1", "toast", null, "usecache");
-            Snackbars.show(Strings.browser.GetStringFromName("networkOffline.message"), Snackbars.LENGTH_INDEFINITE);
-          }
-        }
-        break;
-      case "TabOpen":
-        // Use opening a new tab as a trigger to expire the most stale tab.
-        this.expireLruTab();
-        break;
-    }
-  },
-
-  // Manage the most-recently-used list of tabs. Each tab has a timestamp
-  // associated with it that indicates when it was last touched.
-  expireLruTab: function() {
-    if (!this._enableTabExpiration) {
-      return false;
-    }
-    let expireTimeMs = Services.prefs.getIntPref("browser.tabs.expireTime") * 1000;
-    if (expireTimeMs < 0) {
-      // This behaviour is disabled.
-      return false;
-    }
-    let tabs = BrowserApp.tabs;
-    let selected = BrowserApp.selectedTab;
-    let lruTab = null;
-    // Find the least recently used non-zombie tab.
-    for (let i = 0; i < tabs.length; i++) {
-      if (tabs[i] == selected || tabs[i].browser.__SS_restore) {
-        // This tab is selected or already a zombie, skip it.
-        continue;
-      }
-      if (lruTab == null || tabs[i].lastTouchedAt < lruTab.lastTouchedAt) {
-        lruTab = tabs[i];
-      }
-    }
-    // If the tab was last touched more than browser.tabs.expireTime seconds ago,
-    // zombify it.
-    if (lruTab) {
-      if (Date.now() - lruTab.lastTouchedAt > expireTimeMs) {
-        MemoryObserver.zombify(lruTab);
-        return true;
-      }
-    }
-    return false;
-  },
-
-  get useCache() {
-    if (!Services.prefs.getBoolPref("browser.tabs.useCache")) {
-      return false;
-    }
-    return this._useCache;
-  },
-
-  set useCache(aUseCache) {
-    if (!Services.prefs.getBoolPref("browser.tabs.useCache")) {
-      return;
-    }
-
-    if (this._useCache == aUseCache) {
-      return;
-    }
-
-    BrowserApp.tabs.forEach(function(tab) {
-      if (tab.browser && tab.browser.docShell) {
-        if (aUseCache) {
-          tab.browser.docShell.defaultLoadFlags &= ~Ci.nsIRequest.LOAD_FROM_CACHE;
-        } else {
-          tab.browser.docShell.defaultLoadFlags |= Ci.nsIRequest.LOAD_FROM_CACHE;
-        }
-      }
-    });
-    this._useCache = aUseCache;
-  },
-
-  // For debugging
-  dump: function(aPrefix) {
-    let tabs = BrowserApp.tabs;
-    for (let i = 0; i < tabs.length; i++) {
-      dump(aPrefix + " | " + "Tab [" + tabs[i].browser.contentWindow.location.href + "]: lastTouchedAt:" + tabs[i].lastTouchedAt + ", zombie:" + tabs[i].browser.__SS_restore);
-    }
-  },
-};
-
-function ContextMenuItem(args) {
-  this.id = uuidgen.generateUUID().toString();
-  this.args = args;
-}
-
-ContextMenuItem.prototype = {
-  get order() {
-    return this.args.order || 0;
-  },
-
-  matches: function(elt, x, y) {
-    return this.args.selector.matches(elt, x, y);
-  },
-
-  callback: function(elt) {
-    this.args.callback(elt);
-  },
-
-  addVal: function(name, elt, defaultValue) {
-    if (!(name in this.args))
-      return defaultValue;
-
-    if (typeof this.args[name] == "function")
-      return this.args[name](elt);
-
-    return this.args[name];
-  },
-
-  getValue: function(elt) {
-    return {
-      id: this.id,
-      label: this.addVal("label", elt),
-      showAsActions: this.addVal("showAsActions", elt),
-      icon: this.addVal("icon", elt),
-      isGroup: this.addVal("isGroup", elt, false),
-      inGroup: this.addVal("inGroup", elt, false),
-      disabled: this.addVal("disabled", elt, false),
-      selected: this.addVal("selected", elt, false),
-      isParent: this.addVal("isParent", elt, false),
-    };
-  }
-}
-
-function HTMLContextMenuItem(elt, target) {
-  ContextMenuItem.call(this, { });
-
-  this.menuElementRef = Cu.getWeakReference(elt);
-  this.targetElementRef = Cu.getWeakReference(target);
-}
-
-HTMLContextMenuItem.prototype = Object.create(ContextMenuItem.prototype, {
-  order: {
-    value: NativeWindow.contextmenus.DEFAULT_HTML5_ORDER
-  },
-
-  matches: {
-    value: function(target) {
-      let t = this.targetElementRef.get();
-      return t === target;
-    },
-  },
-
-  callback: {
-    value: function(target) {
-      let elt = this.menuElementRef.get();
-      if (!elt) {
-        return;
-      }
-
-      // If this is a menu item, show a new context menu with the submenu in it
-      if (elt instanceof Ci.nsIDOMHTMLMenuElement) {
-        try {
-          NativeWindow.contextmenus.menus = {};
-
-          let elt = this.menuElementRef.get();
-          let target = this.targetElementRef.get();
-          if (!elt) {
-            return;
-          }
-
-          var items = NativeWindow.contextmenus._getHTMLContextMenuItemsForMenu(elt, target);
-          // This menu will always only have one context, but we still make sure its the "right" one.
-          var context = NativeWindow.contextmenus._getContextType(target);
-          if (items.length > 0) {
-            NativeWindow.contextmenus._addMenuItems(items, context);
-          }
-
-        } catch(ex) {
-          Cu.reportError(ex);
-        }
-      } else {
-        // otherwise just click the menu item
-        elt.click();
-      }
-    },
-  },
-
-  getValue: {
-    value: function(target) {
-      let elt = this.menuElementRef.get();
-      if (!elt) {
-        return null;
-      }
-
-      if (elt.hasAttribute("hidden")) {
-        return null;
-      }
-
-      return {
-        id: this.id,
-        icon: elt.icon,
-        label: elt.label,
-        disabled: elt.disabled,
-        menu: elt instanceof Ci.nsIDOMHTMLMenuElement
-      };
-    }
-  },
-});
-
diff --git a/modules/libpref/init/all.js b/modules/libpref/init/all.js
index 4c83adc..c5ce23f 100755
--- a/modules/libpref/init/all.js
+++ b/modules/libpref/init/all.js
@@ -1081,7 +1081,7 @@ pref("dom.min_timeout_value", 4);
 pref("dom.min_background_timeout_value", 1000);
 
 // Don't use new input types
-pref("dom.experimental_forms", false);
+pref("dom.experimental_forms", true);
 
 // Enable <input type=number>:
 pref("dom.forms.number", true);
@@ -2618,7 +2618,7 @@ pref("dom.ipc.plugins.hangUIMinDisplaySecs", 0);
 pref("dom.ipc.tabs.shutdownTimeoutSecs", 0);
 #endif
 
-pref("dom.ipc.plugins.flash.disable-protected-mode", false);
+pref("dom.ipc.plugins.flash.disable-protected-mode", true);
 
 pref("dom.ipc.plugins.flash.subprocess.crashreporter.enabled", true);
 pref("dom.ipc.plugins.reportCrashURL", true);
@@ -4640,7 +4640,7 @@ pref("dom.w3c_touch_events.enabled", 2);
 #endif
 
 // W3C draft pointer events
-pref("dom.w3c_pointer_events.enabled", false);
+pref("dom.w3c_pointer_events.enabled", true);
 
 // W3C draft ImageCapture API
 pref("dom.imagecapture.enabled", false);
diff --git a/netwerk/protocol/http/nsHttpHandler.cpp b/netwerk/protocol/http/nsHttpHandler.cpp
index 8cdc809..d2ce286 100755
--- a/netwerk/protocol/http/nsHttpHandler.cpp
+++ b/netwerk/protocol/http/nsHttpHandler.cpp
@@ -726,9 +726,6 @@ nsHttpHandler::BuildUserAgent()
         mUserAgent += "Firefox";
         mUserAgent += '/';
         mUserAgent += mAppVersion;
-    }
-    if (!isFirefox) {
-        // "Firefox/x.y" (compatibility) app token
         mUserAgent += ' ';
         mUserAgent += mCompatFirefox;
     }
diff --git a/netwerk/protocol/http/nsHttpHandler.cpp.orig b/netwerk/protocol/http/nsHttpHandler.cpp.orig
deleted file mode 100644
index fd2c451..0000000
--- a/netwerk/protocol/http/nsHttpHandler.cpp.orig
+++ /dev/null
@@ -1,2407 +0,0 @@
-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */
-/* vim:set ts=4 sw=4 sts=4 et cin: */
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-// HttpLog.h should generally be included first
-#include "HttpLog.h"
-
-#include "nsHttp.h"
-#include "nsHttpHandler.h"
-#include "nsHttpChannel.h"
-#include "nsHttpAuthCache.h"
-#include "nsStandardURL.h"
-#include "nsIDOMWindow.h"
-#include "nsIDOMNavigator.h"
-#include "nsIMozNavigatorNetwork.h"
-#include "nsINetworkProperties.h"
-#include "nsIHttpChannel.h"
-#include "nsIStandardURL.h"
-#include "LoadContextInfo.h"
-#include "nsCategoryManagerUtils.h"
-#include "nsIPrefService.h"
-#include "nsIPrefBranch.h"
-#include "nsIPrefLocalizedString.h"
-#include "nsISocketProviderService.h"
-#include "nsISocketProvider.h"
-#include "nsPrintfCString.h"
-#include "nsCOMPtr.h"
-#include "nsNetCID.h"
-#include "prprf.h"
-#include "mozilla/Snprintf.h"
-#include "nsAsyncRedirectVerifyHelper.h"
-#include "nsSocketTransportService2.h"
-#include "nsAlgorithm.h"
-#include "ASpdySession.h"
-#include "mozIApplicationClearPrivateDataParams.h"
-#include "EventTokenBucket.h"
-#include "Tickler.h"
-#include "nsIXULAppInfo.h"
-#include "nsICookieService.h"
-#include "nsIObserverService.h"
-#include "nsISiteSecurityService.h"
-#include "nsIStreamConverterService.h"
-#include "nsITimer.h"
-#include "nsCRT.h"
-#include "SpdyZlibReporter.h"
-#include "nsIMemoryReporter.h"
-#include "nsIParentalControlsService.h"
-#include "nsPIDOMWindow.h"
-#include "nsINetworkLinkService.h"
-#include "nsHttpChannelAuthProvider.h"
-#include "nsServiceManagerUtils.h"
-#include "nsComponentManagerUtils.h"
-#include "nsSocketTransportService2.h"
-#include "nsIOService.h"
-
-#include "mozilla/net/NeckoChild.h"
-#include "mozilla/ipc/URIUtils.h"
-#include "mozilla/Telemetry.h"
-
-#if defined(XP_UNIX)
-#include <sys/utsname.h>
-#endif
-
-#if defined(XP_WIN)
-#include <windows.h>
-#endif
-
-#if defined(XP_MACOSX)
-#include <CoreServices/CoreServices.h>
-#include "nsCocoaFeatures.h"
-#endif
-
-//-----------------------------------------------------------------------------
-#include "mozilla/net/HttpChannelChild.h"
-
-
-#define UA_PREF_PREFIX          "general.useragent."
-#ifdef XP_WIN
-#define UA_SPARE_PLATFORM
-#endif
-
-#define HTTP_PREF_PREFIX        "network.http."
-#define INTL_ACCEPT_LANGUAGES   "intl.accept_languages"
-#define BROWSER_PREF_PREFIX     "browser.cache."
-#define DONOTTRACK_HEADER_ENABLED "privacy.donottrackheader.enabled"
-#define H2MANDATORY_SUITE        "security.ssl3.ecdhe_rsa_aes_128_gcm_sha256"
-#define TELEMETRY_ENABLED        "toolkit.telemetry.enabled"
-#define ALLOW_EXPERIMENTS        "network.allow-experiments"
-#define SAFE_HINT_HEADER_VALUE   "safeHint.enabled"
-#define SECURITY_PREFIX          "security."
-
-#define UA_PREF(_pref) UA_PREF_PREFIX _pref
-#define HTTP_PREF(_pref) HTTP_PREF_PREFIX _pref
-#define BROWSER_PREF(_pref) BROWSER_PREF_PREFIX _pref
-
-#define NS_HTTP_PROTOCOL_FLAGS (URI_STD | ALLOWS_PROXY | ALLOWS_PROXY_HTTP | URI_LOADABLE_BY_ANYONE)
-
-//-----------------------------------------------------------------------------
-
-namespace mozilla {
-namespace net {
-
-LazyLogModule gHttpLog("nsHttp");
-
-static nsresult
-NewURI(const nsACString &aSpec,
-       const char *aCharset,
-       nsIURI *aBaseURI,
-       int32_t aDefaultPort,
-       nsIURI **aURI)
-{
-    RefPtr<nsStandardURL> url = new nsStandardURL();
-
-    nsresult rv = url->Init(nsIStandardURL::URLTYPE_AUTHORITY,
-                            aDefaultPort, aSpec, aCharset, aBaseURI);
-    if (NS_FAILED(rv)) {
-        return rv;
-    }
-
-    url.forget(aURI);
-    return NS_OK;
-}
-
-#ifdef ANDROID
-static nsCString
-GetDeviceModelId() {
-    // Assumed to be running on the main thread
-    // We need the device property in either case
-    nsAutoCString deviceModelId;
-    nsCOMPtr<nsIPropertyBag2> infoService = do_GetService("@mozilla.org/system-info;1");
-    MOZ_ASSERT(infoService, "Could not find a system info service");
-    nsAutoString androidDevice;
-    nsresult rv = infoService->GetPropertyAsAString(NS_LITERAL_STRING("device"), androidDevice);
-    if (NS_SUCCEEDED(rv)) {
-        deviceModelId = NS_LossyConvertUTF16toASCII(androidDevice);
-    }
-    nsAutoCString deviceString;
-    rv = Preferences::GetCString(UA_PREF("device_string"), &deviceString);
-    if (NS_SUCCEEDED(rv)) {
-        deviceString.Trim(" ", true, true);
-        deviceString.ReplaceSubstring(NS_LITERAL_CSTRING("%DEVICEID%"), deviceModelId);
-        return deviceString;
-    }
-    return deviceModelId;
-}
-#endif
-
-//-----------------------------------------------------------------------------
-// nsHttpHandler <public>
-//-----------------------------------------------------------------------------
-
-nsHttpHandler *gHttpHandler = nullptr;
-
-nsHttpHandler::nsHttpHandler()
-    : mHttpVersion(NS_HTTP_VERSION_1_1)
-    , mProxyHttpVersion(NS_HTTP_VERSION_1_1)
-    , mCapabilities(NS_HTTP_ALLOW_KEEPALIVE)
-    , mReferrerLevel(0xff) // by default we always send a referrer
-    , mSpoofReferrerSource(false)
-    , mReferrerTrimmingPolicy(0)
-    , mReferrerXOriginPolicy(0)
-    , mFastFallbackToIPv4(false)
-    , mProxyPipelining(true)
-    , mIdleTimeout(PR_SecondsToInterval(10))
-    , mSpdyTimeout(PR_SecondsToInterval(180))
-    , mResponseTimeout(PR_SecondsToInterval(300))
-    , mResponseTimeoutEnabled(false)
-    , mNetworkChangedTimeout(5000)
-    , mMaxRequestAttempts(6)
-    , mMaxRequestDelay(10)
-    , mIdleSynTimeout(250)
-    , mH2MandatorySuiteEnabled(false)
-    , mPipeliningEnabled(false)
-    , mMaxConnections(24)
-    , mMaxPersistentConnectionsPerServer(2)
-    , mMaxPersistentConnectionsPerProxy(4)
-    , mMaxPipelinedRequests(32)
-    , mMaxOptimisticPipelinedRequests(4)
-    , mPipelineAggressive(false)
-    , mMaxPipelineObjectSize(300000)
-    , mPipelineRescheduleOnTimeout(true)
-    , mPipelineRescheduleTimeout(PR_MillisecondsToInterval(1500))
-    , mPipelineReadTimeout(PR_MillisecondsToInterval(30000))
-    , mRedirectionLimit(10)
-    , mPhishyUserPassLength(1)
-    , mQoSBits(0x00)
-    , mPipeliningOverSSL(false)
-    , mEnforceAssocReq(false)
-    , mLastUniqueID(NowInSeconds())
-    , mSessionStartTime(0)
-    , mLegacyAppName("Mozilla")
-    , mLegacyAppVersion("5.0")
-    , mProduct("Gecko")
-    , mCompatFirefoxEnabled(false)
-    , mUserAgentIsDirty(true)
-    , mPromptTempRedirect(true)
-    , mSendSecureXSiteReferrer(true)
-    , mEnablePersistentHttpsCaching(false)
-    , mDoNotTrackEnabled(false)
-    , mSafeHintEnabled(false)
-    , mParentalControlEnabled(false)
-    , mHandlerActive(false)
-    , mTelemetryEnabled(false)
-    , mAllowExperiments(true)
-    , mDebugObservations(false)
-    , mEnableSpdy(false)
-    , mSpdyV31(true)
-    , mHttp2Enabled(true)
-    , mUseH2Deps(true)
-    , mEnforceHttp2TlsProfile(true)
-    , mCoalesceSpdy(true)
-    , mSpdyPersistentSettings(false)
-    , mAllowPush(true)
-    , mEnableAltSvc(false)
-    , mEnableAltSvcOE(false)
-    , mSpdySendingChunkSize(ASpdySession::kSendingChunkSize)
-    , mSpdySendBufferSize(ASpdySession::kTCPSendBufferSize)
-    , mSpdyPushAllowance(32768)
-    , mSpdyPullAllowance(ASpdySession::kInitialRwin)
-    , mDefaultSpdyConcurrent(ASpdySession::kDefaultMaxConcurrent)
-    , mSpdyPingThreshold(PR_SecondsToInterval(58))
-    , mSpdyPingTimeout(PR_SecondsToInterval(8))
-    , mConnectTimeout(90000)
-    , mParallelSpeculativeConnectLimit(6)
-    , mRequestTokenBucketEnabled(true)
-    , mRequestTokenBucketMinParallelism(6)
-    , mRequestTokenBucketHz(100)
-    , mRequestTokenBucketBurst(32)
-    , mCriticalRequestPrioritization(true)
-    , mTCPKeepaliveShortLivedEnabled(false)
-    , mTCPKeepaliveShortLivedTimeS(60)
-    , mTCPKeepaliveShortLivedIdleTimeS(10)
-    , mTCPKeepaliveLongLivedEnabled(false)
-    , mTCPKeepaliveLongLivedIdleTimeS(600)
-    , mEnforceH1Framing(FRAMECHECK_BARELY)
-{
-    LOG(("Creating nsHttpHandler [this=%p].\n", this));
-
-    RegisterStrongMemoryReporter(new SpdyZlibReporter());
-
-    MOZ_ASSERT(!gHttpHandler, "HTTP handler already created!");
-    gHttpHandler = this;
-}
-
-nsHttpHandler::~nsHttpHandler()
-{
-    LOG(("Deleting nsHttpHandler [this=%p]\n", this));
-
-    // make sure the connection manager is shutdown
-    if (mConnMgr) {
-        mConnMgr->Shutdown();
-        mConnMgr = nullptr;
-    }
-
-    // Note: don't call NeckoChild::DestroyNeckoChild() here, as it's too late
-    // and it'll segfault.  NeckoChild will get cleaned up by process exit.
-
-    nsHttp::DestroyAtomTable();
-    if (mPipelineTestTimer) {
-        mPipelineTestTimer->Cancel();
-        mPipelineTestTimer = nullptr;
-    }
-
-    gHttpHandler = nullptr;
-}
-
-nsresult
-nsHttpHandler::Init()
-{
-    nsresult rv;
-
-    LOG(("nsHttpHandler::Init\n"));
-    MOZ_ASSERT(NS_IsMainThread());
-
-    rv = nsHttp::CreateAtomTable();
-    if (NS_FAILED(rv))
-        return rv;
-
-    nsCOMPtr<nsIIOService> service = do_GetService(NS_IOSERVICE_CONTRACTID, &rv);
-    if (NS_FAILED(rv)) {
-        NS_WARNING("unable to continue without io service");
-        return rv;
-    }
-    mIOService = new nsMainThreadPtrHolder<nsIIOService>(service);
-
-    if (IsNeckoChild())
-        NeckoChild::InitNeckoChild();
-
-    InitUserAgentComponents();
-
-    // monitor some preference changes
-    nsCOMPtr<nsIPrefBranch> prefBranch = do_GetService(NS_PREFSERVICE_CONTRACTID);
-    if (prefBranch) {
-        prefBranch->AddObserver(HTTP_PREF_PREFIX, this, true);
-        prefBranch->AddObserver(UA_PREF_PREFIX, this, true);
-        prefBranch->AddObserver(INTL_ACCEPT_LANGUAGES, this, true);
-        prefBranch->AddObserver(BROWSER_PREF("disk_cache_ssl"), this, true);
-        prefBranch->AddObserver(DONOTTRACK_HEADER_ENABLED, this, true);
-        prefBranch->AddObserver(TELEMETRY_ENABLED, this, true);
-        prefBranch->AddObserver(H2MANDATORY_SUITE, this, true);
-        prefBranch->AddObserver(HTTP_PREF("tcp_keepalive.short_lived_connections"), this, true);
-        prefBranch->AddObserver(HTTP_PREF("tcp_keepalive.long_lived_connections"), this, true);
-        prefBranch->AddObserver(SAFE_HINT_HEADER_VALUE, this, true);
-        prefBranch->AddObserver(SECURITY_PREFIX, this, true);
-        PrefsChanged(prefBranch, nullptr);
-    }
-
-    rv = Preferences::AddBoolVarCache(&mPackagedAppsEnabled,
-        "network.http.enable-packaged-apps", false);
-    if (NS_FAILED(rv)) {
-        mPackagedAppsEnabled = false;
-    }
-
-    nsHttpChannelAuthProvider::InitializePrefs();
-
-    mMisc.AssignLiteral("rv:" MOZILLA_UAVERSION);
-
-    mCompatFirefox.AssignLiteral("Firefox/" MOZILLA_UAVERSION);
-
-    nsCOMPtr<nsIXULAppInfo> appInfo =
-        do_GetService("@mozilla.org/xre/app-info;1");
-
-    mAppName.AssignLiteral(MOZ_APP_UA_NAME);
-    if (mAppName.Length() == 0 && appInfo) {
-        // Try to get the UA name from appInfo, falling back to the name
-        appInfo->GetUAName(mAppName);
-        if (mAppName.Length() == 0) {
-          appInfo->GetName(mAppName);
-        }
-        appInfo->GetVersion(mAppVersion);
-        mAppName.StripChars(" ()<>@,;:\\\"/[]?={}");
-    } else {
-        mAppVersion.AssignLiteral(MOZ_APP_UA_VERSION);
-    }
-
-    mSessionStartTime = NowInSeconds();
-    mHandlerActive = true;
-
-    rv = mAuthCache.Init();
-    if (NS_FAILED(rv)) return rv;
-
-    rv = mPrivateAuthCache.Init();
-    if (NS_FAILED(rv)) return rv;
-
-    rv = InitConnectionMgr();
-    if (NS_FAILED(rv)) return rv;
-
-    mSchedulingContextService =
-        do_GetService("@mozilla.org/network/scheduling-context-service;1");
-
-#ifdef ANDROID
-    mProductSub.AssignLiteral(MOZILLA_UAVERSION);
-#else
-    mProductSub.AssignLiteral("20100101");
-#endif
-
-#if DEBUG
-    // dump user agent prefs
-    LOG(("> legacy-app-name = %s\n", mLegacyAppName.get()));
-    LOG(("> legacy-app-version = %s\n", mLegacyAppVersion.get()));
-    LOG(("> platform = %s\n", mPlatform.get()));
-    LOG(("> oscpu = %s\n", mOscpu.get()));
-    LOG(("> misc = %s\n", mMisc.get()));
-    LOG(("> product = %s\n", mProduct.get()));
-    LOG(("> product-sub = %s\n", mProductSub.get()));
-    LOG(("> app-name = %s\n", mAppName.get()));
-    LOG(("> app-version = %s\n", mAppVersion.get()));
-    LOG(("> compat-firefox = %s\n", mCompatFirefox.get()));
-    LOG(("> user-agent = %s\n", UserAgent().get()));
-#endif
-
-    // Startup the http category
-    // Bring alive the objects in the http-protocol-startup category
-    NS_CreateServicesFromCategory(NS_HTTP_STARTUP_CATEGORY,
-                                  static_cast<nsISupports*>(static_cast<void*>(this)),
-                                  NS_HTTP_STARTUP_TOPIC);
-
-    nsCOMPtr<nsIObserverService> obsService = services::GetObserverService();
-    if (obsService) {
-        // register the handler object as a weak callback as we don't need to worry
-        // about shutdown ordering.
-        obsService->AddObserver(this, "profile-change-net-teardown", true);
-        obsService->AddObserver(this, "profile-change-net-restore", true);
-        obsService->AddObserver(this, NS_XPCOM_SHUTDOWN_OBSERVER_ID, true);
-        obsService->AddObserver(this, "net:clear-active-logins", true);
-        obsService->AddObserver(this, "net:prune-dead-connections", true);
-        // Sent by the TorButton add-on in the Tor Browser
-        obsService->AddObserver(this, "net:prune-all-connections", true);
-        obsService->AddObserver(this, "net:failed-to-process-uri-content", true);
-        obsService->AddObserver(this, "last-pb-context-exited", true);
-        obsService->AddObserver(this, "webapps-clear-data", true);
-        obsService->AddObserver(this, "browser:purge-session-history", true);
-        obsService->AddObserver(this, NS_NETWORK_LINK_TOPIC, true);
-        obsService->AddObserver(this, "application-background", true);
-    }
-
-    MakeNewRequestTokenBucket();
-    mWifiTickler = new Tickler();
-    if (NS_FAILED(mWifiTickler->Init()))
-        mWifiTickler = nullptr;
-
-    nsCOMPtr<nsIParentalControlsService> pc = do_CreateInstance("@mozilla.org/parental-controls-service;1");
-    if (pc) {
-        pc->GetParentalControlsEnabled(&mParentalControlEnabled);
-    }
-    return NS_OK;
-}
-
-void
-nsHttpHandler::MakeNewRequestTokenBucket()
-{
-    LOG(("nsHttpHandler::MakeNewRequestTokenBucket this=%p child=%d\n",
-         this, IsNeckoChild()));
-    if (!mConnMgr || IsNeckoChild()) {
-        return;
-    }
-    RefPtr<EventTokenBucket> tokenBucket =
-        new EventTokenBucket(RequestTokenBucketHz(), RequestTokenBucketBurst());
-    mConnMgr->UpdateRequestTokenBucket(tokenBucket);
-}
-
-nsresult
-nsHttpHandler::InitConnectionMgr()
-{
-    // Init ConnectionManager only on parent!
-    if (IsNeckoChild()) {
-        return NS_OK;
-    }
-
-    nsresult rv;
-
-    if (!mConnMgr) {
-        mConnMgr = new nsHttpConnectionMgr();
-    }
-
-    rv = mConnMgr->Init(mMaxConnections,
-                        mMaxPersistentConnectionsPerServer,
-                        mMaxPersistentConnectionsPerProxy,
-                        mMaxRequestDelay,
-                        mMaxPipelinedRequests,
-                        mMaxOptimisticPipelinedRequests);
-    return rv;
-}
-
-nsresult
-nsHttpHandler::AddStandardRequestHeaders(nsHttpHeaderArray *request, bool isSecure)
-{
-    nsresult rv;
-
-    // Add the "User-Agent" header
-    rv = request->SetHeader(nsHttp::User_Agent, UserAgent(),
-                            false, nsHttpHeaderArray::eVarietyDefault);
-    if (NS_FAILED(rv)) return rv;
-
-    // MIME based content negotiation lives!
-    // Add the "Accept" header.  Note, this is set as an override because the
-    // service worker expects to see it.  The other "default" headers are
-    // hidden from service worker interception.
-    rv = request->SetHeader(nsHttp::Accept, mAccept,
-                            false, nsHttpHeaderArray::eVarietyOverride);
-    if (NS_FAILED(rv)) return rv;
-
-    // Add the "Accept-Language" header.  This header is also exposed to the
-    // service worker.
-    if (!mAcceptLanguages.IsEmpty()) {
-        // Add the "Accept-Language" header
-        rv = request->SetHeader(nsHttp::Accept_Language, mAcceptLanguages,
-                                false, nsHttpHeaderArray::eVarietyOverride);
-        if (NS_FAILED(rv)) return rv;
-    }
-
-    // Add the "Accept-Encoding" header
-    if (isSecure) {
-        rv = request->SetHeader(nsHttp::Accept_Encoding, mHttpsAcceptEncodings,
-                                false, nsHttpHeaderArray::eVarietyDefault);
-    } else {
-        rv = request->SetHeader(nsHttp::Accept_Encoding, mHttpAcceptEncodings,
-                                false, nsHttpHeaderArray::eVarietyDefault);
-    }
-    if (NS_FAILED(rv)) return rv;
-
-    // Add the "Do-Not-Track" header
-    if (mDoNotTrackEnabled) {
-      rv = request->SetHeader(nsHttp::DoNotTrack, NS_LITERAL_CSTRING("1"),
-                              false, nsHttpHeaderArray::eVarietyDefault);
-      if (NS_FAILED(rv)) return rv;
-    }
-
-    // add the "Send Hint" header
-    if (mSafeHintEnabled || mParentalControlEnabled) {
-      rv = request->SetHeader(nsHttp::Prefer, NS_LITERAL_CSTRING("safe"),
-                              false, nsHttpHeaderArray::eVarietyDefault);
-      if (NS_FAILED(rv)) return rv;
-    }
-    return NS_OK;
-}
-
-nsresult
-nsHttpHandler::AddConnectionHeader(nsHttpHeaderArray *request,
-                                   uint32_t caps)
-{
-    // RFC2616 section 19.6.2 states that the "Connection: keep-alive"
-    // and "Keep-alive" request headers should not be sent by HTTP/1.1
-    // user-agents.  But this is not a problem in practice, and the
-    // alternative proxy-connection is worse. see 570283
-
-    NS_NAMED_LITERAL_CSTRING(close, "close");
-    NS_NAMED_LITERAL_CSTRING(keepAlive, "keep-alive");
-
-    const nsACString *connectionType = &close;
-    if (caps & NS_HTTP_ALLOW_KEEPALIVE) {
-        connectionType = &keepAlive;
-    }
-
-    return request->SetHeader(nsHttp::Connection, *connectionType);
-}
-
-bool
-nsHttpHandler::IsAcceptableEncoding(const char *enc, bool isSecure)
-{
-    if (!enc)
-        return false;
-
-    // we used to accept x-foo anytime foo was acceptable, but that's just
-    // continuing bad behavior.. so limit it to known x-* patterns
-    bool rv;
-    if (isSecure) {
-        rv = nsHttp::FindToken(mHttpsAcceptEncodings.get(), enc, HTTP_LWS ",") != nullptr;
-    } else {
-        rv = nsHttp::FindToken(mHttpAcceptEncodings.get(), enc, HTTP_LWS ",") != nullptr;
-    }
-    // gzip and deflate are inherently acceptable in modern HTTP - always
-    // process them if a stream converter can also be found.
-    if (!rv &&
-        (!PL_strcasecmp(enc, "gzip") || !PL_strcasecmp(enc, "deflate") ||
-         !PL_strcasecmp(enc, "x-gzip") || !PL_strcasecmp(enc, "x-deflate"))) {
-        rv = true;
-    }
-    LOG(("nsHttpHandler::IsAceptableEncoding %s https=%d %d\n",
-         enc, isSecure, rv));
-    return rv;
-}
-
-nsresult
-nsHttpHandler::GetStreamConverterService(nsIStreamConverterService **result)
-{
-    if (!mStreamConvSvc) {
-        nsresult rv;
-        nsCOMPtr<nsIStreamConverterService> service =
-            do_GetService(NS_STREAMCONVERTERSERVICE_CONTRACTID, &rv);
-        if (NS_FAILED(rv))
-            return rv;
-        mStreamConvSvc = new nsMainThreadPtrHolder<nsIStreamConverterService>(service);
-    }
-    *result = mStreamConvSvc;
-    NS_ADDREF(*result);
-    return NS_OK;
-}
-
-nsISiteSecurityService*
-nsHttpHandler::GetSSService()
-{
-    if (!mSSService) {
-        nsCOMPtr<nsISiteSecurityService> service = do_GetService(NS_SSSERVICE_CONTRACTID);
-        mSSService = new nsMainThreadPtrHolder<nsISiteSecurityService>(service);
-    }
-    return mSSService;
-}
-
-nsICookieService *
-nsHttpHandler::GetCookieService()
-{
-    if (!mCookieService) {
-        nsCOMPtr<nsICookieService> service = do_GetService(NS_COOKIESERVICE_CONTRACTID);
-        mCookieService = new nsMainThreadPtrHolder<nsICookieService>(service);
-    }
-    return mCookieService;
-}
-
-nsresult
-nsHttpHandler::GetIOService(nsIIOService** result)
-{
-    NS_ENSURE_ARG_POINTER(result);
-
-    NS_ADDREF(*result = mIOService);
-    return NS_OK;
-}
-
-uint32_t
-nsHttpHandler::Get32BitsOfPseudoRandom()
-{
-    // only confirm rand seeding on socket thread
-    MOZ_ASSERT(PR_GetCurrentThread() == gSocketThread);
-
-    // rand() provides different amounts of PRNG on different platforms.
-    // 15 or 31 bits are common amounts.
-
-    PR_STATIC_ASSERT(RAND_MAX >= 0xfff);
-
-#if RAND_MAX < 0xffffU
-    return ((uint16_t) rand() << 20) |
-            (((uint16_t) rand() & 0xfff) << 8) |
-            ((uint16_t) rand() & 0xff);
-#elif RAND_MAX < 0xffffffffU
-    return ((uint16_t) rand() << 16) | ((uint16_t) rand() & 0xffff);
-#else
-    return (uint32_t) rand();
-#endif
-}
-
-void
-nsHttpHandler::NotifyObservers(nsIHttpChannel *chan, const char *event)
-{
-    LOG(("nsHttpHandler::NotifyObservers [chan=%x event=\"%s\"]\n", chan, event));
-    nsCOMPtr<nsIObserverService> obsService = services::GetObserverService();
-    if (obsService)
-        obsService->NotifyObservers(chan, event, nullptr);
-}
-
-nsresult
-nsHttpHandler::AsyncOnChannelRedirect(nsIChannel* oldChan, nsIChannel* newChan,
-                                 uint32_t flags)
-{
-    // TODO E10S This helper has to be initialized on the other process
-    RefPtr<nsAsyncRedirectVerifyHelper> redirectCallbackHelper =
-        new nsAsyncRedirectVerifyHelper();
-
-    return redirectCallbackHelper->Init(oldChan, newChan, flags);
-}
-
-/* static */ nsresult
-nsHttpHandler::GenerateHostPort(const nsCString& host, int32_t port,
-                                nsACString& hostLine)
-{
-    return NS_GenerateHostPort(host, port, hostLine);
-}
-
-//-----------------------------------------------------------------------------
-// nsHttpHandler <private>
-//-----------------------------------------------------------------------------
-
-const nsAFlatCString &
-nsHttpHandler::UserAgent()
-{
-    if (mUserAgentOverride) {
-        LOG(("using general.useragent.override : %s\n", mUserAgentOverride.get()));
-        return mUserAgentOverride;
-    }
-
-    if (mUserAgentIsDirty) {
-        BuildUserAgent();
-        mUserAgentIsDirty = false;
-    }
-
-    return mUserAgent;
-}
-
-void
-nsHttpHandler::BuildUserAgent()
-{
-    LOG(("nsHttpHandler::BuildUserAgent\n"));
-
-    MOZ_ASSERT(!mLegacyAppName.IsEmpty() &&
-               !mLegacyAppVersion.IsEmpty(),
-               "HTTP cannot send practical requests without this much");
-
-    // preallocate to worst-case size, which should always be better
-    // than if we didn't preallocate at all.
-    mUserAgent.SetCapacity(mLegacyAppName.Length() +
-                           mLegacyAppVersion.Length() +
-#ifndef UA_SPARE_PLATFORM
-                           mPlatform.Length() +
-#endif
-                           mOscpu.Length() +
-                           mMisc.Length() +
-                           mProduct.Length() +
-                           mProductSub.Length() +
-                           mAppName.Length() +
-                           mAppVersion.Length() +
-                           mCompatFirefox.Length() +
-                           mCompatDevice.Length() +
-                           mDeviceModelId.Length() +
-                           13);
-
-    // Application portion
-    mUserAgent.Assign(mLegacyAppName);
-    mUserAgent += '/';
-    mUserAgent += mLegacyAppVersion;
-    mUserAgent += ' ';
-
-    // Application comment
-    mUserAgent += '(';
-#ifndef UA_SPARE_PLATFORM
-    if (!mPlatform.IsEmpty()) {
-      mUserAgent += mPlatform;
-      mUserAgent.AppendLiteral("; ");
-    }
-#endif
-    if (!mCompatDevice.IsEmpty()) {
-        mUserAgent += mCompatDevice;
-        mUserAgent.AppendLiteral("; ");
-    }
-    else if (!mOscpu.IsEmpty()) {
-      mUserAgent += mOscpu;
-      mUserAgent.AppendLiteral("; ");
-    }
-    if (!mDeviceModelId.IsEmpty()) {
-        mUserAgent += mDeviceModelId;
-        mUserAgent.AppendLiteral("; ");
-    }
-    mUserAgent += mMisc;
-    mUserAgent += ')';
-
-    // Product portion
-    mUserAgent += ' ';
-    mUserAgent += mProduct;
-    mUserAgent += '/';
-    mUserAgent += mProductSub;
-
-    bool isFirefox = mAppName.EqualsLiteral("Firefox");
-    if (isFirefox || mCompatFirefoxEnabled) {
-        // "Firefox/x.y" (compatibility) app token
-        mUserAgent += ' ';
-        mUserAgent += mCompatFirefox;
-    }
-    if (!isFirefox) {
-        // App portion
-        mUserAgent += ' ';
-        mUserAgent += mAppName;
-        mUserAgent += '/';
-        mUserAgent += mAppVersion;
-    }
-}
-
-#ifdef XP_WIN
-#define WNT_BASE "Windows NT %ld.%ld"
-#define W64_PREFIX "; Win64"
-#endif
-
-void
-nsHttpHandler::InitUserAgentComponents()
-{
-#ifndef MOZ_UA_OS_AGNOSTIC
-    // Gather platform.
-    mPlatform.AssignLiteral(
-#if defined(ANDROID)
-    "Android"
-#elif defined(XP_WIN)
-    "Windows"
-#elif defined(XP_MACOSX)
-    "Macintosh"
-#elif defined(XP_UNIX)
-    // We historically have always had X11 here,
-    // and there seems little a webpage can sensibly do
-    // based on it being something else, so use X11 for
-    // backwards compatibility in all cases.
-    "X11"
-#endif
-    );
-#endif
-
-
-#ifdef ANDROID
-    nsCOMPtr<nsIPropertyBag2> infoService = do_GetService("@mozilla.org/system-info;1");
-    MOZ_ASSERT(infoService, "Could not find a system info service");
-    nsresult rv;
-    // Add the Android version number to the Fennec platform identifier.
-#if defined MOZ_WIDGET_ANDROID
-#ifndef MOZ_UA_OS_AGNOSTIC // Don't add anything to mPlatform since it's empty.
-    nsAutoString androidVersion;
-    rv = infoService->GetPropertyAsAString(
-        NS_LITERAL_STRING("release_version"), androidVersion);
-    if (NS_SUCCEEDED(rv)) {
-      mPlatform += " ";
-      // If the 2nd character is a ".", we know the major version is a single
-      // digit. If we're running on a version below 4 we pretend to be on
-      // Android KitKat (4.4) to work around scripts sniffing for low versions.
-      if (androidVersion[1] == 46 && androidVersion[0] < 52) {
-        mPlatform += "4.4";
-      } else {
-        mPlatform += NS_LossyConvertUTF16toASCII(androidVersion);
-      }
-    }
-#endif
-#endif
-    // Add the `Mobile` or `Tablet` or `TV` token when running on device.
-    bool isTablet;
-    rv = infoService->GetPropertyAsBool(NS_LITERAL_STRING("tablet"), &isTablet);
-    if (NS_SUCCEEDED(rv) && isTablet) {
-        mCompatDevice.AssignLiteral("Tablet");
-    } else {
-        bool isTV;
-        rv = infoService->GetPropertyAsBool(NS_LITERAL_STRING("tv"), &isTV);
-        if (NS_SUCCEEDED(rv) && isTV) {
-            mCompatDevice.AssignLiteral("TV");
-        } else {
-            mCompatDevice.AssignLiteral("Mobile");
-        }
-    }
-
-    if (Preferences::GetBool(UA_PREF("use_device"), false)) {
-        mDeviceModelId = mozilla::net::GetDeviceModelId();
-    }
-#endif // ANDROID
-
-#ifdef FXOS_SIMULATOR
-    {
-        // Add the `Mobile` or `Tablet` or `TV` token when running in the b2g
-        // desktop simulator via preference.
-        nsCString deviceType;
-        nsresult rv = Preferences::GetCString("devtools.useragent.device_type", &deviceType);
-        if (NS_SUCCEEDED(rv)) {
-            mCompatDevice.Assign(deviceType);
-        } else {
-            mCompatDevice.AssignLiteral("Mobile");
-        }
-    }
-#endif // FXOS_SIMULATOR
-
-#if defined(MOZ_WIDGET_GONK)
-    // Device model identifier should be a simple token, which can be composed
-    // of letters, numbers, hyphen ("-") and dot (".").
-    // Any other characters means the identifier is invalid and ignored.
-    nsCString deviceId;
-    rv = Preferences::GetCString("general.useragent.device_id", &deviceId);
-    if (NS_SUCCEEDED(rv)) {
-        bool valid = true;
-        deviceId.Trim(" ", true, true);
-        for (size_t i = 0; i < deviceId.Length(); i++) {
-            char c = deviceId.CharAt(i);
-            if (!(isalnum(c) || c == '-' || c == '.')) {
-                valid = false;
-                break;
-            }
-        }
-        if (valid) {
-            mDeviceModelId = deviceId;
-        } else {
-            LOG(("nsHttpHandler: Ignore invalid device ID: [%s]\n",
-                  deviceId.get()));
-        }
-    }
-#endif
-
-#ifndef MOZ_UA_OS_AGNOSTIC
-    // Gather OS/CPU.
-#if defined(XP_WIN)
-    OSVERSIONINFO info = { sizeof(OSVERSIONINFO) };
-#pragma warning(push)
-#pragma warning(disable:4996)
-    if (GetVersionEx(&info)) {
-#pragma warning(pop)
-        const char *format;
-#if defined _M_IA64
-        format = WNT_BASE W64_PREFIX "; IA64";
-#elif defined _M_X64 || defined _M_AMD64
-        format = WNT_BASE W64_PREFIX "; x64";
-#else
-        BOOL isWow64 = FALSE;
-        if (!IsWow64Process(GetCurrentProcess(), &isWow64)) {
-            isWow64 = FALSE;
-        }
-        format = isWow64
-          ? WNT_BASE "; WOW64"
-          : WNT_BASE;
-#endif
-        char *buf = PR_smprintf(format,
-                                info.dwMajorVersion,
-                                info.dwMinorVersion);
-        if (buf) {
-            mOscpu = buf;
-            PR_smprintf_free(buf);
-        }
-    }
-#elif defined (XP_MACOSX)
-#if defined(__ppc__)
-    mOscpu.AssignLiteral("PPC Mac OS X");
-#elif defined(__i386__) || defined(__x86_64__)
-    mOscpu.AssignLiteral("Intel Mac OS X");
-#endif
-    SInt32 majorVersion = nsCocoaFeatures::OSXVersionMajor();
-    SInt32 minorVersion = nsCocoaFeatures::OSXVersionMinor();
-    mOscpu += nsPrintfCString(" %d.%d", majorVersion, minorVersion);
-#elif defined (XP_UNIX)
-    struct utsname name;
-
-    int ret = uname(&name);
-    if (ret >= 0) {
-        nsAutoCString buf;
-        buf =  (char*)name.sysname;
-
-        if (strcmp(name.machine, "x86_64") == 0 &&
-            sizeof(void *) == sizeof(int32_t)) {
-            // We're running 32-bit code on x86_64. Make this browser
-            // look like it's running on i686 hardware, but append "
-            // (x86_64)" to the end of the oscpu identifier to be able
-            // to differentiate this from someone running 64-bit code
-            // on x86_64..
-
-            buf += " i686 on x86_64";
-        } else {
-            buf += ' ';
-
-#ifdef AIX
-            // AIX uname returns machine specific info in the uname.machine
-            // field and does not return the cpu type like other platforms.
-            // We use the AIX version and release numbers instead.
-            buf += (char*)name.version;
-            buf += '.';
-            buf += (char*)name.release;
-#else
-            buf += (char*)name.machine;
-#endif
-        }
-
-        mOscpu.Assign(buf);
-    }
-#endif
-#endif
-
-    mUserAgentIsDirty = true;
-}
-
-uint32_t
-nsHttpHandler::MaxSocketCount()
-{
-    PR_CallOnce(&nsSocketTransportService::gMaxCountInitOnce,
-                nsSocketTransportService::DiscoverMaxCount);
-    // Don't use the full max count because sockets can be held in
-    // the persistent connection pool for a long time and that could
-    // starve other users.
-
-    uint32_t maxCount = nsSocketTransportService::gMaxCount;
-    if (maxCount <= 8)
-        maxCount = 1;
-    else
-        maxCount -= 8;
-
-    return maxCount;
-}
-
-void
-nsHttpHandler::PrefsChanged(nsIPrefBranch *prefs, const char *pref)
-{
-    nsresult rv = NS_OK;
-    int32_t val;
-
-    LOG(("nsHttpHandler::PrefsChanged [pref=%s]\n", pref));
-
-#define PREF_CHANGED(p) ((pref == nullptr) || !PL_strcmp(pref, p))
-#define MULTI_PREF_CHANGED(p) \
-  ((pref == nullptr) || !PL_strncmp(pref, p, sizeof(p) - 1))
-
-    // If a security pref changed, lets clear our connection pool reuse
-    if (MULTI_PREF_CHANGED(SECURITY_PREFIX)) {
-        LOG(("nsHttpHandler::PrefsChanged Security Pref Changed %s\n", pref));
-        if (mConnMgr) {
-            mConnMgr->DoShiftReloadConnectionCleanup(nullptr);
-            mConnMgr->PruneDeadConnections();
-        }
-    }
-
-    //
-    // UA components
-    //
-
-    bool cVar = false;
-
-    if (PREF_CHANGED(UA_PREF("compatMode.firefox"))) {
-        rv = prefs->GetBoolPref(UA_PREF("compatMode.firefox"), &cVar);
-        mCompatFirefoxEnabled = (NS_SUCCEEDED(rv) && cVar);
-        mUserAgentIsDirty = true;
-    }
-
-    // general.useragent.override
-    if (PREF_CHANGED(UA_PREF("override"))) {
-        prefs->GetCharPref(UA_PREF("override"),
-                            getter_Copies(mUserAgentOverride));
-        mUserAgentIsDirty = true;
-    }
-
-#ifdef ANDROID
-    // general.useragent.use_device
-    if (PREF_CHANGED(UA_PREF("use_device"))) {
-        if (Preferences::GetBool(UA_PREF("use_device"), false)) {
-            mDeviceModelId = mozilla::net::GetDeviceModelId();
-        } else {
-            mDeviceModelId = EmptyCString();
-        }
-        mUserAgentIsDirty = true;
-    }
-#endif
-
-    //
-    // HTTP options
-    //
-
-    if (PREF_CHANGED(HTTP_PREF("keep-alive.timeout"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("keep-alive.timeout"), &val);
-        if (NS_SUCCEEDED(rv))
-            mIdleTimeout = PR_SecondsToInterval(clamped(val, 1, 0xffff));
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("request.max-attempts"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("request.max-attempts"), &val);
-        if (NS_SUCCEEDED(rv))
-            mMaxRequestAttempts = (uint16_t) clamped(val, 1, 0xffff);
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("request.max-start-delay"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("request.max-start-delay"), &val);
-        if (NS_SUCCEEDED(rv)) {
-            mMaxRequestDelay = (uint16_t) clamped(val, 0, 0xffff);
-            if (mConnMgr)
-                mConnMgr->UpdateParam(nsHttpConnectionMgr::MAX_REQUEST_DELAY,
-                                      mMaxRequestDelay);
-        }
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("response.timeout"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("response.timeout"), &val);
-        if (NS_SUCCEEDED(rv))
-            mResponseTimeout = PR_SecondsToInterval(clamped(val, 0, 0xffff));
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("network-changed.timeout"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("network-changed.timeout"), &val);
-        if (NS_SUCCEEDED(rv))
-            mNetworkChangedTimeout = clamped(val, 1, 600) * 1000;
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("max-connections"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("max-connections"), &val);
-        if (NS_SUCCEEDED(rv)) {
-
-            mMaxConnections = (uint16_t) clamped((uint32_t)val,
-                                                 (uint32_t)1, MaxSocketCount());
-
-            if (mConnMgr)
-                mConnMgr->UpdateParam(nsHttpConnectionMgr::MAX_CONNECTIONS,
-                                      mMaxConnections);
-        }
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("max-persistent-connections-per-server"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("max-persistent-connections-per-server"), &val);
-        if (NS_SUCCEEDED(rv)) {
-            mMaxPersistentConnectionsPerServer = (uint8_t) clamped(val, 1, 0xff);
-            if (mConnMgr)
-                mConnMgr->UpdateParam(nsHttpConnectionMgr::MAX_PERSISTENT_CONNECTIONS_PER_HOST,
-                                      mMaxPersistentConnectionsPerServer);
-        }
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("max-persistent-connections-per-proxy"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("max-persistent-connections-per-proxy"), &val);
-        if (NS_SUCCEEDED(rv)) {
-            mMaxPersistentConnectionsPerProxy = (uint8_t) clamped(val, 1, 0xff);
-            if (mConnMgr)
-                mConnMgr->UpdateParam(nsHttpConnectionMgr::MAX_PERSISTENT_CONNECTIONS_PER_PROXY,
-                                      mMaxPersistentConnectionsPerProxy);
-        }
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("sendRefererHeader"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("sendRefererHeader"), &val);
-        if (NS_SUCCEEDED(rv))
-            mReferrerLevel = (uint8_t) clamped(val, 0, 0xff);
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("referer.spoofSource"))) {
-        rv = prefs->GetBoolPref(HTTP_PREF("referer.spoofSource"), &cVar);
-        if (NS_SUCCEEDED(rv))
-            mSpoofReferrerSource = cVar;
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("referer.trimmingPolicy"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("referer.trimmingPolicy"), &val);
-        if (NS_SUCCEEDED(rv))
-            mReferrerTrimmingPolicy = (uint8_t) clamped(val, 0, 0xff);
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("referer.XOriginPolicy"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("referer.XOriginPolicy"), &val);
-        if (NS_SUCCEEDED(rv))
-            mReferrerXOriginPolicy = (uint8_t) clamped(val, 0, 0xff);
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("redirection-limit"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("redirection-limit"), &val);
-        if (NS_SUCCEEDED(rv))
-            mRedirectionLimit = (uint8_t) clamped(val, 0, 0xff);
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("connection-retry-timeout"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("connection-retry-timeout"), &val);
-        if (NS_SUCCEEDED(rv))
-            mIdleSynTimeout = (uint16_t) clamped(val, 0, 3000);
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("fast-fallback-to-IPv4"))) {
-        rv = prefs->GetBoolPref(HTTP_PREF("fast-fallback-to-IPv4"), &cVar);
-        if (NS_SUCCEEDED(rv))
-            mFastFallbackToIPv4 = cVar;
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("version"))) {
-        nsXPIDLCString httpVersion;
-        prefs->GetCharPref(HTTP_PREF("version"), getter_Copies(httpVersion));
-        if (httpVersion) {
-            if (!PL_strcmp(httpVersion, "1.1"))
-                mHttpVersion = NS_HTTP_VERSION_1_1;
-            else if (!PL_strcmp(httpVersion, "0.9"))
-                mHttpVersion = NS_HTTP_VERSION_0_9;
-            else
-                mHttpVersion = NS_HTTP_VERSION_1_0;
-        }
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("proxy.version"))) {
-        nsXPIDLCString httpVersion;
-        prefs->GetCharPref(HTTP_PREF("proxy.version"), getter_Copies(httpVersion));
-        if (httpVersion) {
-            if (!PL_strcmp(httpVersion, "1.1"))
-                mProxyHttpVersion = NS_HTTP_VERSION_1_1;
-            else
-                mProxyHttpVersion = NS_HTTP_VERSION_1_0;
-            // it does not make sense to issue a HTTP/0.9 request to a proxy server
-        }
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("pipelining"))) {
-        rv = prefs->GetBoolPref(HTTP_PREF("pipelining"), &cVar);
-        if (NS_SUCCEEDED(rv)) {
-            if (cVar)
-                mCapabilities |=  NS_HTTP_ALLOW_PIPELINING;
-            else
-                mCapabilities &= ~NS_HTTP_ALLOW_PIPELINING;
-            mPipeliningEnabled = cVar;
-        }
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("pipelining.maxrequests"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("pipelining.maxrequests"), &val);
-        if (NS_SUCCEEDED(rv)) {
-            mMaxPipelinedRequests = clamped(val, 1, 0xffff);
-            if (mConnMgr)
-                mConnMgr->UpdateParam(nsHttpConnectionMgr::MAX_PIPELINED_REQUESTS,
-                                      mMaxPipelinedRequests);
-        }
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("pipelining.max-optimistic-requests"))) {
-        rv = prefs->
-            GetIntPref(HTTP_PREF("pipelining.max-optimistic-requests"), &val);
-        if (NS_SUCCEEDED(rv)) {
-            mMaxOptimisticPipelinedRequests = clamped(val, 1, 0xffff);
-            if (mConnMgr)
-                mConnMgr->UpdateParam
-                    (nsHttpConnectionMgr::MAX_OPTIMISTIC_PIPELINED_REQUESTS,
-                     mMaxOptimisticPipelinedRequests);
-        }
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("pipelining.aggressive"))) {
-        rv = prefs->GetBoolPref(HTTP_PREF("pipelining.aggressive"), &cVar);
-        if (NS_SUCCEEDED(rv))
-            mPipelineAggressive = cVar;
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("pipelining.maxsize"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("pipelining.maxsize"), &val);
-        if (NS_SUCCEEDED(rv)) {
-            mMaxPipelineObjectSize =
-                static_cast<int64_t>(clamped(val, 1000, 100000000));
-        }
-    }
-
-    // Determines whether or not to actually reschedule after the
-    // reschedule-timeout has expired
-    if (PREF_CHANGED(HTTP_PREF("pipelining.reschedule-on-timeout"))) {
-        rv = prefs->GetBoolPref(HTTP_PREF("pipelining.reschedule-on-timeout"),
-                                &cVar);
-        if (NS_SUCCEEDED(rv))
-            mPipelineRescheduleOnTimeout = cVar;
-    }
-
-    // The amount of time head of line blocking is allowed (in ms)
-    // before the blocked transactions are moved to another pipeline
-    if (PREF_CHANGED(HTTP_PREF("pipelining.reschedule-timeout"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("pipelining.reschedule-timeout"),
-                               &val);
-        if (NS_SUCCEEDED(rv)) {
-            mPipelineRescheduleTimeout =
-                PR_MillisecondsToInterval((uint16_t) clamped(val, 500, 0xffff));
-        }
-    }
-
-    // The amount of time a pipelined transaction is allowed to wait before
-    // being canceled and retried in a non-pipeline connection
-    if (PREF_CHANGED(HTTP_PREF("pipelining.read-timeout"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("pipelining.read-timeout"), &val);
-        if (NS_SUCCEEDED(rv)) {
-            mPipelineReadTimeout =
-                PR_MillisecondsToInterval((uint16_t) clamped(val, 5000,
-                                                             0xffff));
-        }
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("pipelining.ssl"))) {
-        rv = prefs->GetBoolPref(HTTP_PREF("pipelining.ssl"), &cVar);
-        if (NS_SUCCEEDED(rv))
-            mPipeliningOverSSL = cVar;
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("proxy.pipelining"))) {
-        rv = prefs->GetBoolPref(HTTP_PREF("proxy.pipelining"), &cVar);
-        if (NS_SUCCEEDED(rv))
-            mProxyPipelining = cVar;
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("qos"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("qos"), &val);
-        if (NS_SUCCEEDED(rv))
-            mQoSBits = (uint8_t) clamped(val, 0, 0xff);
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("sendSecureXSiteReferrer"))) {
-        rv = prefs->GetBoolPref(HTTP_PREF("sendSecureXSiteReferrer"), &cVar);
-        if (NS_SUCCEEDED(rv))
-            mSendSecureXSiteReferrer = cVar;
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("accept.default"))) {
-        nsXPIDLCString accept;
-        rv = prefs->GetCharPref(HTTP_PREF("accept.default"),
-                                  getter_Copies(accept));
-        if (NS_SUCCEEDED(rv))
-            SetAccept(accept);
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("accept-encoding"))) {
-        nsXPIDLCString acceptEncodings;
-        rv = prefs->GetCharPref(HTTP_PREF("accept-encoding"),
-                                  getter_Copies(acceptEncodings));
-        if (NS_SUCCEEDED(rv)) {
-            SetAcceptEncodings(acceptEncodings, false);
-        }
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("accept-encoding.secure"))) {
-        nsXPIDLCString acceptEncodings;
-        rv = prefs->GetCharPref(HTTP_PREF("accept-encoding.secure"),
-                                  getter_Copies(acceptEncodings));
-        if (NS_SUCCEEDED(rv)) {
-            SetAcceptEncodings(acceptEncodings, true);
-        }
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("default-socket-type"))) {
-        nsXPIDLCString sval;
-        rv = prefs->GetCharPref(HTTP_PREF("default-socket-type"),
-                                getter_Copies(sval));
-        if (NS_SUCCEEDED(rv)) {
-            if (sval.IsEmpty())
-                mDefaultSocketType.Adopt(0);
-            else {
-                // verify that this socket type is actually valid
-                nsCOMPtr<nsISocketProviderService> sps(
-                        do_GetService(NS_SOCKETPROVIDERSERVICE_CONTRACTID));
-                if (sps) {
-                    nsCOMPtr<nsISocketProvider> sp;
-                    rv = sps->GetSocketProvider(sval, getter_AddRefs(sp));
-                    if (NS_SUCCEEDED(rv)) {
-                        // OK, this looks like a valid socket provider.
-                        mDefaultSocketType.Assign(sval);
-                    }
-                }
-            }
-        }
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("prompt-temp-redirect"))) {
-        rv = prefs->GetBoolPref(HTTP_PREF("prompt-temp-redirect"), &cVar);
-        if (NS_SUCCEEDED(rv)) {
-            mPromptTempRedirect = cVar;
-        }
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("assoc-req.enforce"))) {
-        cVar = false;
-        rv = prefs->GetBoolPref(HTTP_PREF("assoc-req.enforce"), &cVar);
-        if (NS_SUCCEEDED(rv))
-            mEnforceAssocReq = cVar;
-    }
-
-    // enable Persistent caching for HTTPS - bug#205921
-    if (PREF_CHANGED(BROWSER_PREF("disk_cache_ssl"))) {
-        cVar = false;
-        rv = prefs->GetBoolPref(BROWSER_PREF("disk_cache_ssl"), &cVar);
-        if (NS_SUCCEEDED(rv))
-            mEnablePersistentHttpsCaching = cVar;
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("phishy-userpass-length"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("phishy-userpass-length"), &val);
-        if (NS_SUCCEEDED(rv))
-            mPhishyUserPassLength = (uint8_t) clamped(val, 0, 0xff);
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("spdy.enabled"))) {
-        rv = prefs->GetBoolPref(HTTP_PREF("spdy.enabled"), &cVar);
-        if (NS_SUCCEEDED(rv))
-            mEnableSpdy = cVar;
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("spdy.enabled.v3-1"))) {
-        rv = prefs->GetBoolPref(HTTP_PREF("spdy.enabled.v3-1"), &cVar);
-        if (NS_SUCCEEDED(rv))
-            mSpdyV31 = cVar;
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("spdy.enabled.http2"))) {
-        rv = prefs->GetBoolPref(HTTP_PREF("spdy.enabled.http2"), &cVar);
-        if (NS_SUCCEEDED(rv))
-            mHttp2Enabled = cVar;
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("spdy.enabled.deps"))) {
-        rv = prefs->GetBoolPref(HTTP_PREF("spdy.enabled.deps"), &cVar);
-        if (NS_SUCCEEDED(rv))
-            mUseH2Deps = cVar;
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("spdy.enforce-tls-profile"))) {
-        rv = prefs->GetBoolPref(HTTP_PREF("spdy.enforce-tls-profile"), &cVar);
-        if (NS_SUCCEEDED(rv))
-            mEnforceHttp2TlsProfile = cVar;
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("spdy.coalesce-hostnames"))) {
-        rv = prefs->GetBoolPref(HTTP_PREF("spdy.coalesce-hostnames"), &cVar);
-        if (NS_SUCCEEDED(rv))
-            mCoalesceSpdy = cVar;
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("spdy.persistent-settings"))) {
-        rv = prefs->GetBoolPref(HTTP_PREF("spdy.persistent-settings"),
-                                &cVar);
-        if (NS_SUCCEEDED(rv))
-            mSpdyPersistentSettings = cVar;
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("spdy.timeout"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("spdy.timeout"), &val);
-        if (NS_SUCCEEDED(rv))
-            mSpdyTimeout = PR_SecondsToInterval(clamped(val, 1, 0xffff));
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("spdy.chunk-size"))) {
-        // keep this within http/2 ranges of 1 to 2^14-1
-        rv = prefs->GetIntPref(HTTP_PREF("spdy.chunk-size"), &val);
-        if (NS_SUCCEEDED(rv))
-            mSpdySendingChunkSize = (uint32_t) clamped(val, 1, 0x3fff);
-    }
-
-    // The amount of idle seconds on a spdy connection before initiating a
-    // server ping. 0 will disable.
-    if (PREF_CHANGED(HTTP_PREF("spdy.ping-threshold"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("spdy.ping-threshold"), &val);
-        if (NS_SUCCEEDED(rv))
-            mSpdyPingThreshold =
-                PR_SecondsToInterval((uint16_t) clamped(val, 0, 0x7fffffff));
-    }
-
-    // The amount of seconds to wait for a spdy ping response before
-    // closing the session.
-    if (PREF_CHANGED(HTTP_PREF("spdy.ping-timeout"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("spdy.ping-timeout"), &val);
-        if (NS_SUCCEEDED(rv))
-            mSpdyPingTimeout =
-                PR_SecondsToInterval((uint16_t) clamped(val, 0, 0x7fffffff));
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("spdy.allow-push"))) {
-        rv = prefs->GetBoolPref(HTTP_PREF("spdy.allow-push"),
-                                &cVar);
-        if (NS_SUCCEEDED(rv))
-            mAllowPush = cVar;
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("altsvc.enabled"))) {
-        rv = prefs->GetBoolPref(HTTP_PREF("altsvc.enabled"),
-                                &cVar);
-        if (NS_SUCCEEDED(rv))
-            mEnableAltSvc = cVar;
-    }
-
-
-    if (PREF_CHANGED(HTTP_PREF("altsvc.oe"))) {
-        rv = prefs->GetBoolPref(HTTP_PREF("altsvc.oe"),
-                                &cVar);
-        if (NS_SUCCEEDED(rv))
-            mEnableAltSvcOE = cVar;
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("spdy.push-allowance"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("spdy.push-allowance"), &val);
-        if (NS_SUCCEEDED(rv)) {
-            mSpdyPushAllowance =
-                static_cast<uint32_t>
-                (clamped(val, 1024, static_cast<int32_t>(ASpdySession::kInitialRwin)));
-        }
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("spdy.pull-allowance"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("spdy.pull-allowance"), &val);
-        if (NS_SUCCEEDED(rv)) {
-            mSpdyPullAllowance =
-                static_cast<uint32_t>(clamped(val, 1024, 0x7fffffff));
-        }
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("spdy.default-concurrent"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("spdy.default-concurrent"), &val);
-        if (NS_SUCCEEDED(rv)) {
-            mDefaultSpdyConcurrent =
-                static_cast<uint32_t>(std::max<int32_t>(std::min<int32_t>(val, 9999), 1));
-        }
-    }
-
-    // The amount of seconds to wait for a spdy ping response before
-    // closing the session.
-    if (PREF_CHANGED(HTTP_PREF("spdy.send-buffer-size"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("spdy.send-buffer-size"), &val);
-        if (NS_SUCCEEDED(rv))
-            mSpdySendBufferSize = (uint32_t) clamped(val, 1500, 0x7fffffff);
-    }
-
-    // The maximum amount of time to wait for socket transport to be
-    // established
-    if (PREF_CHANGED(HTTP_PREF("connection-timeout"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("connection-timeout"), &val);
-        if (NS_SUCCEEDED(rv))
-            // the pref is in seconds, but the variable is in milliseconds
-            mConnectTimeout = clamped(val, 1, 0xffff) * PR_MSEC_PER_SEC;
-    }
-
-    // The maximum number of current global half open sockets allowable
-    // for starting a new speculative connection.
-    if (PREF_CHANGED(HTTP_PREF("speculative-parallel-limit"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("speculative-parallel-limit"), &val);
-        if (NS_SUCCEEDED(rv))
-            mParallelSpeculativeConnectLimit = (uint32_t) clamped(val, 0, 1024);
-    }
-
-    // Whether or not to block requests for non head js/css items (e.g. media)
-    // while those elements load.
-    if (PREF_CHANGED(HTTP_PREF("rendering-critical-requests-prioritization"))) {
-        rv = prefs->GetBoolPref(HTTP_PREF("rendering-critical-requests-prioritization"), &cVar);
-        if (NS_SUCCEEDED(rv))
-            mCriticalRequestPrioritization = cVar;
-    }
-
-    // on transition of network.http.diagnostics to true print
-    // a bunch of information to the console
-    if (pref && PREF_CHANGED(HTTP_PREF("diagnostics"))) {
-        rv = prefs->GetBoolPref(HTTP_PREF("diagnostics"), &cVar);
-        if (NS_SUCCEEDED(rv) && cVar) {
-            if (mConnMgr)
-                mConnMgr->PrintDiagnostics();
-        }
-    }
-    //
-    // INTL options
-    //
-
-    if (PREF_CHANGED(INTL_ACCEPT_LANGUAGES)) {
-        nsCOMPtr<nsIPrefLocalizedString> pls;
-        prefs->GetComplexValue(INTL_ACCEPT_LANGUAGES,
-                                NS_GET_IID(nsIPrefLocalizedString),
-                                getter_AddRefs(pls));
-        if (pls) {
-            nsXPIDLString uval;
-            pls->ToString(getter_Copies(uval));
-            if (uval)
-                SetAcceptLanguages(NS_ConvertUTF16toUTF8(uval).get());
-        }
-    }
-
-    //
-    // Tracking options
-    //
-
-    if (PREF_CHANGED(DONOTTRACK_HEADER_ENABLED)) {
-        cVar = false;
-        rv = prefs->GetBoolPref(DONOTTRACK_HEADER_ENABLED, &cVar);
-        if (NS_SUCCEEDED(rv)) {
-            mDoNotTrackEnabled = cVar;
-        }
-    }
-    // Hint option
-    if (PREF_CHANGED(SAFE_HINT_HEADER_VALUE)) {
-        cVar = false;
-        rv = prefs->GetBoolPref(SAFE_HINT_HEADER_VALUE, &cVar);
-        if (NS_SUCCEEDED(rv)) {
-            mSafeHintEnabled = cVar;
-        }
-    }
-
-    // toggle to true anytime a token bucket related pref is changed.. that
-    // includes telemetry and allow-experiments because of the abtest profile
-    bool requestTokenBucketUpdated = false;
-
-    //
-    // Telemetry
-    //
-
-    if (PREF_CHANGED(TELEMETRY_ENABLED)) {
-        cVar = false;
-        requestTokenBucketUpdated = true;
-        rv = prefs->GetBoolPref(TELEMETRY_ENABLED, &cVar);
-        if (NS_SUCCEEDED(rv)) {
-            mTelemetryEnabled = cVar;
-        }
-    }
-
-    // "security.ssl3.ecdhe_rsa_aes_128_gcm_sha256" is the required h2 interop
-    // suite.
-
-    if (PREF_CHANGED(H2MANDATORY_SUITE)) {
-        cVar = false;
-        rv = prefs->GetBoolPref(H2MANDATORY_SUITE, &cVar);
-        if (NS_SUCCEEDED(rv)) {
-            mH2MandatorySuiteEnabled = cVar;
-        }
-    }
-
-    //
-    // network.allow-experiments
-    //
-    if (PREF_CHANGED(ALLOW_EXPERIMENTS)) {
-        cVar = true;
-        requestTokenBucketUpdated = true;
-        rv = prefs->GetBoolPref(ALLOW_EXPERIMENTS, &cVar);
-        if (NS_SUCCEEDED(rv)) {
-            mAllowExperiments = cVar;
-        }
-    }
-
-    // network.http.debug-observations
-    if (PREF_CHANGED("network.http.debug-observations")) {
-        cVar = false;
-        rv = prefs->GetBoolPref("network.http.debug-observations", &cVar);
-        if (NS_SUCCEEDED(rv)) {
-            mDebugObservations = cVar;
-        }
-    }
-
-    //
-    // Test HTTP Pipelining (bug796192)
-    // If experiments are allowed and pipelining is Off,
-    // turn it On for just 10 minutes
-    //
-    if (mAllowExperiments && !mPipeliningEnabled &&
-        PREF_CHANGED(HTTP_PREF("pipelining.abtest"))) {
-        rv = prefs->GetBoolPref(HTTP_PREF("pipelining.abtest"), &cVar);
-        if (NS_SUCCEEDED(rv)) {
-            // If option is enabled, only test for ~1% of sessions
-            if (cVar && !(rand() % 128)) {
-                mCapabilities |=  NS_HTTP_ALLOW_PIPELINING;
-                if (mPipelineTestTimer)
-                    mPipelineTestTimer->Cancel();
-                mPipelineTestTimer =
-                    do_CreateInstance("@mozilla.org/timer;1", &rv);
-                if (NS_SUCCEEDED(rv)) {
-                    rv = mPipelineTestTimer->InitWithFuncCallback(
-                        TimerCallback, this, 10*60*1000, // 10 minutes
-                        nsITimer::TYPE_ONE_SHOT);
-                }
-            } else {
-                mCapabilities &= ~NS_HTTP_ALLOW_PIPELINING;
-                if (mPipelineTestTimer) {
-                    mPipelineTestTimer->Cancel();
-                    mPipelineTestTimer = nullptr;
-                }
-            }
-        }
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("pacing.requests.enabled"))) {
-        rv = prefs->GetBoolPref(HTTP_PREF("pacing.requests.enabled"), &cVar);
-        if (NS_SUCCEEDED(rv)) {
-            mRequestTokenBucketEnabled = cVar;
-            requestTokenBucketUpdated = true;
-        }
-    }
-    if (PREF_CHANGED(HTTP_PREF("pacing.requests.min-parallelism"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("pacing.requests.min-parallelism"), &val);
-        if (NS_SUCCEEDED(rv)) {
-            mRequestTokenBucketMinParallelism = static_cast<uint16_t>(clamped(val, 1, 1024));
-            requestTokenBucketUpdated = true;
-        }
-    }
-    if (PREF_CHANGED(HTTP_PREF("pacing.requests.hz"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("pacing.requests.hz"), &val);
-        if (NS_SUCCEEDED(rv)) {
-            mRequestTokenBucketHz = static_cast<uint32_t>(clamped(val, 1, 10000));
-            requestTokenBucketUpdated = true;
-        }
-    }
-    if (PREF_CHANGED(HTTP_PREF("pacing.requests.burst"))) {
-        rv = prefs->GetIntPref(HTTP_PREF("pacing.requests.burst"), &val);
-        if (NS_SUCCEEDED(rv)) {
-            mRequestTokenBucketBurst = val ? val : 1;
-            requestTokenBucketUpdated = true;
-        }
-    }
-    if (requestTokenBucketUpdated) {
-        MakeNewRequestTokenBucket();
-    }
-
-    // Keepalive values for initial and idle connections.
-    if (PREF_CHANGED(HTTP_PREF("tcp_keepalive.short_lived_connections"))) {
-        rv = prefs->GetBoolPref(
-            HTTP_PREF("tcp_keepalive.short_lived_connections"), &cVar);
-        if (NS_SUCCEEDED(rv) && cVar != mTCPKeepaliveShortLivedEnabled) {
-            mTCPKeepaliveShortLivedEnabled = cVar;
-        }
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("tcp_keepalive.short_lived_time"))) {
-        rv = prefs->GetIntPref(
-            HTTP_PREF("tcp_keepalive.short_lived_time"), &val);
-        if (NS_SUCCEEDED(rv) && val > 0)
-            mTCPKeepaliveShortLivedTimeS = clamped(val, 1, 300); // Max 5 mins.
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("tcp_keepalive.short_lived_idle_time"))) {
-        rv = prefs->GetIntPref(
-            HTTP_PREF("tcp_keepalive.short_lived_idle_time"), &val);
-        if (NS_SUCCEEDED(rv) && val > 0)
-            mTCPKeepaliveShortLivedIdleTimeS = clamped(val,
-                                                       1, kMaxTCPKeepIdle);
-    }
-
-    // Keepalive values for Long-lived Connections.
-    if (PREF_CHANGED(HTTP_PREF("tcp_keepalive.long_lived_connections"))) {
-        rv = prefs->GetBoolPref(
-            HTTP_PREF("tcp_keepalive.long_lived_connections"), &cVar);
-        if (NS_SUCCEEDED(rv) && cVar != mTCPKeepaliveLongLivedEnabled) {
-            mTCPKeepaliveLongLivedEnabled = cVar;
-        }
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("tcp_keepalive.long_lived_idle_time"))) {
-        rv = prefs->GetIntPref(
-            HTTP_PREF("tcp_keepalive.long_lived_idle_time"), &val);
-        if (NS_SUCCEEDED(rv) && val > 0)
-            mTCPKeepaliveLongLivedIdleTimeS = clamped(val,
-                                                      1, kMaxTCPKeepIdle);
-    }
-
-    if (PREF_CHANGED(HTTP_PREF("enforce-framing.http1")) ||
-        PREF_CHANGED(HTTP_PREF("enforce-framing.soft")) ) {
-        rv = prefs->GetBoolPref(HTTP_PREF("enforce-framing.http1"), &cVar);
-        if (NS_SUCCEEDED(rv) && cVar) {
-            mEnforceH1Framing = FRAMECHECK_STRICT;
-        } else {
-            rv = prefs->GetBoolPref(HTTP_PREF("enforce-framing.soft"), &cVar);
-            if (NS_SUCCEEDED(rv) && cVar) {
-                mEnforceH1Framing = FRAMECHECK_BARELY;
-            } else {
-                mEnforceH1Framing = FRAMECHECK_LAX;
-            }
-        }
-    }
-
-    // Enable HTTP response timeout if TCP Keepalives are disabled.
-    mResponseTimeoutEnabled = !mTCPKeepaliveShortLivedEnabled &&
-                              !mTCPKeepaliveLongLivedEnabled;
-
-#undef PREF_CHANGED
-#undef MULTI_PREF_CHANGED
-}
-
-
-/**
- * Static method called by mPipelineTestTimer when it expires.
- */
-void
-nsHttpHandler::TimerCallback(nsITimer * aTimer, void * aClosure)
-{
-    RefPtr<nsHttpHandler> thisObject = static_cast<nsHttpHandler*>(aClosure);
-    if (!thisObject->mPipeliningEnabled)
-        thisObject->mCapabilities &= ~NS_HTTP_ALLOW_PIPELINING;
-}
-
-/**
- * Currently, only regularizes the case of subtags.
- */
-static void
-CanonicalizeLanguageTag(char *languageTag)
-{
-    char *s = languageTag;
-    while (*s != '\0') {
-        *s = nsCRT::ToLower(*s);
-        s++;
-    }
-
-    s = languageTag;
-    bool isFirst = true;
-    bool seenSingleton = false;
-    while (*s != '\0') {
-        char *subTagEnd = strchr(s, '-');
-        if (subTagEnd == nullptr) {
-            subTagEnd = strchr(s, '\0');
-        }
-
-        if (isFirst) {
-            isFirst = false;
-        } else if (seenSingleton) {
-            // Do nothing
-        } else {
-            size_t subTagLength = subTagEnd - s;
-            if (subTagLength == 1) {
-                seenSingleton = true;
-            } else if (subTagLength == 2) {
-                *s = nsCRT::ToUpper(*s);
-                *(s + 1) = nsCRT::ToUpper(*(s + 1));
-            } else if (subTagLength == 4) {
-                *s = nsCRT::ToUpper(*s);
-            }
-        }
-
-        s = subTagEnd;
-        if (*s != '\0') {
-            s++;
-        }
-    }
-}
-
-/**
- *  Allocates a C string into that contains a ISO 639 language list
- *  notated with HTTP "q" values for output with a HTTP Accept-Language
- *  header. Previous q values will be stripped because the order of
- *  the langs imply the q value. The q values are calculated by dividing
- *  1.0 amongst the number of languages present.
- *
- *  Ex: passing: "en, ja"
- *      returns: "en,ja;q=0.5"
- *
- *      passing: "en, ja, fr_CA"
- *      returns: "en,ja;q=0.7,fr_CA;q=0.3"
- */
-static nsresult
-PrepareAcceptLanguages(const char *i_AcceptLanguages, nsACString &o_AcceptLanguages)
-{
-    if (!i_AcceptLanguages)
-        return NS_OK;
-
-    uint32_t n, count_n, size, wrote;
-    double q, dec;
-    char *p, *p2, *token, *q_Accept, *o_Accept;
-    const char *comma;
-    int32_t available;
-
-    o_Accept = strdup(i_AcceptLanguages);
-    if (!o_Accept)
-        return NS_ERROR_OUT_OF_MEMORY;
-    for (p = o_Accept, n = size = 0; '\0' != *p; p++) {
-        if (*p == ',') n++;
-            size++;
-    }
-
-    available = size + ++n * 11 + 1;
-    q_Accept = new char[available];
-    if (!q_Accept) {
-        free(o_Accept);
-        return NS_ERROR_OUT_OF_MEMORY;
-    }
-    *q_Accept = '\0';
-    q = 1.0;
-    dec = q / (double) n;
-    count_n = 0;
-    p2 = q_Accept;
-    for (token = nsCRT::strtok(o_Accept, ",", &p);
-         token != (char *) 0;
-         token = nsCRT::strtok(p, ",", &p))
-    {
-        token = net_FindCharNotInSet(token, HTTP_LWS);
-        char* trim;
-        trim = net_FindCharInSet(token, ";" HTTP_LWS);
-        if (trim != (char*)0)  // remove "; q=..." if present
-            *trim = '\0';
-
-        if (*token != '\0') {
-            CanonicalizeLanguageTag(token);
-
-            comma = count_n++ != 0 ? "," : ""; // delimiter if not first item
-            uint32_t u = QVAL_TO_UINT(q);
-
-            // Only display q-value if less than 1.00.
-            if (u < 100) {
-                const char *qval_str;
-
-                // With a small number of languages, one decimal place is enough to prevent duplicate q-values.
-                // Also, trailing zeroes do not add any information, so they can be removed.
-                if ((n < 10) || ((u % 10) == 0)) {
-                    u = (u + 5) / 10;
-                    qval_str = "%s%s;q=0.%u";
-                } else {
-                    // Values below 10 require zero padding.
-                    qval_str = "%s%s;q=0.%02u";
-                }
-
-                wrote = snprintf(p2, available, qval_str, comma, token, u);
-            } else {
-                wrote = snprintf(p2, available, "%s%s", comma, token);
-            }
-
-            q -= dec;
-            p2 += wrote;
-            available -= wrote;
-            MOZ_ASSERT(available > 0, "allocated string not long enough");
-        }
-    }
-    free(o_Accept);
-
-    o_AcceptLanguages.Assign((const char *) q_Accept);
-    delete [] q_Accept;
-
-    return NS_OK;
-}
-
-nsresult
-nsHttpHandler::SetAcceptLanguages(const char *aAcceptLanguages)
-{
-    nsAutoCString buf;
-    nsresult rv = PrepareAcceptLanguages(aAcceptLanguages, buf);
-    if (NS_SUCCEEDED(rv))
-        mAcceptLanguages.Assign(buf);
-    return rv;
-}
-
-nsresult
-nsHttpHandler::SetAccept(const char *aAccept)
-{
-    mAccept = aAccept;
-    return NS_OK;
-}
-
-nsresult
-nsHttpHandler::SetAcceptEncodings(const char *aAcceptEncodings, bool isSecure)
-{
-    if (isSecure) {
-        mHttpsAcceptEncodings = aAcceptEncodings;
-    } else {
-        // use legacy list if a secure override is not specified
-        mHttpAcceptEncodings = aAcceptEncodings;
-        if (mHttpsAcceptEncodings.IsEmpty()) {
-            mHttpsAcceptEncodings = aAcceptEncodings;
-        }
-    }
-      
-    return NS_OK;
-}
-
-//-----------------------------------------------------------------------------
-// nsHttpHandler::nsISupports
-//-----------------------------------------------------------------------------
-
-NS_IMPL_ISUPPORTS(nsHttpHandler,
-                  nsIHttpProtocolHandler,
-                  nsIProxiedProtocolHandler,
-                  nsIProtocolHandler,
-                  nsIObserver,
-                  nsISupportsWeakReference,
-                  nsISpeculativeConnect)
-
-//-----------------------------------------------------------------------------
-// nsHttpHandler::nsIProtocolHandler
-//-----------------------------------------------------------------------------
-
-NS_IMETHODIMP
-nsHttpHandler::GetScheme(nsACString &aScheme)
-{
-    aScheme.AssignLiteral("http");
-    return NS_OK;
-}
-
-NS_IMETHODIMP
-nsHttpHandler::GetDefaultPort(int32_t *result)
-{
-    *result = NS_HTTP_DEFAULT_PORT;
-    return NS_OK;
-}
-
-NS_IMETHODIMP
-nsHttpHandler::GetProtocolFlags(uint32_t *result)
-{
-    *result = NS_HTTP_PROTOCOL_FLAGS;
-    return NS_OK;
-}
-
-NS_IMETHODIMP
-nsHttpHandler::NewURI(const nsACString &aSpec,
-                      const char *aCharset,
-                      nsIURI *aBaseURI,
-                      nsIURI **aURI)
-{
-    return mozilla::net::NewURI(aSpec, aCharset, aBaseURI, NS_HTTP_DEFAULT_PORT, aURI);
-}
-
-NS_IMETHODIMP
-nsHttpHandler::NewChannel2(nsIURI* uri,
-                           nsILoadInfo* aLoadInfo,
-                           nsIChannel** result)
-{
-    LOG(("nsHttpHandler::NewChannel\n"));
-
-    NS_ENSURE_ARG_POINTER(uri);
-    NS_ENSURE_ARG_POINTER(result);
-
-    bool isHttp = false, isHttps = false;
-
-    // Verify that we have been given a valid scheme
-    nsresult rv = uri->SchemeIs("http", &isHttp);
-    if (NS_FAILED(rv)) return rv;
-    if (!isHttp) {
-        rv = uri->SchemeIs("https", &isHttps);
-        if (NS_FAILED(rv)) return rv;
-        if (!isHttps) {
-            NS_WARNING("Invalid URI scheme");
-            return NS_ERROR_UNEXPECTED;
-        }
-    }
-
-    return NewProxiedChannel2(uri, nullptr, 0, nullptr, aLoadInfo, result);
-}
-
-NS_IMETHODIMP
-nsHttpHandler::NewChannel(nsIURI *uri, nsIChannel **result)
-{
-    return NewChannel2(uri, nullptr, result);
-}
-
-NS_IMETHODIMP
-nsHttpHandler::AllowPort(int32_t port, const char *scheme, bool *_retval)
-{
-    // don't override anything.
-    *_retval = false;
-    return NS_OK;
-}
-
-//-----------------------------------------------------------------------------
-// nsHttpHandler::nsIProxiedProtocolHandler
-//-----------------------------------------------------------------------------
-
-NS_IMETHODIMP
-nsHttpHandler::NewProxiedChannel2(nsIURI *uri,
-                                  nsIProxyInfo* givenProxyInfo,
-                                  uint32_t proxyResolveFlags,
-                                  nsIURI *proxyURI,
-                                  nsILoadInfo* aLoadInfo,
-                                  nsIChannel** result)
-{
-    RefPtr<HttpBaseChannel> httpChannel;
-
-    LOG(("nsHttpHandler::NewProxiedChannel [proxyInfo=%p]\n",
-        givenProxyInfo));
-
-    nsCOMPtr<nsProxyInfo> proxyInfo;
-    if (givenProxyInfo) {
-        proxyInfo = do_QueryInterface(givenProxyInfo);
-        NS_ENSURE_ARG(proxyInfo);
-    }
-
-    bool https;
-    nsresult rv = uri->SchemeIs("https", &https);
-    if (NS_FAILED(rv))
-        return rv;
-
-    if (IsNeckoChild()) {
-        httpChannel = new HttpChannelChild();
-    } else {
-        httpChannel = new nsHttpChannel();
-    }
-
-    uint32_t caps = mCapabilities;
-
-    if (https) {
-        // enable pipelining over SSL if requested
-        if (mPipeliningOverSSL)
-            caps |= NS_HTTP_ALLOW_PIPELINING;
-    }
-
-    if (!IsNeckoChild()) {
-        // HACK: make sure PSM gets initialized on the main thread.
-        net_EnsurePSMInit();
-    }
-
-    rv = httpChannel->Init(uri, caps, proxyInfo, proxyResolveFlags, proxyURI);
-    if (NS_FAILED(rv))
-        return rv;
-
-    // set the loadInfo on the new channel
-    rv = httpChannel->SetLoadInfo(aLoadInfo);
-    if (NS_FAILED(rv)) {
-        return rv;
-    }
-
-    httpChannel.forget(result);
-    return NS_OK;
-}
-
-NS_IMETHODIMP
-nsHttpHandler::NewProxiedChannel(nsIURI *uri,
-                                 nsIProxyInfo* givenProxyInfo,
-                                 uint32_t proxyResolveFlags,
-                                 nsIURI *proxyURI,
-                                 nsIChannel **result)
-{
-    return NewProxiedChannel2(uri, givenProxyInfo,
-                              proxyResolveFlags, proxyURI,
-                              nullptr, result);
-}
-
-//-----------------------------------------------------------------------------
-// nsHttpHandler::nsIHttpProtocolHandler
-//-----------------------------------------------------------------------------
-
-NS_IMETHODIMP
-nsHttpHandler::GetUserAgent(nsACString &value)
-{
-    value = UserAgent();
-    return NS_OK;
-}
-
-NS_IMETHODIMP
-nsHttpHandler::GetAppName(nsACString &value)
-{
-    value = mLegacyAppName;
-    return NS_OK;
-}
-
-NS_IMETHODIMP
-nsHttpHandler::GetAppVersion(nsACString &value)
-{
-    value = mLegacyAppVersion;
-    return NS_OK;
-}
-
-NS_IMETHODIMP
-nsHttpHandler::GetPlatform(nsACString &value)
-{
-    value = mPlatform;
-    return NS_OK;
-}
-
-NS_IMETHODIMP
-nsHttpHandler::GetOscpu(nsACString &value)
-{
-    value = mOscpu;
-    return NS_OK;
-}
-
-NS_IMETHODIMP
-nsHttpHandler::GetMisc(nsACString &value)
-{
-    value = mMisc;
-    return NS_OK;
-}
-
-//-----------------------------------------------------------------------------
-// nsHttpHandler::nsIObserver
-//-----------------------------------------------------------------------------
-
-NS_IMETHODIMP
-nsHttpHandler::Observe(nsISupports *subject,
-                       const char *topic,
-                       const char16_t *data)
-{
-    MOZ_ASSERT(NS_IsMainThread());
-    LOG(("nsHttpHandler::Observe [topic=\"%s\"]\n", topic));
-
-    if (!strcmp(topic, NS_PREFBRANCH_PREFCHANGE_TOPIC_ID)) {
-        nsCOMPtr<nsIPrefBranch> prefBranch = do_QueryInterface(subject);
-        if (prefBranch)
-            PrefsChanged(prefBranch, NS_ConvertUTF16toUTF8(data).get());
-    } else if (!strcmp(topic, "profile-change-net-teardown") ||
-               !strcmp(topic, NS_XPCOM_SHUTDOWN_OBSERVER_ID) ) {
-
-        mHandlerActive = false;
-
-        // clear cache of all authentication credentials.
-        mAuthCache.ClearAll();
-        mPrivateAuthCache.ClearAll();
-        if (mWifiTickler)
-            mWifiTickler->Cancel();
-
-        // Inform nsIOService that network is tearing down.
-        gIOService->SetHttpHandlerAlreadyShutingDown();
-
-        ShutdownConnectionManager();
-
-        // need to reset the session start time since cache validation may
-        // depend on this value.
-        mSessionStartTime = NowInSeconds();
-
-        if (!mDoNotTrackEnabled) {
-            Telemetry::Accumulate(Telemetry::DNT_USAGE, 2);
-        } else {
-            Telemetry::Accumulate(Telemetry::DNT_USAGE, 1);
-        }
-    } else if (!strcmp(topic, "profile-change-net-restore")) {
-        // initialize connection manager
-        InitConnectionMgr();
-    } else if (!strcmp(topic, "net:clear-active-logins")) {
-        mAuthCache.ClearAll();
-        mPrivateAuthCache.ClearAll();
-    } else if (!strcmp(topic, "net:prune-dead-connections")) {
-        if (mConnMgr) {
-            mConnMgr->PruneDeadConnections();
-        }
-    } else if (!strcmp(topic, "net:prune-all-connections")) {
-        if (mConnMgr) {
-            mConnMgr->DoShiftReloadConnectionCleanup(nullptr);
-            mConnMgr->PruneDeadConnections();
-        }
-    } else if (!strcmp(topic, "net:failed-to-process-uri-content")) {
-        nsCOMPtr<nsIURI> uri = do_QueryInterface(subject);
-        if (uri && mConnMgr) {
-            mConnMgr->ReportFailedToProcess(uri);
-        }
-    } else if (!strcmp(topic, "last-pb-context-exited")) {
-        mPrivateAuthCache.ClearAll();
-        if (mConnMgr) {
-            mConnMgr->ClearAltServiceMappings();
-        }
-    } else if (!strcmp(topic, "webapps-clear-data")) {
-        if (mConnMgr) {
-            mConnMgr->ClearAltServiceMappings();
-        }
-    } else if (!strcmp(topic, "browser:purge-session-history")) {
-        if (mConnMgr) {
-            if (gSocketTransportService) {
-                nsCOMPtr<nsIRunnable> event =
-                    NS_NewRunnableMethod(mConnMgr,
-                                         &nsHttpConnectionMgr::ClearConnectionHistory);
-                gSocketTransportService->Dispatch(event, NS_DISPATCH_NORMAL);
-            }
-            mConnMgr->ClearAltServiceMappings();
-        }
-    } else if (!strcmp(topic, NS_NETWORK_LINK_TOPIC)) {
-        nsAutoCString converted = NS_ConvertUTF16toUTF8(data);
-        if (!strcmp(converted.get(), NS_NETWORK_LINK_DATA_CHANGED)) {
-            if (mConnMgr) {
-                mConnMgr->PruneDeadConnections();
-                mConnMgr->VerifyTraffic();
-            }
-        }
-    } else if (!strcmp(topic, "application-background")) {
-        // going to the background on android means we should close
-        // down idle connections for power conservation
-        if (mConnMgr) {
-            mConnMgr->DoShiftReloadConnectionCleanup(nullptr);
-        }
-    }
-
-    return NS_OK;
-}
-
-// nsISpeculativeConnect
-
-nsresult
-nsHttpHandler::SpeculativeConnectInternal(nsIURI *aURI,
-                                          nsIInterfaceRequestor *aCallbacks,
-                                          bool anonymous)
-{
-    if (IsNeckoChild()) {
-        ipc::URIParams params;
-        SerializeURI(aURI, params);
-        gNeckoChild->SendSpeculativeConnect(params, anonymous);
-        return NS_OK;
-    }
-
-    if (!mHandlerActive)
-        return NS_OK;
-
-    MOZ_ASSERT(NS_IsMainThread());
-    nsCOMPtr<nsIObserverService> obsService = services::GetObserverService();
-    if (mDebugObservations && obsService) {
-        // this is basically used for test coverage of an otherwise 'hintable' feature
-        nsAutoCString spec;
-        aURI->GetSpec(spec);
-        spec.Append(anonymous ? NS_LITERAL_CSTRING("[A]") : NS_LITERAL_CSTRING("[.]"));
-        obsService->NotifyObservers(nullptr,
-                                    "speculative-connect-request",
-                                    NS_ConvertUTF8toUTF16(spec).get());
-    }
-
-    nsISiteSecurityService* sss = gHttpHandler->GetSSService();
-    bool isStsHost = false;
-    if (!sss)
-        return NS_OK;
-
-    nsCOMPtr<nsILoadContext> loadContext = do_GetInterface(aCallbacks);
-    uint32_t flags = 0;
-    if (loadContext && loadContext->UsePrivateBrowsing())
-        flags |= nsISocketProvider::NO_PERMANENT_STORAGE;
-    nsCOMPtr<nsIURI> clone;
-    if (NS_SUCCEEDED(sss->IsSecureURI(nsISiteSecurityService::HEADER_HSTS,
-                                      aURI, flags, &isStsHost)) && isStsHost) {
-        if (NS_SUCCEEDED(aURI->Clone(getter_AddRefs(clone)))) {
-            clone->SetScheme(NS_LITERAL_CSTRING("https"));
-            aURI = clone.get();
-        }
-    }
-
-    nsAutoCString scheme;
-    nsresult rv = aURI->GetScheme(scheme);
-    if (NS_FAILED(rv))
-        return rv;
-
-    // If this is HTTPS, make sure PSM is initialized as the channel
-    // creation path may have been bypassed
-    if (scheme.EqualsLiteral("https")) {
-        if (!IsNeckoChild()) {
-            // make sure PSM gets initialized on the main thread.
-            net_EnsurePSMInit();
-        }
-    }
-    // Ensure that this is HTTP or HTTPS, otherwise we don't do preconnect here
-    else if (!scheme.EqualsLiteral("http"))
-        return NS_ERROR_UNEXPECTED;
-
-    // Construct connection info object
-    bool usingSSL = false;
-    rv = aURI->SchemeIs("https", &usingSSL);
-    if (NS_FAILED(rv))
-        return rv;
-
-    nsAutoCString host;
-    rv = aURI->GetAsciiHost(host);
-    if (NS_FAILED(rv))
-        return rv;
-
-    int32_t port = -1;
-    rv = aURI->GetPort(&port);
-    if (NS_FAILED(rv))
-        return rv;
-
-    nsAutoCString username;
-    aURI->GetUsername(username);
-
-    nsHttpConnectionInfo *ci =
-        new nsHttpConnectionInfo(host, port, EmptyCString(), username, nullptr, usingSSL);
-    ci->SetAnonymous(anonymous);
-
-    return SpeculativeConnect(ci, aCallbacks);
-}
-
-NS_IMETHODIMP
-nsHttpHandler::SpeculativeConnect(nsIURI *aURI,
-                                  nsIInterfaceRequestor *aCallbacks)
-{
-    return SpeculativeConnectInternal(aURI, aCallbacks, false);
-}
-
-NS_IMETHODIMP
-nsHttpHandler::SpeculativeAnonymousConnect(nsIURI *aURI,
-                                           nsIInterfaceRequestor *aCallbacks)
-{
-    return SpeculativeConnectInternal(aURI, aCallbacks, true);
-}
-
-void
-nsHttpHandler::TickleWifi(nsIInterfaceRequestor *cb)
-{
-    if (!cb || !mWifiTickler)
-        return;
-
-    // If B2G requires a similar mechanism nsINetworkManager, currently only avail
-    // on B2G, contains the necessary information on wifi and gateway
-
-    nsCOMPtr<nsIDOMWindow> domWindow = do_GetInterface(cb);
-    nsCOMPtr<nsPIDOMWindow> piWindow = do_QueryInterface(domWindow);
-    if (!piWindow)
-        return;
-
-    nsCOMPtr<nsIDOMNavigator> domNavigator = piWindow->GetNavigator();
-    nsCOMPtr<nsIMozNavigatorNetwork> networkNavigator =
-        do_QueryInterface(domNavigator);
-    if (!networkNavigator)
-        return;
-
-    nsCOMPtr<nsINetworkProperties> networkProperties;
-    networkNavigator->GetProperties(getter_AddRefs(networkProperties));
-    if (!networkProperties)
-        return;
-
-    uint32_t gwAddress;
-    bool isWifi;
-    nsresult rv;
-
-    rv = networkProperties->GetDhcpGateway(&gwAddress);
-    if (NS_SUCCEEDED(rv))
-        rv = networkProperties->GetIsWifi(&isWifi);
-    if (NS_FAILED(rv))
-        return;
-
-    if (!gwAddress || !isWifi)
-        return;
-
-    mWifiTickler->SetIPV4Address(gwAddress);
-    mWifiTickler->Tickle();
-}
-
-//-----------------------------------------------------------------------------
-// nsHttpsHandler implementation
-//-----------------------------------------------------------------------------
-
-NS_IMPL_ISUPPORTS(nsHttpsHandler,
-                  nsIHttpProtocolHandler,
-                  nsIProxiedProtocolHandler,
-                  nsIProtocolHandler,
-                  nsISupportsWeakReference,
-                  nsISpeculativeConnect)
-
-nsresult
-nsHttpsHandler::Init()
-{
-    nsCOMPtr<nsIProtocolHandler> httpHandler(
-            do_GetService(NS_NETWORK_PROTOCOL_CONTRACTID_PREFIX "http"));
-    MOZ_ASSERT(httpHandler.get() != nullptr);
-    return NS_OK;
-}
-
-NS_IMETHODIMP
-nsHttpsHandler::GetScheme(nsACString &aScheme)
-{
-    aScheme.AssignLiteral("https");
-    return NS_OK;
-}
-
-NS_IMETHODIMP
-nsHttpsHandler::GetDefaultPort(int32_t *aPort)
-{
-    *aPort = NS_HTTPS_DEFAULT_PORT;
-    return NS_OK;
-}
-
-NS_IMETHODIMP
-nsHttpsHandler::GetProtocolFlags(uint32_t *aProtocolFlags)
-{
-    *aProtocolFlags = NS_HTTP_PROTOCOL_FLAGS | URI_SAFE_TO_LOAD_IN_SECURE_CONTEXT;
-    return NS_OK;
-}
-
-NS_IMETHODIMP
-nsHttpsHandler::NewURI(const nsACString &aSpec,
-                       const char *aOriginCharset,
-                       nsIURI *aBaseURI,
-                       nsIURI **_retval)
-{
-    return mozilla::net::NewURI(aSpec, aOriginCharset, aBaseURI, NS_HTTPS_DEFAULT_PORT, _retval);
-}
-
-NS_IMETHODIMP
-nsHttpsHandler::NewChannel2(nsIURI* aURI,
-                            nsILoadInfo* aLoadInfo,
-                            nsIChannel** _retval)
-{
-    MOZ_ASSERT(gHttpHandler);
-    if (!gHttpHandler)
-      return NS_ERROR_UNEXPECTED;
-    return gHttpHandler->NewChannel2(aURI, aLoadInfo, _retval);
-}
-
-NS_IMETHODIMP
-nsHttpsHandler::NewChannel(nsIURI *aURI, nsIChannel **_retval)
-{
-    return NewChannel2(aURI, nullptr, _retval);
-}
-
-NS_IMETHODIMP
-nsHttpsHandler::AllowPort(int32_t aPort, const char *aScheme, bool *_retval)
-{
-    // don't override anything.
-    *_retval = false;
-    return NS_OK;
-}
-
-void
-nsHttpHandler::ShutdownConnectionManager()
-{
-    // ensure connection manager is shutdown
-    if (mConnMgr) {
-        mConnMgr->Shutdown();
-    }
-}
-
-} // namespace net
-} // namespace mozilla
diff --git a/toolkit/components/maintenanceservice/bootstrapinstaller/maintenanceservice_installer.nsi b/toolkit/components/maintenanceservice/bootstrapinstaller/maintenanceservice_installer.nsi
index 9e831dc..49ad028 100755
--- a/toolkit/components/maintenanceservice/bootstrapinstaller/maintenanceservice_installer.nsi
+++ b/toolkit/components/maintenanceservice/bootstrapinstaller/maintenanceservice_installer.nsi
@@ -133,7 +133,7 @@ Function un.onInit
 ; The commands inside this ifndef are needed prior to NSIS 3.0a2 and can be
 ; removed after we require NSIS 3.0a2 or greater.
 !ifndef NSIS_PACKEDVERSION
-  ${If} ${AtLeastWinVista}
+  ${If} ${AtLeastWinXP}
     System::Call 'user32::SetProcessDPIAware()'
   ${EndIf}
 !endif
diff --git a/toolkit/mozapps/installer/windows/nsis/common.nsh b/toolkit/mozapps/installer/windows/nsis/common.nsh
index 6950c2b..f322787 100755
--- a/toolkit/mozapps/installer/windows/nsis/common.nsh
+++ b/toolkit/mozapps/installer/windows/nsis/common.nsh
@@ -3718,7 +3718,7 @@
       Push $R5
       Push $R4
 
-      ${If} ${AtLeastWin7}
+      ${If} ${AtLeastWinXP}
         ; Since shortcuts that are pinned can later be removed without removing
         ; the pinned shortcut unpin the pinned shortcuts for the application's
         ; main exe using the pinned shortcuts themselves.
@@ -5099,7 +5099,7 @@
 
       !ifdef HAVE_64BIT_BUILD
         ${Unless} ${RunningX64}
-        ${OrUnless} ${AtLeastWin7}
+        ${OrUnless} ${AtLeastWinXP}
           MessageBox MB_OK|MB_ICONSTOP "$R9" IDOK
           ; Nothing initialized so no need to call OnEndCommon
           Quit
@@ -5853,7 +5853,7 @@
       Push $0
 
 !ifndef NONADMIN_ELEVATE
-        ${If} ${AtLeastWinVista}
+        ${If} ${AtLeastWinXP}
           UAC::IsAdmin
           ; If the user is not an admin already
           ${If} "$0" != "1"
@@ -5884,7 +5884,7 @@
           ${EndIf}
         ${EndIf}
 !else
-      ${If} ${AtLeastWinVista}
+      ${If} ${AtLeastWinXP}
         UAC::IsAdmin
         ; If the user is not an admin already
         ${If} "$0" != "1"
@@ -5997,7 +5997,7 @@
     !define ${_MOZFUNC_UN}UnloadUAC "!insertmacro ${_MOZFUNC_UN}UnloadUACCall"
 
     Function ${_MOZFUNC_UN}UnloadUAC
-      ${Unless} ${AtLeastWinVista}
+      ${Unless} ${AtLeastWinXP}
         Return
       ${EndUnless}
 
@@ -6650,7 +6650,7 @@
     !define ${_MOZFUNC_UN}SetAppLSPCategories "!insertmacro ${_MOZFUNC_UN}SetAppLSPCategoriesCall"
 
     Function ${_MOZFUNC_UN}SetAppLSPCategories
-      ${Unless} ${AtLeastWinVista}
+      ${Unless} ${AtLeastWinXP}
         Return
       ${EndUnless}
 
@@ -6763,7 +6763,7 @@
 
       StrCpy $R5 "false"
 
-      ${If} ${AtLeastWin7}
+      ${If} ${AtLeastWinXP}
       ${AndIf} ${FileExists} "$QUICKLAUNCH\User Pinned\TaskBar"
         FindFirst $R8 $R7 "$QUICKLAUNCH\User Pinned\TaskBar\*.lnk"
         ${Do}
@@ -6843,7 +6843,7 @@
 
       StrCpy $R5 "false"
 
-      ${If} ${AtLeastWin7}
+      ${If} ${AtLeastWinXP}
       ${AndIf} ${FileExists} "$QUICKLAUNCH\User Pinned\StartMenu"
         FindFirst $R8 $R7 "$QUICKLAUNCH\User Pinned\StartMenu\*.lnk"
         ${Do}
@@ -6915,7 +6915,7 @@
 
       StrCpy $R9 0
 
-      ${If} ${AtLeastWin7}
+      ${If} ${AtLeastWinXP}
       ${AndIf} ${FileExists} "$QUICKLAUNCH\User Pinned\TaskBar"
         FindFirst $R8 $R7 "$QUICKLAUNCH\User Pinned\TaskBar\*.lnk"
         ${Do}
@@ -6976,7 +6976,7 @@
 
       StrCpy $R9 0
 
-      ${If} ${AtLeastWin7}
+      ${If} ${AtLeastWinXP}
       ${AndIf} ${FileExists} "$QUICKLAUNCH\User Pinned\StartMenu"
         FindFirst $R8 $R7 "$QUICKLAUNCH\User Pinned\StartMenu\*.lnk"
         ${Do}
@@ -7057,7 +7057,7 @@
 
       StrCpy $R3 "false"
 
-      ${If} ${AtLeastWin7}
+      ${If} ${AtLeastWinXP}
         ; installed shortcuts
         ${${_MOZFUNC_UN}GetLongPath} "$INSTDIR\uninstall\${SHORTCUTS_LOG}" $R6
         ${If} ${FileExists} "$R6"
@@ -7288,7 +7288,7 @@
       Exch $R8 ; stack: $R8, $R9   | $R8 = regpath
       Push $R7
 
-      ${If} ${AtLeastWin7}
+      ${If} ${AtLeastWinXP}
         ${${_MOZFUNC_UN}GetLongPath} "$R9" $R9
         ; Always create a new AppUserModelID and overwrite the existing one
         ; for the current installation path.
@@ -7391,7 +7391,7 @@
       ; Don't create when running silently.
       ${Unless} ${Silent}
         ; This is only supported on Win 7 and above.
-        ${If} ${AtLeastWin7}
+        ${If} ${AtLeastWinXP}
           System::Call "ole32::CoCreateInstance(g '${CLSID_ITaskbarList}', \
                                                 i 0, \
                                                 i ${CLSCTX_INPROC_SERVER}, \

