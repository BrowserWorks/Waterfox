<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>Bug 1300461</title>
  </head>
  <!-- The empty unload handler is to prevent bfcache. -->
  <body onload="test();" onunload="">
    <script>
      let Ci = SpecialPowers.Ci;
      let webNav = SpecialPowers.wrap(window)
                     .QueryInterface(Ci.nsIInterfaceRequestor)
                     .getInterface(Ci.nsIWebNavigation);
      let shistory = webNav.sessionHistory;
      function test() {
        if (opener) {
          opener.info("file_bug1300461_back.html");
          opener.is(shistory.count, 2, 'check history length');
          opener.is(shistory.index, 1, 'check history index');
          opener.is(shistory.requestedIndex, -1, 'check requestedIndex');
          opener.ok(webNav.canGoBack, 'check canGoBack');
          if (opener.testCount == 1) {
            opener.info('replaceState to redirect.html');
            window.history.replaceState({}, '', 'file_bug1300461_redirect.html');
          }
          window.history.back();
        }
      }
    </script>
  </body>
</html>
